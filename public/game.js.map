{
  "version": 3,
  "sources": ["../src/game/seed.ts", "../src/entities/enemy.ts", "../src/entities/item.ts", "../src/entities/itemDatabase.ts", "../src/dungeon/Interactable.ts", "../src/events/mysteriousEvent.ts", "../src/puzzles/puzzle.ts", "../src/dungeon/room.ts", "../src/entities/player.ts", "../src/entities/fighter.ts", "../src/integration/dungeonGenerator.ts", "../src/entities/warlock.ts", "../src/game/managers/InventoryManager.ts", "../src/game/managers/ShopManager.ts", "../src/game/managers/InteractionManager.ts", "../src/game/managers/PuzzleManager.ts", "../src/game/managers/EventManager.ts", "../src/game/gameState.ts", "../src/game/combatEngine.ts", "../src/game/gameLoop.ts", "../src/ui/imageAssets.ts", "../src/ui/WebGameLoop.ts", "../src/ui/webEntry.ts"],
  "sourcesContent": ["/**\n * @fileoverview Seeded Random Number Generator for Dungeon Roguelike\n * \n * This module provides deterministic random number generation using a\n * Mulberry32-variant algorithm. Using seeds allows for reproducible\n * dungeon generation and game runs.\n * \n * @module game/seed\n */\n\n// Re-export DungeonLayer from types for backwards compatibility\nexport type { DungeonLayer } from '../types/dungeon';\n\n/**\n * Seeded random number generator using a variant of the Mulberry32 algorithm.\n * Provides deterministic random numbers for reproducible game runs.\n * \n * @example\n * ```typescript\n * const rng = new Seed('my-game-seed');\n * const roll = rng.nextInt(1, 20); // Always same result for same seed\n * const item = rng.choice(['sword', 'shield', 'potion']);\n * ```\n */\nexport class Seed {\n    /** Internal seed state (32-bit integer) */\n    private seed: number\n\n    /**\n     * Creates a new seeded RNG instance.\n     * \n     * @param seed - Either a string (will be hashed) or a number to use as the seed\n     */\n    constructor(seed: string | number) {\n        if (typeof seed === 'string') {\n            this.seed = this.hashString(seed);\n        } else {\n            this.seed = seed;\n        }\n    }\n\n    /**\n     * Hashes a string into a 32-bit integer for use as a seed.\n     * Uses a simple but effective hash algorithm.\n     * \n     * @param str - The string to hash\n     * @returns A positive 32-bit integer hash\n     * @private\n     */\n    private hashString(str: string): number {\n        let hash = 0\n        for (let i = 0; i < str.length; i++) {\n            const char = str.charCodeAt(i)\n            hash = ((hash << 5) - hash) + char\n            hash = hash & hash\n        }\n        return Math.abs(hash)\n    }\n\n    /**\n     * Generates the next raw 32-bit unsigned integer in the sequence.\n     * This is the core RNG function using Mulberry32 algorithm.\n     * \n     * @returns A 32-bit unsigned integer (0 to 4294967295)\n     */\n    next(): number {\n        let t = this.seed += 0x6D2B79F5;\n        t = Math.imul(t ^ (t >>> 15), t | 1)\n        t ^= t + Math.imul(t ^ (t >>> 7), t | 61)\n        return (t ^ (t >>> 14)) >>> 0\n    }\n\n    /**\n     * Generates a random float between 0 (inclusive) and 1 (exclusive).\n     * \n     * @returns A float in the range [0, 1)\n     */\n    nextFloat(): number {\n        return this.next() / 0xFFFFFFFF;\n    }\n\n    /**\n     * Generates a random integer within a range (inclusive on both ends).\n     * \n     * @param min - Minimum value (inclusive)\n     * @param max - Maximum value (inclusive)\n     * @returns An integer in the range [min, max]\n     * \n     * @example\n     * ```typescript\n     * const d20 = rng.nextInt(1, 20); // Roll a d20\n     * const damage = rng.nextInt(5, 10); // 5-10 damage\n     * ```\n     */\n    nextInt(min: number, max: number): number {\n        return Math.floor(this.nextFloat() * (max - min + 1)) + min\n    }\n\n    /**\n     * Selects a random element from an array.\n     * \n     * @param array - The array to select from\n     * @returns A randomly selected element\n     * @template T - The type of elements in the array\n     * \n     * @example\n     * ```typescript\n     * const enemy = rng.choice(['goblin', 'orc', 'troll']);\n     * ```\n     */\n    choice<T>(array: T[]): T {\n        return array[this.nextInt(0, array.length - 1)]\n    }\n\n    /**\n     * Shuffles an array in place using the Fisher-Yates algorithm.\n     * \n     * @param array - The array to shuffle (modified in place)\n     * @returns The same array, now shuffled\n     * @template T - The type of elements in the array\n     * \n     * @example\n     * ```typescript\n     * const deck = ['A', 'B', 'C', 'D'];\n     * rng.shuffle(deck); // deck is now randomly ordered\n     * ```\n     */\n    shuffle<T>(array: T[]): T[] {\n        for (let i = array.length - 1; i > 0; i--) {\n            const j = this.nextInt(0, i);\n            [array[i], array[j]] = [array[j], array[i]];\n        }\n        return array;\n    }\n\n    /**\n     * Returns true with the given probability.\n     * \n     * @param probability - Probability of returning true (0 to 1)\n     * @returns true with the specified probability\n     * \n     * @example\n     * ```typescript\n     * if (rng.chance(0.3)) {\n     *   // 30% chance to execute\n     * }\n     * ```\n     */\n    chance(probability: number): boolean {\n        return this.nextFloat() < probability;\n    }\n\n    /**\n     * Returns true with the given percentage chance.\n     * \n     * @param percent - Percentage chance of returning true (0 to 100)\n     * @returns true with the specified percentage chance\n     * \n     * @example\n     * ```typescript\n     * if (rng.percentChance(15)) {\n     *   // 15% critical hit chance\n     * }\n     * ```\n     */\n    percentChance(percent: number): boolean {\n        return this.nextFloat() * 100 < percent;\n    }\n}\n\n/**\n * Global RNG instance for the game.\n * Initialize with initializeRNG() before use.\n * @private\n */\nlet globalRNG: Seed | null = null;\n\n/**\n * Initializes the global RNG with a seed string.\n * Call this once at game start before any random operations.\n * \n * @param seed - The seed string for reproducible generation\n * @returns The initialized Seed instance\n * \n * @example\n * ```typescript\n * initializeRNG('my-dungeon-seed-123');\n * // Now all calls to getRNG() will use this seed\n * ```\n */\nexport function initializeRNG(seed: string): Seed {\n    globalRNG = new Seed(seed);\n    return globalRNG;\n}\n\n/**\n * Gets the global RNG instance.\n * \n * @returns The global Seed instance\n * @throws Error if RNG hasn't been initialized with initializeRNG()\n */\nexport function getRNG(): Seed {\n    if (!globalRNG) {\n        throw new Error('RNG not initialized. Call initializeRNG() first.');\n    }\n    return globalRNG;\n}\n\n/**\n * Checks if the global RNG has been initialized.\n * Useful for fallback logic when RNG might not be available.\n * \n * @returns true if initializeRNG() has been called\n */\nexport function isRNGInitialized(): boolean {\n    return globalRNG !== null;\n}\n\n/**\n * Generates a random alphanumeric string of the specified length.\n * Uses the global RNG if initialized, otherwise uses Math.random().\n * \n * @param length - The length of the string to generate\n * @returns A random string containing lowercase letters, numbers, underscores, and hyphens\n * \n * @example\n * ```typescript\n * const sessionId = generateRandomString(16); // e.g., 'a3b_k9-x2m4n7p1'\n * ```\n */\nexport function generateRandomString(length: number): string {\n    const characters = 'abcdefghijklmnopqrstuvwxyz0123456789_-'.split('');\n    if (isRNGInitialized()) {\n        return Array.from({ length }, () => getRNG().choice(characters)).join('');\n    }\n    // Fallback to Math.random() if RNG not initialized\n    return Array.from({ length }, () => \n        characters[Math.floor(Math.random() * characters.length)]\n    ).join('');\n}\n", "/**\n * @fileoverview Enemy Entity System for Dungeon Roguelike\n * \n * This module defines the Enemy interface and MonsterAPI service for\n * fetching enemy data from the D&D 5e API. Enemies are the hostile\n * entities that players encounter in combat rooms.\n * \n * The MonsterAPI provides:\n * - Fetching individual monsters by name\n * - Fetching monsters by challenge rating (CR)\n * - Automatic caching to reduce API calls\n * - Rate limiting to avoid 429 errors\n * - Level-appropriate monster selection for dungeon rooms\n * \n * @see https://www.dnd5eapi.co/docs\n * @module entities/enemy\n */\n\nimport { getRNG, isRNGInitialized } from '../game/seed';\n\n/**\n * Enemy category/type for classification.\n * Based on D&D 5e creature types.\n * @enum {string}\n */\nexport enum EnemyType {\n    /** Alien beings from the Far Realm */\n    ABERRATION = 'aberration',\n    /** Natural animals and creatures */\n    BEAST = 'beast',\n    /** Divine beings from the Upper Planes */\n    CELESTIAL = 'celestial',\n    /** Magically animated objects */\n    CONSTRUCT = 'construct',\n    /** Powerful reptilian creatures */\n    DRAGON = 'dragon',\n    /** Beings from the Elemental Planes */\n    ELEMENTAL = 'elemental',\n    /** Magical creatures from the Feywild */\n    FEY = 'fey',\n    /** Evil beings from the Lower Planes */\n    FIEND = 'fiend',\n    /** Massive humanoid creatures */\n    GIANT = 'giant',\n    /** Human-like creatures */\n    HUMANOID = 'humanoid',\n    /** Unnatural creatures, often magical hybrids */\n    MONSTROSITY = 'monstrosity',\n    /** Amorphous creatures */\n    OOZE = 'ooze',\n    /** Animated plant creatures */\n    PLANT = 'plant',\n    /** Creatures animated by dark magic */\n    UNDEAD = 'undead'\n}\n\n/**\n * Represents an enemy entity with combat statistics.\n * @interface\n */\nexport interface Enemy {\n    /** Unique identifier for the enemy instance */\n    id: string;\n    /** Display name of the enemy */\n    name: string;\n    /** Current health points */\n    health: number;\n    /** Maximum health points */\n    maxHealth: number;\n    /** Base attack power value (attack bonus) */\n    attackPower: number;\n    /** Defense/armor class value */\n    defense: number;\n    /** Experience points awarded upon defeat */\n    experience: number;\n    /** Challenge rating indicating difficulty (D&D CR scale) */\n    challengeRating: number;\n    /** Enemy classification type */\n    type: EnemyType;\n    /** Initiative/speed modifier for turn order */\n    speed: number;\n    /** URL to the monster's image (from D&D 5e API) */\n    imageUrl?: string;\n}\n\n/**\n * Response structure from the D&D 5e API for armor class.\n * @interface\n * @private\n */\ninterface APIArmorClass {\n    type: string;\n    value: number;\n}\n\n/**\n * Response structure from the D&D 5e API for monsters.\n * @interface\n * @private\n */\ninterface MonsterAPIResponse {\n    index: string;\n    name: string;\n    hit_points: number;\n    armor_class: APIArmorClass[];\n    challenge_rating: number;\n    xp: number;\n    type: string;\n    speed: {\n        walk?: string;\n        fly?: string;\n        swim?: string;\n    };\n    actions?: Array<{\n        name: string;\n        attack_bonus?: number;\n    }>;\n    /** Path to monster image (relative to API base) */\n    image?: string;\n}\n\n/**\n * Response structure for monster list queries.\n * @interface\n * @private\n */\ninterface MonsterListResponse {\n    count: number;\n    results: Array<{\n        index: string;\n        name: string;\n        url: string;\n    }>;\n}\n\n/**\n * Error thrown when monster API operations fail.\n * Includes additional context about the failure.\n */\nexport class MonsterAPIError extends Error {\n    /**\n     * Creates a new Error.\n     * \n     * @param message - Error description\n     * @param statusCode - HTTP status code (if applicable)\n     * @param monsterName - Name of the monster that failed (if applicable)\n     */\n    constructor(\n        message: string,\n        public readonly statusCode?: number,\n        public readonly monsterName?: string\n    ) {\n        super(message);\n        this.name = 'MonsterAPIError';\n    }\n}\n\n/**\n * Delay utility for rate limiting.\n * \n * @param ms - Milliseconds to delay\n * @returns Promise that resolves after the delay\n * @private\n */\nfunction delay(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * Service for fetching enemy data from the D&D 5e API.\n * \n * Implements caching and rate limiting to avoid 429 errors.\n * All methods are static - no instantiation required.\n * \n * **Caching:**\n * - Individual monsters are cached by index name\n * - CR-based queries are cached by CR value\n * - Use clearCache() to free memory after dungeon generation\n * \n * **Rate Limiting:**\n * - 100ms delay between API requests\n * - Cached requests skip the delay\n * \n * @see https://www.dnd5eapi.co/docs\n * \n * @example\n * ```typescript\n * // Get a specific monster\n * const goblin = await MonsterAPI.getMonsterByName('goblin');\n * \n * // Get monsters for a dungeon level\n * const enemies = await MonsterAPI.getMonstersForLevel(5, 3);\n * \n * // Clear cache when done\n * MonsterAPI.clearCache();\n * ```\n */\nexport class MonsterAPI {\n    /** Base URL for the D&D 5e API monsters endpoint */\n    private static readonly BASE_URL = 'https://www.dnd5eapi.co/api/2014/monsters';\n    \n    /** Delay between API requests in milliseconds */\n    private static readonly REQUEST_DELAY_MS = 100;\n    \n    /** In-memory cache for monster data (keyed by monster index) */\n    private static monsterCache: Map<string, Enemy> = new Map();\n    \n    /** In-memory cache for monsters by CR (keyed by CR value) */\n    private static crCache: Map<number, Enemy[]> = new Map();\n    \n    /** In-memory cache for monster name lists by CR (lightweight, just indexes) */\n    private static crNameListCache: Map<number, string[]> = new Map();\n\n    /**\n     * Clears all cached monster data.\n     * Useful for testing or freeing memory after dungeon generation.\n     */\n    static clearCache(): void {\n        this.monsterCache.clear();\n        this.crCache.clear();\n        this.crNameListCache.clear();\n    }\n\n    /**\n     * Fetches a monster by its index/name from the D&D 5e API.\n     * Uses cache to avoid redundant API calls.\n     * \n     * @param name - The monster's index name (e.g., 'goblin', 'adult-red-dragon')\n     * @returns A promise that resolves to an Enemy object\n     * @throws {MonsterAPIError} If the fetch fails or the monster is not found\n     * \n     * @example\n     * ```typescript\n     * const dragon = await MonsterAPI.getMonsterByName('adult-red-dragon');\n     * console.log(dragon.health, dragon.attackPower);\n     * ```\n     */\n    static async getMonsterByName(name: string): Promise<Enemy> {\n        const normalizedName = name.toLowerCase().replace(/\\s+/g, '-');\n        \n        // Check cache first\n        const cached = this.monsterCache.get(normalizedName);\n        if (cached) {\n            return cached;\n        }\n        \n        let response: Response;\n        try {\n            response = await fetch(`${this.BASE_URL}/${normalizedName}`);\n        } catch (error) {\n            throw new MonsterAPIError(\n                `Network error fetching monster: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                undefined,\n                name\n            );\n        }\n\n        if (!response.ok) {\n            throw new MonsterAPIError(\n                `Monster '${name}' not found or API error`,\n                response.status,\n                name\n            );\n        }\n\n        let data: MonsterAPIResponse;\n        try {\n            data = await response.json() as MonsterAPIResponse;\n        } catch {\n            throw new MonsterAPIError(\n                'Failed to parse API response',\n                response.status,\n                name\n            );\n        }\n\n        const enemy = this.mapToEnemy(data);\n        \n        // Store in cache\n        this.monsterCache.set(normalizedName, enemy);\n        \n        return enemy;\n    }\n\n    /** Base URL for the D&D 5e API (for constructing image URLs) */\n    private static readonly API_BASE = 'https://www.dnd5eapi.co';\n\n    /**\n     * Maps the D&D 5e API response to our Enemy interface.\n     * \n     * @param data - The raw API response\n     * @returns A properly structured Enemy object\n     * @private\n     */\n    private static mapToEnemy(data: MonsterAPIResponse): Enemy {\n        // Extract the first armor class value (most monsters have one)\n        const defense = data.armor_class?.[0]?.value ?? 10;\n\n        // Extract attack bonus from first action with an attack, or default to 0\n        const attackPower = data.actions?.find(a => a.attack_bonus !== undefined)?.attack_bonus ?? 0;\n\n        // Parse speed from walk speed string (e.g., \"30 ft.\" -> 30)\n        const speedString = data.speed?.walk ?? '30 ft.';\n        const speed = parseInt(speedString, 10) || 30;\n\n        // Map API type string to our EnemyType enum\n        const type = this.mapEnemyType(data.type);\n\n        // Construct full image URL if image path is provided\n        const imageUrl = data.image ? `${this.API_BASE}${data.image}` : undefined;\n\n        return {\n            id: data.index,\n            name: data.name,\n            health: data.hit_points,\n            maxHealth: data.hit_points,\n            attackPower,\n            defense,\n            experience: data.xp ?? 0,\n            challengeRating: data.challenge_rating ?? 0,\n            type,\n            speed,\n            imageUrl\n        };\n    }\n\n    /**\n     * Maps a D&D 5e API type string to our EnemyType enum.\n     * \n     * @param apiType - The type string from the API\n     * @returns The corresponding EnemyType enum value\n     * @private\n     */\n    private static mapEnemyType(apiType: string): EnemyType {\n        const typeMap: Record<string, EnemyType> = {\n            'aberration': EnemyType.ABERRATION,\n            'beast': EnemyType.BEAST,\n            'celestial': EnemyType.CELESTIAL,\n            'construct': EnemyType.CONSTRUCT,\n            'dragon': EnemyType.DRAGON,\n            'elemental': EnemyType.ELEMENTAL,\n            'fey': EnemyType.FEY,\n            'fiend': EnemyType.FIEND,\n            'giant': EnemyType.GIANT,\n            'humanoid': EnemyType.HUMANOID,\n            'monstrosity': EnemyType.MONSTROSITY,\n            'ooze': EnemyType.OOZE,\n            'plant': EnemyType.PLANT,\n            'undead': EnemyType.UNDEAD\n        };\n\n        return typeMap[apiType.toLowerCase()] ?? EnemyType.MONSTROSITY;\n    }\n\n    /**\n     * Fetches multiple monsters by their names.\n     * Fetches sequentially with delays to avoid rate limiting.\n     * \n     * @param names - Array of monster index names\n     * @returns A promise that resolves to an array of Enemy objects\n     * @throws {MonsterAPIError} If any fetch fails\n     */\n    static async getMonsters(names: string[]): Promise<Enemy[]> {\n        const enemies: Enemy[] = [];\n        \n        for (const name of names) {\n            const normalizedName = name.toLowerCase().replace(/\\s+/g, '-');\n            \n            // Only delay if not cached\n            if (!this.monsterCache.has(normalizedName)) {\n                await delay(this.REQUEST_DELAY_MS);\n            }\n            \n            const enemy = await this.getMonsterByName(name);\n            enemies.push(enemy);\n        }\n        \n        return enemies;\n    }\n\n    /**\n     * Fetches just the list of monster names/indexes for a challenge rating.\n     * This is a lightweight call that doesn't fetch full monster details.\n     * Uses cache to avoid redundant API calls.\n     * \n     * @param cr - The challenge rating to filter by\n     * @returns A promise that resolves to an array of monster index names\n     * @throws {MonsterAPIError} If the fetch fails\n     * @private\n     */\n    private static async getMonsterNamesByCR(cr: number): Promise<string[]> {\n        // Check name list cache first\n        const cached = this.crNameListCache.get(cr);\n        if (cached) {\n            return cached;\n        }\n        \n        let response: Response;\n        try {\n            await delay(this.REQUEST_DELAY_MS);\n            response = await fetch(`${this.BASE_URL}?challenge_rating=${cr}`);\n        } catch (error) {\n            throw new MonsterAPIError(\n                `Network error fetching monsters by CR: ${error instanceof Error ? error.message : 'Unknown error'}`\n            );\n        }\n\n        if (!response.ok) {\n            throw new MonsterAPIError(\n                `Failed to fetch monsters with CR ${cr}`,\n                response.status\n            );\n        }\n\n        let data: MonsterListResponse;\n        try {\n            data = await response.json() as MonsterListResponse;\n        } catch {\n            throw new MonsterAPIError(\n                'Failed to parse monster list response',\n                response.status\n            );\n        }\n \n        const monsterNames = data.results.map(m => m.index);\n        \n        // Store in name list cache\n        this.crNameListCache.set(cr, monsterNames);\n        \n        return monsterNames;\n    }\n\n    /**\n     * Fetches monsters filtered by challenge rating.\n     * Uses cache to avoid redundant API calls.\n     * Useful for populating rooms based on dungeon level.\n     * \n     * @param cr - The challenge rating to filter by (e.g., 0.25, 0.5, 1, 2, etc.)\n     * @returns A promise that resolves to an array of Enemy objects matching the CR\n     * @throws {MonsterAPIError} If the fetch fails\n     */\n    static async getMonstersByCR(cr: number): Promise<Enemy[]> {\n        // Check CR cache first\n        const cachedCR = this.crCache.get(cr);\n        if (cachedCR) {\n            return cachedCR;\n        }\n        \n        // Get monster names (lightweight call)\n        const monsterNames = await this.getMonsterNamesByCR(cr);\n \n        // Fetch full details for each monster in the list (with rate limiting)\n        const monsters = await this.getMonsters(monsterNames);\n        \n        // Store in CR cache\n        this.crCache.set(cr, monsters);\n        \n        return monsters;\n    }\n\n    /**\n     * Fetches monsters within a challenge rating range.\n     * Fetches sequentially to avoid rate limiting.\n     * Useful for scaling encounters based on dungeon level.\n     * \n     * @param minCR - Minimum challenge rating (inclusive)\n     * @param maxCR - Maximum challenge rating (inclusive)\n     * @returns A promise that resolves to an array of Enemy objects within the CR range\n     * @throws {MonsterAPIError} If the fetch fails\n     */\n    static async getMonstersByCRRange(minCR: number, maxCR: number): Promise<Enemy[]> {\n        // D&D 5e CR values: 0, 0.125, 0.25, 0.5, 1, 2, 3, ... 30\n        const crValues = [0, 0.125, 0.25, 0.5, ...Array.from({ length: 30 }, (_, i) => i + 1)];\n        const validCRs = crValues.filter(cr => cr >= minCR && cr <= maxCR);\n\n        const allMonsters: Enemy[] = [];\n        \n        // Fetch sequentially to avoid rate limiting\n        for (const cr of validCRs) {\n            const monsters = await this.getMonstersByCR(cr);\n            allMonsters.push(...monsters);\n        }\n\n        return allMonsters;\n    }\n\n    /**\n     * Fetches random monsters matching the given challenge rating.\n     * Only fetches full details for the selected monsters (not the entire CR list).\n     * Uses seeded RNG for reproducible results.\n     * \n     * @param cr - The challenge rating to filter by\n     * @param count - Number of monsters to fetch (default: 1)\n     * @returns A promise that resolves to an array of random Enemy objects matching the CR\n     * @throws {MonsterAPIError} If the fetch fails\n     */\n    static async getRandomMonstersByCR(cr: number, count: number = 1): Promise<Enemy[]> {\n        // Get just the monster names (lightweight - no full data fetch)\n        const monsterNames = await this.getMonsterNamesByCR(cr);\n        if (monsterNames.length === 0) {\n            return [];\n        }\n        \n        // Randomly select 'count' monster names\n        const selectedNames: string[] = [];\n        const rng = isRNGInitialized() ? getRNG() : null;\n        \n        for (let i = 0; i < count && monsterNames.length > 0; i++) {\n            const randomIndex = rng \n                ? rng.nextInt(0, monsterNames.length - 1)\n                : Math.floor(Math.random() * monsterNames.length);\n            selectedNames.push(monsterNames[randomIndex]);\n        }\n        \n        // Only fetch full details for the selected monsters\n        const enemies = await this.getMonsters(selectedNames);\n        \n        // Give each enemy a unique instance ID\n        return enemies.map(enemy => ({\n            ...enemy,\n            id: `${enemy.id}-${crypto.randomUUID().slice(0, 8)}`\n        }));\n    }\n\n    /**\n     * Fetches random monsters for a room based on dungeon level.\n     * Maps dungeon level to appropriate challenge ratings.\n     * Uses seeded RNG for reproducible results.\n     * \n     * **Level to CR mapping:**\n     * - Level 1-2: CR 0-0.5 (easy encounters)\n     * - Level 3-4: CR 0.5-2\n     * - Level 5-6: CR 2-4\n     * - Level 7-10: CR 4-7\n     * - Level 11-15: CR 7-12\n     * - Level 16-20: CR 12-20\n     * \n     * @param level - The dungeon level (1-20+)\n     * @param count - Number of enemies to generate (default: 1-3 based on level)\n     * @returns A promise that resolves to an array of Enemy objects appropriate for the level\n     * \n     * @example\n     * ```typescript\n     * // Get 3 enemies for dungeon level 5\n     * const enemies = await MonsterAPI.getMonstersForLevel(5, 3);\n     * ```\n     */\n    static async getMonstersForLevel(level: number, count?: number): Promise<Enemy[]> {\n        // Map dungeon level to CR range\n        const crRanges: Record<number, [number, number]> = {\n            1: [0, 0.5],\n            2: [0.25, 1],\n            3: [0.5, 2],\n            4: [1, 3],\n            5: [2, 4],\n            6: [2, 5],\n            7: [3, 6],\n            8: [4, 7],\n            9: [4, 8],\n            10: [5, 9],\n            11: [6, 10],\n            12: [7, 11],\n            13: [8, 12],\n            14: [9, 13],\n            15: [10, 14],\n            16: [11, 16],\n            17: [12, 17],\n            18: [13, 18],\n            19: [14, 19],\n            20: [15, 20]\n        };\n\n        const clampedLevel = Math.min(Math.max(level, 1), 20);\n        const [minCR, maxCR] = crRanges[clampedLevel];\n\n        const availableMonsters = await this.getMonstersByCRRange(minCR, maxCR);\n        \n        if (availableMonsters.length === 0) {\n            return [];\n        }\n\n        // Determine enemy count if not specified\n        const enemyCount = count ?? Math.min(1 + Math.floor(level / 5), 4);\n\n        // Select random monsters from the available pool using seeded RNG\n        const selected: Enemy[] = [];\n        const rng = isRNGInitialized() ? getRNG() : null;\n        \n        for (let i = 0; i < enemyCount && availableMonsters.length > 0; i++) {\n            const randomIndex = rng \n                ? rng.nextInt(0, availableMonsters.length - 1)\n                : Math.floor(Math.random() * availableMonsters.length);\n            // Create a copy with fresh health values\n            const monster = { ...availableMonsters[randomIndex] };\n            monster.id = `${monster.id}-${crypto.randomUUID().slice(0, 8)}`;\n            selected.push(monster);\n        }\n\n        return selected;\n    }\n}\n", "/**\n * @fileoverview Item System for Dungeon Roguelike\n * \n * This module defines the core item types, interfaces, and utility functions\n * for the game's item system. Items include:\n * - Weapons: Deal damage with various effects\n * - Armor: Provide defense and stat bonuses\n * - Accessories: Rings, amulets, boots with various effects\n * - Consumables: Potions and elixirs for healing/buffs\n * - Treasure: Gold and gems for selling\n * \n * @module entities/item\n */\n\n/**\n * Item types/categories.\n * @enum {string}\n */\nexport enum ItemType {\n    /** Weapons for dealing damage */\n    WEAPON = 'weapon',\n    /** Armor for defense */\n    ARMOR = 'armor',\n    /** Potions, elixirs, and other one-time use items */\n    CONSUMABLE = 'consumable',\n    /** Rings, amulets, boots, and other accessories */\n    ACCESSORY = 'accessory',\n    /** Gold, gems, and other valuables */\n    TREASURE = 'treasure'\n}\n\n/**\n * Equipment slots for equippable items.\n * @enum {string}\n */\nexport enum ItemSlot {\n    /** Weapon slot (main hand) */\n    WEAPON = 'weapon',\n    /** Armor slot (body) */\n    ARMOR = 'armor',\n    /** Accessory slot (ring, amulet, etc.) */\n    ACCESSORY = 'accessory',\n    /** Consumable items (used from inventory) */\n    CONSUMABLE = 'consumable',\n    /** Items that cannot be equipped (treasure) */\n    NONE = 'none'\n}\n\n/**\n * Rarity levels for items.\n * Higher rarity = better stats and effects.\n * @enum {string}\n */\nexport enum ItemRarity {\n    /** Basic items, common drops */\n    COMMON = 'common',\n    /** Better than common, moderate bonuses */\n    UNCOMMON = 'uncommon',\n    /** Good items with notable effects */\n    RARE = 'rare',\n    /** Excellent items with powerful effects */\n    VERY_RARE = 'very_rare',\n    /** Best items in the game */\n    LEGENDARY = 'legendary'\n}\n\n/**\n * Damage types for weapons and abilities.\n * @enum {string}\n */\nexport enum DamageType {\n    /** Generic physical damage */\n    PHYSICAL = 'physical',\n    /** Cutting damage (swords, axes) */\n    SLASHING = 'slashing',\n    /** Stabbing damage (daggers, spears) */\n    PIERCING = 'piercing',\n    /** Impact damage (maces, hammers) */\n    BLUDGEONING = 'bludgeoning',\n    /** Arcane/magical damage */\n    MAGIC = 'magic',\n    /** Fire elemental damage */\n    FIRE = 'fire',\n    /** Cold/ice elemental damage */\n    ICE = 'ice',\n    /** Electric elemental damage */\n    LIGHTNING = 'lightning',\n    /** Toxic damage */\n    POISON = 'poison',\n    /** Dark/death magic damage */\n    NECROTIC = 'necrotic'\n}\n\n/**\n * On-hit effect types that can trigger during attacks.\n * @enum {string}\n */\nexport enum OnHitEffectType {\n    /** Apply poison DOT */\n    POISON = 'poison',\n    /** Apply burning DOT */\n    BURN = 'burn',\n    /** Slow/freeze the target */\n    FREEZE = 'freeze',\n    /** Heal attacker based on damage */\n    LIFESTEAL = 'lifesteal',\n    /** Restore mana based on damage */\n    MANA_STEAL = 'manaSteal',\n    /** Stun the target (skip turn) */\n    STUN = 'stun',\n    /** Apply bleeding DOT */\n    BLEED = 'bleed'\n}\n\n/**\n * Stat bonuses that can be applied by items.\n * All properties are optional - items only define bonuses they provide.\n * @interface\n */\nexport interface StatBonus {\n    /** Bonus to maximum health */\n    maxHealth?: number;\n    /** Bonus to attack power */\n    attack?: number;\n    /** Bonus to defense */\n    defense?: number;\n    /** Bonus to current mana (rare) */\n    mana?: number;\n    /** Bonus to maximum mana */\n    maxMana?: number;\n    /** Bonus to speed/initiative */\n    speed?: number;\n    /** Bonus to critical hit chance (percentage points) */\n    critChance?: number;\n    /** Bonus to critical hit multiplier */\n    critMultiplier?: number;\n}\n\n/**\n * Ability granted by an item when equipped.\n * @interface\n */\nexport interface GrantedAbility {\n    /** Unique identifier */\n    id: string;\n    /** Display name */\n    name: string;\n    /** Description of what the ability does */\n    description: string;\n    /** Mana cost to use */\n    manaCost: number;\n    /** Cooldown in turns */\n    cooldown: number;\n    /** Damage dealt (if applicable) */\n    damage?: number;\n    /** Damage type (if applicable) */\n    damageType?: DamageType;\n    /** Healing provided (if applicable) */\n    healing?: number;\n    /** Special effect type */\n    effect?: string;\n    /** Whether this ability hits all enemies */\n    isAoe?: boolean;\n}\n\n/**\n * On-hit effect that triggers during attacks.\n * @interface\n */\nexport interface OnHitEffect {\n    /** Chance to proc (0-100 percentage) */\n    chance: number;\n    /** Type of effect */\n    type: OnHitEffectType;\n    /** Damage/healing value */\n    value?: number;\n    /** Duration in turns (for DOT/debuff effects) */\n    duration?: number;\n}\n\n/**\n * Weapon damage configuration.\n * @interface\n */\nexport interface WeaponDamage {\n    /** Dice notation (e.g., \"1d8\", \"2d6\") */\n    dice: string;\n    /** Damage type */\n    type: DamageType;\n}\n\n/**\n * Consumable effect configuration.\n * @interface\n */\nexport interface ConsumeEffect {\n    /** Healing dice and bonus (e.g., { dice: \"2d4\", bonus: 2 }) */\n    healing?: {\n        dice: string;\n        bonus: number;\n    };\n    /** Flat mana restore amount */\n    manaRestore?: number;\n    /** Duration of temporary buff in turns */\n    buffDuration?: number;\n    /** Temporary stat buff to apply */\n    buff?: StatBonus;\n}\n\n/**\n * Unified Item interface representing all item types.\n * \n * Different item types use different properties:\n * - **Weapons**: damage, twoHandedDamage, weaponProperties, onHit\n * - **Armor**: armorClass, dexBonus, maxDexBonus, strengthRequirement, stealthDisadvantage\n * - **Consumables**: consumeEffect\n * - **Accessories**: bonuses, grantedAbility, onHit\n * - **Treasure**: stackable, quantity\n * \n * @interface\n */\nexport interface Item {\n    /** Unique identifier */\n    id: string;\n    /** Display name */\n    name: string;\n    /** Item category */\n    type: ItemType;\n    /** Equipment slot (or none for treasure) */\n    slot: ItemSlot;\n    /** Item rarity */\n    rarity: ItemRarity;\n    /** Gold value for buying/selling */\n    value: number;\n    /** Weight in pounds */\n    weight: number;\n    /** Item description */\n    description?: string;\n\n    // === Stat Modifiers (applied while equipped) ===\n\n    /** Passive stat bonuses */\n    bonuses?: StatBonus;\n\n    // === Active Effects ===\n\n    /** Ability granted by this item */\n    grantedAbility?: GrantedAbility;\n\n    /** On-hit effect (primarily for weapons) */\n    onHit?: OnHitEffect;\n\n    // === Weapon-Specific ===\n\n    /** Weapon damage dice and type */\n    damage?: WeaponDamage;\n    /** Two-handed damage (for versatile weapons) */\n    twoHandedDamage?: WeaponDamage;\n    /** Weapon properties (e.g., \"Versatile\", \"Finesse\") */\n    weaponProperties?: string[];\n\n    // === Armor-Specific ===\n\n    /** Base armor class */\n    armorClass?: number;\n    /** Whether dex bonus applies to AC */\n    dexBonus?: boolean;\n    /** Max dex bonus (for medium armor) */\n    maxDexBonus?: number;\n    /** Strength requirement to wear */\n    strengthRequirement?: number;\n    /** Whether armor imposes stealth disadvantage */\n    stealthDisadvantage?: boolean;\n\n    // === Consumable-Specific ===\n\n    /** Effect when consumed */\n    consumeEffect?: ConsumeEffect;\n\n    // === Treasure-Specific ===\n\n    /** Whether item stacks in inventory */\n    stackable?: boolean;\n    /** Current stack quantity */\n    quantity?: number;\n}\n\nimport { getRNG, isRNGInitialized, Seed } from '../game/seed';\n\n/**\n * Calculates the average damage from dice notation.\n * Uses the formula: numDice * ((dieSize + 1) / 2) + bonus\n * \n * @param dice - Dice notation string (e.g., \"1d8\", \"2d6+3\")\n * @returns The average damage value, or 0 if notation is invalid\n * \n * @example\n * ```typescript\n * calculateAverageDamage(\"1d8\")    // returns 4.5\n * calculateAverageDamage(\"2d6+3\")  // returns 10\n * calculateAverageDamage(\"1d6\")    // returns 3.5\n * ```\n */\nexport function calculateAverageDamage(dice: string): number {\n    const match = dice.match(/(\\d+)d(\\d+)(?:\\s*\\+\\s*(\\d+))?/);\n    if (!match) return 0;\n\n    const numDice = parseInt(match[1], 10);\n    const dieSize = parseInt(match[2], 10);\n    const bonus = match[3] ? parseInt(match[3], 10) : 0;\n\n    return numDice * ((dieSize + 1) / 2) + bonus;\n}\n\n/**\n * Rolls dice using standard dice notation and returns the total.\n * Uses seeded RNG for reproducible results when available.\n * Falls back to Math.random() if RNG not initialized (useful for testing).\n * \n * @param dice - Dice notation string (e.g., \"1d8\", \"2d6+3\")\n * @param rng - Optional Seed instance for deterministic rolls\n * @returns The total rolled value, or 0 if notation is invalid\n * \n * @example\n * ```typescript\n * rollDice(\"1d6\")     // returns 1-6\n * rollDice(\"2d6+3\")   // returns 5-15\n * rollDice(\"1d20\")    // returns 1-20\n * ```\n */\nexport function rollDice(dice: string, rng?: Seed): number {\n    const match = dice.match(/(\\d+)d(\\d+)(?:\\s*\\+\\s*(\\d+))?/);\n    if (!match) return 0;\n\n    const numDice = parseInt(match[1], 10);\n    const dieSize = parseInt(match[2], 10);\n    const bonus = match[3] ? parseInt(match[3], 10) : 0;\n\n    // Use provided RNG, global RNG, or fallback to Math.random\n    const random = rng ?? (isRNGInitialized() ? getRNG() : null);\n\n    let total = bonus;\n    for (let i = 0; i < numDice; i++) {\n        if (random) {\n            total += random.nextInt(1, dieSize);\n        } else {\n            total += Math.floor(Math.random() * dieSize) + 1;\n        }\n    }\n\n    return total;\n}\n\n/**\n * Factory function to create an Item with sensible defaults.\n * Automatically sets the equipment slot based on item type.\n * \n * @param partial - Partial Item object with required id, name, and type\n * @returns A complete Item object with defaults applied\n * \n * @example\n * ```typescript\n * const sword = createItem({\n *   id: 'iron-sword',\n *   name: 'Iron Sword',\n *   type: ItemType.WEAPON,\n *   damage: { dice: '1d8', type: DamageType.SLASHING }\n * });\n * \n * const potion = createItem({\n *   id: 'health-potion',\n *   name: 'Health Potion',\n *   type: ItemType.CONSUMABLE,\n *   consumeEffect: { healing: { dice: '2d4', bonus: 2 } }\n * });\n * ```\n */\nexport function createItem(partial: Partial<Item> & { id: string; name: string; type: ItemType }): Item {\n    const defaults: Omit<Item, 'id' | 'name' | 'type'> = {\n        slot: typeToSlot(partial.type),\n        rarity: ItemRarity.COMMON,\n        value: 0,\n        weight: 0\n    };\n\n    return { ...defaults, ...partial };\n}\n\n/**\n * Maps item type to default equipment slot.\n * \n * @param type - The item type\n * @returns The default slot for that item type\n * @private\n */\nfunction typeToSlot(type: ItemType): ItemSlot {\n    switch (type) {\n        case ItemType.WEAPON: return ItemSlot.WEAPON;\n        case ItemType.ARMOR: return ItemSlot.ARMOR;\n        case ItemType.ACCESSORY: return ItemSlot.ACCESSORY;\n        case ItemType.CONSUMABLE: return ItemSlot.CONSUMABLE;\n        case ItemType.TREASURE: return ItemSlot.NONE;\n        default: return ItemSlot.NONE;\n    }\n}\n", "/**\n * @fileoverview Item Database for Dungeon Roguelike\n * \n * This module contains all predefined items in the game, organized by type:\n * - WEAPONS: From common daggers to legendary Soul Reaver\n * - ARMOR: From leather armor to Armor of Invulnerability\n * - ACCESSORIES: Rings, amulets, boots, cloaks, belts\n * - CONSUMABLES: Healing potions, mana potions, buff elixirs\n * - TREASURE: Gold coins and gemstones\n * \n * Also provides utility functions for:\n * - Looking up items by ID or type\n * - Generating random loot based on dungeon level\n * - Cloning items for inventory management\n * \n * @module entities/itemDatabase\n */\n\nimport {\n    Item,\n    ItemType,\n    ItemSlot,\n    ItemRarity,\n    DamageType,\n    OnHitEffectType,\n    createItem\n} from './item';\nimport { getRNG, isRNGInitialized, Seed } from '../game/seed';\n\n// ============================================================================\n// WEAPONS\n// ============================================================================\n\n/**\n * All weapon items available in the game.\n * \n * Weapons are organized by rarity:\n * - **Common**: Dagger, Shortsword, Longsword, Greataxe, Staff\n * - **Uncommon**: Silver Sword, Vampiric Dagger, Arcane Staff\n * - **Rare**: Flame Tongue, Frost Brand, Staff of Power\n * - **Very Rare**: Vorpal Sword, Staff of the Magi\n * - **Legendary**: Soul Reaver\n * \n * @const\n */\nexport const WEAPONS: Item[] = [\n    // === Common Weapons ===\n    createItem({\n        id: 'dagger',\n        name: 'Dagger',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.COMMON,\n        value: 2,\n        weight: 1,\n        description: 'A simple dagger, quick but weak.',\n        damage: { dice: '1d4', type: DamageType.PIERCING },\n        weaponProperties: ['Finesse', 'Light', 'Thrown'],\n        bonuses: { speed: 2 }\n    }),\n    createItem({\n        id: 'shortsword',\n        name: 'Shortsword',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.COMMON,\n        value: 10,\n        weight: 2,\n        description: 'A reliable short blade.',\n        damage: { dice: '1d6', type: DamageType.SLASHING },\n        weaponProperties: ['Finesse', 'Light']\n    }),\n    createItem({\n        id: 'longsword',\n        name: 'Longsword',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.COMMON,\n        value: 15,\n        weight: 3,\n        description: 'A versatile blade favored by fighters.',\n        damage: { dice: '1d8', type: DamageType.SLASHING },\n        twoHandedDamage: { dice: '1d10', type: DamageType.SLASHING },\n        weaponProperties: ['Versatile']\n    }),\n    createItem({\n        id: 'greataxe',\n        name: 'Greataxe',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.COMMON,\n        value: 30,\n        weight: 7,\n        description: 'A massive axe requiring two hands.',\n        damage: { dice: '1d12', type: DamageType.SLASHING },\n        weaponProperties: ['Heavy', 'Two-Handed'],\n        bonuses: { attack: 1 }\n    }),\n    createItem({\n        id: 'staff',\n        name: 'Wooden Staff',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.COMMON,\n        value: 5,\n        weight: 4,\n        description: 'A simple wooden staff, good for channeling magic.',\n        damage: { dice: '1d6', type: DamageType.BLUDGEONING },\n        weaponProperties: ['Versatile'],\n        bonuses: { maxMana: 10 }\n    }),\n\n    // === Uncommon Weapons ===\n    createItem({\n        id: 'silver-sword',\n        name: 'Silver Sword',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.UNCOMMON,\n        value: 100,\n        weight: 3,\n        description: 'A blade of pure silver, effective against undead.',\n        damage: { dice: '1d8', type: DamageType.SLASHING },\n        bonuses: { attack: 2 }\n    }),\n    createItem({\n        id: 'vampiric-dagger',\n        name: 'Vampiric Dagger',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.UNCOMMON,\n        value: 150,\n        weight: 1,\n        description: 'A cursed blade that drains life from enemies.',\n        damage: { dice: '1d4', type: DamageType.PIERCING },\n        onHit: {\n            chance: 25,\n            type: OnHitEffectType.LIFESTEAL,\n            value: 5\n        },\n        bonuses: { speed: 2 }\n    }),\n    createItem({\n        id: 'arcane-staff',\n        name: 'Arcane Staff',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.UNCOMMON,\n        value: 200,\n        weight: 4,\n        description: 'A staff imbued with arcane energy.',\n        damage: { dice: '1d6', type: DamageType.MAGIC },\n        bonuses: { maxMana: 25, critChance: 3 }\n    }),\n\n    // === Rare Weapons ===\n    createItem({\n        id: 'flame-tongue',\n        name: 'Flame Tongue',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.RARE,\n        value: 500,\n        weight: 3,\n        description: 'A sword wreathed in magical flames.',\n        damage: { dice: '1d8', type: DamageType.SLASHING },\n        onHit: {\n            chance: 100,\n            type: OnHitEffectType.BURN,\n            value: 5,\n            duration: 2\n        },\n        bonuses: { attack: 3 }\n    }),\n    createItem({\n        id: 'frost-brand',\n        name: 'Frost Brand',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.RARE,\n        value: 500,\n        weight: 3,\n        description: 'A blade of eternal ice that chills enemies to the bone.',\n        damage: { dice: '1d8', type: DamageType.SLASHING },\n        onHit: {\n            chance: 30,\n            type: OnHitEffectType.FREEZE,\n            duration: 1\n        },\n        bonuses: { attack: 2, defense: 2 }\n    }),\n    createItem({\n        id: 'staff-of-power',\n        name: 'Staff of Power',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.RARE,\n        value: 750,\n        weight: 4,\n        description: 'A powerful staff crackling with arcane energy.',\n        damage: { dice: '1d8', type: DamageType.MAGIC },\n        bonuses: { maxMana: 50, attack: 2, critMultiplier: 0.25 },\n        grantedAbility: {\n            id: 'arcane-burst',\n            name: 'Arcane Burst',\n            description: 'Release a burst of arcane energy dealing damage to all enemies.',\n            manaCost: 25,\n            cooldown: 4,\n            damage: 20,\n            damageType: DamageType.MAGIC,\n            isAoe: true\n        }\n    }),\n\n    // === Very Rare Weapons ===\n    createItem({\n        id: 'vorpal-sword',\n        name: 'Vorpal Sword',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.VERY_RARE,\n        value: 2000,\n        weight: 3,\n        description: 'A legendary blade that can sever heads with a single strike.',\n        damage: { dice: '2d6', type: DamageType.SLASHING },\n        bonuses: { attack: 5, critChance: 10, critMultiplier: 0.5 }\n    }),\n    createItem({\n        id: 'staff-of-the-magi',\n        name: 'Staff of the Magi',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.VERY_RARE,\n        value: 2500,\n        weight: 4,\n        description: 'The ultimate staff for any spellcaster.',\n        damage: { dice: '1d10', type: DamageType.MAGIC },\n        bonuses: { maxMana: 100, attack: 4, maxHealth: 20 },\n        grantedAbility: {\n            id: 'spell-absorption',\n            name: 'Spell Absorption',\n            description: 'Absorb incoming magic damage and convert it to mana.',\n            manaCost: 0,\n            cooldown: 5,\n            effect: 'magic_immunity'\n        }\n    }),\n\n    // === Legendary Weapons ===\n    createItem({\n        id: 'soul-reaver',\n        name: 'Soul Reaver',\n        type: ItemType.WEAPON,\n        rarity: ItemRarity.LEGENDARY,\n        value: 10000,\n        weight: 4,\n        description: 'A blade forged from the souls of fallen warriors.',\n        damage: { dice: '2d8', type: DamageType.NECROTIC },\n        onHit: {\n            chance: 50,\n            type: OnHitEffectType.LIFESTEAL,\n            value: 15\n        },\n        bonuses: { attack: 8, maxHealth: 30, critChance: 15 },\n        grantedAbility: {\n            id: 'soul-drain',\n            name: 'Soul Drain',\n            description: 'Drain the soul of an enemy, dealing massive damage and healing yourself.',\n            manaCost: 40,\n            cooldown: 6,\n            damage: 50,\n            damageType: DamageType.NECROTIC,\n            healing: 25\n        }\n    })\n];\n\n// ============================================================================\n// ARMOR\n// ============================================================================\n\n/**\n * All armor items available in the game.\n * \n * Armor is organized by rarity:\n * - **Common**: Leather Armor, Chain Shirt, Chain Mail, Robes\n * - **Uncommon**: Scale Mail +1, Mithral Chain, Arcane Robes\n * - **Rare**: Plate of Fortitude, Shadow Leather, Robes of the Archmagi\n * - **Legendary**: Armor of Invulnerability\n * \n * @const\n */\nexport const ARMOR: Item[] = [\n    // === Common Armor ===\n    createItem({\n        id: 'leather-armor',\n        name: 'Leather Armor',\n        type: ItemType.ARMOR,\n        rarity: ItemRarity.COMMON,\n        value: 10,\n        weight: 10,\n        description: 'Light armor made of leather.',\n        armorClass: 11,\n        dexBonus: true\n    }),\n    createItem({\n        id: 'chain-shirt',\n        name: 'Chain Shirt',\n        type: ItemType.ARMOR,\n        rarity: ItemRarity.COMMON,\n        value: 50,\n        weight: 20,\n        description: 'A shirt of interlocking metal rings.',\n        armorClass: 13,\n        dexBonus: true,\n        maxDexBonus: 2\n    }),\n    createItem({\n        id: 'chain-mail',\n        name: 'Chain Mail',\n        type: ItemType.ARMOR,\n        rarity: ItemRarity.COMMON,\n        value: 75,\n        weight: 55,\n        description: 'Heavy armor of interlocking metal rings.',\n        armorClass: 16,\n        dexBonus: false,\n        strengthRequirement: 13,\n        stealthDisadvantage: true\n    }),\n    createItem({\n        id: 'robes',\n        name: 'Cloth Robes',\n        type: ItemType.ARMOR,\n        rarity: ItemRarity.COMMON,\n        value: 5,\n        weight: 3,\n        description: 'Simple cloth robes, offering little protection.',\n        armorClass: 10,\n        dexBonus: true,\n        bonuses: { maxMana: 15 }\n    }),\n\n    // === Uncommon Armor ===\n    createItem({\n        id: 'scale-mail-plus',\n        name: 'Scale Mail +1',\n        type: ItemType.ARMOR,\n        rarity: ItemRarity.UNCOMMON,\n        value: 200,\n        weight: 45,\n        description: 'Enchanted scale armor providing extra protection.',\n        armorClass: 15,\n        dexBonus: true,\n        maxDexBonus: 2,\n        bonuses: { defense: 1 }\n    }),\n    createItem({\n        id: 'mithral-chain',\n        name: 'Mithral Chain Shirt',\n        type: ItemType.ARMOR,\n        rarity: ItemRarity.UNCOMMON,\n        value: 300,\n        weight: 10,\n        description: 'Lightweight chain made of mithral.',\n        armorClass: 13,\n        dexBonus: true,\n        bonuses: { speed: 5 }\n    }),\n    createItem({\n        id: 'arcane-robes',\n        name: 'Arcane Robes',\n        type: ItemType.ARMOR,\n        rarity: ItemRarity.UNCOMMON,\n        value: 250,\n        weight: 3,\n        description: 'Robes woven with arcane threads.',\n        armorClass: 11,\n        dexBonus: true,\n        bonuses: { maxMana: 30, critChance: 2 }\n    }),\n\n    // === Rare Armor ===\n    createItem({\n        id: 'plate-of-fortitude',\n        name: 'Plate of Fortitude',\n        type: ItemType.ARMOR,\n        rarity: ItemRarity.RARE,\n        value: 1500,\n        weight: 65,\n        description: 'Heavy plate armor that bolsters the wearer\\'s vitality.',\n        armorClass: 18,\n        dexBonus: false,\n        strengthRequirement: 15,\n        stealthDisadvantage: true,\n        bonuses: { maxHealth: 30, defense: 3 }\n    }),\n    createItem({\n        id: 'shadow-leather',\n        name: 'Shadow Leather',\n        type: ItemType.ARMOR,\n        rarity: ItemRarity.RARE,\n        value: 800,\n        weight: 8,\n        description: 'Armor that seems to absorb light.',\n        armorClass: 13,\n        dexBonus: true,\n        bonuses: { speed: 10, critChance: 5 }\n    }),\n    createItem({\n        id: 'robes-of-the-archmagi',\n        name: 'Robes of the Archmagi',\n        type: ItemType.ARMOR,\n        rarity: ItemRarity.RARE,\n        value: 1000,\n        weight: 3,\n        description: 'Legendary robes worn by powerful mages.',\n        armorClass: 13,\n        dexBonus: true,\n        bonuses: { maxMana: 50, defense: 2, critMultiplier: 0.2 }\n    }),\n\n    // === Legendary Armor ===\n    createItem({\n        id: 'armor-of-invulnerability',\n        name: 'Armor of Invulnerability',\n        type: ItemType.ARMOR,\n        rarity: ItemRarity.LEGENDARY,\n        value: 15000,\n        weight: 65,\n        description: 'Legendary armor that renders the wearer nearly invincible.',\n        armorClass: 20,\n        dexBonus: false,\n        strengthRequirement: 15,\n        bonuses: { maxHealth: 50, defense: 10 },\n        grantedAbility: {\n            id: 'invulnerability',\n            name: 'Invulnerability',\n            description: 'Become immune to all damage for 1 turn.',\n            manaCost: 50,\n            cooldown: 10,\n            effect: 'invulnerable'\n        }\n    })\n];\n\n// ============================================================================\n// ACCESSORIES\n// ============================================================================\n\n/**\n * All accessory items available in the game.\n * Includes rings, amulets, boots, cloaks, and belts.\n * \n * Accessories are organized by rarity:\n * - **Common**: Ring of Protection, Amulet of Health, Ring of Mana\n * - **Uncommon**: Boots of Speed, Cloak of Protection, Ring of Precision\n * - **Rare**: Amulet of Fireball, Ring of Vampirism, Belt of Giant Strength\n * - **Legendary**: Ring of Three Wishes\n * \n * @const\n */\nexport const ACCESSORIES: Item[] = [\n    // === Common Accessories ===\n    createItem({\n        id: 'ring-of-protection',\n        name: 'Ring of Protection',\n        type: ItemType.ACCESSORY,\n        rarity: ItemRarity.COMMON,\n        value: 50,\n        weight: 0,\n        description: 'A simple ring that offers minor protection.',\n        bonuses: { defense: 1 }\n    }),\n    createItem({\n        id: 'amulet-of-health',\n        name: 'Amulet of Health',\n        type: ItemType.ACCESSORY,\n        rarity: ItemRarity.COMMON,\n        value: 50,\n        weight: 0,\n        description: 'An amulet that bolsters vitality.',\n        bonuses: { maxHealth: 10 }\n    }),\n    createItem({\n        id: 'ring-of-mana',\n        name: 'Ring of Mana',\n        type: ItemType.ACCESSORY,\n        rarity: ItemRarity.COMMON,\n        value: 50,\n        weight: 0,\n        description: 'A ring that expands the wearer\\'s mana pool.',\n        bonuses: { maxMana: 15 }\n    }),\n\n    // === Uncommon Accessories ===\n    createItem({\n        id: 'boots-of-speed',\n        name: 'Boots of Speed',\n        type: ItemType.ACCESSORY,\n        rarity: ItemRarity.UNCOMMON,\n        value: 200,\n        weight: 1,\n        description: 'Enchanted boots that quicken the wearer.',\n        bonuses: { speed: 10 }\n    }),\n    createItem({\n        id: 'cloak-of-protection',\n        name: 'Cloak of Protection',\n        type: ItemType.ACCESSORY,\n        rarity: ItemRarity.UNCOMMON,\n        value: 250,\n        weight: 1,\n        description: 'A magical cloak that deflects attacks.',\n        bonuses: { defense: 2, maxHealth: 10 }\n    }),\n    createItem({\n        id: 'ring-of-precision',\n        name: 'Ring of Precision',\n        type: ItemType.ACCESSORY,\n        rarity: ItemRarity.UNCOMMON,\n        value: 200,\n        weight: 0,\n        description: 'A ring that sharpens the wearer\\'s strikes.',\n        bonuses: { critChance: 5, attack: 1 }\n    }),\n\n    // === Rare Accessories ===\n    createItem({\n        id: 'amulet-of-fireball',\n        name: 'Amulet of Fireball',\n        type: ItemType.ACCESSORY,\n        rarity: ItemRarity.RARE,\n        value: 1000,\n        weight: 0,\n        description: 'An amulet that grants the power to cast Fireball.',\n        bonuses: { maxMana: 20 },\n        grantedAbility: {\n            id: 'fireball',\n            name: 'Fireball',\n            description: 'Hurl a ball of fire at all enemies.',\n            manaCost: 30,\n            cooldown: 5,\n            damage: 30,\n            damageType: DamageType.FIRE,\n            isAoe: true\n        }\n    }),\n    createItem({\n        id: 'ring-of-vampirism',\n        name: 'Ring of Vampirism',\n        type: ItemType.ACCESSORY,\n        rarity: ItemRarity.RARE,\n        value: 800,\n        weight: 0,\n        description: 'A cursed ring that drains life with each attack.',\n        onHit: {\n            chance: 20,\n            type: OnHitEffectType.LIFESTEAL,\n            value: 10\n        },\n        bonuses: { attack: 2 }\n    }),\n    createItem({\n        id: 'belt-of-giant-strength',\n        name: 'Belt of Giant Strength',\n        type: ItemType.ACCESSORY,\n        rarity: ItemRarity.RARE,\n        value: 1200,\n        weight: 1,\n        description: 'A belt that grants the strength of a giant.',\n        bonuses: { attack: 5, maxHealth: 20 }\n    }),\n\n    // === Legendary Accessories ===\n    createItem({\n        id: 'ring-of-three-wishes',\n        name: 'Ring of Three Wishes',\n        type: ItemType.ACCESSORY,\n        rarity: ItemRarity.LEGENDARY,\n        value: 50000,\n        weight: 0,\n        description: 'A legendary ring containing three powerful wishes.',\n        bonuses: { maxHealth: 30, maxMana: 30, attack: 3, defense: 3 },\n        grantedAbility: {\n            id: 'wish',\n            name: 'Wish',\n            description: 'Fully restore health and mana, and reset all cooldowns.',\n            manaCost: 0,\n            cooldown: 99, // Essentially once per dungeon\n            healing: 999,\n            effect: 'full_restore'\n        }\n    })\n];\n\n// ============================================================================\n// CONSUMABLES\n// ============================================================================\n\n/**\n * All consumable items available in the game.\n * Includes healing potions, mana potions, and buff elixirs.\n * \n * Consumables are organized by effect:\n * - **Healing**: Potion of Healing, Greater Healing, Superior Healing\n * - **Mana**: Potion of Mana, Greater Mana\n * - **Buffs**: Potion of Strength, Iron Skin, Elixir of Heroism\n * \n * @const\n */\nexport const CONSUMABLES: Item[] = [\n    // === Healing Potions ===\n    createItem({\n        id: 'potion-of-healing',\n        name: 'Potion of Healing',\n        type: ItemType.CONSUMABLE,\n        rarity: ItemRarity.COMMON,\n        value: 50,\n        weight: 0.5,\n        description: 'A red potion that restores health.',\n        consumeEffect: {\n            healing: { dice: '2d4', bonus: 2 }\n        }\n    }),\n    createItem({\n        id: 'potion-of-greater-healing',\n        name: 'Potion of Greater Healing',\n        type: ItemType.CONSUMABLE,\n        rarity: ItemRarity.UNCOMMON,\n        value: 100,\n        weight: 0.5,\n        description: 'A vibrant red potion that restores significant health.',\n        consumeEffect: {\n            healing: { dice: '4d4', bonus: 4 }\n        }\n    }),\n    createItem({\n        id: 'potion-of-superior-healing',\n        name: 'Potion of Superior Healing',\n        type: ItemType.CONSUMABLE,\n        rarity: ItemRarity.RARE,\n        value: 500,\n        weight: 0.5,\n        description: 'A brilliant red potion that restores great health.',\n        consumeEffect: {\n            healing: { dice: '8d4', bonus: 8 }\n        }\n    }),\n\n    // === Mana Potions ===\n    createItem({\n        id: 'potion-of-mana',\n        name: 'Potion of Mana',\n        type: ItemType.CONSUMABLE,\n        rarity: ItemRarity.COMMON,\n        value: 50,\n        weight: 0.5,\n        description: 'A blue potion that restores mana.',\n        consumeEffect: {\n            manaRestore: 25\n        }\n    }),\n    createItem({\n        id: 'potion-of-greater-mana',\n        name: 'Potion of Greater Mana',\n        type: ItemType.CONSUMABLE,\n        rarity: ItemRarity.UNCOMMON,\n        value: 100,\n        weight: 0.5,\n        description: 'A vibrant blue potion that restores significant mana.',\n        consumeEffect: {\n            manaRestore: 50\n        }\n    }),\n\n    // === Buff Potions ===\n    createItem({\n        id: 'potion-of-strength',\n        name: 'Potion of Strength',\n        type: ItemType.CONSUMABLE,\n        rarity: ItemRarity.UNCOMMON,\n        value: 150,\n        weight: 0.5,\n        description: 'A potion that temporarily increases attack power.',\n        consumeEffect: {\n            buffDuration: 5,\n            buff: { attack: 5 }\n        }\n    }),\n    createItem({\n        id: 'potion-of-iron-skin',\n        name: 'Potion of Iron Skin',\n        type: ItemType.CONSUMABLE,\n        rarity: ItemRarity.UNCOMMON,\n        value: 150,\n        weight: 0.5,\n        description: 'A potion that temporarily increases defense.',\n        consumeEffect: {\n            buffDuration: 5,\n            buff: { defense: 5 }\n        }\n    }),\n    createItem({\n        id: 'elixir-of-heroism',\n        name: 'Elixir of Heroism',\n        type: ItemType.CONSUMABLE,\n        rarity: ItemRarity.RARE,\n        value: 500,\n        weight: 0.5,\n        description: 'A powerful elixir that enhances all abilities.',\n        consumeEffect: {\n            buffDuration: 3,\n            buff: { attack: 5, defense: 3, critChance: 10, speed: 5 }\n        }\n    })\n];\n\n// ============================================================================\n// TREASURE\n// ============================================================================\n\n/**\n * All treasure items available in the game.\n * Includes gold coins and gemstones of various values.\n * \n * @const\n */\nexport const TREASURE: Item[] = [\n    createItem({\n        id: 'gold-coins',\n        name: 'Gold Coins',\n        type: ItemType.TREASURE,\n        slot: ItemSlot.NONE,\n        rarity: ItemRarity.COMMON,\n        value: 1,\n        weight: 0.02,\n        description: 'Shiny gold coins.',\n        stackable: true,\n        quantity: 1\n    }),\n    createItem({\n        id: 'ruby',\n        name: 'Ruby',\n        type: ItemType.TREASURE,\n        slot: ItemSlot.NONE,\n        rarity: ItemRarity.UNCOMMON,\n        value: 100,\n        weight: 0,\n        description: 'A brilliant red gemstone.'\n    }),\n    createItem({\n        id: 'sapphire',\n        name: 'Sapphire',\n        type: ItemType.TREASURE,\n        slot: ItemSlot.NONE,\n        rarity: ItemRarity.UNCOMMON,\n        value: 100,\n        weight: 0,\n        description: 'A deep blue gemstone.'\n    }),\n    createItem({\n        id: 'emerald',\n        name: 'Emerald',\n        type: ItemType.TREASURE,\n        slot: ItemSlot.NONE,\n        rarity: ItemRarity.RARE,\n        value: 500,\n        weight: 0,\n        description: 'A vivid green gemstone.'\n    }),\n    createItem({\n        id: 'diamond',\n        name: 'Diamond',\n        type: ItemType.TREASURE,\n        slot: ItemSlot.NONE,\n        rarity: ItemRarity.VERY_RARE,\n        value: 1000,\n        weight: 0,\n        description: 'A flawless diamond.'\n    })\n];\n\n// ============================================================================\n// ITEM DATABASE ACCESS\n// ============================================================================\n\n/**\n * All items in the game combined into a single array.\n * @const\n */\nexport const ALL_ITEMS: Item[] = [\n    ...WEAPONS,\n    ...ARMOR,\n    ...ACCESSORIES,\n    ...CONSUMABLES,\n    ...TREASURE\n];\n\n/**\n * Retrieves an item from the database by its unique identifier.\n * \n * @param id - The unique item ID to search for\n * @returns The matching Item, or undefined if not found\n * \n * @example\n * ```typescript\n * const sword = getItemById('longsword');\n * const potion = getItemById('potion-of-healing');\n * ```\n */\nexport function getItemById(id: string): Item | undefined {\n    return ALL_ITEMS.find(item => item.id === id);\n}\n\n/**\n * Retrieves all items of a specific type from the database.\n * \n * @param type - The ItemType to filter by (WEAPON, ARMOR, CONSUMABLE, etc.)\n * @returns Array of items matching the specified type\n * \n * @example\n * ```typescript\n * const weapons = getItemsByType(ItemType.WEAPON);\n * const potions = getItemsByType(ItemType.CONSUMABLE);\n * ```\n */\nexport function getItemsByType(type: ItemType): Item[] {\n    return ALL_ITEMS.filter(item => item.type === type);\n}\n\n/**\n * Retrieves all items of a specific rarity from the database.\n * \n * @param rarity - The ItemRarity to filter by (COMMON, UNCOMMON, RARE, etc.)\n * @returns Array of items matching the specified rarity\n * \n * @example\n * ```typescript\n * const legendaryItems = getItemsByRarity(ItemRarity.LEGENDARY);\n * ```\n */\nexport function getItemsByRarity(rarity: ItemRarity): Item[] {\n    return ALL_ITEMS.filter(item => item.rarity === rarity);\n}\n\n/**\n * Selects a random item from the database with optional filtering.\n * Items are weighted by rarity (common items are more likely to be selected).\n * Uses seeded RNG for reproducible results when available.\n * \n * **Rarity weights:**\n * - Common: 10x\n * - Uncommon: 5x\n * - Rare: 2x\n * - Very Rare: 1x\n * - Legendary: 0.5x\n * \n * @param type - Optional ItemType to filter by\n * @param maxRarity - Optional maximum rarity (items above this rarity are excluded)\n * @param rng - Optional Seed instance for deterministic selection\n * @returns A randomly selected Item from the filtered pool\n * \n * @example\n * ```typescript\n * // Random item of any type\n * const item = getRandomItem();\n * \n * // Random weapon up to rare rarity\n * const weapon = getRandomItem(ItemType.WEAPON, ItemRarity.RARE);\n * ```\n */\nexport function getRandomItem(type?: ItemType, maxRarity?: ItemRarity, rng?: Seed): Item {\n    // Use provided RNG, global RNG, or fallback\n    const random = rng ?? (isRNGInitialized() ? getRNG() : null);\n    \n    let pool = ALL_ITEMS;\n\n    if (type) {\n        pool = pool.filter(item => item.type === type);\n    }\n\n    if (maxRarity) {\n        const rarityOrder = [\n            ItemRarity.COMMON,\n            ItemRarity.UNCOMMON,\n            ItemRarity.RARE,\n            ItemRarity.VERY_RARE,\n            ItemRarity.LEGENDARY\n        ];\n        const maxIndex = rarityOrder.indexOf(maxRarity);\n        pool = pool.filter(item => rarityOrder.indexOf(item.rarity) <= maxIndex);\n    }\n\n    // Weight by rarity (common items more likely)\n    const weighted: Item[] = [];\n    for (const item of pool) {\n        const weight = item.rarity === ItemRarity.COMMON ? 10\n            : item.rarity === ItemRarity.UNCOMMON ? 5\n            : item.rarity === ItemRarity.RARE ? 2\n            : item.rarity === ItemRarity.VERY_RARE ? 1\n            : 0.5; // Legendary\n\n        for (let i = 0; i < weight; i++) {\n            weighted.push(item);\n        }\n    }\n\n    if (random) {\n        return random.choice(weighted);\n    }\n    return weighted[Math.floor(Math.random() * weighted.length)];\n}\n\n/**\n * Generates random loot appropriate for a given dungeon level.\n * Higher levels unlock higher rarity items and increase equipment drop chance.\n * Always includes at least one consumable item.\n * Uses seeded RNG for reproducible results when available.\n * \n * **Level to max rarity mapping:**\n * - Levels 1-2: Common\n * - Levels 3-4: Uncommon\n * - Levels 5-9: Rare\n * - Levels 10-14: Very Rare\n * - Levels 15+: Legendary\n * \n * **Equipment drop chance:**\n * Base 30% + 3% per level (e.g., level 10 = 60% chance)\n * \n * @param level - The dungeon level (1-20+) determining loot quality\n * @param rng - Optional Seed instance for deterministic generation\n * @returns Array of Item objects appropriate for the level\n * \n * @example\n * ```typescript\n * // Generate loot for dungeon level 5\n * const loot = generateLootForLevel(5);\n * \n * // Generate deterministic loot\n * const rng = new Seed('my-seed');\n * const loot = generateLootForLevel(10, rng);\n * ```\n */\nexport function generateLootForLevel(level: number, rng?: Seed, guaranteeEquipment: boolean = false): Item[] {\n    // Use provided RNG, global RNG, or fallback\n    const random = rng ?? (isRNGInitialized() ? getRNG() : null);\n    \n    const loot: Item[] = [];\n\n    // Determine max rarity based on level\n    let maxRarity: ItemRarity;\n    if (level >= 15) maxRarity = ItemRarity.LEGENDARY;\n    else if (level >= 10) maxRarity = ItemRarity.VERY_RARE;\n    else if (level >= 5) maxRarity = ItemRarity.RARE;\n    else if (level >= 3) maxRarity = ItemRarity.UNCOMMON;\n    else maxRarity = ItemRarity.COMMON;\n\n    // Always drop a consumable\n    loot.push(getRandomItem(ItemType.CONSUMABLE, maxRarity, random ?? undefined));\n\n    // Equipment drop chance: starts at 50% and increases with level\n    // At level 1: 50%, at level 10: 80%, at level 20: 100%+\n    const equipmentChance = 0.5 + (level * 0.03);\n    const shouldDropEquipment = guaranteeEquipment || (random \n        ? random.chance(equipmentChance)\n        : Math.random() < equipmentChance);\n        \n    if (shouldDropEquipment) {\n        const equipmentTypes = [ItemType.WEAPON, ItemType.ARMOR, ItemType.ACCESSORY];\n        const type = random \n            ? random.choice(equipmentTypes)\n            : equipmentTypes[Math.floor(Math.random() * equipmentTypes.length)];\n        loot.push(getRandomItem(type, maxRarity, random ?? undefined));\n    }\n    \n    // Small chance for a second equipment piece at higher levels\n    if (level >= 5) {\n        const bonusEquipChance = 0.1 + (level * 0.02); // 10% at level 5, up to 40% at level 20\n        const shouldDropBonus = random \n            ? random.chance(bonusEquipChance)\n            : Math.random() < bonusEquipChance;\n        if (shouldDropBonus) {\n            const equipmentTypes = [ItemType.WEAPON, ItemType.ARMOR, ItemType.ACCESSORY];\n            const type = random \n                ? random.choice(equipmentTypes)\n                : equipmentTypes[Math.floor(Math.random() * equipmentTypes.length)];\n            loot.push(getRandomItem(type, maxRarity, random ?? undefined));\n        }\n    }\n\n    return loot;\n}\n\n/**\n * Creates a deep copy of an item with a new unique ID.\n * Used when adding items to inventory to ensure each instance is unique.\n * The new ID is the original ID suffixed with a random 8-character UUID segment.\n * \n * @param item - The item template to clone\n * @returns A new Item instance with a unique ID\n * \n * @example\n * ```typescript\n * const template = getItemById('longsword')!;\n * const sword1 = cloneItem(template); // longsword-a1b2c3d4\n * const sword2 = cloneItem(template); // longsword-e5f6g7h8\n * ```\n */\nexport function cloneItem(item: Item): Item {\n    return {\n        ...item,\n        id: `${item.id}-${crypto.randomUUID().slice(0, 8)}`\n    };\n}\n\n/**\n * Shop item with calculated buy price.\n */\nexport interface ShopItem {\n    /** The item for sale */\n    item: Item;\n    /** Price to buy this item (higher than base value) */\n    buyPrice: number;\n}\n\n/**\n * Generates shop inventory based on dungeon level.\n * Shop inventory includes a mix of weapons, armor, accessories, and consumables.\n * Prices are marked up from base item values.\n * \n * @param level - Current dungeon level (affects item rarity and selection)\n * @param rng - Optional seeded RNG for deterministic generation\n * @returns Array of ShopItems available for purchase\n */\nexport function generateShopInventory(level: number, rng?: Seed): ShopItem[] {\n    const random = rng ?? (isRNGInitialized() ? getRNG() : null);\n    const inventory: ShopItem[] = [];\n    \n    // Determine max rarity based on level\n    let maxRarity: ItemRarity;\n    if (level >= 15) maxRarity = ItemRarity.VERY_RARE;\n    else if (level >= 10) maxRarity = ItemRarity.RARE;\n    else if (level >= 5) maxRarity = ItemRarity.UNCOMMON;\n    else maxRarity = ItemRarity.COMMON;\n    \n    // Price markup multiplier (shops charge more than item base value)\n    const markup = 1.5;\n    \n    // Always have 2-3 consumables\n    const consumableCount = random ? random.nextInt(2, 3) : Math.floor(Math.random() * 2) + 2;\n    for (let i = 0; i < consumableCount; i++) {\n        const item = cloneItem(getRandomItem(ItemType.CONSUMABLE, maxRarity, random ?? undefined));\n        inventory.push({\n            item,\n            buyPrice: Math.floor(item.value * markup)\n        });\n    }\n    \n    // 1-2 weapons\n    const weaponCount = random ? random.nextInt(1, 2) : Math.floor(Math.random() * 2) + 1;\n    for (let i = 0; i < weaponCount; i++) {\n        const item = cloneItem(getRandomItem(ItemType.WEAPON, maxRarity, random ?? undefined));\n        inventory.push({\n            item,\n            buyPrice: Math.floor(item.value * markup)\n        });\n    }\n    \n    // 1-2 armor pieces\n    const armorCount = random ? random.nextInt(1, 2) : Math.floor(Math.random() * 2) + 1;\n    for (let i = 0; i < armorCount; i++) {\n        const item = cloneItem(getRandomItem(ItemType.ARMOR, maxRarity, random ?? undefined));\n        inventory.push({\n            item,\n            buyPrice: Math.floor(item.value * markup)\n        });\n    }\n    \n    // 0-1 accessory\n    const hasAccessory = random ? random.chance(0.6) : Math.random() < 0.6;\n    if (hasAccessory) {\n        const item = cloneItem(getRandomItem(ItemType.ACCESSORY, maxRarity, random ?? undefined));\n        inventory.push({\n            item,\n            buyPrice: Math.floor(item.value * markup)\n        });\n    }\n    \n    return inventory;\n}\n\n/**\n * Calculates the sell price for an item (player selling to shop).\n * Sell price is typically 50% of the item's base value.\n * \n * @param item - The item to sell\n * @returns Gold amount the player receives\n */\nexport function getSellPrice(item: Item): number {\n    return Math.floor(item.value * 0.5);\n}\n", "/**\n * @fileoverview Interactable Objects System for Dungeon Roguelike\n * \n * This module defines interactable objects that players can interact with\n * in dungeon rooms. Interactables include:\n * - Chests: Contain loot and gold\n * - Traps: Deal damage when triggered\n * - Altars: May grant blessings or curses\n * - Levers: Trigger dungeon mechanisms\n * - NPCs: Non-player characters for dialogue/trading\n * \n * @module dungeon/Interactable\n */\n\nimport { Item } from '../entities/item';\nimport { generateLootForLevel, cloneItem } from '../entities/itemDatabase';\nimport { getRNG, isRNGInitialized } from '../game/seed';\nimport { Relic, generateTrapRelic, cloneRelic } from '../entities/relic';\n\n/**\n * Types of interactable objects that can appear in rooms.\n * @enum {string}\n */\nexport enum InteractableType {\n    /** A container that can be opened for loot */\n    CHEST = 'chest',\n    /** A mechanism that triggers events when activated */\n    LEVER = 'lever',\n    /** A sacred object that may grant blessings or curses */\n    ALTAR = 'altar',\n    /** A hazard that triggers when approached */\n    TRAP = 'trap',\n    /** A non-player character for dialogue or trading */\n    NPC = 'npc'\n}\n\n/**\n * Types of traps with different effects.\n * @enum {string}\n */\nexport enum TrapType {\n    /** Basic damage trap */\n    SPIKE = 'spike',\n    /** Deals damage over time (poison) */\n    POISON = 'poison',\n    /** Slows the player (reduces speed) */\n    FROST = 'frost',\n    /** Deals fire damage and may burn items */\n    FIRE = 'fire',\n    /** Stuns the player (lose a turn in combat) */\n    STUN = 'stun',\n    /** Teleports player to a random room */\n    TELEPORT = 'teleport',\n    /** Drains gold */\n    GOLD_DRAIN = 'gold_drain',\n    /** Summons additional enemies */\n    ALARM = 'alarm'\n}\n\n/**\n * Trap effect result containing damage and status effects.\n * @interface\n */\nexport interface TrapEffect {\n    /** Immediate damage dealt */\n    damage?: number;\n    /** Status effect applied */\n    statusEffect?: {\n        type: 'poison' | 'slow' | 'burn' | 'stun';\n        duration: number;\n        damagePerTurn?: number;\n        statReduction?: number;\n    };\n    /** Gold lost */\n    goldLost?: number;\n    /** Whether player should be teleported */\n    teleport?: boolean;\n    /** Whether alarm was triggered (summons enemies) */\n    alarmTriggered?: boolean;\n}\n\n/**\n * Result of interacting with an object.\n * Contains all possible outcomes of an interaction.\n * @interface\n */\nexport interface InteractionResult {\n    /** Message describing what happened */\n    message: string;\n    /** Items received from the interaction */\n    items?: Item[];\n    /** Gold received from the interaction */\n    gold?: number;\n    /** Damage taken from the interaction (e.g., trap) */\n    damage?: number;\n    /** Healing received from the interaction */\n    healing?: number;\n    /** Whether the interactable was consumed/destroyed */\n    consumed: boolean;\n    /** Stat bonuses from the interaction (e.g., altar blessing) */\n    statBonus?: { attack?: number; defense?: number; speed?: number; health?: number };\n    /** Duration of stat bonus in turns */\n    duration?: number;\n    /** Trap effect details (for enhanced trap system) */\n    trapEffect?: TrapEffect;\n    /** Gold lost (e.g., from gold drain trap) */\n    goldLost?: number;\n}\n\n/**\n * Represents an object in a room that the player can interact with.\n * Interactables can provide loot, trigger events, or offer services.\n * @interface\n */\nexport interface Interactable {\n    /** Unique identifier for the interactable */\n    id: string;\n    /** The type of interactable object */\n    type: InteractableType;\n    /** Display name shown to the player */\n    name: string;\n    /** Whether this interactable has been used */\n    used: boolean;\n    /** Items contained (for chests) */\n    contents?: Item[];\n    /** Gold contained (for chests) */\n    gold?: number;\n    /** Damage dealt (for traps) */\n    damage?: number;\n    /** Whether the trap has been disarmed */\n    disarmed?: boolean;\n    /** Type of trap (for TRAP type interactables) */\n    trapType?: TrapType;\n    /** Difficulty class to disarm the trap (1-20) */\n    disarmDC?: number;\n    /** Whether the trap is hidden (requires perception to spot) */\n    hidden?: boolean;\n    /** Whether the trap has been detected */\n    detected?: boolean;\n}\n\n/**\n * Names for different interactable types.\n * Used to randomly assign flavor names to interactables.\n * @const\n */\nconst INTERACTABLE_NAMES: Record<InteractableType, string[]> = {\n    [InteractableType.CHEST]: ['Wooden Chest', 'Iron Chest', 'Ornate Chest', 'Ancient Chest'],\n    [InteractableType.LEVER]: ['Rusty Lever', 'Stone Lever', 'Golden Lever'],\n    [InteractableType.ALTAR]: ['Stone Altar', 'Dark Altar', 'Blessed Altar', 'Ancient Shrine'],\n    [InteractableType.TRAP]: ['Spike Trap', 'Poison Dart Trap', 'Fire Trap', 'Pit Trap'],\n    [InteractableType.NPC]: ['Wandering Merchant', 'Lost Adventurer', 'Mysterious Figure']\n};\n\n/**\n * Names for different trap types.\n * @const\n */\nconst TRAP_TYPE_NAMES: Record<TrapType, string[]> = {\n    [TrapType.SPIKE]: ['Spike Trap', 'Pit Trap', 'Blade Trap', 'Crushing Wall'],\n    [TrapType.POISON]: ['Poison Dart Trap', 'Venomous Needle', 'Toxic Gas Vent', 'Serpent Trap'],\n    [TrapType.FROST]: ['Frost Trap', 'Ice Shard Trap', 'Freezing Glyph', 'Cryogenic Vent'],\n    [TrapType.FIRE]: ['Fire Trap', 'Flame Jet', 'Inferno Glyph', 'Lava Pit'],\n    [TrapType.STUN]: ['Lightning Trap', 'Thunder Rune', 'Shock Plate', 'Static Glyph'],\n    [TrapType.TELEPORT]: ['Teleportation Circle', 'Displacement Trap', 'Warp Rune'],\n    [TrapType.GOLD_DRAIN]: ['Cursed Chest', 'Greed Trap', 'Gold Siphon'],\n    [TrapType.ALARM]: ['Alarm Trap', 'Summoning Circle', 'Warning Glyph', 'Sentry Rune']\n};\n\n/**\n * Gets available trap types for a given dungeon level.\n * More dangerous traps appear at higher levels.\n * \n * @param level - The dungeon level\n * @returns Array of available trap types\n */\nfunction getTrapTypesForLevel(level: number): TrapType[] {\n    const types: TrapType[] = [TrapType.SPIKE]; // Always available\n    \n    if (level >= 2) types.push(TrapType.POISON);\n    if (level >= 3) types.push(TrapType.FROST);\n    if (level >= 4) types.push(TrapType.FIRE);\n    if (level >= 5) types.push(TrapType.STUN);\n    if (level >= 7) types.push(TrapType.GOLD_DRAIN);\n    if (level >= 8) types.push(TrapType.ALARM);\n    if (level >= 10) types.push(TrapType.TELEPORT);\n    \n    return types;\n}\n\n/**\n * Gets a random name for a trap type.\n * \n * @param trapType - The type of trap\n * @param rng - Optional seeded RNG\n * @returns A flavor name for the trap\n */\nfunction getTrapName(trapType: TrapType, rng: ReturnType<typeof getRNG> | null): string {\n    const names = TRAP_TYPE_NAMES[trapType];\n    return rng ? rng.choice(names) : names[Math.floor(Math.random() * names.length)];\n}\n\n/**\n * Creates an interactable object appropriate for the given room level.\n * \n * The interactable is populated with:\n * - A random name from the type's name pool\n * - Contents/gold (for chests)\n * - Damage value (for traps)\n * - Offerings (for altars, 30% chance)\n * \n * @param type - The type of interactable to create\n * @param level - The dungeon level (affects loot quality and trap damage)\n * @returns A new Interactable object\n * \n * @example\n * ```typescript\n * const chest = createInteractable(InteractableType.CHEST, 5);\n * const trap = createInteractable(InteractableType.TRAP, 10);\n * ```\n */\nexport function createInteractable(type: InteractableType, level: number): Interactable {\n    const rng = isRNGInitialized() ? getRNG() : null;\n    const names = INTERACTABLE_NAMES[type];\n    const name = rng ? rng.choice(names) : names[Math.floor(Math.random() * names.length)];\n\n    const base: Interactable = {\n        id: crypto.randomUUID(),\n        type,\n        name,\n        used: false\n    };\n\n    switch (type) {\n        case InteractableType.CHEST:\n            // Chests contain loot and gold\n            base.contents = generateLootForLevel(level).map(item => cloneItem(item));\n            base.gold = Math.floor((rng ? rng.nextInt(10, 50) : Math.random() * 40 + 10) * level);\n            break;\n\n        case InteractableType.TRAP: {\n            // Select trap type based on level and randomness\n            const trapTypes = getTrapTypesForLevel(level);\n            base.trapType = rng ? rng.choice(trapTypes) : trapTypes[Math.floor(Math.random() * trapTypes.length)];\n            \n            // Base damage scales with level\n            base.damage = Math.floor(5 + level * 2 + (rng ? rng.nextInt(0, level) : Math.random() * level));\n            base.disarmed = false;\n            \n            // Disarm difficulty scales with level (DC 8 at level 1, up to DC 20 at level 20)\n            base.disarmDC = Math.min(20, 8 + Math.floor(level * 0.6));\n            \n            // Higher level traps are more likely to be hidden\n            const hiddenChance = 0.3 + (level * 0.02);\n            base.hidden = rng ? rng.chance(hiddenChance) : Math.random() < hiddenChance;\n            base.detected = !base.hidden; // If not hidden, it's automatically detected\n            \n            // Update name based on trap type\n            base.name = getTrapName(base.trapType, rng);\n            break;\n        }\n\n        case InteractableType.ALTAR:\n            // Altars may contain offerings\n            const hasOffering = rng ? rng.chance(0.3) : Math.random() < 0.3;\n            if (hasOffering) {\n                base.contents = generateLootForLevel(level + 1).map(item => cloneItem(item));\n            }\n            break;\n\n        // Levers and NPCs don't need additional setup here\n        // Their effects are handled by game logic\n    }\n\n    return base;\n}\n\n/**\n * Processes interaction with an interactable object.\n * \n * Interaction outcomes by type:\n * - **CHEST**: Opens and gives contents/gold (one-time use)\n * - **TRAP**: Triggers and deals damage (unless disarmed)\n * - **ALTAR**: Either gives offerings, blessing (heal), or curse (damage)\n * - **LEVER**: Activates (triggers dungeon events)\n * - **NPC**: Greets player (can interact multiple times)\n * \n * @param interactable - The object being interacted with\n * @returns The result of the interaction\n * \n * @example\n * ```typescript\n * const result = interact(chest);\n * if (result.items) {\n *   player.inventory.push(...result.items);\n * }\n * if (result.damage) {\n *   player.takeDamage(result.damage);\n * }\n * ```\n */\nexport function interact(interactable: Interactable): InteractionResult {\n    if (interactable.used && interactable.type !== InteractableType.NPC) {\n        return {\n            message: `The ${interactable.name} has already been used.`,\n            consumed: false\n        };\n    }\n\n    switch (interactable.type) {\n        case InteractableType.CHEST: {\n            interactable.used = true;\n            \n            // Build detailed message about chest contents\n            const lootParts: string[] = [];\n            if (interactable.contents && interactable.contents.length > 0) {\n                const itemNames = interactable.contents.map(item => item.name);\n                if (itemNames.length === 1) {\n                    lootParts.push(itemNames[0]);\n                } else if (itemNames.length === 2) {\n                    lootParts.push(`${itemNames[0]} and ${itemNames[1]}`);\n                } else {\n                    const lastItem = itemNames.pop();\n                    lootParts.push(`${itemNames.join(', ')}, and ${lastItem}`);\n                }\n            }\n            if (interactable.gold && interactable.gold > 0) {\n                lootParts.push(`${interactable.gold} gold`);\n            }\n            \n            const lootDescription = lootParts.length > 0 \n                ? lootParts.join(' and ') \n                : 'nothing';\n            \n            return {\n                message: `You open the ${interactable.name} and find ${lootDescription}!`,\n                items: interactable.contents,\n                gold: interactable.gold,\n                consumed: true\n            };\n        }\n\n        case InteractableType.TRAP:\n            if (interactable.disarmed) {\n                return {\n                    message: `The ${interactable.name} has been disarmed.`,\n                    consumed: false\n                };\n            }\n            interactable.used = true;\n            return triggerTrap(interactable);\n\n        case InteractableType.ALTAR: {\n            interactable.used = true;\n            if (interactable.contents && interactable.contents.length > 0) {\n                const itemNames = interactable.contents.map(item => item.name).join(', ');\n                return {\n                    message: `You pray at the ${interactable.name} and find offerings: ${itemNames}.`,\n                    items: interactable.contents,\n                    consumed: true\n                };\n            }\n            // Random blessing or curse\n            const rng = isRNGInitialized() ? getRNG() : null;\n            const roll = rng ? rng.nextFloat() : Math.random();\n            \n            if (roll < 0.4) {\n                // Stat blessing\n                const statTypes = ['attack', 'defense', 'speed'] as const;\n                const statType = statTypes[Math.floor((rng ? rng.nextFloat() : Math.random()) * statTypes.length)];\n                const bonus = rng ? rng.nextInt(2, 5) : Math.floor(Math.random() * 3) + 2;\n                const duration = rng ? rng.nextInt(5, 10) : Math.floor(Math.random() * 5) + 5;\n                return {\n                    message: `The ${interactable.name} bestows a blessing upon you! +${bonus} ${statType} for ${duration} turns.`,\n                    statBonus: { [statType]: bonus },\n                    duration,\n                    consumed: true\n                };\n            } else if (roll < 0.7) {\n                // Healing\n                const healAmount = rng ? rng.nextInt(15, 40) : Math.floor(Math.random() * 25 + 15);\n                return {\n                    message: `The ${interactable.name} glows warmly. You feel restored.`,\n                    healing: healAmount,\n                    consumed: true\n                };\n            } else if (roll < 0.85) {\n                // Gold offering\n                const goldAmount = rng ? rng.nextInt(20, 50) : Math.floor(Math.random() * 30 + 20);\n                return {\n                    message: `You find gold offerings at the ${interactable.name}.`,\n                    gold: goldAmount,\n                    consumed: true\n                };\n            } else {\n                // Curse\n                const damageAmount = rng ? rng.nextInt(8, 20) : Math.floor(Math.random() * 12 + 8);\n                return {\n                    message: `Dark energy surges from the ${interactable.name}!`,\n                    damage: damageAmount,\n                    consumed: true\n                };\n            }\n        }\n\n        case InteractableType.LEVER:\n            interactable.used = true;\n            return {\n                message: `You pull the ${interactable.name}. You hear a distant rumbling...`,\n                consumed: true\n            };\n\n        case InteractableType.NPC:\n            // NPCs can be interacted with multiple times\n            return {\n                message: `The ${interactable.name} greets you.`,\n                consumed: false\n            };\n\n        default:\n            return {\n                message: 'Nothing happens.',\n                consumed: false\n            };\n    }\n}\n\n/**\n * Triggers a trap and returns the full effect based on trap type.\n * \n * @param trap - The trap being triggered\n * @returns InteractionResult with damage and status effects\n */\nfunction triggerTrap(trap: Interactable): InteractionResult {\n    const rng = isRNGInitialized() ? getRNG() : null;\n    const trapType = trap.trapType ?? TrapType.SPIKE;\n    \n    const baseResult: InteractionResult = {\n        message: `You trigger the ${trap.name}!`,\n        damage: trap.damage,\n        consumed: true\n    };\n    \n    switch (trapType) {\n        case TrapType.SPIKE:\n            baseResult.message = `You trigger the ${trap.name}! Sharp spikes pierce your flesh for ${trap.damage} damage!`;\n            break;\n            \n        case TrapType.POISON: {\n            const poisonDuration = rng ? rng.nextInt(3, 6) : Math.floor(Math.random() * 3) + 3;\n            const poisonDamage = Math.floor((trap.damage ?? 10) / 3);\n            baseResult.message = `You trigger the ${trap.name}! Venomous darts strike you for ${trap.damage} damage and poison courses through your veins!`;\n            baseResult.trapEffect = {\n                statusEffect: {\n                    type: 'poison',\n                    duration: poisonDuration,\n                    damagePerTurn: poisonDamage\n                }\n            };\n            break;\n        }\n        \n        case TrapType.FROST: {\n            const slowDuration = rng ? rng.nextInt(2, 4) : Math.floor(Math.random() * 2) + 2;\n            baseResult.damage = Math.floor((trap.damage ?? 10) * 0.7); // Less direct damage\n            baseResult.message = `You trigger the ${trap.name}! Freezing cold blasts you for ${baseResult.damage} damage and slows your movements!`;\n            baseResult.trapEffect = {\n                statusEffect: {\n                    type: 'slow',\n                    duration: slowDuration,\n                    statReduction: 3\n                }\n            };\n            break;\n        }\n        \n        case TrapType.FIRE: {\n            const burnDuration = rng ? rng.nextInt(2, 4) : Math.floor(Math.random() * 2) + 2;\n            const burnDamage = Math.floor((trap.damage ?? 10) / 4);\n            baseResult.damage = Math.floor((trap.damage ?? 10) * 1.2); // More direct damage\n            baseResult.message = `You trigger the ${trap.name}! Flames engulf you for ${baseResult.damage} damage and you catch fire!`;\n            baseResult.trapEffect = {\n                statusEffect: {\n                    type: 'burn',\n                    duration: burnDuration,\n                    damagePerTurn: burnDamage\n                }\n            };\n            break;\n        }\n        \n        case TrapType.STUN: {\n            const stunDuration = rng ? rng.nextInt(1, 2) : 1;\n            baseResult.damage = Math.floor((trap.damage ?? 10) * 0.5); // Less direct damage\n            baseResult.message = `You trigger the ${trap.name}! Lightning courses through you for ${baseResult.damage} damage and stuns you!`;\n            baseResult.trapEffect = {\n                statusEffect: {\n                    type: 'stun',\n                    duration: stunDuration\n                }\n            };\n            break;\n        }\n        \n        case TrapType.TELEPORT:\n            baseResult.damage = 0; // No damage, just teleport\n            baseResult.message = `You trigger the ${trap.name}! Reality warps around you and you find yourself elsewhere!`;\n            baseResult.trapEffect = {\n                teleport: true\n            };\n            break;\n        \n        case TrapType.GOLD_DRAIN: {\n            const goldLost = rng ? rng.nextInt(20, 100) : Math.floor(Math.random() * 80) + 20;\n            baseResult.damage = Math.floor((trap.damage ?? 10) * 0.3); // Minimal damage\n            baseResult.message = `You trigger the ${trap.name}! A curse drains ${goldLost} gold from your pouch!`;\n            baseResult.goldLost = goldLost;\n            baseResult.trapEffect = {\n                goldLost\n            };\n            break;\n        }\n        \n        case TrapType.ALARM:\n            baseResult.damage = 0; // No direct damage\n            baseResult.message = `You trigger the ${trap.name}! A loud alarm sounds and you hear footsteps approaching!`;\n            baseResult.trapEffect = {\n                alarmTriggered: true\n            };\n            break;\n    }\n    \n    return baseResult;\n}\n\n/**\n * Attempts to detect a hidden trap.\n * \n * @param trap - The trap to detect\n * @param perceptionBonus - Player's perception skill bonus\n * @returns Object with success status and message\n */\nexport function detectTrap(trap: Interactable, perceptionBonus: number = 0): { success: boolean; message: string } {\n    if (trap.type !== InteractableType.TRAP) {\n        return { success: false, message: 'Nothing suspicious here.' };\n    }\n    \n    if (trap.detected) {\n        return { success: true, message: `You already know about the ${trap.name}.` };\n    }\n    \n    if (!trap.hidden) {\n        trap.detected = true;\n        return { success: true, message: `You spot the ${trap.name}!` };\n    }\n    \n    const rng = isRNGInitialized() ? getRNG() : null;\n    const dc = trap.disarmDC ?? 10;\n    const roll = (rng ? rng.nextInt(1, 20) : Math.floor(Math.random() * 20) + 1) + perceptionBonus;\n    \n    if (roll >= dc) {\n        trap.detected = true;\n        trap.hidden = false;\n        return { success: true, message: `Your keen senses detect a hidden ${trap.name}!` };\n    }\n    \n    return { success: false, message: 'You don\\'t notice anything unusual.' };\n}\n\n/**\n * Result of a trap disarm attempt.\n * @interface\n */\nexport interface DisarmResult {\n    /** Whether the disarm was successful */\n    success: boolean;\n    /** Message describing what happened */\n    message: string;\n    /** Damage taken if trap triggered */\n    damage?: number;\n    /** Trap effect if trap triggered */\n    trapEffect?: TrapEffect;\n    /** Whether this was a critical failure (natural 1) */\n    criticalFail?: boolean;\n    /** Relic reward for successful disarm */\n    relic?: Relic;\n}\n\n/**\n * Attempts to disarm a trap using a skill check.\n * \n * The disarm uses a D20 roll + skillBonus vs the trap's DC.\n * - Success: Trap is disarmed, chance for relic reward\n * - Critical Success (nat 20): Guaranteed relic reward\n * - Failure by 5+: Trap triggers immediately\n * - Failure by less than 5: No trigger, can try again\n * \n * @param trap - The trap to disarm\n * @param skillBonus - Player's trap disarm skill bonus (typically 0-10)\n * @param level - Dungeon level (affects relic quality)\n * @param ownedRelicIds - IDs of relics already owned (to avoid duplicates)\n * @returns DisarmResult with success status, message, and optional rewards/effects\n * \n * @example\n * ```typescript\n * const result = disarmTrap(trap, player.dexterityModifier, dungeonLevel, player.getOwnedRelicBaseIds());\n * if (result.relic) {\n *   player.addRelic(result.relic);\n * }\n * if (!result.success && result.trapEffect) {\n *   // Handle trap triggering\n * }\n * ```\n */\nexport function disarmTrap(\n    trap: Interactable, \n    skillBonus: number = 0,\n    level: number = 1,\n    ownedRelicIds: string[] = []\n): DisarmResult {\n    if (trap.type !== InteractableType.TRAP) {\n        return { success: false, message: 'This is not a trap.' };\n    }\n\n    if (trap.disarmed) {\n        return { success: true, message: 'The trap is already disarmed.' };\n    }\n\n    if (trap.used) {\n        return { success: false, message: 'The trap has already been triggered.' };\n    }\n    \n    if (!trap.detected) {\n        return { success: false, message: 'You need to detect the trap first!' };\n    }\n\n    const rng = isRNGInitialized() ? getRNG() : null;\n    const dc = trap.disarmDC ?? 10;\n    const roll = (rng ? rng.nextInt(1, 20) : Math.floor(Math.random() * 20) + 1);\n    const total = roll + skillBonus;\n    \n    // Natural 20 always succeeds with guaranteed relic\n    if (roll === 20) {\n        trap.disarmed = true;\n        const relic = cloneRelic(generateTrapRelic(dc, level, ownedRelicIds));\n        return { \n            success: true, \n            message: `Critical success! You expertly disarm the ${trap.name} and discover a hidden ${relic.name}!`,\n            relic\n        };\n    }\n    \n    // Regular success\n    if (total >= dc) {\n        trap.disarmed = true;\n        \n        // Chance for relic based on DC difficulty\n        // DC 8-10: 30% chance, DC 11-14: 50% chance, DC 15-17: 70% chance, DC 18+: 90% chance\n        let relicChance = 0.3;\n        if (dc >= 18) relicChance = 0.9;\n        else if (dc >= 15) relicChance = 0.7;\n        else if (dc >= 11) relicChance = 0.5;\n        \n        const getsRelic = rng ? rng.chance(relicChance) : Math.random() < relicChance;\n        \n        if (getsRelic) {\n            const relic = cloneRelic(generateTrapRelic(dc, level, ownedRelicIds));\n            return { \n                success: true, \n                message: `You carefully disarm the ${trap.name} and find a ${relic.name}! (Rolled ${roll}+${skillBonus}=${total} vs DC ${dc})`,\n                relic\n            };\n        }\n        \n        return { \n            success: true, \n            message: `You carefully disarm the ${trap.name}. (Rolled ${roll}+${skillBonus}=${total} vs DC ${dc})`\n        };\n    }\n    \n    // Natural 1 or failing by 5+ triggers the trap\n    const failMargin = dc - total;\n    if (roll === 1 || failMargin >= 5) {\n        trap.used = true;\n        const triggerResult = triggerTrap(trap);\n        return { \n            success: false, \n            message: `You fumble the disarm attempt and trigger the ${trap.name}! (Rolled ${roll}+${skillBonus}=${total} vs DC ${dc})`,\n            damage: triggerResult.damage,\n            trapEffect: triggerResult.trapEffect,\n            criticalFail: roll === 1\n        };\n    }\n    \n    // Failed but didn't trigger - can try again\n    return { \n        success: false, \n        message: `You fail to disarm the ${trap.name}, but avoid triggering it. (Rolled ${roll}+${skillBonus}=${total} vs DC ${dc})`\n    };\n}\n", "/**\n * @fileoverview Mysterious Event System\n * \n * This module handles random events that can occur in EVENT rooms.\n * Events can grant buffs, debuffs, powerful items, or other effects.\n * \n * @module events/mysteriousEvent\n */\n\nimport { Item, ItemType, ItemSlot, ItemRarity, DamageType, createItem, StatBonus } from '../entities/item';\nimport { getRNG, isRNGInitialized } from '../game/seed';\n\n/**\n * Types of mysterious event outcomes\n */\nexport enum EventOutcomeType {\n    /** Grants a temporary buff to the player */\n    BUFF = 'buff',\n    /** Applies a temporary debuff to the player */\n    DEBUFF = 'debuff',\n    /** Grants a powerful weapon */\n    WEAPON = 'weapon',\n    /** Grants powerful armor */\n    ARMOR = 'armor',\n    /** Grants a healing potion */\n    POTION = 'potion',\n    /** Grants gold */\n    GOLD = 'gold',\n    /** Heals the player */\n    HEAL = 'heal',\n    /** Damages the player */\n    DAMAGE = 'damage',\n}\n\n/**\n * Represents a mysterious event outcome\n */\nexport interface EventOutcome {\n    /** Type of outcome */\n    type: EventOutcomeType;\n    /** Display name of the outcome */\n    name: string;\n    /** Description of what happened */\n    description: string;\n    /** Item granted (for WEAPON, ARMOR, POTION) */\n    item?: Item;\n    /** Buff/debuff stats (for BUFF, DEBUFF) */\n    statBonus?: StatBonus;\n    /** Duration in turns (for BUFF, DEBUFF) */\n    duration?: number;\n    /** Gold amount (for GOLD) */\n    gold?: number;\n    /** Health change (positive for HEAL, negative for DAMAGE) */\n    healthChange?: number;\n    /** Whether the outcome is positive for the player */\n    isPositive: boolean;\n}\n\n/**\n * Represents a mysterious event with multiple possible outcomes\n */\nexport interface MysteriousEvent {\n    /** Unique identifier */\n    id: string;\n    /** Event title */\n    title: string;\n    /** Event description/flavor text */\n    description: string;\n    /** The outcome of the event */\n    outcome: EventOutcome;\n}\n\n// ============================================================================\n// EVENT TEMPLATES\n// ============================================================================\n\n/** Buff templates with varying power levels */\nconst BUFF_TEMPLATES = [\n    { name: 'Blessing of Strength', stat: 'attack', value: 5, duration: 10, desc: 'Your muscles surge with power!' },\n    { name: 'Iron Skin', stat: 'defense', value: 5, duration: 10, desc: 'Your skin hardens like iron!' },\n    { name: 'Swift Feet', stat: 'speed', value: 10, duration: 10, desc: 'You feel light as a feather!' },\n    { name: 'Arcane Infusion', stat: 'maxMana', value: 20, duration: 15, desc: 'Magical energy flows through you!' },\n    { name: 'Vitality Surge', stat: 'maxHealth', value: 30, duration: 15, desc: 'Life force courses through your veins!' },\n    { name: 'Lucky Charm', stat: 'critChance', value: 10, duration: 10, desc: 'Fortune smiles upon you!' },\n];\n\n/** Debuff templates */\nconst DEBUFF_TEMPLATES = [\n    { name: 'Curse of Weakness', stat: 'attack', value: -3, duration: 8, desc: 'A dark curse saps your strength...' },\n    { name: 'Brittle Bones', stat: 'defense', value: -3, duration: 8, desc: 'Your defenses feel fragile...' },\n    { name: 'Sluggish Mind', stat: 'speed', value: -5, duration: 8, desc: 'Your reactions slow...' },\n    { name: 'Mana Drain', stat: 'maxMana', value: -10, duration: 10, desc: 'Your magical reserves diminish...' },\n];\n\n/** Powerful weapon templates */\nconst WEAPON_TEMPLATES = [\n    {\n        name: 'Blade of the Fallen',\n        description: 'A sword that whispers of ancient battles',\n        damage: { dice: '2d6', bonus: 3, type: DamageType.SLASHING },\n        stats: { attack: 4, critChance: 5 },\n        rarity: ItemRarity.RARE,\n    },\n    {\n        name: 'Thunderstrike Mace',\n        description: 'Crackles with barely contained lightning',\n        damage: { dice: '1d10', bonus: 4, type: DamageType.BLUDGEONING },\n        stats: { attack: 5 },\n        rarity: ItemRarity.RARE,\n    },\n    {\n        name: 'Shadowfang Dagger',\n        description: 'Seems to drink in the light around it',\n        damage: { dice: '1d6', bonus: 2, type: DamageType.PIERCING },\n        stats: { attack: 2, speed: 5, critChance: 10 },\n        rarity: ItemRarity.RARE,\n    },\n    {\n        name: 'Infernal Greataxe',\n        description: 'Burns with hellfire that never dies',\n        damage: { dice: '2d8', bonus: 5, type: DamageType.FIRE },\n        stats: { attack: 6 },\n        rarity: ItemRarity.EPIC,\n    },\n];\n\n/** Powerful armor templates */\nconst ARMOR_TEMPLATES = [\n    {\n        name: 'Dragonscale Mail',\n        description: 'Forged from the scales of an ancient dragon',\n        stats: { defense: 6, maxHealth: 20 },\n        rarity: ItemRarity.RARE,\n    },\n    {\n        name: 'Cloak of Shadows',\n        description: 'Makes you harder to hit',\n        stats: { defense: 3, speed: 8 },\n        rarity: ItemRarity.RARE,\n    },\n    {\n        name: 'Platemail of the Guardian',\n        description: 'Heavy but nearly impenetrable',\n        stats: { defense: 8, speed: -2 },\n        rarity: ItemRarity.RARE,\n    },\n    {\n        name: 'Robes of the Archmage',\n        description: 'Woven with threads of pure magic',\n        stats: { defense: 2, maxMana: 30, mana: 15 },\n        rarity: ItemRarity.EPIC,\n    },\n];\n\n/** Potion templates */\nconst POTION_TEMPLATES = [\n    {\n        name: 'Greater Healing Potion',\n        description: 'Restores a significant amount of health',\n        healing: { dice: '4d4', bonus: 8 },\n        rarity: ItemRarity.UNCOMMON,\n    },\n    {\n        name: 'Elixir of Vitality',\n        description: 'Fully restores health and grants temporary vigor',\n        healing: { dice: '6d6', bonus: 10 },\n        buff: { maxHealth: 20 },\n        buffDuration: 5,\n        rarity: ItemRarity.RARE,\n    },\n    {\n        name: 'Potion of Giant Strength',\n        description: 'Grants immense strength for a time',\n        buff: { attack: 8 },\n        buffDuration: 8,\n        rarity: ItemRarity.RARE,\n    },\n];\n\n/** Event flavor text for different outcomes */\nconst EVENT_DESCRIPTIONS = {\n    altar: [\n        'You approach a mysterious altar glowing with ethereal light...',\n        'An ancient shrine pulses with unknown energy...',\n        'A weathered statue seems to watch you with knowing eyes...',\n    ],\n    chest: [\n        'You discover a ornate chest hidden in the shadows...',\n        'A golden coffer sits atop a stone pedestal...',\n        'An ancient lockbox bears strange runes...',\n    ],\n    spirit: [\n        'A ghostly figure materializes before you...',\n        'The air shimmers and a spectral form appears...',\n        'You sense a presence watching from beyond the veil...',\n    ],\n};\n\n// ============================================================================\n// EVENT GENERATION\n// ============================================================================\n\n/**\n * Generates a random mysterious event based on dungeon level.\n * Higher levels have better rewards but also worse debuffs.\n * \n * @param level - Current dungeon level (1-20)\n * @returns A generated MysteriousEvent\n */\nexport function generateMysteriousEvent(level: number): MysteriousEvent {\n    const rng = isRNGInitialized() ? getRNG() : null;\n    const random = () => rng ? rng.nextFloat() : Math.random();\n    const choice = <T>(arr: T[]): T => arr[Math.floor(random() * arr.length)];\n    \n    // Determine outcome type based on weighted probabilities\n    // Higher levels have slightly better odds for good outcomes\n    const levelBonus = Math.min(level / 40, 0.15); // Max 15% bonus at level 20\n    const roll = random();\n    \n    let outcomeType: EventOutcomeType;\n    if (roll < 0.20 + levelBonus) {\n        outcomeType = EventOutcomeType.WEAPON;\n    } else if (roll < 0.35 + levelBonus) {\n        outcomeType = EventOutcomeType.ARMOR;\n    } else if (roll < 0.50 + levelBonus) {\n        outcomeType = EventOutcomeType.POTION;\n    } else if (roll < 0.65 + levelBonus) {\n        outcomeType = EventOutcomeType.BUFF;\n    } else if (roll < 0.75) {\n        outcomeType = EventOutcomeType.GOLD;\n    } else if (roll < 0.85) {\n        outcomeType = EventOutcomeType.HEAL;\n    } else if (roll < 0.92) {\n        outcomeType = EventOutcomeType.DEBUFF;\n    } else {\n        outcomeType = EventOutcomeType.DAMAGE;\n    }\n    \n    const outcome = generateOutcome(outcomeType, level, choice);\n    const eventType = choice(['altar', 'chest', 'spirit'] as const);\n    const description = choice(EVENT_DESCRIPTIONS[eventType]);\n    \n    return {\n        id: crypto.randomUUID(),\n        title: getEventTitle(eventType),\n        description,\n        outcome,\n    };\n}\n\n/**\n * Gets a title for the event based on type.\n */\nfunction getEventTitle(type: 'altar' | 'chest' | 'spirit'): string {\n    switch (type) {\n        case 'altar': return 'Mysterious Altar';\n        case 'chest': return 'Hidden Treasure';\n        case 'spirit': return 'Spectral Encounter';\n    }\n}\n\n/**\n * Generates a specific outcome based on type and level.\n */\nfunction generateOutcome(\n    type: EventOutcomeType,\n    level: number,\n    choice: <T>(arr: T[]) => T\n): EventOutcome {\n    switch (type) {\n        case EventOutcomeType.BUFF: {\n            const template = choice(BUFF_TEMPLATES);\n            const scaledValue = Math.floor(template.value * (1 + level / 20));\n            return {\n                type: EventOutcomeType.BUFF,\n                name: template.name,\n                description: template.desc,\n                statBonus: { [template.stat]: scaledValue },\n                duration: template.duration,\n                isPositive: true,\n            };\n        }\n        \n        case EventOutcomeType.DEBUFF: {\n            const template = choice(DEBUFF_TEMPLATES);\n            return {\n                type: EventOutcomeType.DEBUFF,\n                name: template.name,\n                description: template.desc,\n                statBonus: { [template.stat]: template.value },\n                duration: template.duration,\n                isPositive: false,\n            };\n        }\n        \n        case EventOutcomeType.WEAPON: {\n            const template = choice(WEAPON_TEMPLATES);\n            const item = createItem({\n                id: `event-weapon-${crypto.randomUUID()}`,\n                name: template.name,\n                type: ItemType.WEAPON,\n                slot: ItemSlot.WEAPON,\n                rarity: template.rarity,\n                value: 100 + level * 20,\n                description: template.description,\n                damage: template.damage,\n                statBonus: template.stats,\n            });\n            return {\n                type: EventOutcomeType.WEAPON,\n                name: template.name,\n                description: `You found ${template.name}! ${template.description}`,\n                item,\n                isPositive: true,\n            };\n        }\n        \n        case EventOutcomeType.ARMOR: {\n            const template = choice(ARMOR_TEMPLATES);\n            const item = createItem({\n                id: `event-armor-${crypto.randomUUID()}`,\n                name: template.name,\n                type: ItemType.ARMOR,\n                slot: ItemSlot.ARMOR,\n                rarity: template.rarity,\n                value: 80 + level * 15,\n                description: template.description,\n                statBonus: template.stats,\n            });\n            return {\n                type: EventOutcomeType.ARMOR,\n                name: template.name,\n                description: `You found ${template.name}! ${template.description}`,\n                item,\n                isPositive: true,\n            };\n        }\n        \n        case EventOutcomeType.POTION: {\n            const template = choice(POTION_TEMPLATES);\n            const item = createItem({\n                id: `event-potion-${crypto.randomUUID()}`,\n                name: template.name,\n                type: ItemType.CONSUMABLE,\n                slot: ItemSlot.CONSUMABLE,\n                rarity: template.rarity,\n                value: 50 + level * 5,\n                description: template.description,\n                consumeEffect: {\n                    healing: template.healing,\n                    buff: template.buff,\n                    buffDuration: template.buffDuration,\n                },\n            });\n            return {\n                type: EventOutcomeType.POTION,\n                name: template.name,\n                description: `You found ${template.name}! ${template.description}`,\n                item,\n                isPositive: true,\n            };\n        }\n        \n        case EventOutcomeType.GOLD: {\n            const goldAmount = 50 + Math.floor(level * 15 * (0.8 + Math.random() * 0.4));\n            return {\n                type: EventOutcomeType.GOLD,\n                name: 'Gold Cache',\n                description: `You discovered a hidden cache of ${goldAmount} gold!`,\n                gold: goldAmount,\n                isPositive: true,\n            };\n        }\n        \n        case EventOutcomeType.HEAL: {\n            const healPercent = 0.3 + Math.random() * 0.2; // 30-50% heal\n            return {\n                type: EventOutcomeType.HEAL,\n                name: 'Healing Light',\n                description: 'A warm light washes over you, healing your wounds.',\n                healthChange: healPercent, // Will be converted to actual HP in execution\n                isPositive: true,\n            };\n        }\n        \n        case EventOutcomeType.DAMAGE: {\n            const damagePercent = 0.1 + Math.random() * 0.15; // 10-25% damage\n            return {\n                type: EventOutcomeType.DAMAGE,\n                name: 'Dark Curse',\n                description: 'A malevolent force strikes you!',\n                healthChange: -damagePercent, // Negative for damage\n                isPositive: false,\n            };\n        }\n    }\n}\n\n/**\n * Gets a display message for the event outcome.\n */\nexport function getOutcomeMessage(outcome: EventOutcome): string {\n    switch (outcome.type) {\n        case EventOutcomeType.BUFF:\n            return `${outcome.name} - ${outcome.description} (+${Object.entries(outcome.statBonus || {}).map(([k, v]) => `${v} ${k}`).join(', ')} for ${outcome.duration} turns)`;\n        case EventOutcomeType.DEBUFF:\n            return `${outcome.name} - ${outcome.description} (${Object.entries(outcome.statBonus || {}).map(([k, v]) => `${v} ${k}`).join(', ')} for ${outcome.duration} turns)`;\n        case EventOutcomeType.WEAPON:\n        case EventOutcomeType.ARMOR:\n        case EventOutcomeType.POTION:\n            return outcome.description;\n        case EventOutcomeType.GOLD:\n            return outcome.description;\n        case EventOutcomeType.HEAL:\n            return outcome.description;\n        case EventOutcomeType.DAMAGE:\n            return outcome.description;\n        default:\n            return outcome.description;\n    }\n}\n\n", "/**\n * @fileoverview Puzzle System for Dungeon Roguelike\n * \n * This module handles puzzle rooms with various puzzle types:\n * - Riddles: Answer a riddle correctly\n * - Sequence: Remember and repeat a pattern\n * - Math: Solve a mathematical problem\n * \n * @module puzzles/puzzle\n */\n\nimport { getRNG, isRNGInitialized } from '../game/seed';\n\n/**\n * Types of puzzles that can appear in puzzle rooms\n */\nexport enum PuzzleType {\n    /** Answer a riddle */\n    RIDDLE = 'riddle',\n    /** Remember and repeat a sequence */\n    SEQUENCE = 'sequence',\n    /** Solve a math problem */\n    MATH = 'math',\n}\n\n/**\n * Represents a puzzle challenge\n */\nexport interface Puzzle {\n    /** Unique identifier */\n    id: string;\n    /** Type of puzzle */\n    type: PuzzleType;\n    /** Puzzle title */\n    title: string;\n    /** The puzzle question or challenge */\n    question: string;\n    /** Possible answers (for multiple choice) */\n    options: string[];\n    /** Index of the correct answer in options */\n    correctIndex: number;\n    /** Hint for the puzzle */\n    hint: string;\n    /** Whether the puzzle has been solved */\n    solved: boolean;\n    /** Number of attempts made */\n    attempts: number;\n    /** Maximum attempts allowed */\n    maxAttempts: number;\n    /** Reward multiplier based on attempts (1.0 = full reward) */\n    rewardMultiplier: number;\n}\n\n/**\n * Result of attempting to solve a puzzle\n */\nexport interface PuzzleSolveResult {\n    /** Whether the answer was correct */\n    correct: boolean;\n    /** Message to display */\n    message: string;\n    /** Whether the puzzle is now complete (solved or failed) */\n    complete: boolean;\n    /** Remaining attempts if incorrect */\n    remainingAttempts?: number;\n}\n\n// ============================================================================\n// RIDDLE TEMPLATES\n// ============================================================================\n\nconst RIDDLES = [\n    {\n        question: \"I have cities, but no houses live there. I have mountains, but no trees grow there. I have water, but no fish swim there. What am I?\",\n        options: [\"A painting\", \"A map\", \"A dream\", \"A mirror\"],\n        correctIndex: 1,\n        hint: \"Adventurers use me to find their way.\"\n    },\n    {\n        question: \"The more you take, the more you leave behind. What am I?\",\n        options: [\"Memories\", \"Footsteps\", \"Breaths\", \"Time\"],\n        correctIndex: 1,\n        hint: \"Look down as you walk.\"\n    },\n    {\n        question: \"I speak without a mouth and hear without ears. I have no body, but I come alive with the wind. What am I?\",\n        options: [\"A ghost\", \"An echo\", \"A shadow\", \"A whisper\"],\n        correctIndex: 1,\n        hint: \"Shout in a canyon and you'll find me.\"\n    },\n    {\n        question: \"What has keys but no locks, space but no room, and you can enter but can't go inside?\",\n        options: [\"A keyboard\", \"A piano\", \"A treasure chest\", \"A riddle\"],\n        correctIndex: 0,\n        hint: \"Wizards use these to write their spells.\"\n    },\n    {\n        question: \"I am not alive, but I grow. I don't have lungs, but I need air. What am I?\",\n        options: [\"A crystal\", \"Fire\", \"A shadow\", \"Moss\"],\n        correctIndex: 1,\n        hint: \"Dragons breathe this.\"\n    },\n    {\n        question: \"What can travel around the world while staying in a corner?\",\n        options: [\"A spider\", \"A stamp\", \"A shadow\", \"The wind\"],\n        correctIndex: 1,\n        hint: \"Found on letters and parcels.\"\n    },\n    {\n        question: \"The more of me there is, the less you see. What am I?\",\n        options: [\"Fog\", \"Darkness\", \"Smoke\", \"All of these\"],\n        correctIndex: 3,\n        hint: \"Rogues love to hide in me.\"\n    },\n    {\n        question: \"I have hands but cannot clap. What am I?\",\n        options: [\"A statue\", \"A clock\", \"A tree\", \"A puppet\"],\n        correctIndex: 1,\n        hint: \"I tell you when it's time for adventure.\"\n    },\n];\n\n// ============================================================================\n// SEQUENCE TEMPLATES\n// ============================================================================\n\nconst SEQUENCE_ELEMENTS = ['Fire', 'Water', 'Earth', 'Air', 'Light', 'Shadow'];\nconst SEQUENCE_SYMBOLS = ['\uD83D\uDD25', '\uD83D\uDCA7', '\uD83C\uDF0D', '\uD83D\uDCA8', '\u2728', '\uD83C\uDF11'];\n\n// ============================================================================\n// MATH TEMPLATES\n// ============================================================================\n\nfunction generateMathPuzzle(level: number): { question: string; options: string[]; correctIndex: number; hint: string } {\n    const rng = isRNGInitialized() ? getRNG() : null;\n    const random = () => rng ? rng.nextFloat() : Math.random();\n    const randInt = (min: number, max: number) => Math.floor(random() * (max - min + 1)) + min;\n    \n    // Difficulty scales with level\n    const maxNum = 10 + level * 2;\n    \n    const puzzleType = randInt(0, 2);\n    let a: number, b: number, answer: number, question: string, hint: string;\n    \n    switch (puzzleType) {\n        case 0: // Addition\n            a = randInt(5, maxNum);\n            b = randInt(5, maxNum);\n            answer = a + b;\n            question = `A warrior has ${a} swords. He finds ${b} more in a chest. How many swords does he have now?`;\n            hint = \"Add them together.\";\n            break;\n        case 1: // Multiplication\n            a = randInt(2, Math.min(12, 5 + Math.floor(level / 3)));\n            b = randInt(2, Math.min(12, 5 + Math.floor(level / 3)));\n            answer = a * b;\n            question = `A dungeon has ${a} floors. Each floor has ${b} rooms. How many rooms are there in total?`;\n            hint = \"Multiply the numbers.\";\n            break;\n        case 2: // Subtraction\n            a = randInt(20, maxNum * 2);\n            b = randInt(5, a - 5);\n            answer = a - b;\n            question = `A mage has ${a} mana points. She casts a spell costing ${b} mana. How much mana remains?`;\n            hint = \"Subtract to find the remainder.\";\n            break;\n        default:\n            a = 10; b = 5; answer = 15;\n            question = `What is ${a} + ${b}?`;\n            hint = \"Basic addition.\";\n    }\n    \n    // Generate wrong answers\n    const wrongAnswers = [\n        answer + randInt(1, 5),\n        answer - randInt(1, 5),\n        answer + randInt(6, 10),\n    ].filter(w => w !== answer && w > 0);\n    \n    // Shuffle options\n    const options = [answer.toString(), ...wrongAnswers.slice(0, 3).map(String)];\n    const correctIndex = 0;\n    \n    // Shuffle the options\n    for (let i = options.length - 1; i > 0; i--) {\n        const j = Math.floor(random() * (i + 1));\n        [options[i], options[j]] = [options[j], options[i]];\n    }\n    \n    return {\n        question,\n        options,\n        correctIndex: options.indexOf(answer.toString()),\n        hint\n    };\n}\n\n// ============================================================================\n// PUZZLE GENERATION\n// ============================================================================\n\n/**\n * Generates a random puzzle based on dungeon level.\n * \n * @param level - Current dungeon level\n * @returns A generated Puzzle\n */\nexport function generatePuzzle(level: number): Puzzle {\n    const rng = isRNGInitialized() ? getRNG() : null;\n    const random = () => rng ? rng.nextFloat() : Math.random();\n    \n    // Choose puzzle type\n    const typeRoll = random();\n    let type: PuzzleType;\n    if (typeRoll < 0.5) {\n        type = PuzzleType.RIDDLE;\n    } else if (typeRoll < 0.8) {\n        type = PuzzleType.MATH;\n    } else {\n        type = PuzzleType.SEQUENCE;\n    }\n    \n    let title: string;\n    let question: string;\n    let options: string[];\n    let correctIndex: number;\n    let hint: string;\n    \n    switch (type) {\n        case PuzzleType.RIDDLE: {\n            const riddle = RIDDLES[Math.floor(random() * RIDDLES.length)];\n            title = \"Ancient Riddle\";\n            question = riddle.question;\n            options = [...riddle.options];\n            correctIndex = riddle.correctIndex;\n            hint = riddle.hint;\n            break;\n        }\n        \n        case PuzzleType.SEQUENCE: {\n            // Generate a sequence of 3-5 elements based on level\n            const length = Math.min(3 + Math.floor(level / 5), 5);\n            const sequence: number[] = [];\n            for (let i = 0; i < length; i++) {\n                sequence.push(Math.floor(random() * SEQUENCE_ELEMENTS.length));\n            }\n            \n            title = \"Elemental Sequence\";\n            question = `Repeat the sequence: ${sequence.map(i => SEQUENCE_SYMBOLS[i]).join(' \u2192 ')}`;\n            \n            // Create options including the correct sequence and wrong ones\n            const correctAnswer = sequence.map(i => SEQUENCE_ELEMENTS[i]).join(', ');\n            const wrongSequences = [\n                [...sequence].reverse().map(i => SEQUENCE_ELEMENTS[i]).join(', '),\n                sequence.map(i => SEQUENCE_ELEMENTS[(i + 1) % SEQUENCE_ELEMENTS.length]).join(', '),\n                sequence.map(i => SEQUENCE_ELEMENTS[(i + 2) % SEQUENCE_ELEMENTS.length]).join(', '),\n            ];\n            \n            options = [correctAnswer, ...wrongSequences];\n            correctIndex = 0;\n            \n            // Shuffle\n            for (let i = options.length - 1; i > 0; i--) {\n                const j = Math.floor(random() * (i + 1));\n                [options[i], options[j]] = [options[j], options[i]];\n            }\n            correctIndex = options.indexOf(correctAnswer);\n            hint = \"Follow the symbols in order.\";\n            break;\n        }\n        \n        case PuzzleType.MATH: {\n            const mathPuzzle = generateMathPuzzle(level);\n            title = \"Numerical Challenge\";\n            question = mathPuzzle.question;\n            options = mathPuzzle.options;\n            correctIndex = mathPuzzle.correctIndex;\n            hint = mathPuzzle.hint;\n            break;\n        }\n    }\n    \n    return {\n        id: crypto.randomUUID(),\n        type,\n        title,\n        question,\n        options,\n        correctIndex,\n        hint,\n        solved: false,\n        attempts: 0,\n        maxAttempts: 3,\n        rewardMultiplier: 1.0\n    };\n}\n\n/**\n * Attempts to solve a puzzle with the given answer.\n * \n * @param puzzle - The puzzle to solve\n * @param answerIndex - Index of the selected answer\n * @returns Result of the attempt\n */\nexport function attemptPuzzle(puzzle: Puzzle, answerIndex: number): PuzzleSolveResult {\n    if (puzzle.solved) {\n        return {\n            correct: true,\n            message: \"This puzzle has already been solved.\",\n            complete: true\n        };\n    }\n    \n    puzzle.attempts++;\n    \n    if (answerIndex === puzzle.correctIndex) {\n        puzzle.solved = true;\n        // Reduce reward based on attempts\n        puzzle.rewardMultiplier = Math.max(0.5, 1.0 - (puzzle.attempts - 1) * 0.25);\n        \n        return {\n            correct: true,\n            message: puzzle.attempts === 1 \n                ? \"Brilliant! You solved it on the first try!\" \n                : `Correct! Solved in ${puzzle.attempts} attempts.`,\n            complete: true\n        };\n    }\n    \n    const remainingAttempts = puzzle.maxAttempts - puzzle.attempts;\n    \n    if (remainingAttempts <= 0) {\n        return {\n            correct: false,\n            message: `Wrong! The puzzle locks itself. The answer was: ${puzzle.options[puzzle.correctIndex]}`,\n            complete: true,\n            remainingAttempts: 0\n        };\n    }\n    \n    return {\n        correct: false,\n        message: `Incorrect. ${remainingAttempts} attempt${remainingAttempts > 1 ? 's' : ''} remaining. Hint: ${puzzle.hint}`,\n        complete: false,\n        remainingAttempts\n    };\n}\n\n", "/**\n * @fileoverview Room System for Dungeon Roguelike\n * \n * This module defines the Room class and related types that form the core\n * structure of the dungeon. Rooms are the primary navigation and interaction\n * points in the game, containing enemies, interactables, and rewards.\n * \n * Room Types:\n * - ENTRANCE: Starting room\n * - COMBAT: Standard enemy encounters\n * - ELITE: Difficult encounters with better rewards\n * - BOSS: Final challenge room\n * - TREASURE: Guaranteed loot rooms\n * - REST: Safe rooms for healing\n * - SHOP: Purchase items and equipment\n * - EVENT: Random events with various outcomes\n * - PUZZLE: Logic/skill challenges\n * \n * @module dungeon/room\n */\n\nimport { Enemy, MonsterAPI } from '../entities/enemy';\nimport { Item } from '../entities/item';\nimport { generateLootForLevel, cloneItem, generateShopInventory, ShopItem } from '../entities/itemDatabase';\nimport { Interactable, InteractableType, createInteractable, interact, InteractionResult } from './Interactable';\nimport { getRNG, isRNGInitialized } from '../game/seed';\nimport { MysteriousEvent, generateMysteriousEvent } from '../events/mysteriousEvent';\nimport { Puzzle, generatePuzzle } from '../puzzles/puzzle';\n\n/**\n * Types of rooms that can appear in the dungeon.\n * Each type has different contents, rewards, and player interactions.\n * @enum {string}\n */\nexport enum RoomType {\n    /** Final challenge room with powerful boss enemy */\n    BOSS = 'boss',\n    /** Standard combat encounter */\n    COMBAT = 'combat',\n    /** Difficult combat with stronger enemies and better rewards */\n    ELITE = 'elite',\n    /** Starting room of the dungeon */\n    ENTRANCE = 'entrance',\n    /** Random event with various outcomes */\n    EVENT = 'event',\n    /** Logic/skill challenge room */\n    PUZZLE = 'puzzle',\n    /** Safe room for healing and upgrades */\n    REST = 'rest',\n    /** Purchase items and equipment */\n    SHOP = 'shop',\n    /** Loot room with guaranteed rewards */\n    TREASURE = 'treasure'\n}\n\n/**\n * Possible states a room can be in during gameplay.\n * @enum {string}\n */\nexport enum RoomState {\n    /** Player is currently in this room */\n    ACTIVE = 'active',\n    /** Room can be entered (connected to a cleared room) */\n    AVAILABLE = 'available',\n    /** Room has been completed */\n    CLEARED = 'cleared',\n    /** Room cannot be entered yet (not connected to cleared room) */\n    LOCKED = 'locked'\n}\n\n/**\n * Reward configuration for completing a room.\n * @interface\n */\nexport interface Reward {\n    /** Items dropped upon completion */\n    items: Item[];\n    /** Gold awarded */\n    gold: number;\n    /** Experience points awarded */\n    experience: number;\n    /** Optional health restoration (for rest rooms) */\n    healthRestore?: number;\n}\n\n/**\n * Serialized representation of a Room for save/load.\n * @interface\n */\nexport interface RoomJSON {\n    /** Unique room identifier */\n    id: string;\n    /** Room type */\n    type: RoomType;\n    /** Dungeon level (1-20) */\n    level: number;\n    /** Current room state */\n    state: RoomState;\n    /** IDs of connected rooms */\n    connections: string[];\n    /** Room completion rewards */\n    reward: Reward;\n    /** Enemies in the room (if hostile) */\n    enemies?: Enemy[];\n    /** Interactable objects in the room */\n    interactables: Interactable[];\n    /** Flavor text description */\n    description: string;\n}\n\n/**\n * Reward multiplier constants for different room types.\n * @const\n */\nconst REWARD_CONSTANTS = {\n    /** Base gold reward per level */\n    BASE_GOLD: 50,\n    /** Base XP reward per level */\n    BASE_XP: 100,\n    /** Gold multiplier for treasure rooms */\n    TREASURE_GOLD_MULTIPLIER: 3,\n    /** XP/gold multiplier for elite rooms */\n    ELITE_MULTIPLIER: 1.5,\n    /** XP multiplier for boss rooms */\n    BOSS_XP_MULTIPLIER: 3,\n    /** Gold multiplier for boss rooms */\n    BOSS_GOLD_MULTIPLIER: 2,\n    /** Health restored in rest rooms */\n    REST_HEALTH_RESTORE: 100,\n    /** XP multiplier for combat rooms */\n    COMBAT_XP_MULTIPLIER: 1.2,\n    /** Gold multiplier for puzzle rooms */\n    PUZZLE_GOLD_MULTIPLIER: 0.5,\n    /** XP multiplier for puzzle rooms */\n    PUZZLE_XP_MULTIPLIER: 1.5,\n    /** Gold multiplier for event rooms */\n    EVENT_GOLD_MULTIPLIER: 0.75,\n    /** XP multiplier for event rooms */\n    EVENT_XP_MULTIPLIER: 0.75\n} as const;\n\n/**\n * Represents a single room in the dungeon.\n * \n * Rooms are the fundamental building blocks of the dungeon, containing:\n * - A type that determines behavior and contents\n * - Connections to other rooms forming the dungeon graph\n * - Enemies (for hostile rooms)\n * - Interactable objects (chests, traps, altars, etc.)\n * - Rewards for completion\n * \n * Use the static `create()` factory method to instantiate rooms, as it\n * handles async operations like fetching enemies from the API.\n * \n * @example\n * ```typescript\n * const room = Room.create(RoomType.COMBAT, 5);\n * if (room.canEnter()) {\n *   room.enter();\n *   // ... player fights enemies ...\n *   const rewards = room.complete();\n * }\n * ```\n */\nexport class Room {\n    /** Unique identifier for the room */\n    public readonly id: string = crypto.randomUUID();\n    \n    /** The type of room (combat, treasure, shop, etc.) */\n    public type: RoomType;\n    \n    /** The dungeon level this room is on (1-20) */\n    public level: number;\n    \n    /** Current state of the room (locked, available, active, cleared) */\n    public state: RoomState;\n    \n    /** IDs of rooms connected to this one */\n    public connections: string[];\n    \n    /** Rewards granted upon completing the room */\n    public reward: Reward;\n    \n    /** Enemies present in hostile rooms */\n    public enemies?: Enemy[];\n    \n    /** Whether enemies have been loaded from API (for lazy loading) */\n    private enemiesLoaded: boolean = false;\n    \n    /** Interactable objects in the room (chests, traps, altars, etc.) */\n    public interactables: Interactable[] = [];\n    \n    /** Flavor text description of the room */\n    public description: string;\n    \n    /** Mysterious event for EVENT rooms (generated on first enter) */\n    public event?: MysteriousEvent;\n    \n    /** Shop inventory for SHOP rooms (generated on first enter) */\n    public shopInventory?: ShopItem[];\n    \n    /** Puzzle for PUZZLE rooms (generated on first enter) */\n    public puzzle?: Puzzle;\n\n    /**\n     * Private constructor - use Room.create() factory method instead.\n     * \n     * @param type - The type of room to create\n     * @param level - The dungeon level (affects difficulty and rewards)\n     * @private\n     */\n    private constructor(type: RoomType, level: number) {\n        this.type = type ?? RoomType.ENTRANCE;\n        this.level = Math.max(1, level ?? 1);\n        this.state = RoomState.LOCKED;\n        this.connections = [];\n        this.interactables = [];\n        this.reward = this.generateReward();\n        this.description = this.generateDescription();\n    }\n\n    /**\n     * Factory method to create a new Room instance.\n     * Creates the room synchronously without fetching enemy data.\n     * Enemy data is loaded lazily when entering the room via ensureEnemiesLoaded().\n     * \n     * @param type - The type of room to create\n     * @param level - The dungeon level (affects difficulty and rewards)\n     * @returns The created Room (synchronous)\n     * \n     * @example\n     * ```typescript\n     * const combatRoom = Room.create(RoomType.COMBAT, 5);\n     * const shopRoom = Room.create(RoomType.SHOP, 10);\n     * // Later, when entering:\n     * await combatRoom.ensureEnemiesLoaded();\n     * ```\n     */\n    static create(type: RoomType, level: number): Room {\n        const room = new Room(type, level);\n        room.populateInteractables();\n        return room;\n    }\n\n    /**\n     * Creates a bidirectional connection between this room and another room.\n     * Both rooms will have each other in their connections array.\n     * \n     * @param room - The room to connect to\n     */\n    connectTo(room: Room): void {\n        if (!this.connections.includes(room.id)) {\n            this.connections.push(room.id);\n        }\n        if (!room.connections.includes(this.id)) {\n            room.connections.push(this.id);\n        }\n    }\n\n    /**\n     * Checks if the room can be entered based on its current state.\n     * \n     * A room can be entered if:\n     * - It's the entrance room (always accessible)\n     * - Its state is AVAILABLE (connected to a cleared room)\n     * \n     * @returns true if the room can be entered\n     */\n    canEnter(): boolean {\n        // Can't enter if locked or already cleared\n        if (this.state === RoomState.LOCKED || this.state === RoomState.CLEARED) {\n            return false;\n        }\n\n        // Entrance is always available\n        if (this.type === RoomType.ENTRANCE) {\n            return true;\n        }\n\n        // Available if marked as available\n        if (this.state === RoomState.AVAILABLE) {\n            return true;\n        }\n\n        return false;\n    }\n\n    /**\n     * Enters the room, setting its state to ACTIVE.\n     * For EVENT rooms, generates the mysterious event if not already present.\n     * For SHOP rooms, generates the shop inventory if not already present.\n     * \n     * @throws Error if the room is locked\n     */\n    enter(): void {\n        if (this.state === RoomState.LOCKED) {\n            throw new Error('Room is locked');\n        }\n\n        this.state = RoomState.ACTIVE;\n        \n        // Generate event for EVENT rooms on first enter\n        if (this.type === RoomType.EVENT && !this.event) {\n            this.event = generateMysteriousEvent(this.level);\n        }\n        \n        // Generate shop inventory for SHOP rooms on first enter\n        if (this.type === RoomType.SHOP && !this.shopInventory) {\n            this.shopInventory = generateShopInventory(this.level);\n        }\n        \n        // Generate puzzle for PUZZLE rooms on first enter\n        if (this.type === RoomType.PUZZLE && !this.puzzle) {\n            this.puzzle = generatePuzzle(this.level);\n        }\n    }\n\n    /**\n     * Ensures enemies are loaded for hostile rooms.\n     * This method implements lazy loading - enemies are only fetched from the API\n     * when this method is called, not during room creation.\n     * \n     * Safe to call multiple times - will only fetch once.\n     * \n     * @returns Promise that resolves when enemies are loaded (or immediately if not needed)\n     * \n     * @example\n     * ```typescript\n     * // Before entering combat, ensure enemies are loaded\n     * await room.ensureEnemiesLoaded();\n     * const enemies = room.enemies; // Now populated\n     * ```\n     */\n    async ensureEnemiesLoaded(): Promise<void> {\n        // Skip if already loaded or not a hostile room\n        if (this.enemiesLoaded || !this.isHostileRoom()) {\n            return;\n        }\n        \n        await this.populateEnemies();\n        this.enemiesLoaded = true;\n    }\n\n    /**\n     * Checks if enemies have been loaded for this room.\n     * Useful for UI to show loading state.\n     * \n     * @returns true if enemies have been loaded (or room doesn't need enemies)\n     */\n    areEnemiesLoaded(): boolean {\n        return this.enemiesLoaded || !this.isHostileRoom();\n    }\n\n    /**\n     * Marks the room as completed and returns its rewards.\n     * \n     * @returns The Reward object containing items, gold, and experience\n     * @throws Error if the room is not currently active\n     */\n    complete(): Reward {\n        if (this.state !== RoomState.ACTIVE) {\n            throw new Error('Room is not active');\n        }\n\n        this.state = RoomState.CLEARED;\n        return this.reward;\n    }\n\n    /**\n     * Checks if this room type contains enemies.\n     * \n     * @returns true if the room is COMBAT, ELITE, or BOSS type\n     */\n    isHostileRoom(): boolean {\n        return [RoomType.COMBAT, RoomType.ELITE, RoomType.BOSS].includes(this.type);\n    }\n\n    /**\n     * Generates rewards based on room type and level.\n     * \n     * @returns The calculated Reward object\n     * @private\n     */\n    private generateReward(): Reward {\n        const { BASE_GOLD, BASE_XP } = REWARD_CONSTANTS;\n\n        let goldMultiplier = 1;\n        let xpMultiplier = 1;\n\n        switch (this.type) {\n            case RoomType.TREASURE:\n                goldMultiplier = REWARD_CONSTANTS.TREASURE_GOLD_MULTIPLIER;\n                break;\n            case RoomType.ELITE:\n                xpMultiplier = REWARD_CONSTANTS.ELITE_MULTIPLIER;\n                goldMultiplier = REWARD_CONSTANTS.ELITE_MULTIPLIER;\n                break;\n            case RoomType.BOSS:\n                xpMultiplier = REWARD_CONSTANTS.BOSS_XP_MULTIPLIER;\n                goldMultiplier = REWARD_CONSTANTS.BOSS_GOLD_MULTIPLIER;\n                break;\n            case RoomType.REST:\n                return {\n                    items: [],\n                    gold: 0,\n                    experience: 0,\n                    healthRestore: REWARD_CONSTANTS.REST_HEALTH_RESTORE\n                };\n            case RoomType.SHOP:\n                return {\n                    items: [],\n                    gold: BASE_GOLD * this.level,\n                    experience: 0\n                };\n            case RoomType.COMBAT:\n                xpMultiplier = REWARD_CONSTANTS.COMBAT_XP_MULTIPLIER;\n                break;\n            case RoomType.PUZZLE:\n                goldMultiplier = REWARD_CONSTANTS.PUZZLE_GOLD_MULTIPLIER;\n                xpMultiplier = REWARD_CONSTANTS.PUZZLE_XP_MULTIPLIER;\n                break;\n            case RoomType.EVENT:\n                goldMultiplier = REWARD_CONSTANTS.EVENT_GOLD_MULTIPLIER;\n                xpMultiplier = REWARD_CONSTANTS.EVENT_XP_MULTIPLIER;\n                break;\n            case RoomType.ENTRANCE:\n            default:\n                // Entrance and any unknown types get minimal rewards\n                goldMultiplier = 0;\n                xpMultiplier = 0;\n                break;\n        }\n\n        const gold = Math.floor(BASE_GOLD * goldMultiplier * this.level);\n        const experience = Math.floor(BASE_XP * xpMultiplier * this.level);\n\n        return {\n            items: this.generateItems(),\n            gold,\n            experience\n        };\n    }\n\n    /**\n     * Generates item drops based on room type and level.\n     * \n     * @returns Array of items to drop\n     * @private\n     */\n    private generateItems(): Item[] {\n        // Generate loot based on room type and level\n        switch (this.type) {\n            case RoomType.TREASURE:\n                // Treasure rooms guarantee equipment and give more items\n                return [\n                    ...generateLootForLevel(this.level, undefined, true), // Guarantee equipment\n                    ...generateLootForLevel(this.level)\n                ].map(item => cloneItem(item));\n\n            case RoomType.BOSS:\n                // Boss rooms guarantee multiple pieces of equipment\n                return [\n                    ...generateLootForLevel(this.level + 2, undefined, true), // Guarantee equipment\n                    ...generateLootForLevel(this.level + 1, undefined, true), // Guarantee equipment\n                    ...generateLootForLevel(this.level)\n                ].map(item => cloneItem(item));\n\n            case RoomType.ELITE:\n                // Elite rooms guarantee equipment\n                return generateLootForLevel(this.level + 1, undefined, true).map(item => cloneItem(item));\n\n            case RoomType.COMBAT:\n                // Combat rooms now have better equipment chances\n                // First combat room (level 1-2) guarantees a weapon to help players get started\n                const guaranteeEquip = this.level <= 2;\n                return generateLootForLevel(this.level, undefined, guaranteeEquip).map(item => cloneItem(item));\n\n            case RoomType.PUZZLE:\n            case RoomType.EVENT:\n                // Puzzle/Event rooms have a chance for loot\n                const shouldDropLoot = isRNGInitialized()\n                    ? getRNG().chance(0.5)\n                    : Math.random() < 0.5;\n                if (shouldDropLoot) {\n                    return generateLootForLevel(this.level).map(item => cloneItem(item));\n                }\n                return [];\n\n            default:\n                return [];\n        }\n    }\n\n    /**\n     * Fetches and assigns enemies to this room from the D&D 5e API.\n     * Enemy count and difficulty scales with room type and level.\n     * Boss and Elite rooms always have exactly 1 enemy.\n     * \n     * @returns Promise that resolves when enemies are populated\n     */\n    async populateEnemies(): Promise<void> {\n        if (!this.isHostileRoom()) return;\n\n        // Generate 1-3 enemies based on room type\n        let count: number;\n        if (this.type === RoomType.BOSS || this.type === RoomType.ELITE) {\n            count = 1;\n        } else {\n            const maxEnemies = Math.floor(this.level / 3) + 1;\n            const baseCount = isRNGInitialized()\n                ? getRNG().nextInt(1, 3)\n                : Math.floor(Math.random() * 3) + 1;\n            count = Math.min(baseCount, maxEnemies);\n        }\n\n        // Map dungeon level to appropriate CR (simplified mapping)\n        const cr = this.levelToCR(this.level);\n        this.enemies = await MonsterAPI.getRandomMonstersByCR(this.level, count);\n    }\n\n    /**\n     * Maps dungeon level to an appropriate challenge rating.\n     * \n     * @param level - The dungeon level (1-20)\n     * @returns The challenge rating appropriate for that level\n     * @private\n     */\n    private levelToCR(level: number): number {\n        // Simplified CR mapping based on dungeon level\n        if (level <= 2) return 0.25;\n        if (level <= 4) return 0.5;\n        if (level <= 6) return 1;\n        if (level <= 8) return 2;\n        if (level <= 10) return 3;\n        if (level <= 12) return 4;\n        if (level <= 14) return 5;\n        if (level <= 16) return 6;\n        if (level <= 18) return 7;\n        return 8;\n    }\n\n    /**\n     * Populates interactable objects based on room type.\n     * Different room types have different interactable configurations.\n     * \n     * @private\n     */\n    private populateInteractables(): void {\n        const rng = isRNGInitialized() ? getRNG() : null;\n\n        switch (this.type) {\n            case RoomType.TREASURE:\n                // Treasure rooms always have 1-2 chests\n                const chestCount = rng ? rng.nextInt(1, 2) : Math.floor(Math.random() * 2) + 1;\n                for (let i = 0; i < chestCount; i++) {\n                    this.interactables.push(createInteractable(InteractableType.CHEST, this.level));\n                }\n                // 30% chance for a trap guarding the treasure\n                if (rng ? rng.chance(0.3) : Math.random() < 0.3) {\n                    this.interactables.push(createInteractable(InteractableType.TRAP, this.level));\n                }\n                break;\n\n            case RoomType.COMBAT:\n            case RoomType.ELITE:\n                // Combat rooms may have a chest (20% chance) or trap (15% chance)\n                if (rng ? rng.chance(0.2) : Math.random() < 0.2) {\n                    this.interactables.push(createInteractable(InteractableType.CHEST, this.level));\n                }\n                if (rng ? rng.chance(0.15) : Math.random() < 0.15) {\n                    this.interactables.push(createInteractable(InteractableType.TRAP, this.level));\n                }\n                break;\n\n            case RoomType.BOSS:\n                // Boss rooms always have a chest after defeating the boss\n                this.interactables.push(createInteractable(InteractableType.CHEST, this.level + 2));\n                break;\n\n            case RoomType.REST:\n                // Rest rooms have an altar for blessings\n                this.interactables.push(createInteractable(InteractableType.ALTAR, this.level));\n                break;\n\n            case RoomType.SHOP:\n                // Shop rooms have an NPC merchant\n                this.interactables.push(createInteractable(InteractableType.NPC, this.level));\n                break;\n\n            case RoomType.PUZZLE:\n                // Puzzle rooms have levers and possibly traps\n                const leverCount = rng ? rng.nextInt(1, 3) : Math.floor(Math.random() * 3) + 1;\n                for (let i = 0; i < leverCount; i++) {\n                    this.interactables.push(createInteractable(InteractableType.LEVER, this.level));\n                }\n                // 50% chance for traps in puzzle rooms\n                if (rng ? rng.chance(0.5) : Math.random() < 0.5) {\n                    this.interactables.push(createInteractable(InteractableType.TRAP, this.level));\n                }\n                break;\n\n            case RoomType.EVENT:\n                // Event rooms have random interactables\n                const eventTypes = [\n                    InteractableType.CHEST,\n                    InteractableType.ALTAR,\n                    InteractableType.NPC,\n                    InteractableType.TRAP\n                ];\n                const eventType = rng\n                    ? rng.choice(eventTypes)\n                    : eventTypes[Math.floor(Math.random() * eventTypes.length)];\n                this.interactables.push(createInteractable(eventType, this.level));\n                break;\n\n            case RoomType.ENTRANCE:\n                // Entrance rooms are empty\n                break;\n        }\n    }\n\n    /**\n     * Interacts with an interactable object in the room by its ID.\n     * \n     * @param interactableId - The ID of the interactable to interact with\n     * @returns The result of the interaction, or null if not found\n     */\n    interactWith(interactableId: string): InteractionResult | null {\n        const interactable = this.interactables.find(i => i.id === interactableId);\n        if (!interactable) {\n            return null;\n        }\n        return interact(interactable);\n    }\n\n    /**\n     * Gets all interactables that haven't been used yet.\n     * NPCs are always considered available (can interact multiple times).\n     * \n     * @returns Array of unused interactables\n     */\n    getAvailableInteractables(): Interactable[] {\n        return this.interactables.filter(i => !i.used || i.type === InteractableType.NPC);\n    }\n\n    /**\n     * Checks if the room has any unused interactables.\n     * \n     * @returns true if there are available interactables\n     */\n    hasAvailableInteractables(): boolean {\n        return this.getAvailableInteractables().length > 0;\n    }\n\n    /**\n     * Returns an emoji icon representing this room type.\n     * Used for UI display purposes.\n     * \n     * @returns An emoji string for UI display\n     */\n    getIcon(): string {\n        const icons: Record<RoomType, string> = {\n            [RoomType.ENTRANCE]: '\uD83D\uDEAA',\n            [RoomType.COMBAT]: '\u2694\uFE0F',\n            [RoomType.ELITE]: '\uD83D\uDC79',\n            [RoomType.TREASURE]: '\uD83D\uDC8E',\n            [RoomType.REST]: '\uD83D\uDD25',\n            [RoomType.SHOP]: '\uD83C\uDFEA',\n            [RoomType.EVENT]: '\u2753',\n            [RoomType.BOSS]: '\uD83D\uDC80',\n            [RoomType.PUZZLE]: '\uD83D\uDD0D'\n        };\n        return icons[this.type] || '?';\n    }\n\n    /**\n     * Generates a flavor text description for the room.\n     * \n     * @returns A description string based on room type and level\n     * @todo Generate more detailed descriptions based on room type and level\n     */\n    generateDescription(): string {\n        // TODO: Generate description based on room type and level\n        return `This is a ${this.type} room at level ${this.level}.`;\n    }\n\n    /**\n     * Serializes the room to a JSON-compatible object.\n     * \n     * @returns A RoomJSON object for persistence or transmission\n     */\n    toJSON(): RoomJSON {\n        return {\n            id: this.id,\n            type: this.type,\n            level: this.level,\n            state: this.state,\n            connections: this.connections,\n            reward: this.reward,\n            enemies: this.enemies,\n            interactables: this.interactables,\n            description: this.description\n        };\n    }\n}\n", "/**\n * @fileoverview Player Entity System for Dungeon Roguelike\n * \n * This module defines the base Player class and related types. Players are\n * the main controllable entities in the game with:\n * - Stats (health, mana, attack, defense, speed, crit)\n * - Equipment (weapon, armor, accessory)\n * - Inventory management\n * - Abilities (class-specific and equipment-granted)\n * - Buff/debuff system\n * - Experience and leveling\n * \n * The Player class is abstract - use Fighter or Warlock subclasses.\n * \n * @module entities/player\n */\n\nimport {\n    Item,\n    ItemType,\n    ItemSlot,\n    StatBonus,\n    GrantedAbility,\n    OnHitEffect,\n    calculateAverageDamage,\n    rollDice\n} from './item';\nimport { Relic, RelicType, PassiveEffectType, CombatModifierType, PassiveEffect, CombatModifier } from './relic';\nimport { getRNG, isRNGInitialized } from '../game/seed';\n\n/**\n * Available player class types.\n * Each class has different base stats, abilities, and playstyles.\n * @enum {string}\n */\nexport enum PlayerClass {\n    /** Melee warrior with high health and defense */\n    FIGHTER = 'fighter',\n    /** Magic user with high mana and powerful spells */\n    WARLOCK = 'warlock'\n}\n\n/**\n * Equipment slots for the player.\n * Each slot can hold one item of the appropriate type.\n * @interface\n */\nexport interface Equipment {\n    /** Equipped weapon (affects attack damage) */\n    weapon: Item | null;\n    /** Equipped armor (affects defense) */\n    armor: Item | null;\n    /** Equipped accessory (various bonuses) */\n    accessory: Item | null;\n}\n\n/**\n * Base stats for a player character.\n * These values are modified by equipment, buffs, and level.\n * @interface\n */\nexport interface PlayerStats {\n    /** Maximum health points */\n    maxHealth: number;\n    /** Current health points */\n    health: number;\n    /** Base attack power (modified by weapon and class) */\n    attack: number;\n    /** Base defense (modified by armor and class) */\n    defense: number;\n    /** Current mana/resource pool for abilities */\n    mana: number;\n    /** Maximum mana */\n    maxMana: number;\n    /** Speed/initiative for turn order */\n    speed: number;\n    /** Critical hit chance (0-100) */\n    critChance: number;\n    /** Critical hit damage multiplier (e.g., 1.5 = 150% damage) */\n    critMultiplier: number;\n}\n\n/**\n * Active buff applied to player.\n * Buffs provide temporary stat bonuses that expire after a number of turns.\n * @interface\n */\nexport interface ActiveBuff {\n    /** Display name of the buff */\n    name: string;\n    /** Stat bonuses provided by the buff */\n    bonuses: StatBonus;\n    /** Number of turns remaining */\n    remainingTurns: number;\n}\n\n/**\n * Class-specific or equipment-granted ability.\n * Abilities are special actions that cost mana and may have cooldowns.\n * @interface\n */\nexport interface Ability {\n    /** Unique identifier */\n    id: string;\n    /** Display name */\n    name: string;\n    /** Description of what the ability does */\n    description: string;\n    /** Mana cost to use */\n    manaCost: number;\n    /** Cooldown in turns before ability can be used again */\n    cooldown: number;\n    /** Current cooldown remaining (0 = ready) */\n    currentCooldown: number;\n    /** Damage dealt (if applicable) */\n    damage?: number;\n    /** Healing provided (if applicable) */\n    healing?: number;\n    /** Special effect type */\n    effect?: string;\n    /** Source of the ability ('class' or item name) */\n    source?: string;\n}\n\n/**\n * Result of processing on-hit effects from equipment.\n * @interface\n */\nexport interface OnHitResult {\n    /** Type of effect triggered */\n    type: string;\n    /** Value associated with the effect (damage, healing, etc.) */\n    value?: number;\n    /** Duration in turns (for DOT/debuff effects) */\n    duration?: number;\n}\n\n/**\n * Serialized player data for save/load functionality.\n * @interface\n */\nexport interface PlayerJSON {\n    /** Unique player ID */\n    id: string;\n    /** Player name */\n    name: string;\n    /** Player class */\n    playerClass: PlayerClass;\n    /** Current level */\n    level: number;\n    /** Total experience points */\n    experience: number;\n    /** Current gold */\n    gold: number;\n    /** Current stats */\n    stats: PlayerStats;\n    /** Equipment item IDs */\n    equipment: {\n        weapon: string | null;\n        armor: string | null;\n        accessory: string | null;\n    };\n    /** Inventory item IDs */\n    inventory: string[];\n    /** Current ability states */\n    abilities: Ability[];\n    /** Active buffs */\n    activeBuffs: ActiveBuff[];\n}\n\n/**\n * Base stat configurations per class.\n * @const\n */\nconst CLASS_BASE_STATS: Record<PlayerClass, PlayerStats> = {\n    [PlayerClass.FIGHTER]: {\n        maxHealth: 120,\n        health: 120,\n        attack: 12,\n        defense: 10,\n        mana: 30,\n        maxMana: 30,\n        speed: 25,\n        critChance: 15,\n        critMultiplier: 1.5\n    },\n    [PlayerClass.WARLOCK]: {\n        maxHealth: 80,\n        health: 80,\n        attack: 6,\n        defense: 6,\n        mana: 100,\n        maxMana: 100,\n        speed: 20,\n        critChance: 10,\n        critMultiplier: 2.0\n    }\n};\n\n/**\n * Stat growth per level per class.\n * @const\n */\nconst CLASS_STAT_GROWTH: Record<PlayerClass, Partial<PlayerStats>> = {\n    [PlayerClass.FIGHTER]: {\n        maxHealth: 15,\n        attack: 2,\n        defense: 2,\n        mana: 5,\n        maxMana: 5,\n        speed: 1,\n        critChance: 0.5\n    },\n    [PlayerClass.WARLOCK]: {\n        maxHealth: 8,\n        attack: 1,\n        defense: 1,\n        mana: 15,\n        maxMana: 15,\n        speed: 1,\n        critChance: 1\n    }\n};\n\n/**\n * Experience required to reach each level.\n * Index corresponds to level (XP_PER_LEVEL[1] = XP needed for level 2).\n * @const\n */\nconst XP_PER_LEVEL = [\n    0,      // Level 1\n    100,    // Level 2\n    300,    // Level 3\n    600,    // Level 4\n    1000,   // Level 5\n    1500,   // Level 6\n    2100,   // Level 7\n    2800,   // Level 8\n    3600,   // Level 9\n    4500,   // Level 10\n    5500,   // Level 11\n    6600,   // Level 12\n    7800,   // Level 13\n    9100,   // Level 14\n    10500,  // Level 15\n    12000,  // Level 16\n    13600,  // Level 17\n    15300,  // Level 18\n    17100,  // Level 19\n    19000   // Level 20\n];\n\n/**\n * Abstract base Player class - handles core player functionality.\n * \n * This class provides:\n * - Stat calculations with equipment and buff bonuses\n * - Health and mana management\n * - Equipment and inventory management\n * - Buff/debuff system\n * - Experience and leveling\n * - Combat actions (basic attack, abilities)\n * - Serialization for save/load\n * \n * Subclasses (Fighter, Warlock) implement class-specific abilities.\n * \n * @abstract\n * @example\n * ```typescript\n * // Use a concrete subclass\n * const fighter = new Fighter('Hero');\n * const warlock = new Warlock('Mage');\n * \n * // Common operations\n * player.equipItem(sword);\n * player.takeDamage(20);\n * player.heal(15);\n * player.useAbility('power_strike');\n * ```\n */\nexport abstract class Player {\n    /** Unique identifier for the player */\n    public readonly id: string = crypto.randomUUID();\n    \n    /** Player's display name */\n    public name: string;\n    \n    /** Player's class type */\n    public readonly playerClass: PlayerClass;\n    \n    /** Current level (1-20) */\n    public level: number = 1;\n    \n    /** Total experience points earned */\n    public experience: number = 0;\n    \n    /** Current gold amount */\n    public gold: number = 0;\n    \n    /** Current stat values */\n    public stats: PlayerStats;\n    \n    /** Currently equipped items */\n    public equipment: Equipment = {\n        weapon: null,\n        armor: null,\n        accessory: null\n    };\n    \n    /** Items in inventory */\n    public inventory: Item[] = [];\n    \n    /** Available abilities */\n    public abilities: Ability[] = [];\n    \n    /** Currently active buffs */\n    public activeBuffs: ActiveBuff[] = [];\n\n    /** Collected relics (permanent bonuses) */\n    public relics: Relic[] = [];\n\n    /**\n     * Creates a new player with the specified name and class.\n     * \n     * @param name - The player's display name\n     * @param playerClass - The player's class (FIGHTER or WARLOCK)\n     */\n    constructor(name: string, playerClass: PlayerClass) {\n        this.name = name;\n        this.playerClass = playerClass;\n        this.stats = { ...CLASS_BASE_STATS[playerClass] };\n        this.initializeAbilities();\n    }\n\n    /**\n     * Initialize class-specific abilities.\n     * Must be implemented by subclasses.\n     * @protected\n     * @abstract\n     */\n    protected abstract initializeAbilities(): void;\n\n    // =========================================================================\n    // STAT CALCULATIONS (with equipment and buff bonuses)\n    // =========================================================================\n\n    /**\n     * Gets the total bonus from all equipment for a specific stat.\n     * \n     * @param stat - The stat to get bonuses for\n     * @returns Total bonus value from all equipped items\n     * @private\n     */\n    private getEquipmentBonus(stat: keyof StatBonus): number {\n        let bonus = 0;\n        const slots: (Item | null)[] = [\n            this.equipment.weapon,\n            this.equipment.armor,\n            this.equipment.accessory\n        ];\n\n        for (const item of slots) {\n            if (item?.bonuses?.[stat]) {\n                bonus += item.bonuses[stat]!;\n            }\n        }\n\n        return bonus;\n    }\n\n    /**\n     * Gets the total bonus from active buffs for a specific stat.\n     * \n     * @param stat - The stat to get bonuses for\n     * @returns Total bonus value from all active buffs\n     * @private\n     */\n    private getBuffBonus(stat: keyof StatBonus): number {\n        let bonus = 0;\n        for (const buff of this.activeBuffs) {\n            if (buff.bonuses[stat]) {\n                bonus += buff.bonuses[stat]!;\n            }\n        }\n        return bonus;\n    }\n\n    /**\n     * Gets the total bonus from relics for a specific stat.\n     * \n     * @param stat - The stat to get bonuses for\n     * @returns Total bonus value from all relics with stat bonuses\n     * @private\n     */\n    private getRelicBonus(stat: keyof StatBonus): number {\n        let bonus = 0;\n        for (const relic of this.relics) {\n            if (relic.type === RelicType.STAT_BOOST && relic.statBonus?.[stat]) {\n                bonus += relic.statBonus[stat]!;\n            }\n        }\n        return bonus;\n    }\n\n    /**\n     * Gets the effective attack power including equipment, buff, and relic bonuses.\n     * Includes weapon damage dice average.\n     * \n     * @returns Total attack power\n     */\n    getAttackPower(): number {\n        let attack = this.stats.attack;\n\n        // Add weapon damage dice average\n        if (this.equipment.weapon?.damage) {\n            attack += calculateAverageDamage(this.equipment.weapon.damage.dice);\n        }\n\n        // Add equipment bonuses\n        attack += this.getEquipmentBonus('attack');\n\n        // Add buff bonuses\n        attack += this.getBuffBonus('attack');\n\n        // Add relic bonuses\n        attack += this.getRelicBonus('attack');\n\n        return Math.floor(attack);\n    }\n\n    /**\n     * Gets the effective defense including equipment, buff, and relic bonuses.\n     * Includes armor class from equipped armor.\n     * \n     * @returns Total defense value\n     */\n    getDefense(): number {\n        let defense = this.stats.defense;\n\n        // Add armor class from armor\n        if (this.equipment.armor?.armorClass) {\n            defense += this.equipment.armor.armorClass;\n        }\n\n        // Add equipment bonuses\n        defense += this.getEquipmentBonus('defense');\n\n        // Add buff bonuses\n        defense += this.getBuffBonus('defense');\n\n        // Add relic bonuses\n        defense += this.getRelicBonus('defense');\n\n        return defense;\n    }\n\n    /**\n     * Gets effective max health including equipment, buff, and relic bonuses.\n     * \n     * @returns Total maximum health\n     */\n    getMaxHealth(): number {\n        return this.stats.maxHealth\n            + this.getEquipmentBonus('maxHealth')\n            + this.getBuffBonus('maxHealth')\n            + this.getRelicBonus('maxHealth');\n    }\n\n    /**\n     * Gets effective max mana including equipment, buff, and relic bonuses.\n     * \n     * @returns Total maximum mana\n     */\n    getMaxMana(): number {\n        return this.stats.maxMana\n            + this.getEquipmentBonus('maxMana')\n            + this.getBuffBonus('maxMana')\n            + this.getRelicBonus('maxMana');\n    }\n\n    /**\n     * Gets effective speed including equipment, buff, and relic bonuses.\n     * \n     * @returns Total speed value\n     */\n    getSpeed(): number {\n        return this.stats.speed\n            + this.getEquipmentBonus('speed')\n            + this.getBuffBonus('speed')\n            + this.getRelicBonus('speed');\n    }\n\n    /**\n     * Gets effective crit chance including equipment, buff, and relic bonuses.\n     * \n     * @returns Total crit chance (0-100+)\n     */\n    getCritChance(): number {\n        return this.stats.critChance\n            + this.getEquipmentBonus('critChance')\n            + this.getBuffBonus('critChance')\n            + this.getRelicBonus('critChance');\n    }\n\n    /**\n     * Gets effective crit multiplier including equipment, buff, and relic bonuses.\n     * \n     * @returns Total crit damage multiplier\n     */\n    getCritMultiplier(): number {\n        return this.stats.critMultiplier\n            + (this.getEquipmentBonus('critMultiplier') ?? 0)\n            + (this.getBuffBonus('critMultiplier') ?? 0)\n            + (this.getRelicBonus('critMultiplier') ?? 0);\n    }\n\n    // =========================================================================\n    // ABILITIES (class + equipment + relics)\n    // =========================================================================\n\n    /**\n     * Gets all available abilities (class abilities + equipment + relic granted abilities).\n     * Equipment and relic abilities are merged with class abilities.\n     * \n     * @returns Array of all available abilities\n     */\n    getAllAbilities(): Ability[] {\n        const abilities: Ability[] = [...this.abilities];\n\n        // Add abilities from equipment\n        const slots: (Item | null)[] = [\n            this.equipment.weapon,\n            this.equipment.armor,\n            this.equipment.accessory\n        ];\n\n        for (const item of slots) {\n            if (item?.grantedAbility) {\n                // Check if we already have this ability tracked\n                const existingIndex = abilities.findIndex(a => a.id === item.grantedAbility!.id);\n                if (existingIndex === -1) {\n                    abilities.push({\n                        ...item.grantedAbility,\n                        currentCooldown: 0,\n                        source: item.name\n                    });\n                }\n            }\n        }\n\n        // Add abilities from relics\n        for (const relic of this.relics) {\n            if (relic.type === RelicType.ABILITY && relic.grantedAbility) {\n                const existingIndex = abilities.findIndex(a => a.id === relic.grantedAbility!.id);\n                if (existingIndex === -1) {\n                    abilities.push({\n                        ...relic.grantedAbility,\n                        currentCooldown: 0,\n                        source: relic.name\n                    });\n                }\n            }\n        }\n\n        return abilities;\n    }\n\n    // =========================================================================\n    // RELIC MANAGEMENT\n    // =========================================================================\n\n    /**\n     * Adds a relic to the player's collection.\n     * Applies immediate stat bonuses if applicable.\n     * \n     * @param relic - The relic to add\n     */\n    addRelic(relic: Relic): void {\n        this.relics.push(relic);\n\n        // Apply immediate stat bonuses (health/mana increases)\n        if (relic.type === RelicType.STAT_BOOST && relic.statBonus) {\n            // If the relic grants max health, also heal for that amount\n            if (relic.statBonus.maxHealth) {\n                this.stats.health = Math.min(\n                    this.stats.health + relic.statBonus.maxHealth,\n                    this.getMaxHealth()\n                );\n            }\n            // If the relic grants max mana, also restore that amount\n            if (relic.statBonus.maxMana) {\n                this.stats.mana = Math.min(\n                    this.stats.mana + relic.statBonus.maxMana,\n                    this.getMaxMana()\n                );\n            }\n        }\n    }\n\n    /**\n     * Gets all passive effects from relics.\n     * \n     * @returns Array of all passive effects\n     */\n    getPassiveEffects(): PassiveEffect[] {\n        return this.relics\n            .filter(r => r.type === RelicType.PASSIVE && r.passiveEffect)\n            .map(r => r.passiveEffect!);\n    }\n\n    /**\n     * Gets all combat modifiers from relics.\n     * \n     * @returns Array of all combat modifiers\n     */\n    getCombatModifiers(): CombatModifier[] {\n        return this.relics\n            .filter(r => r.type === RelicType.COMBAT_MODIFIER && r.combatModifier)\n            .map(r => r.combatModifier!);\n    }\n\n    /**\n     * Checks if the player has a specific passive effect.\n     * \n     * @param effectType - The type of passive effect to check for\n     * @returns The passive effect if found, undefined otherwise\n     */\n    hasPassiveEffect(effectType: PassiveEffectType): PassiveEffect | undefined {\n        return this.getPassiveEffects().find(e => e.type === effectType);\n    }\n\n    /**\n     * Gets the total value of a specific passive effect type.\n     * Combines values from multiple relics with the same effect.\n     * \n     * @param effectType - The type of passive effect\n     * @returns Total value of the effect\n     */\n    getPassiveEffectValue(effectType: PassiveEffectType): number {\n        return this.getPassiveEffects()\n            .filter(e => e.type === effectType)\n            .reduce((sum, e) => sum + e.value, 0);\n    }\n\n    /**\n     * Processes start-of-turn passive effects (health/mana regen).\n     * Should be called at the start of each turn.\n     * \n     * @returns Object describing what happened\n     */\n    processPassiveEffects(): { healthRegen: number; manaRegen: number } {\n        let healthRegen = 0;\n        let manaRegen = 0;\n\n        // Health regeneration\n        const healthRegenEffect = this.getPassiveEffectValue(PassiveEffectType.HEALTH_REGEN);\n        if (healthRegenEffect > 0 && this.stats.health < this.getMaxHealth()) {\n            healthRegen = Math.min(healthRegenEffect, this.getMaxHealth() - this.stats.health);\n            this.stats.health += healthRegen;\n        }\n\n        // Mana regeneration\n        const manaRegenEffect = this.getPassiveEffectValue(PassiveEffectType.MANA_REGEN);\n        if (manaRegenEffect > 0 && this.stats.mana < this.getMaxMana()) {\n            manaRegen = Math.min(manaRegenEffect, this.getMaxMana() - this.stats.mana);\n            this.stats.mana += manaRegen;\n        }\n\n        return { healthRegen, manaRegen };\n    }\n\n    /**\n     * Gets IDs of all owned relics (for exclusion when generating new ones).\n     * \n     * @returns Array of relic base IDs (without instance suffix)\n     */\n    getOwnedRelicBaseIds(): string[] {\n        return this.relics.map(r => r.id.split('-')[0] + '_' + r.id.split('_').slice(1).join('_').split('-')[0]);\n    }\n\n    // =========================================================================\n    // ON-HIT EFFECTS\n    // =========================================================================\n\n    /**\n     * Processes on-hit effects from equipped items.\n     * Uses seeded RNG for reproducible results.\n     * \n     * @returns Array of triggered on-hit effects\n     */\n    processOnHitEffects(): OnHitResult[] {\n        const results: OnHitResult[] = [];\n\n        const slots: (Item | null)[] = [\n            this.equipment.weapon,\n            this.equipment.accessory\n        ];\n\n        for (const item of slots) {\n            if (item?.onHit) {\n                const triggered = isRNGInitialized()\n                    ? getRNG().percentChance(item.onHit.chance)\n                    : Math.random() * 100 < item.onHit.chance;\n\n                if (triggered) {\n                    results.push({\n                        type: item.onHit.type,\n                        value: item.onHit.value,\n                        duration: item.onHit.duration\n                    });\n                }\n            }\n        }\n\n        return results;\n    }\n\n    // =========================================================================\n    // HEALTH & MANA\n    // =========================================================================\n\n    /**\n     * Checks if the player is alive.\n     * \n     * @returns true if health is greater than 0\n     */\n    isAlive(): boolean {\n        return this.stats.health > 0;\n    }\n\n    /**\n     * Applies damage to the player after defense reduction.\n     * Damage is reduced by floor(defense/2), minimum 1 damage.\n     * \n     * @param amount - Raw damage amount before reduction\n     * @returns Actual damage taken after defense\n     */\n    takeDamage(amount: number): number {\n        if (amount <= 0) amount = 0;\n        const defense = this.getDefense();\n        const damageReduction = Math.floor(defense / 2);\n        const actualDamage = Math.max(1, amount - damageReduction);\n\n        this.stats.health = Math.max(0, this.stats.health - actualDamage);\n        return actualDamage;\n    }\n\n    /**\n     * Heals the player, capped at max health.\n     * \n     * @param amount - Amount to heal\n     * @returns Actual amount healed\n     */\n    heal(amount: number): number {\n        if (amount <= 0) return 0;\n        const previousHealth = this.stats.health;\n        const maxHealth = this.getMaxHealth();\n        this.stats.health = Math.min(maxHealth, this.stats.health + amount);\n        return this.stats.health - previousHealth;\n    }\n\n    /**\n     * Restores mana, capped at max mana.\n     * \n     * @param amount - Amount to restore\n     * @returns Actual amount restored\n     */\n    restoreMana(amount: number): number {\n        if (amount <= 0) return 0;\n        const previousMana = this.stats.mana;\n        const maxMana = this.getMaxMana();\n        this.stats.mana = Math.min(maxMana, this.stats.mana + amount);\n        return this.stats.mana - previousMana;\n    }\n\n    /**\n     * Attempts to use mana for an ability.\n     * \n     * @param amount - Mana cost\n     * @returns true if mana was spent, false if insufficient\n     */\n    useMana(amount: number): boolean {\n        if (this.stats.mana < amount) {\n            return false;\n        }\n        this.stats.mana -= amount;\n        return true;\n    }\n\n    // =========================================================================\n    // BUFFS\n    // =========================================================================\n\n    /**\n     * Applies a temporary buff to the player.\n     * If the buff already exists, refreshes the duration.\n     * \n     * @param name - Buff display name\n     * @param bonuses - Stat bonuses to apply\n     * @param duration - Duration in turns\n     */\n    applyBuff(name: string, bonuses: StatBonus, duration: number): void {\n        // Check if buff already exists, refresh duration if so\n        const existing = this.activeBuffs.find(b => b.name === name);\n        if (existing) {\n            existing.remainingTurns = Math.max(existing.remainingTurns, duration);\n            return;\n        }\n\n        this.activeBuffs.push({ name, bonuses, remainingTurns: duration });\n    }\n\n    /**\n     * Ticks down buff durations and removes expired buffs.\n     * Called at end of turn.\n     */\n    tickBuffs(): void {\n        for (let i = this.activeBuffs.length - 1; i >= 0; i--) {\n            this.activeBuffs[i].remainingTurns--;\n            if (this.activeBuffs[i].remainingTurns <= 0) {\n                this.activeBuffs.splice(i, 1);\n            }\n        }\n    }\n\n    // =========================================================================\n    // EXPERIENCE & LEVELING\n    // =========================================================================\n\n    /**\n     * Adds experience and handles level ups.\n     * Player is fully healed on level up.\n     * \n     * @param amount - Experience points to add\n     * @returns Object with levels gained and new level\n     */\n    addExperience(amount: number): { levelsGained: number; newLevel: number } {\n        this.experience += amount;\n        let levelsGained = 0;\n\n        while (this.level < 20 && this.experience >= XP_PER_LEVEL[this.level]) {\n            this.levelUp();\n            levelsGained++;\n        }\n\n        return { levelsGained, newLevel: this.level };\n    }\n\n    /**\n     * Levels up the player, applying stat growth.\n     * @private\n     */\n    private levelUp(): void {\n        this.level++;\n        const growth = CLASS_STAT_GROWTH[this.playerClass];\n\n        // Apply stat growth\n        if (growth.maxHealth) {\n            this.stats.maxHealth += growth.maxHealth;\n            this.stats.health += growth.maxHealth;\n        }\n        if (growth.attack) this.stats.attack += growth.attack;\n        if (growth.defense) this.stats.defense += growth.defense;\n        if (growth.mana) {\n            this.stats.maxMana += growth.mana;\n            this.stats.mana += growth.mana;\n        }\n        if (growth.maxMana) this.stats.maxMana += growth.maxMana;\n        if (growth.speed) this.stats.speed += growth.speed;\n        if (growth.critChance) this.stats.critChance += growth.critChance;\n\n        // Full heal on level up\n        this.stats.health = this.stats.maxHealth;\n        this.stats.mana = this.stats.maxMana;\n    }\n\n    /**\n     * Gets experience needed for next level.\n     * \n     * @returns XP remaining until next level, or 0 if max level\n     */\n    getExperienceToNextLevel(): number {\n        if (this.level >= 20) return 0;\n        return XP_PER_LEVEL[this.level] - this.experience;\n    }\n\n    // =========================================================================\n    // GOLD\n    // =========================================================================\n\n    /**\n     * Adds gold to the player.\n     * \n     * @param amount - Gold to add (must be positive)\n     */\n    addGold(amount: number): void {\n        if (amount <= 0) return;\n        this.gold += amount;\n    }\n\n    /**\n     * Attempts to spend gold.\n     * \n     * @param amount - Gold to spend\n     * @returns true if gold was spent, false if insufficient\n     */\n    spendGold(amount: number): boolean {\n        if (this.gold < amount) {\n            return false;\n        }\n        this.gold -= amount;\n        return true;\n    }\n\n    // =========================================================================\n    // EQUIPMENT & INVENTORY\n    // =========================================================================\n\n    /**\n     * Equips an item to the appropriate slot.\n     * The previous item (if any) is moved to inventory.\n     * \n     * @param item - Item to equip\n     * @returns The previously equipped item, or null\n     */\n    equipItem(item: Item): Item | null {\n        if (item.slot === ItemSlot.NONE || item.slot === ItemSlot.CONSUMABLE) {\n            return null; // Can't equip these\n        }\n\n        let previousItem: Item | null = null;\n\n        switch (item.slot) {\n            case ItemSlot.WEAPON:\n                previousItem = this.equipment.weapon;\n                this.equipment.weapon = item;\n                break;\n            case ItemSlot.ARMOR:\n                previousItem = this.equipment.armor;\n                this.equipment.armor = item;\n                break;\n            case ItemSlot.ACCESSORY:\n                previousItem = this.equipment.accessory;\n                this.equipment.accessory = item;\n                break;\n        }\n\n        // Remove from inventory if present\n        const index = this.inventory.findIndex(i => i.id === item.id);\n        if (index !== -1) {\n            this.inventory.splice(index, 1);\n        }\n\n        // Add previous item to inventory if it exists\n        if (previousItem) {\n            this.inventory.push(previousItem);\n        }\n\n        return previousItem;\n    }\n\n    /**\n     * Unequips an item from a slot and moves it to inventory.\n     * \n     * @param slot - The slot to unequip\n     * @returns The unequipped item, or null if slot was empty\n     */\n    unequipSlot(slot: ItemSlot): Item | null {\n        let item: Item | null = null;\n\n        switch (slot) {\n            case ItemSlot.WEAPON:\n                item = this.equipment.weapon;\n                this.equipment.weapon = null;\n                break;\n            case ItemSlot.ARMOR:\n                item = this.equipment.armor;\n                this.equipment.armor = null;\n                break;\n            case ItemSlot.ACCESSORY:\n                item = this.equipment.accessory;\n                this.equipment.accessory = null;\n                break;\n        }\n\n        if (item) {\n            this.inventory.push(item);\n        }\n\n        return item;\n    }\n\n    /**\n     * Uses a consumable item from inventory.\n     * Applies healing, mana restore, and/or buffs.\n     * \n     * @param item - The consumable item to use\n     * @returns true if item was used, false if invalid or not in inventory\n     */\n    useConsumable(item: Item): boolean {\n        if (item.type !== ItemType.CONSUMABLE || !item.consumeEffect) {\n            return false;\n        }\n\n        const index = this.inventory.findIndex(i => i.id === item.id);\n        if (index === -1) {\n            return false;\n        }\n\n        const effect = item.consumeEffect;\n\n        // Apply healing\n        if (effect.healing) {\n            const healAmount = rollDice(effect.healing.dice) + effect.healing.bonus;\n            this.heal(healAmount);\n        }\n\n        // Apply mana restore\n        if (effect.manaRestore) {\n            this.restoreMana(effect.manaRestore);\n        }\n\n        // Apply temporary buff\n        if (effect.buff && effect.buffDuration) {\n            this.applyBuff(item.name, effect.buff, effect.buffDuration);\n        }\n\n        // Remove from inventory\n        this.inventory.splice(index, 1);\n        return true;\n    }\n\n    /**\n     * Adds an item to the inventory.\n     * \n     * @param item - Item to add\n     */\n    addToInventory(item: Item): void {\n        this.inventory.push(item);\n    }\n\n    /**\n     * Removes an item from inventory by ID.\n     * \n     * @param itemId - ID of item to remove\n     * @returns The removed item, or null if not found\n     */\n    removeFromInventory(itemId: string): Item | null {\n        const index = this.inventory.findIndex(i => i.id === itemId);\n        if (index === -1) return null;\n        return this.inventory.splice(index, 1)[0];\n    }\n\n    /**\n     * Gets inventory items filtered by type.\n     * \n     * @param type - ItemType to filter by\n     * @returns Array of matching items\n     */\n    getInventoryByType(type: ItemType): Item[] {\n        return this.inventory.filter(item => item.type === type);\n    }\n\n    // =========================================================================\n    // COMBAT\n    // =========================================================================\n\n    /**\n     * Performs a basic attack.\n     * Uses seeded RNG for crit determination.\n     * \n     * @returns Object with damage, crit status, and on-hit effects\n     */\n    basicAttack(): { damage: number; isCrit: boolean; onHitEffects: OnHitResult[] } {\n        const attackPower = this.getAttackPower();\n        const critChance = this.getCritChance();\n        const critMultiplier = this.getCritMultiplier();\n\n        const isCrit = isRNGInitialized()\n            ? getRNG().percentChance(critChance)\n            : Math.random() * 100 < critChance;\n        const damage = isCrit\n            ? Math.floor(attackPower * critMultiplier)\n            : attackPower;\n\n        const onHitEffects = this.processOnHitEffects();\n\n        return { damage, isCrit, onHitEffects };\n    }\n\n    /**\n     * Uses an ability by ID.\n     * Checks mana cost and cooldown.\n     * \n     * @param abilityId - ID of ability to use\n     * @returns The ability if used, null if unavailable\n     */\n    useAbility(abilityId: string): Ability | null {\n        // Check class abilities first\n        let ability = this.abilities.find(a => a.id === abilityId);\n\n        // Check equipment abilities if not found\n        if (!ability) {\n            const allAbilities = this.getAllAbilities();\n            ability = allAbilities.find(a => a.id === abilityId);\n        }\n\n        if (!ability) return null;\n        if (ability.currentCooldown > 0) return null;\n        if (!this.useMana(ability.manaCost)) return null;\n\n        ability.currentCooldown = ability.cooldown;\n        return ability;\n    }\n\n    /**\n     * Reduces all ability cooldowns by 1.\n     * Called at end of turn.\n     */\n    tickCooldowns(): void {\n        for (const ability of this.abilities) {\n            if (ability.currentCooldown > 0) {\n                ability.currentCooldown--;\n            }\n        }\n    }\n\n    /**\n     * End of turn processing.\n     * Ticks cooldowns and buffs.\n     */\n    endTurn(): void {\n        this.tickCooldowns();\n        this.tickBuffs();\n    }\n\n    // =========================================================================\n    // REST & RECOVERY\n    // =========================================================================\n\n    /**\n     * Rests at a rest room - fully restores health and mana.\n     * Also resets all cooldowns and clears buffs.\n     */\n    rest(): void {\n        this.stats.health = this.getMaxHealth();\n        this.stats.mana = this.getMaxMana();\n\n        // Reset all cooldowns\n        for (const ability of this.abilities) {\n            ability.currentCooldown = 0;\n        }\n\n        // Clear all buffs (they don't persist through rest)\n        this.activeBuffs = [];\n    }\n\n    // =========================================================================\n    // SERIALIZATION\n    // =========================================================================\n\n    /**\n     * Serializes the player to a JSON-compatible object.\n     * \n     * @returns PlayerJSON object for save/load\n     */\n    toJSON(): PlayerJSON {\n        return {\n            id: this.id,\n            name: this.name,\n            playerClass: this.playerClass,\n            level: this.level,\n            experience: this.experience,\n            gold: this.gold,\n            stats: { ...this.stats },\n            equipment: {\n                weapon: this.equipment.weapon?.id ?? null,\n                armor: this.equipment.armor?.id ?? null,\n                accessory: this.equipment.accessory?.id ?? null\n            },\n            inventory: this.inventory.map(item => item.id),\n            abilities: this.abilities.map(a => ({ ...a })),\n            activeBuffs: this.activeBuffs.map(b => ({ ...b }))\n        };\n    }\n}\n", "/**\n * @fileoverview Fighter Class Implementation for Dungeon Roguelike\n * \n * The Fighter is a melee-focused warrior class with:\n * - High base health and defense\n * - Strong physical attacks\n * - Abilities that enhance survivability and damage\n * - \"Last Stand\" passive for increased defense at low health\n * \n * @module entities/fighter\n */\n\nimport { Item } from './item';\nimport { Player, PlayerClass, PlayerJSON } from './player';\n\n/**\n * Fighter class - melee-focused warrior with high health and defense.\n * \n * **Strengths:**\n * - High base health (120) and defense (10)\n * - Strong physical attacks\n * - Abilities that enhance survivability and damage\n * - \"Last Stand\" passive: +50% defense when below 25% health\n * \n * **Weaknesses:**\n * - Low mana pool (30)\n * - Limited ranged options\n * - Abilities cost health or have long cooldowns\n * \n * **Abilities:**\n * - Power Strike: 150% weapon damage (10 mana, 2 turn CD)\n * - Shield Bash: 75% damage + stun (15 mana, 3 turn CD)\n * - Battle Cry: +25% attack for 3 turns (20 mana, 5 turn CD)\n * - Second Wind: Heal 30% max HP (25 mana, 6 turn CD)\n * - Whirlwind: 75% damage to all enemies (30 mana, 4 turn CD)\n * \n * @extends Player\n * \n * @example\n * ```typescript\n * const fighter = new Fighter('Conan');\n * \n * // Use abilities\n * const strike = fighter.powerStrike();\n * const bash = fighter.shieldBash();\n * fighter.battleCry();\n * fighter.secondWind();\n * const spin = fighter.whirlwind();\n * ```\n */\nexport class Fighter extends Player {\n    /**\n     * Creates a new Fighter with the specified name.\n     * \n     * @param name - The fighter's display name\n     */\n    constructor(name: string) {\n        super(name, PlayerClass.FIGHTER);\n    }\n\n    /**\n     * Initializes Fighter-specific abilities.\n     * @protected\n     */\n    protected initializeAbilities(): void {\n        this.abilities = [\n            {\n                id: 'power_strike',\n                name: 'Power Strike',\n                description: 'A devastating blow that deals 150% weapon damage.',\n                manaCost: 10,\n                cooldown: 2,\n                currentCooldown: 0,\n                damage: 1.5, // Multiplier\n                source: 'class'\n            },\n            {\n                id: 'shield_bash',\n                name: 'Shield Bash',\n                description: 'Bash the enemy, dealing moderate damage and stunning them for 1 turn.',\n                manaCost: 15,\n                cooldown: 3,\n                currentCooldown: 0,\n                damage: 0.75,\n                effect: 'stun',\n                source: 'class'\n            },\n            {\n                id: 'battle_cry',\n                name: 'Battle Cry',\n                description: 'Let out a fierce cry, increasing attack by 25% for 3 turns.',\n                manaCost: 20,\n                cooldown: 5,\n                currentCooldown: 0,\n                effect: 'attack_buff',\n                source: 'class'\n            },\n            {\n                id: 'second_wind',\n                name: 'Second Wind',\n                description: 'Catch your breath and recover 30% of max health.',\n                manaCost: 25,\n                cooldown: 6,\n                currentCooldown: 0,\n                healing: 0.3, // Percentage of max health\n                source: 'class'\n            },\n            {\n                id: 'whirlwind',\n                name: 'Whirlwind',\n                description: 'Spin and strike all enemies for 75% weapon damage.',\n                manaCost: 30,\n                cooldown: 4,\n                currentCooldown: 0,\n                damage: 0.75,\n                effect: 'aoe',\n                source: 'class'\n            }\n        ];\n    }\n\n    /**\n     * Executes Power Strike ability.\n     * Deals 150% of normal attack damage.\n     * \n     * @returns Object with damage dealt and crit status, or null if ability unavailable\n     */\n    powerStrike(): { damage: number; isCrit: boolean } | null {\n        const ability = this.useAbility('power_strike');\n        if (!ability) return null;\n\n        const baseAttack = this.basicAttack();\n        const damage = Math.floor(baseAttack.damage * (ability.damage ?? 1.5));\n\n        return { damage, isCrit: baseAttack.isCrit };\n    }\n\n    /**\n     * Executes Shield Bash ability.\n     * Deals 75% damage and stuns the target for 1 turn.\n     * \n     * @returns Object with damage dealt and stun status, or null if ability unavailable\n     */\n    shieldBash(): { damage: number; stunned: boolean } | null {\n        const ability = this.useAbility('shield_bash');\n        if (!ability) return null;\n\n        const baseAttack = this.basicAttack();\n        const damage = Math.floor(baseAttack.damage * (ability.damage ?? 0.75));\n\n        return { damage, stunned: true };\n    }\n\n    /**\n     * Executes Battle Cry ability.\n     * Increases attack by 25% for 3 turns.\n     * \n     * @returns Object with attack bonus and duration, or null if ability unavailable\n     */\n    battleCry(): { attackBonus: number; duration: number } | null {\n        const ability = this.useAbility('battle_cry');\n        if (!ability) return null;\n\n        // Apply buff using the new buff system\n        const attackBonus = Math.floor(this.stats.attack * 0.25);\n        this.applyBuff('Battle Cry', { attack: attackBonus }, 3);\n\n        return { attackBonus, duration: 3 };\n    }\n\n    /**\n     * Executes Second Wind ability.\n     * Recovers 30% of max health.\n     * \n     * @returns Amount healed, or null if ability unavailable\n     */\n    secondWind(): number | null {\n        const ability = this.useAbility('second_wind');\n        if (!ability) return null;\n\n        const healAmount = Math.floor(this.getMaxHealth() * (ability.healing ?? 0.3));\n        return this.heal(healAmount);\n    }\n\n    /**\n     * Executes Whirlwind ability.\n     * Deals 75% weapon damage to all enemies (AOE).\n     * \n     * @returns Object with damage to apply to all enemies, or null if ability unavailable\n     */\n    whirlwind(): { damage: number; isAoe: true } | null {\n        const ability = this.useAbility('whirlwind');\n        if (!ability) return null;\n\n        const baseAttack = this.basicAttack();\n        const damage = Math.floor(baseAttack.damage * (ability.damage ?? 0.75));\n\n        return { damage, isAoe: true };\n    }\n\n    /**\n     * Checks if Last Stand passive is active.\n     * Last Stand activates when health drops below 25%, granting +50% defense.\n     * \n     * @returns Object with defense bonus and active status\n     */\n    checkLastStand(): { defenseBonus: number; active: boolean } {\n        const healthPercent = this.stats.health / this.getMaxHealth();\n        if (healthPercent <= 0.25) {\n            return { defenseBonus: Math.floor(this.stats.defense * 0.5), active: true };\n        }\n        return { defenseBonus: 0, active: false };\n    }\n\n    /**\n     * Gets effective defense including Last Stand passive.\n     * Overrides base Player.getDefense() to include passive bonus.\n     * \n     * @returns Total defense value\n     */\n    override getDefense(): number {\n        const baseDefense = super.getDefense();\n        const lastStand = this.checkLastStand();\n        return baseDefense + lastStand.defenseBonus;\n    }\n\n    /**\n     * Deserializes a Fighter from JSON data.\n     * \n     * @param data - The serialized PlayerJSON data\n     * @param itemLookup - Map of item IDs to Item objects for restoring equipment/inventory\n     * @returns A fully restored Fighter instance\n     * \n     * @example\n     * ```typescript\n     * const savedData = JSON.parse(saveFile);\n     * const items = new Map<string, Item>();\n     * // ... populate items map ...\n     * const fighter = Fighter.fromJSON(savedData, items);\n     * ```\n     */\n    static fromJSON(data: PlayerJSON, itemLookup: Map<string, Item>): Fighter {\n        const fighter = new Fighter(data.name);\n        \n        // Restore basic properties\n        fighter.level = data.level;\n        fighter.experience = data.experience;\n        fighter.gold = data.gold;\n        fighter.stats = { ...data.stats };\n        \n        // Restore equipment from itemLookup\n        if (data.equipment.weapon) {\n            const weapon = itemLookup.get(data.equipment.weapon);\n            if (weapon) fighter.equipment.weapon = weapon;\n        }\n        if (data.equipment.armor) {\n            const armor = itemLookup.get(data.equipment.armor);\n            if (armor) fighter.equipment.armor = armor;\n        }\n        if (data.equipment.accessory) {\n            const accessory = itemLookup.get(data.equipment.accessory);\n            if (accessory) fighter.equipment.accessory = accessory;\n        }\n        \n        // Restore inventory from itemLookup\n        fighter.inventory = data.inventory\n            .map(id => itemLookup.get(id))\n            .filter((item): item is Item => item !== undefined);\n        \n        // Restore abilities (with cooldown states)\n        fighter.abilities = data.abilities.map(a => ({ ...a }));\n        \n        // Restore active buffs\n        fighter.activeBuffs = data.activeBuffs.map(b => ({ ...b }));\n        \n        return fighter;\n    }\n}\n", "/**\n * @fileoverview Procedural Dungeon Generation System\n * \n * This module handles the procedural generation of dungeon layouts using\n * a layered approach. Dungeons are generated with:\n * - Multiple levels (layers) of increasing difficulty\n * - Branching paths that converge toward the boss\n * - Varied room types (combat, treasure, shop, rest, etc.)\n * - Guaranteed special rooms at key intervals\n * \n * The generator uses seeded RNG for reproducible dungeon layouts.\n * \n * @module integration/dungeonGenerator\n */\n\nimport { Room, RoomState, RoomType} from \"../dungeon/room\";\nimport { Seed, initializeRNG } from \"../game/seed\";\nimport { DungeonLayer } from \"../game/seed\";\n\n/**\n * Procedural dungeon generator that creates interconnected room layouts.\n * \n * The generator creates dungeons with the following structure:\n * - Level 1: Entrance room\n * - Levels 2-19: Combat, treasure, shop, rest, and event rooms\n * - Level 20: Boss room\n * \n * Room distribution varies by dungeon stage:\n * - Early game (1-5): 70% combat, rest of treasure/rest/event\n * - Mid game (6-13): 60% combat, introduces elite and shop rooms\n * - Late game (14-19): 50% combat, more elite and puzzle rooms\n * \n * @example\n * ```typescript\n * const generator = new DungeonGenerator('my-seed');\n * const rooms = await generator.generate(20, 3, 0.3);\n * const layers = generator.getLayers();\n * ```\n */\nexport class DungeonGenerator {\n    /** Seeded RNG instance for reproducible generation */\n    private rng: Seed;\n    \n    /** All generated rooms (flat array) */\n    private rooms: Room[] = [];\n    \n    /** Rooms organized by dungeon level */\n    private layers: DungeonLayer[] = [];\n\n    /**\n     * Creates a new DungeonGenerator with the specified seed.\n     * Also initializes the global RNG for use throughout the game.\n     * \n     * @param seed - String seed for reproducible generation\n     */\n    constructor(seed: string) {\n        // Initialize global RNG and use it for dungeon generation\n        this.rng = initializeRNG(seed);\n    }\n\n    /**\n     * Generates a complete dungeon with the specified parameters.\n     * Creates rooms from entrance through boss, with branching paths.\n     * \n     * Note: This method is now synchronous. Enemy data is loaded lazily\n     * when entering rooms, not during generation.\n     * \n     * @param totalLevels - Total number of dungeon levels (default: 20)\n     * @param branchingFactor - Maximum rooms per level (default: 3)\n     * @param convergenceRate - Rate at which paths merge (0-1, default: 0.3)\n     * @returns Array of all generated rooms\n     * \n     * @example\n     * ```typescript\n     * // Generate a 20-level dungeon with up to 3 rooms per level\n     * const rooms = generator.generate(20, 3, 0.3);\n     * ```\n     */\n    generate(\n        totalLevels: number = 20,\n        branchingFactor: number = 3,\n        convergenceRate: number = 0.3\n    ): Room[] {\n        this.rooms = [];\n        this.layers = [];\n\n        // Generate entrance room\n        this.createEntrance();\n\n        for (let level = 2; level < totalLevels; level++) {\n            this.generateLevel(level, branchingFactor, convergenceRate);\n        }\n        this.createBoss(totalLevels);\n        this.placeSpecialRooms();\n\n        return this.rooms;\n    }\n\n    /**\n     * Creates the entrance room at level 1.\n     * The entrance is always available and serves as the starting point.\n     * \n     * @private\n     */\n    private createEntrance(): void {\n        const entrance = Room.create(RoomType.ENTRANCE, 1);\n        entrance.state = RoomState.AVAILABLE;\n\n        this.rooms.push(entrance);\n        this.layers.push({ level: 1, rooms: [entrance] });\n    }\n\n    /**\n     * Generates a single dungeon level with multiple rooms.\n     * \n     * @param level - The level number to generate\n     * @param branchingFactor - Maximum rooms allowed at this level\n     * @param convergenceRate - Probability of creating extra connections\n     * @private\n     */\n    private generateLevel(\n        level: number,\n        branchingFactor: number,\n        convergenceRate: number\n    ): void {\n        const previousLayer = this.layers[this.layers.length - 1];\n        const currentLayerRooms: Room[] = [];\n\n        const roomCount = this.calculateRoomCount(\n            level,\n            branchingFactor,\n            previousLayer.rooms.length\n        );\n\n        for (let i = 0; i < roomCount; i++) {\n            const roomType = this.selectRoomType(level);\n            const room = Room.create(roomType, level);\n            currentLayerRooms.push(room);\n            this.rooms.push(room);\n        }\n\n        this.connectLayers(previousLayer.rooms, currentLayerRooms, convergenceRate);\n        this.layers.push({ level, rooms: currentLayerRooms });\n    }\n\n    /**\n     * Calculates how many rooms should be at a given level.\n     * \n     * The algorithm:\n     * - Early game (1-5): Gradual growth\n     * - Mid game (6-10): More aggressive expansion\n     * - Late game (15+): Narrowing toward boss\n     * - Final levels: Converge to single path\n     * \n     * @param level - Current dungeon level\n     * @param branchingFactor - Maximum rooms allowed\n     * @param previousRoomCount - Number of rooms in previous level\n     * @param maxLevel - Maximum dungeon level (default: 20)\n     * @returns Number of rooms for this level\n     * @private\n     */\n    private calculateRoomCount(\n        level: number,\n        branchingFactor: number,\n        previousRoomCount: number,\n        maxLevel: number = 20\n    ): number {\n        const levelsRemaining = maxLevel - level;\n\n        // Early game (levels 1-5): gradual growth\n        if (level <= 5) {\n            return Math.min(branchingFactor, previousRoomCount + this.rng.nextInt(0, 1));\n        }\n\n        // Mid game: expand more aggressively\n        if (level <= 10) {\n            return Math.min(branchingFactor, previousRoomCount + this.rng.nextInt(0, 2));\n        }\n\n        // Approaching boss (last 5 levels): start narrowing\n        if (levelsRemaining <= 5) {\n            // More aggressive narrowing as you get closer\n            if (levelsRemaining <= 2) {\n                return Math.max(1, previousRoomCount - this.rng.nextInt(1, 2));\n            }\n            return Math.max(2, previousRoomCount - this.rng.nextInt(0, 1));\n        }\n\n        // Late-mid game: fluctuate/plateau\n        return Math.max(2, previousRoomCount + this.rng.nextInt(-1, 1));\n    }\n\n    /**\n     * Selects a room type based on dungeon progression.\n     * \n     * Room type probabilities vary by stage:\n     * - Stage 1 (0-30%): 70% combat, 15% treasure, 8% rest, 7% event\n     * - Stage 2 (30-70%): 60% combat, 12% elite, 10% treasure, 8% shop, 6% rest, 4% puzzle\n     * - Stage 3 (70-100%): 50% combat, 20% elite, 12% treasure, 10% puzzle, 8% event\n     * \n     * @param level - Current dungeon level (1-20)\n     * @returns The selected RoomType\n     * @private\n     */\n    private selectRoomType(level: number): RoomType {\n        const progress = level / 20;\n        const rand = this.rng.nextFloat();\n\n        // Stage 1 (levels 0-5): 70% combat\n        if (progress < 0.3) {\n            if (rand < 0.70) return RoomType.COMBAT;\n            if (rand < 0.85) return RoomType.TREASURE;\n            if (rand < 0.93) return RoomType.REST;\n            return RoomType.EVENT;\n        }\n\n        // Stage 2 (levels 6-13): 60% combat\n        if (progress < 0.7) {\n            if (rand < 0.60) return RoomType.COMBAT;\n            if (rand < 0.72) return RoomType.ELITE;\n            if (rand < 0.82) return RoomType.TREASURE;\n            if (rand < 0.90) return RoomType.SHOP;\n            if (rand < 0.96) return RoomType.REST;\n            return RoomType.PUZZLE;\n        }\n\n        // Stage 3 (levels 14-19): 50% combat\n        if (rand < 0.50) return RoomType.COMBAT;\n        if (rand < 0.70) return RoomType.ELITE;\n        if (rand < 0.82) return RoomType.TREASURE;\n        if (rand < 0.92) return RoomType.PUZZLE;\n        return RoomType.EVENT;\n    }\n\n    /**\n     * Creates connections between two adjacent dungeon layers.\n     * \n     * Connection algorithm:\n     * 1. First pass: Every room in fromLayer gets at least one forward connection\n     * 2. Second pass: Add extra connections based on convergence rate\n     * 3. Third pass: Ensure every room in toLayer has at least one incoming connection\n     * \n     * @param fromRooms - Rooms in the previous layer\n     * @param toRooms - Rooms in the current layer\n     * @param convergenceRate - Probability of creating extra connections\n     * @private\n     */\n    private connectLayers(\n        fromRooms: Room[],\n        toRooms: Room[],\n        convergenceRate: number\n    ): void {\n        const connectedToRooms = new Set<string>();\n        const connectedFromRooms = new Set<string>();\n\n        // First pass: give each fromRoom at least one forward connection\n        for (const fromRoom of fromRooms) {\n            const targetRoom = this.rng.choice(toRooms);\n            fromRoom.connectTo(targetRoom);\n            connectedToRooms.add(targetRoom.id);\n            connectedFromRooms.add(fromRoom.id);\n        }\n\n        // Second pass: add extra connections based on branching preferences\n        for (const fromRoom of fromRooms) {\n            const connectionCount = this.calculateConnections(\n                fromRooms.length,\n                toRooms.length,\n                convergenceRate\n            );\n\n            // Already has 1 connection, add more if needed\n            const additionalConnections = connectionCount - 1;\n            \n            for (let i = 0; i < additionalConnections; i++) {\n                // Prefer rooms not yet connected to\n                const availableRooms = toRooms.filter(\n                    r => !fromRoom.connections.includes(r.id)\n                );\n                \n                if (availableRooms.length > 0) {\n                    const targetRoom = this.rng.choice(availableRooms);\n                    fromRoom.connectTo(targetRoom);\n                    connectedToRooms.add(targetRoom.id);\n                }\n            }\n        }\n\n        // Third pass: ensure all toRooms have at least one incoming connection\n        for (const toRoom of toRooms) {\n            if (!connectedToRooms.has(toRoom.id)) {\n                const fromRoom = this.rng.choice(fromRooms);\n                fromRoom.connectTo(toRoom);\n            }\n        }\n    }\n\n    /**\n     * Calculates how many connections a room should have to the next layer.\n     * \n     * @param fromCount - Number of rooms in the source layer\n     * @param toCount - Number of rooms in the target layer\n     * @param convergenceRate - Base probability for extra connections\n     * @returns Number of connections (1 or 2)\n     * @private\n     */\n    private calculateConnections(\n        fromCount: number,\n        toCount: number,\n        convergenceRate: number\n    ): number {\n        let connections = 1;\n\n        if (toCount > fromCount) {\n            connections = this.rng.nextFloat() < 0.5 ? 1 : 2;\n        } else if (toCount < fromCount) {\n            connections = 1;\n        } else {\n            connections = this.rng.nextFloat() < convergenceRate ? 2 : 1;\n        }\n\n        return connections;\n    }\n\n    /**\n     * Creates the boss room at the final level.\n     * All rooms from the previous layer connect to the boss room.\n     * \n     * @param level - The level number for the boss room\n     * @private\n     */\n    private createBoss(level: number): void {\n        const boss = Room.create(RoomType.BOSS, level);\n        const previousLayer = this.layers[this.layers.length - 1];\n        for (const room of previousLayer.rooms) {\n            room.connectTo(boss);\n        }\n\n        this.rooms.push(boss);\n        this.layers.push({ level, rooms: [boss] });\n    }\n\n    /**\n     * Places guaranteed special rooms at specific intervals.\n     * \n     * Special room placement:\n     * - Rest rooms: Every 5 levels (5, 10, 15)\n     * - Shop room: Random level between 10-15\n     * - Treasure room: Random level between 3-8\n     * \n     * @private\n     */\n    private placeSpecialRooms(): void {\n        const restInterval = 5\n        for (let level = restInterval; level < 20; level += restInterval) {\n            const layer = this.layers[level - 1];\n            if (layer && layer.rooms.length > 0) {\n                const room = this.rng.choice(layer.rooms);\n                if (room.type === RoomType.COMBAT) {\n                    room.type = RoomType.REST;\n                }\n            }\n        }\n\n        const shopLevel = this.rng.nextInt(10, 15);\n        const shopLayer = this.layers[shopLevel - 1];\n        if(shopLayer){\n            const room = this.rng.choice(shopLayer.rooms);\n            room.type = RoomType.SHOP;\n        }\n\n        const treasureLevel = this.rng.nextInt(3, 8);\n        const treasureLayer = this.layers[treasureLevel - 1];\n        if (treasureLayer) {\n            const room = this.rng.choice(treasureLayer.rooms);\n            if (room.type !== RoomType.REST) {\n                room.type = RoomType.TREASURE;\n            }\n        }\n    }\n\n    /**\n     * Returns all dungeon layers after generation.\n     * \n     * @returns Array of DungeonLayer objects, ordered by level\n     */\n    getLayers(): DungeonLayer[] {\n        return this.layers;\n    }\n\n    /**\n     * Returns all rooms in the dungeon after generation.\n     * \n     * @returns Flat array of all Room objects\n     */\n    getRooms(): Room[] {\n        return this.rooms;\n    }\n\n    /**\n     * Validates dungeon connectivity and returns any issues found.\n     * Checks that:\n     * 1. Every room (except entrance) has at least one incoming connection from previous level\n     * 2. Every room (except boss) has at least one outgoing connection to next level\n     * 3. There's a valid path from entrance to boss\n     * \n     * @returns Array of validation error messages, empty if valid\n     */\n    validateConnectivity(): string[] {\n        const errors: string[] = [];\n        \n        // Build a map of room ID to room for quick lookup\n        const roomMap = new Map<string, Room>();\n        for (const room of this.rooms) {\n            roomMap.set(room.id, room);\n        }\n        \n        // Check each layer (except entrance and boss)\n        for (let layerIndex = 1; layerIndex < this.layers.length - 1; layerIndex++) {\n            const currentLayer = this.layers[layerIndex];\n            const previousLayer = this.layers[layerIndex - 1];\n            const nextLayer = this.layers[layerIndex + 1];\n            \n            for (const room of currentLayer.rooms) {\n                // Check for incoming connections from previous layer\n                const hasIncoming = previousLayer.rooms.some(prevRoom => \n                    prevRoom.connections.includes(room.id)\n                );\n                if (!hasIncoming) {\n                    errors.push(`Level ${currentLayer.level} room ${room.id} has no incoming connection from level ${previousLayer.level}`);\n                }\n                \n                // Check for outgoing connections to next layer\n                const hasOutgoing = room.connections.some(connId => \n                    nextLayer.rooms.some(nextRoom => nextRoom.id === connId)\n                );\n                if (!hasOutgoing) {\n                    errors.push(`Level ${currentLayer.level} room ${room.id} has no outgoing connection to level ${nextLayer.level}`);\n                }\n            }\n        }\n        \n        // Check that entrance connects to level 2\n        const entrance = this.layers[0].rooms[0];\n        const level2 = this.layers[1];\n        const entranceConnectsToLevel2 = entrance.connections.some(connId =>\n            level2.rooms.some(room => room.id === connId)\n        );\n        if (!entranceConnectsToLevel2) {\n            errors.push('Entrance has no connection to level 2');\n        }\n        \n        // Check that all level 19 rooms connect to boss\n        const preBossLayer = this.layers[this.layers.length - 2];\n        const bossRoom = this.layers[this.layers.length - 1].rooms[0];\n        for (const room of preBossLayer.rooms) {\n            if (!room.connections.includes(bossRoom.id)) {\n                errors.push(`Level ${preBossLayer.level} room ${room.id} does not connect to boss`);\n            }\n        }\n        \n        return errors;\n    }\n}\n", "/**\n * @fileoverview Warlock Class Implementation for Dungeon Roguelike\n * \n * The Warlock is a magic-focused spellcaster class with:\n * - Large mana pool for sustained spellcasting\n * - High damage spells\n * - Life drain and utility abilities\n * - Soul Shard mechanic for empowering abilities\n * \n * @module entities/warlock\n */\n\nimport { Player, PlayerClass, PlayerJSON } from './player';\nimport { Item } from './item';\nimport { getRNG, isRNGInitialized } from '../game/seed';\n\n/**\n * Warlock class - magic-focused spellcaster with powerful abilities.\n * \n * **Strengths:**\n * - Large mana pool (100)\n * - High damage spells\n * - Life drain and utility abilities\n * - Higher crit multiplier (2.0x)\n * - Soul Shard mechanic for bonus damage\n * \n * **Weaknesses:**\n * - Low health (80) and defense (6)\n * - Relies on mana management\n * - Weaker basic attacks\n * \n * **Abilities:**\n * - Eldritch Blast: Magic damage, no cooldown (8 mana)\n * - Drain Life: Damage + 50% lifesteal (20 mana, 3 turn CD)\n * - Hex: +25% damage taken debuff for 3 turns (15 mana, 4 turn CD)\n * - Shadow Bolt: High damage + soul shard bonus (25 mana, 2 turn CD)\n * - Dark Pact: Sacrifice 20% HP for 40% mana (0 mana, 5 turn CD)\n * - Soul Harvest: Consume shards for massive damage (35 mana, 6 turn CD)\n * \n * **Soul Shards:**\n * - Gain 1 shard when killing an enemy (max 3)\n * - Shadow Bolt consumes all shards for +10 damage each\n * - Soul Harvest consumes all shards for 20+ damage per shard\n * \n * @extends Player\n * \n * @example\n * ```typescript\n * const warlock = new Warlock('Gul\\'dan');\n * \n * // Basic spell\n * const blast = warlock.eldritchBlast();\n * \n * // Life drain\n * const drain = warlock.drainLife();\n * \n * // Soul shard mechanics\n * warlock.gainSoulShard(); // On enemy kill\n * const bolt = warlock.shadowBolt(); // Consumes shards\n * ```\n */\nexport class Warlock extends Player {\n    /** Current number of soul shards (0-3) */\n    public soulShards: number = 0;\n    \n    /** Maximum soul shards that can be held */\n    public readonly maxSoulShards: number = 3;\n\n    /**\n     * Creates a new Warlock with the specified name.\n     * \n     * @param name - The warlock's display name\n     */\n    constructor(name: string) {\n        super(name, PlayerClass.WARLOCK);\n    }\n\n    /**\n     * Initializes Warlock-specific abilities.\n     * @protected\n     */\n    protected initializeAbilities(): void {\n        this.abilities = [\n            {\n                id: 'eldritch_blast',\n                name: 'Eldritch Blast',\n                description: 'Fire a beam of crackling energy, dealing magic damage.',\n                manaCost: 8,\n                cooldown: 0,\n                currentCooldown: 0,\n                damage: 15,\n                source: 'class'\n            },\n            {\n                id: 'drain_life',\n                name: 'Drain Life',\n                description: 'Siphon life from an enemy, dealing damage and healing yourself for 50% of damage dealt.',\n                manaCost: 20,\n                cooldown: 3,\n                currentCooldown: 0,\n                damage: 12,\n                effect: 'lifesteal',\n                source: 'class'\n            },\n            {\n                id: 'hex',\n                name: 'Hex',\n                description: 'Curse an enemy, increasing damage they take by 25% for 3 turns.',\n                manaCost: 15,\n                cooldown: 4,\n                currentCooldown: 0,\n                effect: 'debuff',\n                source: 'class'\n            },\n            {\n                id: 'shadow_bolt',\n                name: 'Shadow Bolt',\n                description: 'Hurl a bolt of shadow energy. Consumes soul shards for bonus damage.',\n                manaCost: 25,\n                cooldown: 2,\n                currentCooldown: 0,\n                damage: 25,\n                source: 'class'\n            },\n            {\n                id: 'dark_pact',\n                name: 'Dark Pact',\n                description: 'Sacrifice 20% of current health to restore 40% of max mana.',\n                manaCost: 0,\n                cooldown: 5,\n                currentCooldown: 0,\n                effect: 'mana_restore',\n                source: 'class'\n            },\n            {\n                id: 'soul_harvest',\n                name: 'Soul Harvest',\n                description: 'Passive: Killing an enemy grants a soul shard (max 3). Active: Consume all shards to deal massive damage.',\n                manaCost: 35,\n                cooldown: 6,\n                currentCooldown: 0,\n                damage: 20, // Per shard\n                effect: 'consume_shards',\n                source: 'class'\n            }\n        ];\n    }\n\n    /**\n     * Gains a soul shard (called when enemy is killed).\n     * Soul shards are used to empower Shadow Bolt and Soul Harvest.\n     * \n     * @returns true if shard was gained, false if already at max\n     */\n    gainSoulShard(): boolean {\n        if (this.soulShards < this.maxSoulShards) {\n            this.soulShards++;\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * Executes Eldritch Blast - basic magic attack.\n     * Deals 15 base damage + 1.5 per level, can crit.\n     * Uses seeded RNG for crit determination.\n     * \n     * @returns Object with damage dealt and crit status, or null if ability unavailable\n     */\n    eldritchBlast(): { damage: number; isCrit: boolean } | null {\n        const ability = this.useAbility('eldritch_blast');\n        if (!ability) return null;\n\n        const baseDamage = ability.damage ?? 15;\n        const critChance = this.getCritChance();\n        const critMultiplier = this.getCritMultiplier();\n\n        const isCrit = isRNGInitialized()\n            ? getRNG().percentChance(critChance)\n            : Math.random() * 100 < critChance;\n        const damage = isCrit \n            ? Math.floor(baseDamage * critMultiplier)\n            : baseDamage;\n\n        // Scale with level\n        const scaledDamage = damage + Math.floor(this.level * 1.5);\n\n        return { damage: scaledDamage, isCrit };\n    }\n\n    /**\n     * Executes Drain Life - damage + heal.\n     * Deals 12 base damage + 1.2 per level, heals for 50% of damage dealt.\n     * Uses seeded RNG for crit determination.\n     * \n     * @returns Object with damage dealt and amount healed, or null if ability unavailable\n     */\n    drainLife(): { damage: number; healed: number } | null {\n        const ability = this.useAbility('drain_life');\n        if (!ability) return null;\n\n        const baseDamage = (ability.damage ?? 12) + Math.floor(this.level * 1.2);\n        const critChance = this.getCritChance();\n        const critMultiplier = this.getCritMultiplier();\n\n        const isCrit = isRNGInitialized()\n            ? getRNG().percentChance(critChance)\n            : Math.random() * 100 < critChance;\n        const damage = isCrit \n            ? Math.floor(baseDamage * critMultiplier)\n            : baseDamage;\n\n        const healed = this.heal(Math.floor(damage * 0.5));\n\n        return { damage, healed };\n    }\n\n    /**\n     * Executes Hex - applies damage vulnerability debuff to enemy.\n     * Target takes 25% more damage for 3 turns.\n     * \n     * @returns Object with damage increase percentage and duration, or null if ability unavailable\n     */\n    hex(): { damageIncrease: number; duration: number } | null {\n        const ability = this.useAbility('hex');\n        if (!ability) return null;\n\n        return { damageIncrease: 0.25, duration: 3 };\n    }\n\n    /**\n     * Executes Shadow Bolt - consumes soul shards for bonus damage.\n     * Deals 25 base damage + 2 per level + 10 per soul shard consumed.\n     * Uses seeded RNG for crit determination.\n     * \n     * @returns Object with damage, crit status, and shards consumed, or null if ability unavailable\n     */\n    shadowBolt(): { damage: number; isCrit: boolean; shardsConsumed: number } | null {\n        const ability = this.useAbility('shadow_bolt');\n        if (!ability) return null;\n\n        const baseDamage = (ability.damage ?? 25) + Math.floor(this.level * 2);\n        \n        // Bonus damage per soul shard\n        const shardBonus = this.soulShards * 10;\n        const shardsConsumed = this.soulShards;\n        this.soulShards = 0;\n\n        const critChance = this.getCritChance();\n        const critMultiplier = this.getCritMultiplier();\n\n        const isCrit = isRNGInitialized()\n            ? getRNG().percentChance(critChance)\n            : Math.random() * 100 < critChance;\n        const totalDamage = baseDamage + shardBonus;\n        const damage = isCrit \n            ? Math.floor(totalDamage * critMultiplier)\n            : totalDamage;\n\n        return { damage, isCrit, shardsConsumed };\n    }\n\n    /**\n     * Executes Dark Pact - sacrifice health for mana.\n     * Sacrifices 20% of current health to restore 40% of max mana.\n     * Cannot be used if it would kill the warlock.\n     * \n     * @returns Object with health lost and mana restored, or null if ability unavailable or would kill\n     */\n    darkPact(): { healthLost: number; manaRestored: number } | null {\n        const ability = this.useAbility('dark_pact');\n        if (!ability) return null;\n\n        const healthCost = Math.floor(this.stats.health * 0.2);\n        const manaRestore = Math.floor(this.getMaxMana() * 0.4);\n\n        // Can't kill yourself with Dark Pact\n        if (this.stats.health <= healthCost) {\n            return null;\n        }\n\n        this.stats.health -= healthCost;\n        const actualManaRestored = this.restoreMana(manaRestore);\n\n        return { healthLost: healthCost, manaRestored: actualManaRestored };\n    }\n\n    /**\n     * Executes Soul Harvest - consume all shards for massive damage.\n     * Deals (20 + 3 per level) damage per soul shard consumed.\n     * Requires at least 1 soul shard to use.\n     * \n     * @returns Object with total damage and shards consumed, or null if no shards or ability unavailable\n     */\n    soulHarvest(): { damage: number; shardsConsumed: number } | null {\n        if (this.soulShards === 0) return null;\n\n        const ability = this.useAbility('soul_harvest');\n        if (!ability) return null;\n\n        const damagePerShard = (ability.damage ?? 20) + Math.floor(this.level * 3);\n        const damage = damagePerShard * this.soulShards;\n        const shardsConsumed = this.soulShards;\n\n        this.soulShards = 0;\n\n        return { damage, shardsConsumed };\n    }\n\n    /**\n     * Warlock passive: Mana regeneration on basic attacks.\n     * Restores 3 mana per basic attack.\n     * \n     * @returns Basic attack result with on-hit effects\n     */\n    override basicAttack(): { damage: number; isCrit: boolean; onHitEffects: import('./player').OnHitResult[] } {\n        const result = super.basicAttack();\n        \n        // Restore small amount of mana on basic attack\n        this.restoreMana(3);\n\n        return result;\n    }\n\n    /**\n     * Serializes the warlock to JSON, including soul shards.\n     * \n     * @returns PlayerJSON object extended with soulShards\n     */\n    override toJSON() {\n        const json = super.toJSON();\n        return {\n            ...json,\n            soulShards: this.soulShards\n        };\n    }\n\n    /**\n     * Deserializes a Warlock from JSON data.\n     * \n     * @param data - The serialized PlayerJSON data (with soulShards extension)\n     * @param itemLookup - Map of item IDs to Item objects for restoring equipment/inventory\n     * @returns A fully restored Warlock instance\n     * \n     * @example\n     * ```typescript\n     * const savedData = JSON.parse(saveFile);\n     * const items = new Map<string, Item>();\n     * // ... populate items map ...\n     * const warlock = Warlock.fromJSON(savedData, items);\n     * ```\n     */\n    static fromJSON(data: PlayerJSON & { soulShards?: number }, itemLookup: Map<string, Item>): Warlock {\n        const warlock = new Warlock(data.name);\n        \n        // Restore basic properties\n        warlock.level = data.level;\n        warlock.experience = data.experience;\n        warlock.gold = data.gold;\n        warlock.stats = { ...data.stats };\n        \n        // Restore soul shards (warlock-specific)\n        warlock.soulShards = data.soulShards ?? 0;\n        \n        // Restore equipment from itemLookup\n        if (data.equipment.weapon) {\n            const weapon = itemLookup.get(data.equipment.weapon);\n            if (weapon) warlock.equipment.weapon = weapon;\n        }\n        if (data.equipment.armor) {\n            const armor = itemLookup.get(data.equipment.armor);\n            if (armor) warlock.equipment.armor = armor;\n        }\n        if (data.equipment.accessory) {\n            const accessory = itemLookup.get(data.equipment.accessory);\n            if (accessory) warlock.equipment.accessory = accessory;\n        }\n        \n        // Restore inventory from itemLookup\n        warlock.inventory = data.inventory\n            .map(id => itemLookup.get(id))\n            .filter((item): item is Item => item !== undefined);\n        \n        // Restore abilities (with cooldown states)\n        warlock.abilities = data.abilities.map(a => ({ ...a }));\n        \n        // Restore active buffs\n        warlock.activeBuffs = data.activeBuffs.map(b => ({ ...b }));\n        \n        return warlock;\n    }\n}\n", "/**\n * @fileoverview Inventory Management System\n * \n * Handles all inventory-related actions including:\n * - Equipping and unequipping items\n * - Using consumable items\n * - Managing inventory state\n * \n * @module game/managers/InventoryManager\n */\n\nimport { Player } from '../../entities/player';\nimport { Item, ItemSlot } from '../../entities/item';\nimport { ActionResult } from '../gameState';\n\n/**\n * Manages player inventory operations.\n * Extracted from GameStateManager for better separation of concerns.\n */\nexport class InventoryManager {\n    /**\n     * Equips an item from the player's inventory.\n     * \n     * @param player - The player to equip the item on\n     * @param itemId - ID of the item to equip\n     * @returns ActionResult indicating success or failure\n     */\n    equipItem(player: Player, itemId: string): ActionResult {\n        const item = player.inventory.find(i => i.id === itemId);\n        if (!item) {\n            return { type: 'equip_failed', success: false, message: 'Item not found' };\n        }\n        \n        const equipped = player.equipItem(item);\n        if (equipped) {\n            return { \n                type: 'item_equipped', \n                success: true, \n                message: `Equipped ${item.name}`,\n                result: { item }\n            };\n        }\n        return { type: 'equip_failed', success: false, message: `Cannot equip ${item.name}` };\n    }\n\n    /**\n     * Unequips an item from a specific slot.\n     * \n     * @param player - The player to unequip from\n     * @param slotName - Name of the slot to unequip ('weapon', 'armor', 'accessory')\n     * @returns ActionResult indicating success or failure\n     */\n    unequipItem(player: Player, slotName: string | undefined): ActionResult {\n        if (!slotName) {\n            return { type: 'unequip_failed', success: false, message: 'No slot specified' };\n        }\n        \n        // Convert slot name to ItemSlot enum\n        const slotMap: Record<string, ItemSlot> = {\n            'weapon': ItemSlot.WEAPON,\n            'armor': ItemSlot.ARMOR,\n            'accessory': ItemSlot.ACCESSORY\n        };\n        \n        const itemSlot = slotMap[slotName];\n        if (!itemSlot) {\n            return { type: 'unequip_failed', success: false, message: 'Invalid slot' };\n        }\n        \n        const item = player.equipment[slotName as keyof typeof player.equipment];\n        if (!item) {\n            return { type: 'unequip_failed', success: false, message: 'No item in that slot' };\n        }\n        \n        const unequipped = player.unequipSlot(itemSlot);\n        if (unequipped) {\n            return { \n                type: 'item_unequipped', \n                success: true, \n                message: `Unequipped ${item.name}`,\n                result: { item: unequipped }\n            };\n        }\n        return { type: 'unequip_failed', success: false, message: `Cannot unequip ${item.name}` };\n    }\n\n    /**\n     * Uses a consumable item from the player's inventory.\n     * \n     * @param player - The player using the item\n     * @param itemId - ID of the item to use\n     * @returns ActionResult indicating success or failure\n     */\n    useItem(player: Player, itemId: string): ActionResult {\n        const item = player.inventory.find(i => i.id === itemId);\n        if (!item) {\n            return { type: 'use_failed', success: false, message: 'Item not found' };\n        }\n        \n        const success = player.useConsumable(item);\n        return { \n            type: 'item_used', \n            success, \n            message: success ? `Used ${item.name}` : 'Failed to use item',\n            result: { item }\n        };\n    }\n}\n\n", "/**\n * @fileoverview Shop Management System\n * \n * Handles all shop-related actions including:\n * - Buying items from shops\n * - Selling items to shops\n * - Price calculations\n * \n * @module game/managers/ShopManager\n */\n\nimport { Player } from '../../entities/player';\nimport { Room } from '../../dungeon/room';\nimport { getSellPrice } from '../../entities/itemDatabase';\nimport { ActionResult, GameStats } from '../gameState';\n\n/**\n * Manages shop transactions.\n * Extracted from GameStateManager for better separation of concerns.\n */\nexport class ShopManager {\n    /**\n     * Attempts to buy an item from a shop.\n     * \n     * @param player - The player making the purchase\n     * @param room - The room containing the shop\n     * @param itemId - ID of the item to buy\n     * @param stats - Game stats to update\n     * @returns ActionResult indicating success or failure\n     */\n    buyItem(player: Player, room: Room | null, itemId: string, stats: GameStats): ActionResult {\n        if (!room?.shopInventory) {\n            return { type: 'buy_failed', success: false, message: 'No shop here' };\n        }\n        \n        const shopItemIndex = room.shopInventory.findIndex(si => si.item.id === itemId);\n        if (shopItemIndex === -1) {\n            return { type: 'buy_failed', success: false, message: 'Item not in shop' };\n        }\n        \n        const shopItem = room.shopInventory[shopItemIndex];\n        if (player.gold < shopItem.buyPrice) {\n            return { \n                type: 'buy_failed', \n                success: false, \n                message: `Not enough gold (need ${shopItem.buyPrice}, have ${player.gold})` \n            };\n        }\n        \n        // Complete the purchase\n        player.gold -= shopItem.buyPrice;\n        player.addToInventory(shopItem.item);\n        room.shopInventory.splice(shopItemIndex, 1);\n        stats.itemsFound++;\n        \n        return { \n            type: 'item_bought', \n            success: true, \n            message: `Bought ${shopItem.item.name} for ${shopItem.buyPrice} gold`,\n            result: { item: shopItem.item, gold: -shopItem.buyPrice }\n        };\n    }\n\n    /**\n     * Sells an item from the player's inventory.\n     * \n     * @param player - The player selling the item\n     * @param itemId - ID of the item to sell\n     * @param stats - Game stats to update\n     * @returns ActionResult indicating success or failure\n     */\n    sellItem(player: Player, itemId: string, stats: GameStats): ActionResult {\n        const item = player.inventory.find(i => i.id === itemId);\n        if (!item) {\n            return { type: 'sell_failed', success: false, message: 'Item not found' };\n        }\n        \n        const sellPrice = getSellPrice(item);\n        \n        // Remove from inventory and add gold\n        const itemIndex = player.inventory.findIndex(i => i.id === itemId);\n        player.inventory.splice(itemIndex, 1);\n        player.addGold(sellPrice);\n        stats.goldCollected += sellPrice;\n        \n        return { \n            type: 'item_sold', \n            success: true, \n            message: `Sold ${item.name} for ${sellPrice} gold`,\n            result: { item, gold: sellPrice }\n        };\n    }\n\n    /**\n     * Gets the sell price for an item.\n     * \n     * @param itemId - ID of the item to price\n     * @param player - The player whose inventory to check\n     * @returns The sell price, or 0 if item not found\n     */\n    getSellPrice(itemId: string, player: Player): number {\n        const item = player.inventory.find(i => i.id === itemId);\n        if (!item) return 0;\n        return getSellPrice(item);\n    }\n}\n\n", "/**\n * @fileoverview Interaction Management System\n * \n * Handles all interactable object interactions including:\n * - Chests (loot and gold)\n * - Traps (damage)\n * - Altars (blessings/curses)\n * - NPCs (dialogue)\n * \n * @module game/managers/InteractionManager\n */\n\nimport { Player } from '../../entities/player';\nimport { Room } from '../../dungeon/room';\nimport { interact as interactWith, InteractionResult } from '../../dungeon/Interactable';\nimport { ActionResult, GameStats, GamePhase } from '../gameState';\n\n/**\n * Result of an interaction that may affect game state.\n */\nexport interface InteractionOutcome {\n    /** The action result to return */\n    result: ActionResult;\n    /** Whether the player died from the interaction */\n    playerDied: boolean;\n}\n\n/**\n * Manages interactions with room objects.\n * Extracted from GameStateManager for better separation of concerns.\n */\nexport class InteractionManager {\n    /**\n     * Interacts with an object in the current room.\n     * \n     * @param player - The player performing the interaction\n     * @param room - The room containing the interactable\n     * @param interactableIndex - Index of the interactable in the room\n     * @param stats - Game stats to update\n     * @returns InteractionOutcome with result and death status\n     */\n    interact(\n        player: Player, \n        room: Room | null, \n        interactableIndex: number | undefined,\n        stats: GameStats\n    ): InteractionOutcome {\n        if (!room) {\n            return {\n                result: { type: 'interact_failed', success: false, message: 'No room' },\n                playerDied: false\n            };\n        }\n        \n        if (interactableIndex === undefined || !room.interactables[interactableIndex]) {\n            return {\n                result: { type: 'interact_failed', success: false, message: 'Nothing to interact with' },\n                playerDied: false\n            };\n        }\n        \n        const interactable = room.interactables[interactableIndex];\n        const interactResult: InteractionResult = interactWith(interactable);\n        \n        // Apply interaction results\n        let playerDied = false;\n        \n        if (interactResult.gold && interactResult.gold > 0) {\n            player.addGold(interactResult.gold);\n            stats.goldCollected += interactResult.gold;\n        }\n        \n        if (interactResult.items && interactResult.items.length > 0) {\n            interactResult.items.forEach(item => {\n                player.addToInventory(item);\n                stats.itemsFound++;\n            });\n        }\n        \n        if (interactResult.damage && interactResult.damage > 0) {\n            player.takeDamage(interactResult.damage);\n            if (!player.isAlive()) {\n                playerDied = true;\n            }\n        }\n        \n        if (interactResult.healing && interactResult.healing > 0) {\n            player.heal(interactResult.healing);\n        }\n        \n        if (interactResult.statBonus) {\n            player.applyBuff('Blessing', interactResult.statBonus, interactResult.duration || 10);\n        }\n        \n        return {\n            result: { \n                type: 'interacted', \n                success: true, \n                message: interactResult.message,\n                result: interactResult\n            },\n            playerDied\n        };\n    }\n}\n\n", "/**\n * @fileoverview Puzzle Management System\n * \n * Handles all puzzle-related actions including:\n * - Attempting puzzle answers\n * - Calculating puzzle rewards\n * - Skipping puzzles\n * \n * @module game/managers/PuzzleManager\n */\n\nimport { Player } from '../../entities/player';\nimport { Room } from '../../dungeon/room';\nimport { attemptPuzzle } from '../../puzzles/puzzle';\nimport { ActionResult, GameStats, GamePhase } from '../gameState';\n\n/**\n * Result of a puzzle attempt that may change game phase.\n */\nexport interface PuzzleOutcome {\n    /** The action result to return */\n    result: ActionResult;\n    /** The new game phase (if puzzle is complete) */\n    newPhase?: GamePhase;\n    /** Whether the room should be marked complete */\n    roomComplete: boolean;\n}\n\n/**\n * Manages puzzle interactions.\n * Extracted from GameStateManager for better separation of concerns.\n */\nexport class PuzzleManager {\n    /**\n     * Attempts to answer a puzzle.\n     * \n     * @param player - The player attempting the puzzle\n     * @param room - The room containing the puzzle\n     * @param answerIndex - Index of the selected answer\n     * @param stats - Game stats to update\n     * @returns PuzzleOutcome with result and phase changes\n     */\n    attemptAnswer(\n        player: Player,\n        room: Room | null,\n        answerIndex: number | undefined,\n        stats: GameStats\n    ): PuzzleOutcome {\n        if (!room?.puzzle) {\n            return {\n                result: { type: 'puzzle_failed', success: false, message: 'No puzzle here' },\n                roomComplete: false\n            };\n        }\n        \n        if (answerIndex === undefined) {\n            return {\n                result: { type: 'puzzle_failed', success: false, message: 'No answer provided' },\n                roomComplete: false\n            };\n        }\n        \n        const result = attemptPuzzle(room.puzzle, answerIndex);\n        \n        if (result.complete && result.correct) {\n            // Puzzle solved - give rewards\n            const baseXP = 50 * room.level;\n            const xp = Math.floor(baseXP * room.puzzle.rewardMultiplier);\n            const gold = Math.floor(30 * room.level * room.puzzle.rewardMultiplier);\n            \n            player.addExperience(xp);\n            player.addGold(gold);\n            stats.goldCollected += gold;\n            \n            return {\n                result: { \n                    type: 'puzzle_solved', \n                    success: true, \n                    message: `${result.message} You earned ${xp} XP and ${gold} gold!`,\n                    result: { gold }\n                },\n                newPhase: GamePhase.EXPLORATION,\n                roomComplete: true\n            };\n        } else if (result.complete && !result.correct) {\n            // Puzzle failed - no rewards\n            return {\n                result: { \n                    type: 'puzzle_failed', \n                    success: false, \n                    message: result.message\n                },\n                newPhase: GamePhase.EXPLORATION,\n                roomComplete: true\n            };\n        } else {\n            // Wrong answer but attempts remain\n            return {\n                result: { \n                    type: 'puzzle_wrong', \n                    success: false, \n                    message: result.message\n                },\n                roomComplete: false\n            };\n        }\n    }\n\n    /**\n     * Skips the current puzzle, forfeiting rewards.\n     * \n     * @param room - The room containing the puzzle\n     * @returns PuzzleOutcome indicating the puzzle was skipped\n     */\n    skipPuzzle(room: Room | null): PuzzleOutcome {\n        if (!room?.puzzle) {\n            return {\n                result: { type: 'puzzle_skipped', success: true, message: 'No puzzle to skip' },\n                roomComplete: false\n            };\n        }\n        \n        return {\n            result: { \n                type: 'puzzle_skipped', \n                success: true, \n                message: 'You decided to skip the puzzle, forfeiting any rewards.'\n            },\n            newPhase: GamePhase.EXPLORATION,\n            roomComplete: true\n        };\n    }\n}\n\n", "/**\n * @fileoverview Event Management System\n * \n * Handles mysterious event room outcomes including:\n * - Buffs and debuffs\n * - Item rewards\n * - Gold rewards\n * - Health changes\n * \n * @module game/managers/EventManager\n */\n\nimport { Player } from '../../entities/player';\nimport { Room } from '../../dungeon/room';\nimport { EventOutcomeType, getOutcomeMessage } from '../../events/mysteriousEvent';\nimport { ActionResult, GameStats, GamePhase } from '../gameState';\n\n/**\n * Result of executing an event that may affect game state.\n */\nexport interface EventOutcome {\n    /** The action result to return */\n    result: ActionResult;\n    /** Whether the player died from the event */\n    playerDied: boolean;\n    /** The new game phase */\n    newPhase: GamePhase;\n}\n\n/**\n * Manages mysterious event execution.\n * Extracted from GameStateManager for better separation of concerns.\n */\nexport class EventManager {\n    /**\n     * Executes the event in the current room.\n     * \n     * @param player - The player experiencing the event\n     * @param room - The room containing the event\n     * @param stats - Game stats to update\n     * @returns EventOutcome with result, death status, and phase change\n     */\n    executeEvent(player: Player, room: Room | null, stats: GameStats): EventOutcome {\n        if (!room) {\n            return {\n                result: { type: 'event', success: false, message: 'Cannot execute event' },\n                playerDied: false,\n                newPhase: GamePhase.EXPLORATION\n            };\n        }\n        \n        if (!room.event) {\n            return {\n                result: { type: 'event', success: false, message: 'No event in this room' },\n                playerDied: false,\n                newPhase: GamePhase.EXPLORATION\n            };\n        }\n        \n        const event = room.event;\n        const outcome = event.outcome;\n        let message = getOutcomeMessage(outcome);\n        let playerDied = false;\n        \n        // Apply the outcome\n        switch (outcome.type) {\n            case EventOutcomeType.BUFF:\n                if (outcome.statBonus && outcome.duration) {\n                    player.applyBuff(event.title, outcome.statBonus, outcome.duration);\n                }\n                break;\n                \n            case EventOutcomeType.DEBUFF:\n                if (outcome.statBonus && outcome.duration) {\n                    // Debuffs are negative stat bonuses\n                    const negativeBonus = { ...outcome.statBonus };\n                    for (const key in negativeBonus) {\n                        if (negativeBonus[key as keyof typeof negativeBonus] !== undefined) {\n                            (negativeBonus as Record<string, number>)[key] = -(negativeBonus[key as keyof typeof negativeBonus] as number);\n                        }\n                    }\n                    player.applyBuff(event.title, negativeBonus, outcome.duration);\n                }\n                break;\n                \n            case EventOutcomeType.WEAPON:\n            case EventOutcomeType.ARMOR:\n            case EventOutcomeType.POTION:\n                if (outcome.item) {\n                    player.addToInventory(outcome.item);\n                    stats.itemsFound++;\n                }\n                break;\n                \n            case EventOutcomeType.GOLD:\n                if (outcome.gold) {\n                    player.addGold(outcome.gold);\n                    stats.goldCollected += outcome.gold;\n                }\n                break;\n                \n            case EventOutcomeType.HEAL:\n                if (outcome.healthChange) {\n                    const healAmount = Math.floor(player.getMaxHealth() * outcome.healthChange);\n                    player.heal(healAmount);\n                    message = `You feel revitalized! Healed for ${healAmount} HP.`;\n                }\n                break;\n                \n            case EventOutcomeType.DAMAGE:\n                if (outcome.healthChange) {\n                    const damageAmount = Math.floor(player.getMaxHealth() * Math.abs(outcome.healthChange));\n                    player.takeDamage(damageAmount);\n                    message = `Dark energy surges through you! Took ${damageAmount} damage.`;\n                    if (!player.isAlive()) {\n                        playerDied = true;\n                        message += ' You have been slain!';\n                    }\n                }\n                break;\n        }\n        \n        // Mark room as complete and transition to exploration\n        room.complete();\n        \n        return {\n            result: { \n                type: 'event', \n                success: true, \n                message\n            },\n            playerDied,\n            newPhase: GamePhase.EXPLORATION\n        };\n    }\n}\n\n", "/**\n * @fileoverview Game State Management for the Dungeon Roguelike\n * \n * This module contains the core game state management system including:\n * - Game phases (exploration, combat, shop, etc.)\n * - Player actions and their results\n * - Room navigation and completion\n * - Combat action processing\n * \n * @module game/gameState\n */\n\nimport { Player, PlayerClass } from \"../entities/player\";\nimport { Room, RoomState, RoomType } from \"../dungeon/room\";\nimport { DungeonLayer } from \"./seed\";\nimport { CombatState } from \"./combatEngine\";\nimport { Fighter } from \"../entities/fighter\";\nimport { DungeonGenerator } from \"../integration/dungeonGenerator\";\nimport { Warlock } from \"../entities/warlock\";\nimport { Item, ItemType, ItemSlot } from \"../entities/item\";\nimport { getSellPrice } from \"../entities/itemDatabase\";\nimport { getRNG, isRNGInitialized } from \"./seed\";\nimport { \n    InventoryManager, \n    ShopManager, \n    InteractionManager, \n    PuzzleManager, \n    EventManager \n} from \"./managers\";\n\n/**\n * Represents the current phase of the game.\n * Determines what actions are available to the player.\n * @enum {string}\n */\nexport enum GamePhase {\n    /** Player can move between rooms, interact with objects, use items */\n    EXPLORATION = 'exploration',\n    /** Turn-based combat is active */\n    COMBAT = 'combat',\n    /** Player is browsing shop inventory */\n    SHOP = 'shop',\n    /** Player is processing an event choice */\n    EVENT = 'event',\n    /** Player is at a rest room, can heal/upgrade */\n    REST = 'rest',\n    /** Player has died - game over */\n    GAME_OVER = 'game_over',\n    /** Boss has been defeated - victory */\n    VICTORY = 'victory',\n    /** Player is browsing inventory */\n    INVENTORY = 'inventory',\n    /** Player is viewing character sheet */\n    CHARACTER = 'character',\n    /** Player is solving a puzzle */\n    PUZZLE = 'puzzle',\n    /** Player is in a treasure room */\n    TREASURE = 'treasure',\n}\n\n/**\n * Tracks cumulative statistics for the current game run.\n * Used for end-game summary and achievements.\n * @interface\n */\nexport interface GameStats {\n    /** Total number of rooms the player has cleared */\n    roomsCleared: number;\n    /** Total number of enemies defeated */\n    enemiesDefeated: number;\n    /** Total gold collected throughout the run */\n    goldCollected: number;\n    /** Total number of items found */\n    itemsFound: number;\n}\n\n/**\n * Complete snapshot of the current game state.\n * Contains all information needed to render the game and determine valid actions.\n * @interface\n */\nexport interface GameState {\n    /** The player entity, null if game not started */\n    player: Player | null;\n    /** Dungeon structure and navigation state */\n    dungeon: {\n        /** Map of room IDs to Room objects for quick lookup */\n        rooms: Map<string, Room>;\n        /** Ordered array of dungeon layers (levels) */\n        layers: DungeonLayer[];\n        /** ID of the room the player is currently in */\n        currentRoomId: string | null;\n    };\n    /** Current game phase determining available actions */\n    phase: GamePhase;\n    /** Active combat state, null when not in combat */\n    combat: CombatState | null;\n    /** Current turn number (increments each player action) */\n    turn: number;\n    /** Cumulative game statistics */\n    stats: GameStats;\n    /** The seed used for this game run */\n    seed: string;\n}\n\n/**\n * Represents a player action that can be executed.\n * Different action types have different required fields.\n * @interface\n */\nexport interface Action {\n    /** \n     * The type of action to perform.\n     * Valid types: 'move', 'interact', 'basic_attack', 'ability', \n     * 'use_item', 'flee', 'rest', 'leave', 'leave_shop', 'restart',\n     * 'open_inventory', 'view_character', 'view_stats', 'quit'\n     */\n    type: string;\n    /** Target room ID for 'move' actions */\n    roomId?: string;\n    /** Type of the target room for 'move' actions (for UI display) */\n    roomType?: RoomType;\n    /** Target interactable ID for 'interact' actions */\n    interactableId?: string;\n    /** Display name for the action (for UI) */\n    name?: string;\n    /** Ability ID for 'ability' actions */\n    abilityId?: string;\n    /** Ability display name for 'ability' actions */\n    abilityName?: string;\n    /** Item ID for 'use_item' actions */\n    itemId?: string;\n    /** Item display name for 'use_item' actions */\n    itemName?: string;\n    /** Action to open inventory */\n    openInventory?: boolean;\n    /** Action to close inventory */\n    closeInventory?: boolean;\n    /** Action to view character sheet */\n    viewCharacter?: boolean;\n    /** Action to close character sheet */\n    closeCharacter?: boolean;\n    /** Action to equip an item */\n    equipItem?: boolean;\n    /** Action to unequip an item */\n    unequipItem?: boolean;\n    /** Action to sell an item */\n    sellItem?: boolean;\n    /** Action to buy an item */\n    buyItem?: boolean;\n    /** Action to sell all items */\n    sellAllItems?: boolean;\n    /** Equipment slot for equip/unequip actions */\n    slot?: 'weapon' | 'armor' | 'accessory';\n    /** Price for buy/sell actions */\n    price?: number;\n    /** Answer index for puzzle actions */\n    answerIndex?: number;\n    /** Answer text for puzzle actions */\n    answerText?: string;\n    /** Interactable index for interact actions */\n    interactableIndex?: number;\n    /** Interactable name for interact actions */\n    interactableName?: string;\n}\n\n/**\n * Result returned after executing an action.\n * Contains success/failure status and any effects that occurred.\n * @interface\n */\nexport interface ActionResult {\n    /** \n     * Type of result corresponding to the action executed.\n     * Examples: 'moved', 'interaction', 'combat_action', 'item_used', \n     * 'flee', 'rested', 'left', 'restart_requested', etc.\n     */\n    type: string;\n    /** Whether the action succeeded */\n    success?: boolean;\n    /** Human-readable message describing the result */\n    message?: string;\n    /** Detailed result data for actions with effects */\n    result?: {\n        /** Damage dealt or taken */\n        damage?: number;\n        /** Health restored */\n        healing?: number;\n        /** Gold gained */\n        gold?: number;\n        /** Items received */\n        items?: Item[];\n        /** Single item involved in the action */\n        item?: Item;\n    };\n}\n\n\n/**\n * Central manager for all game state operations.\n * \n * Handles:\n * - Game initialization and setup\n * - Room navigation and transitions\n * - Action validation and execution\n * - Phase transitions\n * - Player death and victory conditions\n * \n * @example\n * ```typescript\n * const manager = new GameStateManager();\n * await manager.startNewGame('fighter', 'Hero', 'my-seed');\n * \n * const actions = manager.getAvailableActions();\n * const result = manager.executeAction(actions[0]);\n * ```\n */\nexport class GameStateManager {\n    /** Internal game state - access via getState() */\n    private currentGameState: GameState;\n    \n    /** Stores the phase before opening overlay screens (inventory, character) */\n    private previousPhase: GamePhase | null = null;\n\n    // Extracted managers for better separation of concerns\n    private readonly inventoryManager = new InventoryManager();\n    private readonly shopManager = new ShopManager();\n    private readonly interactionManager = new InteractionManager();\n    private readonly puzzleManager = new PuzzleManager();\n    private readonly eventManager = new EventManager();\n\n    /**\n     * Creates a new GameStateManager with default empty state.\n     * Call startNewGame() to initialize a playable game.\n     */\n    constructor() {\n        this.currentGameState = {\n            player: null,\n            dungeon: {\n                rooms: new Map(),\n                layers: [],\n                currentRoomId: null\n            },\n            phase: GamePhase.EXPLORATION,\n            combat: null,\n            turn: 0,\n            stats: {\n                roomsCleared: 0,\n                enemiesDefeated: 0,\n                goldCollected: 0,\n                itemsFound: 0,\n            },\n            seed: ''\n        }\n    }\n\n    /**\n     * Initializes a new game with the specified player and dungeon.\n     * Generates the dungeon, creates the player, and positions them at the entrance.\n     * \n     * @param playerClass - The class for the player character\n     * @param playerName - Display name for the player\n     * @param seed - Seed string for reproducible dungeon generation\n     * @returns Promise resolving to the initialized GameState\n     * \n     * @example\n     * ```typescript\n     * const state = await manager.startNewGame('warlock', 'Merlin', 'dungeon-seed-123');\n     * console.log(state.player?.name); // 'Merlin'\n     * ```\n     */\n    startNewGame(playerClass: 'fighter' | 'warlock', playerName: string, seed: string): GameState {\n        let player: Player\n        switch (playerClass) {\n            case 'fighter':\n                player = new Fighter(playerName);\n                break;\n            case 'warlock':\n                player = new Warlock(playerName);\n                break;\n        }\n        const dungeon = new DungeonGenerator(seed);\n        const rooms = dungeon.generate(20, 3, 0.3);\n        const layers = dungeon.getLayers();\n        \n        // Validate dungeon connectivity (log warnings if issues found)\n        const connectivityErrors = dungeon.validateConnectivity();\n        if (connectivityErrors.length > 0) {\n            console.warn('Dungeon connectivity issues found:', connectivityErrors);\n        }\n\n        const roomsMap = new Map<string, Room>();\n        for (const room of rooms) {\n            roomsMap.set(room.id, room);\n        }\n\n        const entranceRoom = rooms[0]\n\n        // Set entrance room to AVAILABLE so it can be entered, then enter it\n        entranceRoom.state = RoomState.AVAILABLE;\n        entranceRoom.enter(); // Sets state to ACTIVE\n\n        // Unlock all rooms connected to the entrance\n        for (const connectedId of entranceRoom.connections) {\n            const connectedRoom = roomsMap.get(connectedId);\n            if (connectedRoom && connectedRoom.state === RoomState.LOCKED) {\n                connectedRoom.state = RoomState.AVAILABLE;\n            }\n        }\n\n        this.currentGameState = {\n            player,\n            dungeon: {\n                rooms: roomsMap,\n                layers,\n                currentRoomId: entranceRoom.id\n            },\n            phase: GamePhase.EXPLORATION,\n            combat: null,\n            turn: 0,\n            stats: {\n                roomsCleared: 0,\n                enemiesDefeated: 0,\n                goldCollected: 0,\n                itemsFound: 0,\n            },\n            seed\n        }\n\n        return this.currentGameState;\n    }\n\n    /**\n     * Returns the current game state.\n     * Use this to read state for rendering or decision making.\n     * \n     * @returns The current GameState object\n     */\n    getState(): GameState {\n        return this.currentGameState;\n    }\n\n    /**\n     * Gets the Room object for the player's current location.\n     * \n     * @returns The current Room or null if not in a room\n     * @private\n     */\n    private getCurrentRoom(): Room | null {\n        const { dungeon } = this.currentGameState;\n        if (!dungeon.currentRoomId) {\n            return null;\n        }\n        return dungeon.rooms.get(dungeon.currentRoomId) as Room;\n    }\n\n    /**\n     * Gets the ID of the player's current room.\n     * \n     * @returns The current room ID or null\n     * @private\n     */\n    private getCurrentRoomId(): string | null {\n        return this.currentGameState.dungeon.currentRoomId;\n    }\n\n\n    /**\n     * Moves the player to a connected room.\n     * \n     * This method:\n     * 1. Validates the target room exists and is connected\n     * 2. Marks the current room as cleared\n     * 3. Enters the new room and sets it as active\n     * 4. Unlocks adjacent rooms\n     * 5. Determines the appropriate game phase based on room type\n     * \n     * @param roomId - The ID of the room to move to\n     * @returns The updated GameState after the move\n     * @throws Error if room not found, not connected, or cannot be entered\n     * \n     * @example\n     * ```typescript\n     * try {\n     *   const newState = manager.moveToRoom('room-uuid-123');\n     *   console.log(newState.phase); // Might be 'combat' if enemies present\n     * } catch (e) {\n     *   console.error('Cannot move:', e.message);\n     * }\n     * ```\n     */\n    async moveToRoom(roomId: string): Promise<GameState> {\n        const { dungeon, stats } = this.currentGameState;\n        // 1. Get target room from dungeon\n        const targetRoom = dungeon.rooms.get(roomId);\n        if (!targetRoom) {\n            throw new Error(`Room ${roomId} not found`);\n        }\n        // 2. if room is not connected to current room \u2192 error\n        const currentRoom = dungeon.rooms.get(dungeon.currentRoomId as string);\n        if (currentRoom && !currentRoom.connections.includes(roomId)) {\n            throw new Error(`Room ${roomId} is not connected to current room`);\n        }\n        // 3. if room cannot be entered \u2192 error\n        if (!targetRoom.canEnter()) {\n            throw new Error(`Room ${roomId} cannot be entered`);\n        }\n        // 4. Set current room to CLEARED (if it is active)\n        if (currentRoom && currentRoom.state === RoomState.ACTIVE) {\n            currentRoom.state = RoomState.CLEARED;\n            stats.roomsCleared++;\n        }\n        \n        // 5. Lock all other AVAILABLE rooms on the same level and below\n        // This enforces the \"choose your path\" mechanic - once you pick a room,\n        // other branches become permanently inaccessible\n        const targetLevel = targetRoom.level;\n        for (const [id, room] of dungeon.rooms) {\n            // Skip the room we're moving to\n            if (id === roomId) continue;\n            // Skip rooms that are already cleared or locked\n            if (room.state === RoomState.CLEARED || room.state === RoomState.LOCKED) continue;\n            // Lock rooms on the same level (siblings we didn't choose)\n            if (room.level === targetLevel && room.state === RoomState.AVAILABLE) {\n                room.state = RoomState.LOCKED;\n            }\n            // Lock rooms on levels below that aren't connected to our target\n            // (branches we can no longer reach)\n            if (room.level > targetLevel && room.state === RoomState.AVAILABLE) {\n                // Check if this room is reachable from the target room's connections\n                if (!targetRoom.connections.includes(id)) {\n                    room.state = RoomState.LOCKED;\n                }\n            }\n        }\n        \n        // 6. Set currentRoomId to new room\n        dungeon.currentRoomId = roomId;\n        // 7. Call room.enter()\n        targetRoom.enter();\n        // 8. Unlock connected rooms (set to AVAILABLE) - only rooms on the NEXT level\n        for (const connectedId of targetRoom.connections) {\n            const connectedRoom = dungeon.rooms.get(connectedId);\n            if (connectedRoom && connectedRoom.state === RoomState.LOCKED) {\n                // Only unlock rooms that are on the next level (deeper in dungeon)\n                if (connectedRoom.level > targetLevel) {\n                    connectedRoom.state = RoomState.AVAILABLE;\n                }\n            }\n        }\n\n        // 9. Load enemies if entering a hostile room (lazy loading)\n        // This must happen BEFORE determining phase, since phase depends on enemies being present\n        if (targetRoom.isHostileRoom()) {\n            await targetRoom.ensureEnemiesLoaded();\n        }\n\n        // 10. Determine phase based on room type (now that enemies are loaded)\n        this.currentGameState.phase = this.determinePhaseForRoom(targetRoom);\n\n        // 11. Return updated state\n        return this.currentGameState;\n    }\n\n    /**\n     * Determines the appropriate game phase based on room type.\n     * \n     * @param room - The room to determine phase for\n     * @returns The GamePhase that should be active in this room\n     * @private\n     */\n    private determinePhaseForRoom(room: Room): GamePhase {\n        switch (room.type) {\n            case RoomType.COMBAT:\n            case RoomType.ELITE:\n            case RoomType.BOSS:\n                // Only enter combat if there are enemies\n                if (room.enemies && room.enemies.length > 0) {\n                    return GamePhase.COMBAT;\n                }\n                return GamePhase.EXPLORATION;\n\n            case RoomType.SHOP:\n                return GamePhase.SHOP;\n\n            case RoomType.REST:\n                return GamePhase.REST;\n\n            case RoomType.EVENT:\n                return GamePhase.EVENT;\n\n            case RoomType.PUZZLE:\n                // Only show puzzle phase if puzzle hasn't been solved\n                if (room.puzzle && !room.puzzle.solved && room.puzzle.attempts < room.puzzle.maxAttempts) {\n                    return GamePhase.PUZZLE;\n                }\n                return GamePhase.EXPLORATION;\n\n            case RoomType.TREASURE:\n                return GamePhase.TREASURE;\n\n            case RoomType.ENTRANCE:\n            default:\n                return GamePhase.EXPLORATION;\n        }\n    }\n\n    /**\n     * Result of completing a room, including rewards granted.\n     */\n    public lastRoomRewards: { gold: number; experience: number; items: Item[]; healthRestore?: number } | null = null;\n\n    /**\n     * Completes the current room and grants rewards to the player.\n     * \n     * This method:\n     * 1. Validates the room can be completed (active, no remaining enemies)\n     * 2. Grants gold, experience, and items to the player\n     * 3. Updates game statistics\n     * 4. Transitions to victory if boss room, otherwise exploration\n     * \n     * @returns The updated GameState after completion\n     * @throws Error if no current room, room not active, or enemies remain\n     * \n     * @example\n     * ```typescript\n     * // After defeating all enemies in combat\n     * const state = manager.completeRoom();\n     * console.log(state.stats.goldCollected); // Updated gold total\n     * ```\n     */\n    completeRoom(): GameState {\n        const currentRoom = this.getCurrentRoom();\n        if (!currentRoom) {\n            throw new Error('No current room');\n        }\n\n        if (currentRoom.state !== RoomState.ACTIVE) {\n            throw new Error('Room is not active');\n        }\n\n        if (this.currentGameState.phase === GamePhase.COMBAT && this.currentGameState.dungeon.rooms.get(this.currentGameState.dungeon.currentRoomId as string)?.enemies?.some(enemy => enemy.health > 0)) {\n            throw new Error('Cannot complete room in combat');\n        }\n\n        const rewards = currentRoom.complete();\n        const { player } = this.currentGameState;\n\n        if (player) {\n            player.addGold(rewards.gold);\n            player.addExperience(rewards.experience);\n            player.inventory.push(...rewards.items);\n            if (rewards.healthRestore) {\n                player.heal(rewards.healthRestore);\n            }\n        }\n\n        this.currentGameState.stats.goldCollected += rewards.gold;\n        this.currentGameState.stats.itemsFound += rewards.items.length;\n        this.currentGameState.stats.enemiesDefeated += currentRoom.enemies?.length ?? 0;\n\n        // Store rewards for display\n        this.lastRoomRewards = {\n            gold: rewards.gold,\n            experience: rewards.experience,\n            items: [...rewards.items],\n            healthRestore: rewards.healthRestore\n        };\n\n        if (currentRoom.type === RoomType.BOSS) {\n            this.currentGameState.phase = GamePhase.VICTORY;\n        } else {\n            this.currentGameState.phase = GamePhase.EXPLORATION;\n        }\n        this.currentGameState.combat = null;\n\n        return this.currentGameState;\n    }\n\n    /**\n     * Gets and clears the last room rewards (for display purposes).\n     * @returns The rewards from the last completed room, or null if none\n     */\n    getAndClearLastRewards(): { gold: number; experience: number; items: Item[]; healthRestore?: number } | null {\n        const rewards = this.lastRoomRewards;\n        this.lastRoomRewards = null;\n        return rewards;\n    }\n\n    /**\n     * Returns all actions available to the player in the current game phase.\n     * \n     * Actions vary by phase:\n     * - **EXPLORATION**: move, interact, open_inventory, view_character\n     * - **COMBAT**: basic_attack, ability, use_item, flee\n     * - **SHOP**: sell, leave_shop\n     * - **REST**: rest, leave\n     * - **EVENT**: event-specific choices\n     * - **GAME_OVER**: restart, quit\n     * - **VICTORY**: view_stats, restart\n     * \n     * @returns Array of valid Action objects for the current state\n     * @throws Error if no player exists\n     * \n     * @example\n     * ```typescript\n     * const actions = manager.getAvailableActions();\n     * actions.forEach((action, i) => {\n     *   console.log(`${i + 1}. ${action.type} ${action.name || ''}`);\n     * });\n     * ```\n     */\n    getAvailableActions(): Action[] {\n        let actions: Action[] = [];\n        const { player } = this.currentGameState;\n        const currentRoom = this.getCurrentRoom();\n        if (!player) {\n            throw new Error('No player');\n        }\n\n        switch (this.currentGameState.phase) {\n\n            case GamePhase.EXPLORATION:\n                if (!currentRoom) {\n                    throw new Error('No current room');\n                }\n                for (const connectedId of currentRoom.connections) {\n                    const connectedRoom = this.currentGameState.dungeon.rooms.get(connectedId);\n                    if (connectedRoom && connectedRoom.canEnter()) {\n                        actions.push({ type: 'move', roomId: connectedId, roomType: connectedRoom.type });\n                    }\n                }\n                currentRoom.interactables.forEach((interactable, index) => {\n                    if (!interactable.used || interactable.type === 'npc') {\n                        actions.push({ \n                            type: 'interact', \n                            interactableIndex: index,\n                            interactableName: interactable.name \n                        });\n                    }\n                });\n                actions.push({ type: 'open_inventory' });\n                actions.push({ type: 'view_character' });\n                break;\n            case GamePhase.COMBAT:\n                // Attack\n                actions.push({ type: 'basic_attack' })\n\n                // Abilities (if not on cooldown and have mana)\n                for (const ability of player.getAllAbilities()) {\n                    if (ability.currentCooldown === 0 && player.stats.mana >= ability.manaCost) {\n                        actions.push({ type: 'ability', abilityId: ability.id, name: ability.name })\n                    }\n                }\n\n                // Usable items\n                for (const item of player.getInventoryByType(ItemType.CONSUMABLE)) {\n                    actions.push({ type: 'use_item', itemId: item.id, name: item.name })\n                }\n\n                // Flee (not from boss)\n                if (currentRoom && currentRoom.type !== RoomType.BOSS) {\n                    actions.push({ type: 'flee' })\n                }\n                break;\n            case GamePhase.SHOP:\n                // Add buy actions for each shop item\n                if (currentRoom?.shopInventory) {\n                    for (const shopItem of currentRoom.shopInventory) {\n                        actions.push({ \n                            type: 'buy_item', \n                            itemId: shopItem.item.id, \n                            itemName: shopItem.item.name,\n                            price: shopItem.buyPrice\n                        });\n                    }\n                }\n                // Add sell actions for each item in player inventory\n                if (player) {\n                    for (const item of player.inventory) {\n                        const sellPrice = getSellPrice(item);\n                        actions.push({ \n                            type: 'sell_item', \n                            itemId: item.id, \n                            itemName: item.name,\n                            price: sellPrice\n                        });\n                    }\n                }\n                actions.push({ type: 'leave_shop' });\n                break;\n            case GamePhase.REST:\n                actions.push({ type: 'rest' })  // Full heal\n                actions.push({ type: 'leave' })\n                break;\n            case GamePhase.EVENT:\n                // Event rooms have a single \"accept fate\" action\n                // The outcome is already determined when entering the room\n                actions.push({ type: 'accept_event', name: 'Accept Your Fate' });\n                break;\n            case GamePhase.GAME_OVER:\n                actions.push({ type: 'restart' })\n                actions.push({ type: 'quit' })\n                break;\n            case GamePhase.VICTORY:\n                actions.push({ type: 'view_stats' })\n                actions.push({ type: 'restart' })\n                break;\n            case GamePhase.INVENTORY:\n                // Close inventory button\n                actions.push({ type: 'close_inventory' });\n                \n                // Add equip actions for each equippable item in inventory\n                if (player) {\n                    for (const item of player.inventory) {\n                        if (item.type === ItemType.WEAPON || item.type === ItemType.ARMOR || item.type === ItemType.ACCESSORY) {\n                            actions.push({ \n                                type: 'equip_item', \n                                itemId: item.id, \n                                itemName: item.name \n                            });\n                        }\n                        // Add use action for consumables\n                        if (item.type === ItemType.CONSUMABLE) {\n                            actions.push({ \n                                type: 'use_item', \n                                itemId: item.id, \n                                itemName: item.name \n                            });\n                        }\n                    }\n                    // Add unequip actions for equipped items\n                    if (player.equipment.weapon) {\n                        actions.push({ \n                            type: 'unequip_item', \n                            itemId: player.equipment.weapon.id, \n                            itemName: player.equipment.weapon.name,\n                            slot: 'weapon'\n                        });\n                    }\n                    if (player.equipment.armor) {\n                        actions.push({ \n                            type: 'unequip_item', \n                            itemId: player.equipment.armor.id, \n                            itemName: player.equipment.armor.name,\n                            slot: 'armor'\n                        });\n                    }\n                    if (player.equipment.accessory) {\n                        actions.push({ \n                            type: 'unequip_item', \n                            itemId: player.equipment.accessory.id, \n                            itemName: player.equipment.accessory.name,\n                            slot: 'accessory'\n                        });\n                    }\n                }\n                break;\n            case GamePhase.CHARACTER:\n                actions.push({ type: 'close_character' });\n                break;\n            \n            case GamePhase.PUZZLE:\n                // Add answer options for the puzzle\n                if (currentRoom?.puzzle && !currentRoom.puzzle.solved) {\n                    currentRoom.puzzle.options.forEach((option, index) => {\n                        actions.push({ \n                            type: 'puzzle_answer', \n                            answerIndex: index,\n                            answerText: option\n                        });\n                    });\n                    // Allow skipping the puzzle (forfeit rewards)\n                    actions.push({ type: 'skip_puzzle', name: 'Skip Puzzle' });\n                }\n                break;\n            \n            case GamePhase.TREASURE:\n                // Treasure rooms allow interacting with chests\n                if (currentRoom?.interactables) {\n                    currentRoom.interactables.forEach((obj, index) => {\n                        if (!obj.used) {\n                            actions.push({ \n                                type: 'interact', \n                                interactableIndex: index,\n                                interactableName: obj.name\n                            });\n                        }\n                    });\n                }\n                // Can leave once done\n                actions.push({ type: 'leave', name: 'Leave Room' });\n                break;\n        }\n\n        return actions\n    }\n\n    /**\n     * Executes a player action and returns the result.\n     * \n     * Handles all action types including movement, interaction, combat,\n     * item usage, and menu actions. Updates game state accordingly.\n     * \n     * @param action - The Action to execute\n     * @returns ActionResult describing what happened\n     * @throws Error if no player, invalid action type, or action prerequisites not met\n     * \n     * @example\n     * ```typescript\n     * const moveAction = { type: 'move', roomId: 'room-123' };\n     * const result = manager.executeAction(moveAction);\n     * \n     * if (result.success) {\n     *   console.log(result.message); // 'Moved to new room'\n     * }\n     * ```\n     */\n    async executeAction(action: Action): Promise<ActionResult> {\n        const { player, stats } = this.currentGameState;\n        if (!player) {\n            throw new Error('No player');\n        }\n        \n        switch (action.type) {\n            case 'move':\n                await this.moveToRoom(action.roomId as string);\n                return { type: 'moved', success: true, message: 'Moved to new room' };\n\n            case 'basic_attack':\n                return this.processCombatAction({ type: 'attack' });\n\n            case 'ability':\n                return this.processCombatAction({ type: 'ability', abilityId: action.abilityId });\n\n            case 'use_item':\n                return this.inventoryManager.useItem(player, action.itemId as string);\n\n            case 'equip_item':\n                return this.inventoryManager.equipItem(player, action.itemId as string);\n\n            case 'unequip_item':\n                return this.inventoryManager.unequipItem(player, action.slot);\n\n            case 'flee':\n                return this.attemptFlee();\n\n            case 'rest':\n                player.rest();\n                this.currentGameState.phase = GamePhase.EXPLORATION;\n                return { type: 'rested', success: true, message: 'You feel refreshed!' };\n\n            case 'accept_event':\n                return this.executeEvent();\n\n            case 'buy_item':\n                return this.shopManager.buyItem(\n                    player, \n                    this.getCurrentRoom(), \n                    action.itemId as string, \n                    this.currentGameState.stats\n                );\n\n            case 'sell_item':\n                return this.shopManager.sellItem(\n                    player, \n                    action.itemId as string, \n                    this.currentGameState.stats\n                );\n\n            case 'puzzle_answer': {\n                const currentRoom = this.getCurrentRoom();\n                const puzzleOutcome = this.puzzleManager.attemptAnswer(\n                    player,\n                    currentRoom,\n                    action.answerIndex,\n                    this.currentGameState.stats\n                );\n                if (puzzleOutcome.roomComplete && currentRoom) {\n                    currentRoom.complete();\n                }\n                if (puzzleOutcome.newPhase) {\n                    this.currentGameState.phase = puzzleOutcome.newPhase;\n                }\n                return puzzleOutcome.result;\n            }\n\n            case 'skip_puzzle': {\n                const currentRoom = this.getCurrentRoom();\n                const puzzleOutcome = this.puzzleManager.skipPuzzle(currentRoom);\n                if (puzzleOutcome.roomComplete && currentRoom) {\n                    currentRoom.complete();\n                }\n                if (puzzleOutcome.newPhase) {\n                    this.currentGameState.phase = puzzleOutcome.newPhase;\n                }\n                return puzzleOutcome.result;\n            }\n\n            case 'interact': {\n                const interactionOutcome = this.interactionManager.interact(\n                    player,\n                    this.getCurrentRoom(),\n                    action.interactableIndex,\n                    this.currentGameState.stats\n                );\n                if (interactionOutcome.playerDied) {\n                    this.handlePlayerDeath();\n                }\n                return interactionOutcome.result;\n            }\n\n            case 'leave_shop':\n            case 'leave':\n                this.currentGameState.phase = GamePhase.EXPLORATION;\n                return { type: 'left', success: true, message: 'You left the area' };\n\n            case 'restart':\n                return { type: 'restart_requested', success: true, message: 'Restart requested' };\n\n            case 'open_inventory':\n                // Store the current phase so we can return to it\n                this.previousPhase = this.currentGameState.phase;\n                this.currentGameState.phase = GamePhase.INVENTORY;\n                return { type: 'inventory_opened', success: true };\n\n            case 'close_inventory':\n                // Return to the phase we were in before opening inventory\n                this.currentGameState.phase = this.previousPhase ?? GamePhase.EXPLORATION;\n                this.previousPhase = null;\n                return { type: 'inventory_closed', success: true };\n\n            case 'view_character':\n                this.previousPhase = this.currentGameState.phase;\n                this.currentGameState.phase = GamePhase.CHARACTER;\n                return { type: 'character_viewed', success: true };\n\n            case 'close_character':\n                this.currentGameState.phase = this.previousPhase ?? GamePhase.EXPLORATION;\n                this.previousPhase = null;\n                return { type: 'character_closed', success: true };\n\n            case 'view_stats':\n                return { type: 'stats_viewed', success: true };\n\n            case 'quit':\n                return { type: 'quit_requested', success: true };\n\n            default:\n                throw new Error(`Unknown action type: ${action.type}`);\n        }\n    }\n\n    /**\n     * Checks if the player has died and transitions to game over if so.\n     * Called after any action that could damage the player.\n     * @private\n     */\n    private checkPlayerDeath(): void {\n        const { player } = this.currentGameState;\n        if (player && !player.isAlive()) {\n            this.currentGameState.phase = GamePhase.GAME_OVER;\n            this.currentGameState.combat = null;\n        }\n    }\n\n    /**\n     * Explicitly handles player death and transitions to game over state.\n     * Use this when player death is detected externally (e.g., in CombatEngine).\n     * \n     * @returns The updated GameState in GAME_OVER phase\n     */\n    handlePlayerDeath(): GameState {\n        this.currentGameState.phase = GamePhase.GAME_OVER;\n        this.currentGameState.combat = null;\n        return this.currentGameState;\n    }\n\n    /**\n     * Attempts to flee from the current combat encounter.\n     * \n     * - Cannot flee from boss rooms\n     * - 50% base chance to escape\n     * - Uses seeded RNG for reproducibility\n     * \n     * @returns ActionResult indicating success or failure\n     * @private\n     */\n    private attemptFlee(): ActionResult {\n        const currentRoom = this.getCurrentRoom();\n        if (!currentRoom) {\n            return { type: 'flee', success: false, message: 'Cannot flee - no current room' };\n        }\n\n        if (currentRoom.type === RoomType.BOSS) {\n            return { type: 'flee', success: false, message: 'Cannot flee from boss!' };\n        }\n\n        // 50% base chance to flee, using seeded RNG if available\n        const fleeChance = 50;\n        const roll = isRNGInitialized() \n            ? getRNG().nextInt(1, 100) \n            : Math.floor(Math.random() * 100) + 1;\n\n        if (roll <= fleeChance) {\n            this.currentGameState.phase = GamePhase.EXPLORATION;\n            this.currentGameState.combat = null;\n            return { type: 'flee', success: true, message: 'You escaped!' };\n        } else {\n            return { type: 'flee', success: false, message: 'Failed to escape!' };\n        }\n    }\n\n    /**\n     * Executes the mysterious event in the current EVENT room.\n     * Delegates to EventManager for processing.\n     * \n     * @returns ActionResult with the event outcome details\n     * @private\n     */\n    private executeEvent(): ActionResult {\n        const currentRoom = this.getCurrentRoom();\n        const player = this.currentGameState.player;\n        \n        if (!player) {\n            return { type: 'event', success: false, message: 'Cannot execute event' };\n        }\n        \n        const eventOutcome = this.eventManager.executeEvent(\n            player,\n            currentRoom,\n            this.currentGameState.stats\n        );\n        \n        if (eventOutcome.playerDied) {\n            this.currentGameState.phase = GamePhase.GAME_OVER;\n        } else {\n            this.currentGameState.phase = eventOutcome.newPhase;\n        }\n        \n        return eventOutcome.result;\n    }\n\n    /**\n     * Processes a combat action (attack or ability).\n     * \n     * @todo Integrate with CombatEngine for full combat processing.\n     * Currently returns a placeholder result.\n     * \n     * @param action - The combat action to process\n     * @returns ActionResult with combat outcome\n     * @private\n     */\n    private processCombatAction(action: { type: string; abilityId?: string }): ActionResult {\n        // TODO: Integrate with CombatEngine for full combat processing\n        // This is a placeholder that should be replaced with actual combat logic\n        \n        const { player } = this.currentGameState;\n        if (!player) {\n            throw new Error('No player');\n        }\n\n        const currentRoom = this.getCurrentRoom();\n        if (!currentRoom || !currentRoom.enemies || currentRoom.enemies.length === 0) {\n            return { type: 'combat_action', success: false, message: 'No enemies to fight' };\n        }\n\n        // For now, just return a placeholder result\n        // The actual implementation should use CombatEngine\n        return { \n            type: 'combat_action', \n            success: true, \n            message: `Performed ${action.type}${action.abilityId ? `: ${action.abilityId}` : ''}`\n        };\n    }\n}\n", "import { Player } from '../entities/player';\nimport { Enemy } from '../entities/enemy';\nimport { getRNG, isRNGInitialized } from './seed';\nimport { rollDice } from '../entities/item';\n\n// ============================================================================\n// STATUS EFFECT TYPES\n// ============================================================================\n\n/** Categories of status effects */\nexport enum StatusEffectCategory {\n    /** Damage over time effects (poison, burn, bleed) */\n    DOT = 'dot',\n    /** Positive stat modifications */\n    BUFF = 'buff',\n    /** Negative stat modifications */\n    DEBUFF = 'debuff',\n    /** Effects that prevent actions (stun, freeze, sleep) */\n    INCAPACITATION = 'incapacitation',\n    /** Healing over time effects */\n    HOT = 'hot'\n}\n\n/** Specific types of status effects */\nexport enum StatusEffectType {\n    // DOT effects\n    POISON = 'poison',\n    BURN = 'burn',\n    BLEED = 'bleed',\n    \n    // Incapacitation effects\n    STUN = 'stun',\n    FREEZE = 'freeze',\n    SLEEP = 'sleep',\n    \n    // Debuffs\n    SLOW = 'slow',\n    WEAKEN = 'weaken',\n    VULNERABLE = 'vulnerable',\n    \n    // Buffs\n    HASTE = 'haste',\n    STRENGTHEN = 'strengthen',\n    FORTIFY = 'fortify',\n    REGENERATION = 'regeneration'\n}\n\n/** Maps effect types to their categories */\nconst EFFECT_CATEGORIES: Record<StatusEffectType, StatusEffectCategory> = {\n    [StatusEffectType.POISON]: StatusEffectCategory.DOT,\n    [StatusEffectType.BURN]: StatusEffectCategory.DOT,\n    [StatusEffectType.BLEED]: StatusEffectCategory.DOT,\n    [StatusEffectType.STUN]: StatusEffectCategory.INCAPACITATION,\n    [StatusEffectType.FREEZE]: StatusEffectCategory.INCAPACITATION,\n    [StatusEffectType.SLEEP]: StatusEffectCategory.INCAPACITATION,\n    [StatusEffectType.SLOW]: StatusEffectCategory.DEBUFF,\n    [StatusEffectType.WEAKEN]: StatusEffectCategory.DEBUFF,\n    [StatusEffectType.VULNERABLE]: StatusEffectCategory.DEBUFF,\n    [StatusEffectType.HASTE]: StatusEffectCategory.BUFF,\n    [StatusEffectType.STRENGTHEN]: StatusEffectCategory.BUFF,\n    [StatusEffectType.FORTIFY]: StatusEffectCategory.BUFF,\n    [StatusEffectType.REGENERATION]: StatusEffectCategory.HOT\n};\n\n/** A status effect applied to a combatant */\nexport interface StatusEffect {\n    /** Unique identifier for this effect instance */\n    id: string;\n    /** The type of effect */\n    type: StatusEffectType;\n    /** Display name */\n    name: string;\n    /** Remaining duration in turns */\n    remainingTurns: number;\n    /** Damage/healing per turn (for DOT/HOT) */\n    valuePerTurn?: number;\n    /** Percentage modifier (for buffs/debuffs like +25% attack) */\n    percentModifier?: number;\n    /** The source of the effect (for tracking) */\n    source: string;\n    /** Source level (affects damage scaling) */\n    sourceLevel: number;\n}\n\n/** Result of processing status effects at turn start */\nexport interface StatusEffectTickResult {\n    /** Effects that were processed */\n    processedEffects: StatusEffect[];\n    /** Total DOT damage taken */\n    dotDamage: number;\n    /** Total HOT healing received */\n    hotHealing: number;\n    /** Effects that expired this turn */\n    expiredEffects: StatusEffect[];\n    /** Whether the combatant is incapacitated (can't act) */\n    isIncapacitated: boolean;\n    /** Log messages for what happened */\n    messages: string[];\n}\n\n// ============================================================================\n// COMBAT STATE TYPES\n// ============================================================================\n\n/** Represents any entity that can participate in combat */\nexport interface Combatant {\n    id: string;\n    name: string;\n    health: number;\n    maxHealth: number;\n    speed: number;\n    defense: number;\n    isPlayer: boolean;\n    /** Active status effects on this combatant */\n    statusEffects: StatusEffect[];\n}\n\n/** Result of an attack roll */\nexport interface AttackRollResult {\n    /** The raw d20 roll (1-20) */\n    roll: number;\n    /** Total attack value (roll + bonuses) */\n    total: number;\n    /** Target's defense value */\n    targetDefense: number;\n    /** Whether the attack hit */\n    isHit: boolean;\n    /** Whether this was a natural 20 */\n    isNatural20: boolean;\n    /** Whether this was a natural 1 */\n    isNatural1: boolean;\n}\n\n/** Result of a damage calculation */\nexport interface DamageResult {\n    /** Base damage before reduction */\n    baseDamage: number;\n    /** Damage reduction from defense */\n    damageReduction: number;\n    /** Final damage after reduction (minimum 1) */\n    finalDamage: number;\n    /** Whether this was a critical hit */\n    isCritical: boolean;\n    /** The crit multiplier applied (if crit) */\n    critMultiplier?: number;\n}\n\n/** Complete result of an attack action */\nexport interface AttackResult {\n    /** The attacker */\n    attacker: Combatant;\n    /** The defender */\n    defender: Combatant;\n    /** Attack roll details */\n    attackRoll: AttackRollResult;\n    /** Damage details (null if missed) */\n    damage: DamageResult | null;\n    /** Whether the defender died from this attack */\n    defenderDied: boolean;\n}\n\n/** Represents a single combatant's turn in the order */\nexport interface TurnOrderEntry {\n    combatant: Combatant;\n    initiative: number;\n}\n\n/** Current state of combat */\nexport enum CombatStatus {\n    /** Combat is ongoing */\n    IN_PROGRESS = 'in_progress',\n    /** Player won (all enemies defeated) */\n    VICTORY = 'victory',\n    /** Player lost (player HP = 0) */\n    DEFEAT = 'defeat',\n    /** Player fled successfully */\n    FLED = 'fled'\n}\n\n/** Complete combat state */\nexport interface CombatState {\n    /** Current round number (starts at 1) */\n    round: number;\n    /** Current turn index in the turn order */\n    currentTurnIndex: number;\n    /** Ordered list of combatants by initiative */\n    turnOrder: TurnOrderEntry[];\n    /** Current combat status */\n    status: CombatStatus;\n    /** Combat log of actions taken */\n    log: string[];\n}\n\n/** Result of applying a status effect */\nexport interface ApplyEffectResult {\n    /** Whether the effect was applied (false if immune or blocked) */\n    applied: boolean;\n    /** Whether this refreshed an existing effect */\n    refreshed: boolean;\n    /** Whether this upgraded an existing effect's damage */\n    upgraded: boolean;\n    /** Message describing what happened */\n    message: string;\n}\n\n/** Result of using an ability */\nexport interface AbilityResult {\n    /** Name of the ability used */\n    abilityName: string;\n    /** Whether the ability was successfully used */\n    success: boolean;\n    /** Total damage dealt (if applicable) */\n    damage?: number;\n    /** Total healing done (if applicable) */\n    healing?: number;\n    /** Whether the ability hit all enemies (AOE) */\n    isAoe?: boolean;\n    /** Status effect applied (if applicable) */\n    effectApplied?: string;\n    /** IDs of enemies that died from this ability */\n    enemiesKilled: string[];\n    /** Message describing what happened */\n    message: string;\n}\n\n// ============================================================================\n// COMBAT ENGINE\n// ============================================================================\n\n/**\n * Core combat engine implementing turn-based D&D-inspired combat.\n * \n * Attack Formula: 1d20 + floor(Attack/5) + floor(Level/4) >= Defense\n * Damage Formula: Weapon Dice + floor(Attack/2) - floor(Defense/2)\n * \n * Features:\n * - Speed-based turn order (player wins ties)\n * - Natural 20 auto-hit + auto-crit\n * - Natural 1 auto-miss\n * - Critical hit system (nat 20 or crit chance roll)\n * - Minimum 1 damage on hit\n */\nexport class CombatEngine {\n    private player: Player;\n    private enemies: Enemy[];\n    private state: CombatState;\n\n    constructor(player: Player, enemies: Enemy[]) {\n        this.player = player;\n        this.enemies = [...enemies]; // Clone to avoid mutation\n        this.state = this.initializeCombat();\n    }\n\n    // =========================================================================\n    // INITIALIZATION\n    // =========================================================================\n\n    /**\n     * Initialize combat state and determine turn order.\n     */\n    private initializeCombat(): CombatState {\n        const turnOrder = this.calculateTurnOrder();\n        \n        return {\n            round: 1,\n            currentTurnIndex: 0,\n            turnOrder,\n            status: CombatStatus.IN_PROGRESS,\n            log: [`Combat begins! Round 1`]\n        };\n    }\n\n    /**\n     * Calculate turn order based on speed stats.\n     * Player wins ties. Otherwise sorted by speed descending.\n     */\n    private calculateTurnOrder(): TurnOrderEntry[] {\n        const entries: TurnOrderEntry[] = [];\n\n        // Add player\n        entries.push({\n            combatant: this.playerToCombatant(),\n            initiative: this.player.getSpeed()\n        });\n\n        // Add enemies\n        for (const enemy of this.enemies) {\n            entries.push({\n                combatant: this.enemyToCombatant(enemy),\n                initiative: enemy.speed\n            });\n        }\n\n        // Sort by initiative (descending), player wins ties\n        entries.sort((a, b) => {\n            if (b.initiative !== a.initiative) {\n                return b.initiative - a.initiative;\n            }\n            // Tie: player goes first\n            if (a.combatant.isPlayer) return -1;\n            if (b.combatant.isPlayer) return 1;\n            return 0;\n        });\n\n        return entries;\n    }\n\n    /**\n     * Convert Player to Combatant interface.\n     */\n    private playerToCombatant(): Combatant {\n        // Find existing combatant to preserve status effects\n        const existing = this.state?.turnOrder.find(e => e.combatant.isPlayer);\n        return {\n            id: this.player.id,\n            name: this.player.name,\n            health: this.player.stats.health,\n            maxHealth: this.player.getMaxHealth(),\n            speed: this.player.getSpeed(),\n            defense: this.player.getDefense(),\n            isPlayer: true,\n            statusEffects: existing?.combatant.statusEffects ?? []\n        };\n    }\n\n    /**\n     * Convert Enemy to Combatant interface.\n     */\n    private enemyToCombatant(enemy: Enemy): Combatant {\n        // Find existing combatant to preserve status effects\n        const existing = this.state?.turnOrder.find(e => e.combatant.id === enemy.id);\n        return {\n            id: enemy.id,\n            name: enemy.name,\n            health: enemy.health,\n            maxHealth: enemy.maxHealth,\n            speed: enemy.speed,\n            defense: enemy.defense,\n            isPlayer: false,\n            statusEffects: existing?.combatant.statusEffects ?? []\n        };\n    }\n\n    // =========================================================================\n    // DICE ROLLING\n    // =========================================================================\n\n    /**\n     * Roll a d20 using seeded RNG if available.\n     */\n    private rollD20(): number {\n        if (isRNGInitialized()) {\n            return getRNG().nextInt(1, 20);\n        }\n        return Math.floor(Math.random() * 20) + 1;\n    }\n\n    /**\n     * Roll a d100 for percentage checks.\n     */\n    private rollD100(): number {\n        if (isRNGInitialized()) {\n            return getRNG().nextInt(1, 100);\n        }\n        return Math.floor(Math.random() * 100) + 1;\n    }\n\n    // =========================================================================\n    // ATTACK ROLL CALCULATION\n    // =========================================================================\n\n    /**\n     * Calculate attack bonus for the player.\n     * Formula: floor(AttackPower / 5) + floor(Level / 4)\n     */\n    private getPlayerAttackBonus(): number {\n        const attackPower = this.player.getAttackPower();\n        const level = this.player.level;\n        return Math.floor(attackPower / 5) + Math.floor(level / 4);\n    }\n\n    /**\n     * Calculate attack bonus for an enemy.\n     * Formula: floor(AttackPower / 5) + floor(CR / 4)\n     */\n    private getEnemyAttackBonus(enemy: Enemy): number {\n        return Math.floor(enemy.attackPower / 5) + Math.floor(enemy.challengeRating / 4);\n    }\n\n    /**\n     * Perform an attack roll against a target.\n     * \n     * @param attackBonus - The attacker's total attack bonus\n     * @param targetDefense - The defender's defense value\n     * @returns AttackRollResult with hit/miss determination\n     */\n    rollAttack(attackBonus: number, targetDefense: number): AttackRollResult {\n        const roll = this.rollD20();\n        const total = roll + attackBonus;\n        const isNatural20 = roll === 20;\n        const isNatural1 = roll === 1;\n\n        // Natural 20 always hits, natural 1 always misses\n        let isHit: boolean;\n        if (isNatural20) {\n            isHit = true;\n        } else if (isNatural1) {\n            isHit = false;\n        } else {\n            isHit = total >= targetDefense;\n        }\n\n        return {\n            roll,\n            total,\n            targetDefense,\n            isHit,\n            isNatural20,\n            isNatural1\n        };\n    }\n\n    // =========================================================================\n    // DAMAGE CALCULATION\n    // =========================================================================\n\n    /**\n     * Calculate damage for a successful hit.\n     * \n     * @param attackPower - Attacker's attack power\n     * @param weaponDice - Weapon damage dice (e.g., \"1d8\") or null for unarmed\n     * @param targetDefense - Defender's defense for damage reduction\n     * @param critChance - Attacker's crit chance (0-100)\n     * @param critMultiplier - Attacker's crit damage multiplier\n     * @param isNatural20 - Whether the attack roll was a natural 20 (auto-crit)\n     * @returns DamageResult with final damage calculation\n     */\n    calculateDamage(\n        attackPower: number,\n        weaponDice: string | null,\n        targetDefense: number,\n        critChance: number,\n        critMultiplier: number,\n        isNatural20: boolean\n    ): DamageResult {\n        // Roll weapon damage or use base 1d4 for unarmed\n        const weaponDamage = weaponDice ? rollDice(weaponDice) : rollDice('1d4');\n        \n        // Base damage = weapon dice + floor(attack / 2)\n        const attackBonus = Math.floor(attackPower / 2);\n        let baseDamage = weaponDamage + attackBonus;\n\n        // Check for critical hit\n        let isCritical = isNatural20; // Natural 20 is auto-crit\n        \n        if (!isCritical) {\n            // Roll for crit chance\n            const critRoll = this.rollD100();\n            isCritical = critRoll <= critChance;\n        }\n\n        // Apply crit multiplier\n        if (isCritical) {\n            baseDamage = Math.floor(baseDamage * critMultiplier);\n        }\n\n        // Calculate damage reduction from defense\n        const damageReduction = Math.floor(targetDefense / 2);\n        \n        // Final damage (minimum 1)\n        const finalDamage = Math.max(1, baseDamage - damageReduction);\n\n        return {\n            baseDamage,\n            damageReduction,\n            finalDamage,\n            isCritical,\n            critMultiplier: isCritical ? critMultiplier : undefined\n        };\n    }\n\n    // =========================================================================\n    // STATUS EFFECT MANAGEMENT\n    // =========================================================================\n\n    /**\n     * Apply a status effect to a combatant.\n     * Same effect type refreshes duration and upgrades to higher damage.\n     * Different effect types stack.\n     * \n     * @param targetId - ID of the target combatant\n     * @param effectType - Type of effect to apply\n     * @param duration - Duration in turns\n     * @param source - Source of the effect (for tracking)\n     * @param sourceLevel - Level of the source (affects damage)\n     * @param valueOverride - Optional override for damage/healing value\n     */\n    applyStatusEffect(\n        targetId: string,\n        effectType: StatusEffectType,\n        duration: number,\n        source: string,\n        sourceLevel: number,\n        valueOverride?: number\n    ): ApplyEffectResult {\n        const entry = this.state.turnOrder.find(e => e.combatant.id === targetId);\n        if (!entry) {\n            return { applied: false, refreshed: false, upgraded: false, message: 'Target not found' };\n        }\n\n        const combatant = entry.combatant;\n        const category = EFFECT_CATEGORIES[effectType];\n        const effectName = this.getEffectDisplayName(effectType);\n        const value = valueOverride ?? this.calculateEffectValue(effectType, sourceLevel, combatant.maxHealth);\n\n        // Check for existing effect of same type\n        const existingIndex = combatant.statusEffects.findIndex(e => e.type === effectType);\n\n        if (existingIndex !== -1) {\n            const existing = combatant.statusEffects[existingIndex];\n            \n            // Refresh duration\n            existing.remainingTurns = Math.max(existing.remainingTurns, duration);\n            \n            // Upgrade damage if new value is higher\n            let upgraded = false;\n            if (existing.valuePerTurn !== undefined && value > existing.valuePerTurn) {\n                existing.valuePerTurn = value;\n                upgraded = true;\n            }\n\n            const message = upgraded\n                ? `${combatant.name}'s ${effectName} is upgraded and refreshed!`\n                : `${combatant.name}'s ${effectName} duration refreshed.`;\n\n            this.state.log.push(message);\n            return { applied: true, refreshed: true, upgraded, message };\n        }\n\n        // Apply new effect\n        const newEffect: StatusEffect = {\n            id: crypto.randomUUID(),\n            type: effectType,\n            name: effectName,\n            remainingTurns: duration,\n            source,\n            sourceLevel\n        };\n\n        // Set value for DOT/HOT effects\n        if (category === StatusEffectCategory.DOT || category === StatusEffectCategory.HOT) {\n            newEffect.valuePerTurn = value;\n        }\n\n        // Set modifier for buff/debuff effects\n        if (category === StatusEffectCategory.BUFF || category === StatusEffectCategory.DEBUFF) {\n            newEffect.percentModifier = this.getEffectModifier(effectType);\n        }\n\n        combatant.statusEffects.push(newEffect);\n\n        const message = `${combatant.name} is afflicted with ${effectName}!`;\n        this.state.log.push(message);\n\n        return { applied: true, refreshed: false, upgraded: false, message };\n    }\n\n    /**\n     * Remove a specific status effect from a combatant.\n     */\n    removeStatusEffect(targetId: string, effectId: string): boolean {\n        const entry = this.state.turnOrder.find(e => e.combatant.id === targetId);\n        if (!entry) return false;\n\n        const index = entry.combatant.statusEffects.findIndex(e => e.id === effectId);\n        if (index === -1) return false;\n\n        const removed = entry.combatant.statusEffects.splice(index, 1)[0];\n        this.state.log.push(`${entry.combatant.name}'s ${removed.name} has worn off.`);\n        return true;\n    }\n\n    /**\n     * Remove all effects of a specific type from a combatant.\n     */\n    removeEffectsByType(targetId: string, effectType: StatusEffectType): number {\n        const entry = this.state.turnOrder.find(e => e.combatant.id === targetId);\n        if (!entry) return 0;\n\n        const before = entry.combatant.statusEffects.length;\n        entry.combatant.statusEffects = entry.combatant.statusEffects.filter(e => e.type !== effectType);\n        return before - entry.combatant.statusEffects.length;\n    }\n\n    /**\n     * Get all status effects on a combatant.\n     */\n    getStatusEffects(targetId: string): StatusEffect[] {\n        const entry = this.state.turnOrder.find(e => e.combatant.id === targetId);\n        return entry?.combatant.statusEffects ?? [];\n    }\n\n    /**\n     * Check if a combatant has a specific effect type.\n     */\n    hasStatusEffect(targetId: string, effectType: StatusEffectType): boolean {\n        return this.getStatusEffects(targetId).some(e => e.type === effectType);\n    }\n\n    /**\n     * Check if a combatant is incapacitated (stunned, frozen, asleep).\n     */\n    isIncapacitated(targetId: string): boolean {\n        const effects = this.getStatusEffects(targetId);\n        return effects.some(e => EFFECT_CATEGORIES[e.type] === StatusEffectCategory.INCAPACITATION);\n    }\n\n    /**\n     * Process status effects at the beginning of a combatant's turn.\n     * - Decrements all timers\n     * - Applies DOT damage\n     * - Applies HOT healing\n     * - Removes expired effects\n     * - Checks for incapacitation\n     */\n    processStatusEffects(combatantId: string): StatusEffectTickResult {\n        const entry = this.state.turnOrder.find(e => e.combatant.id === combatantId);\n        if (!entry) {\n            return {\n                processedEffects: [],\n                dotDamage: 0,\n                hotHealing: 0,\n                expiredEffects: [],\n                isIncapacitated: false,\n                messages: []\n            };\n        }\n\n        const combatant = entry.combatant;\n        const messages: string[] = [];\n        const expiredEffects: StatusEffect[] = [];\n        let dotDamage = 0;\n        let hotHealing = 0;\n        let isIncapacitated = false;\n\n        // Process each effect\n        for (const effect of combatant.statusEffects) {\n            const category = EFFECT_CATEGORIES[effect.type];\n\n            // Apply DOT damage\n            if (category === StatusEffectCategory.DOT && effect.valuePerTurn) {\n                dotDamage += effect.valuePerTurn;\n                messages.push(`${combatant.name} takes ${effect.valuePerTurn} ${effect.name} damage.`);\n            }\n\n            // Apply HOT healing\n            if (category === StatusEffectCategory.HOT && effect.valuePerTurn) {\n                hotHealing += effect.valuePerTurn;\n                messages.push(`${combatant.name} regenerates ${effect.valuePerTurn} health.`);\n            }\n\n            // Check incapacitation\n            if (category === StatusEffectCategory.INCAPACITATION) {\n                isIncapacitated = true;\n                messages.push(`${combatant.name} is ${effect.name.toLowerCase()} and cannot act!`);\n            }\n\n            // Decrement timer\n            effect.remainingTurns--;\n\n            // Mark expired effects\n            if (effect.remainingTurns <= 0) {\n                expiredEffects.push(effect);\n            }\n        }\n\n        // Remove expired effects\n        for (const expired of expiredEffects) {\n            const index = combatant.statusEffects.findIndex(e => e.id === expired.id);\n            if (index !== -1) {\n                combatant.statusEffects.splice(index, 1);\n                messages.push(`${combatant.name}'s ${expired.name} has worn off.`);\n            }\n        }\n\n        // Apply DOT damage\n        if (dotDamage > 0) {\n            this.applyDirectDamage(combatantId, dotDamage);\n        }\n\n        // Apply HOT healing\n        if (hotHealing > 0) {\n            this.applyDirectHealing(combatantId, hotHealing);\n        }\n\n        // Add messages to combat log\n        for (const msg of messages) {\n            this.state.log.push(msg);\n        }\n\n        // Check for death from DOT\n        this.checkCombatEnd();\n\n        return {\n            processedEffects: [...combatant.statusEffects],\n            dotDamage,\n            hotHealing,\n            expiredEffects,\n            isIncapacitated,\n            messages\n        };\n    }\n\n    /**\n     * Apply direct damage to a combatant (bypasses defense, used for DOT).\n     */\n    private applyDirectDamage(targetId: string, damage: number): void {\n        const entry = this.state.turnOrder.find(e => e.combatant.id === targetId);\n        if (!entry) return;\n\n        if (entry.combatant.isPlayer) {\n            this.player.stats.health = Math.max(0, this.player.stats.health - damage);\n            entry.combatant.health = this.player.stats.health;\n        } else {\n            const enemy = this.enemies.find(e => e.id === targetId);\n            if (enemy) {\n                enemy.health = Math.max(0, enemy.health - damage);\n                entry.combatant.health = enemy.health;\n\n                // Check for enemy death\n                if (enemy.health <= 0) {\n                    this.state.log.push(`${entry.combatant.name} succumbs to their wounds!`);\n                    this.removeDeadEnemy(targetId);\n                }\n            }\n        }\n    }\n\n    /**\n     * Apply direct healing to a combatant (used for HOT).\n     */\n    private applyDirectHealing(targetId: string, healing: number): void {\n        const entry = this.state.turnOrder.find(e => e.combatant.id === targetId);\n        if (!entry) return;\n\n        if (entry.combatant.isPlayer) {\n            this.player.heal(healing);\n            entry.combatant.health = this.player.stats.health;\n        } else {\n            const enemy = this.enemies.find(e => e.id === targetId);\n            if (enemy) {\n                enemy.health = Math.min(enemy.maxHealth, enemy.health + healing);\n                entry.combatant.health = enemy.health;\n            }\n        }\n    }\n\n    /**\n     * Calculate the damage/healing value for an effect based on type and level.\n     */\n    private calculateEffectValue(effectType: StatusEffectType, sourceLevel: number, targetMaxHealth: number): number {\n        switch (effectType) {\n            case StatusEffectType.POISON:\n                // 5% of max HP per turn\n                return Math.max(1, Math.floor(targetMaxHealth * 0.05));\n            case StatusEffectType.BURN:\n                // 3 + (2 * level) per turn\n                return 3 + (2 * sourceLevel);\n            case StatusEffectType.BLEED:\n                // Flat 5 damage per turn\n                return 5;\n            case StatusEffectType.REGENERATION:\n                // 5 HP per turn (can scale with level)\n                return 5 + Math.floor(sourceLevel / 2);\n            default:\n                return 0;\n        }\n    }\n\n    /**\n     * Get the percentage modifier for buff/debuff effects.\n     */\n    private getEffectModifier(effectType: StatusEffectType): number {\n        switch (effectType) {\n            case StatusEffectType.SLOW:\n                return -50; // -50% speed\n            case StatusEffectType.WEAKEN:\n                return -25; // -25% attack\n            case StatusEffectType.VULNERABLE:\n                return 25;  // +25% damage taken\n            case StatusEffectType.HASTE:\n                return 50;  // +50% speed\n            case StatusEffectType.STRENGTHEN:\n                return 25;  // +25% attack\n            case StatusEffectType.FORTIFY:\n                return 25;  // +25% defense\n            default:\n                return 0;\n        }\n    }\n\n    /**\n     * Get display name for an effect type.\n     */\n    private getEffectDisplayName(effectType: StatusEffectType): string {\n        const names: Record<StatusEffectType, string> = {\n            [StatusEffectType.POISON]: 'Poison',\n            [StatusEffectType.BURN]: 'Burn',\n            [StatusEffectType.BLEED]: 'Bleed',\n            [StatusEffectType.STUN]: 'Stunned',\n            [StatusEffectType.FREEZE]: 'Frozen',\n            [StatusEffectType.SLEEP]: 'Asleep',\n            [StatusEffectType.SLOW]: 'Slowed',\n            [StatusEffectType.WEAKEN]: 'Weakened',\n            [StatusEffectType.VULNERABLE]: 'Vulnerable',\n            [StatusEffectType.HASTE]: 'Haste',\n            [StatusEffectType.STRENGTHEN]: 'Strengthened',\n            [StatusEffectType.FORTIFY]: 'Fortified',\n            [StatusEffectType.REGENERATION]: 'Regeneration'\n        };\n        return names[effectType];\n    }\n\n    /**\n     * Get effective stat value considering buff/debuff effects.\n     */\n    getEffectiveSpeed(combatantId: string): number {\n        const entry = this.state.turnOrder.find(e => e.combatant.id === combatantId);\n        if (!entry) return 0;\n\n        let speed = entry.combatant.speed;\n        \n        for (const effect of entry.combatant.statusEffects) {\n            if (effect.type === StatusEffectType.SLOW && effect.percentModifier) {\n                speed = Math.floor(speed * (1 + effect.percentModifier / 100));\n            }\n            if (effect.type === StatusEffectType.HASTE && effect.percentModifier) {\n                speed = Math.floor(speed * (1 + effect.percentModifier / 100));\n            }\n        }\n\n        return Math.max(1, speed);\n    }\n\n    /**\n     * Get effective attack value considering buff/debuff effects.\n     */\n    getEffectiveAttackModifier(combatantId: string): number {\n        const effects = this.getStatusEffects(combatantId);\n        let modifier = 0;\n\n        for (const effect of effects) {\n            if (effect.type === StatusEffectType.WEAKEN && effect.percentModifier) {\n                modifier += effect.percentModifier; // Negative value\n            }\n            if (effect.type === StatusEffectType.STRENGTHEN && effect.percentModifier) {\n                modifier += effect.percentModifier; // Positive value\n            }\n        }\n\n        return modifier;\n    }\n\n    /**\n     * Get damage multiplier from vulnerability effect.\n     */\n    getDamageReceivedModifier(combatantId: string): number {\n        const effects = this.getStatusEffects(combatantId);\n        let modifier = 1.0;\n\n        for (const effect of effects) {\n            if (effect.type === StatusEffectType.VULNERABLE && effect.percentModifier) {\n                modifier += effect.percentModifier / 100;\n            }\n            if (effect.type === StatusEffectType.FORTIFY && effect.percentModifier) {\n                modifier -= effect.percentModifier / 100;\n            }\n        }\n\n        return Math.max(0.25, modifier); // Minimum 25% damage\n    }\n\n    /**\n     * Handle sleep effect breaking when damaged.\n     */\n    private breakSleepOnDamage(targetId: string): void {\n        const effects = this.getStatusEffects(targetId);\n        const sleepEffect = effects.find(e => e.type === StatusEffectType.SLEEP);\n        \n        if (sleepEffect) {\n            this.removeStatusEffect(targetId, sleepEffect.id);\n            const entry = this.state.turnOrder.find(e => e.combatant.id === targetId);\n            if (entry) {\n                this.state.log.push(`${entry.combatant.name} wakes up from the damage!`);\n            }\n        }\n    }\n\n    // =========================================================================\n    // COMBAT ACTIONS\n    // =========================================================================\n\n    /**\n     * Execute a player attack against a target enemy.\n     * \n     * @param targetId - ID of the enemy to attack\n     * @returns AttackResult with full attack details\n     */\n    playerAttack(targetId: string): AttackResult {\n        const target = this.enemies.find(e => e.id === targetId);\n        if (!target) {\n            throw new Error(`Enemy with ID ${targetId} not found`);\n        }\n\n        const attacker = this.playerToCombatant();\n        const defender = this.enemyToCombatant(target);\n\n        // Roll attack\n        const attackBonus = this.getPlayerAttackBonus();\n        const attackRoll = this.rollAttack(attackBonus, target.defense);\n\n        let damage: DamageResult | null = null;\n        let defenderDied = false;\n\n        if (attackRoll.isHit) {\n            // Get weapon dice\n            const weaponDice = this.player.equipment.weapon?.damage?.dice ?? null;\n            \n            // Calculate damage\n            damage = this.calculateDamage(\n                this.player.getAttackPower(),\n                weaponDice,\n                target.defense,\n                this.player.getCritChance(),\n                this.player.getCritMultiplier(),\n                attackRoll.isNatural20\n            );\n\n            // Apply vulnerability modifier\n            const damageModifier = this.getDamageReceivedModifier(target.id);\n            damage.finalDamage = Math.max(1, Math.floor(damage.finalDamage * damageModifier));\n\n            // Break sleep on damage\n            this.breakSleepOnDamage(target.id);\n\n            // Apply damage to enemy\n            target.health = Math.max(0, target.health - damage.finalDamage);\n            defenderDied = target.health <= 0;\n\n            // Update combatant in turn order\n            this.updateCombatantHealth(target.id, target.health);\n\n            // Log the attack\n            if (damage.isCritical) {\n                this.state.log.push(\n                    `${attacker.name} CRITICALLY hits ${defender.name} for ${damage.finalDamage} damage!`\n                );\n            } else {\n                this.state.log.push(\n                    `${attacker.name} hits ${defender.name} for ${damage.finalDamage} damage.`\n                );\n            }\n\n            if (defenderDied) {\n                this.state.log.push(`${defender.name} is defeated!`);\n                this.removeDeadEnemy(target.id);\n            }\n        } else {\n            // Log miss\n            if (attackRoll.isNatural1) {\n                this.state.log.push(`${attacker.name} critically misses ${defender.name}!`);\n            } else {\n                this.state.log.push(`${attacker.name} misses ${defender.name}.`);\n            }\n        }\n\n        // Check for victory\n        this.checkCombatEnd();\n\n        return {\n            attacker,\n            defender,\n            attackRoll,\n            damage,\n            defenderDied\n        };\n    }\n\n    /**\n     * Execute a player ability against a target or all enemies.\n     * Handles damage abilities, healing abilities, buff abilities, and AOE abilities.\n     * \n     * @param abilityId - ID of the ability to use\n     * @param targetId - ID of the target enemy (optional for self-targeting or AOE abilities)\n     * @returns AbilityResult with full ability details\n     */\n    playerUseAbility(abilityId: string, targetId?: string): AbilityResult {\n        const ability = this.player.abilities.find(a => a.id === abilityId);\n        if (!ability) {\n            return {\n                abilityName: 'Unknown',\n                success: false,\n                enemiesKilled: [],\n                message: 'Ability not found'\n            };\n        }\n\n        // Check if ability can be used (mana, cooldown)\n        if (ability.currentCooldown > 0) {\n            return {\n                abilityName: ability.name,\n                success: false,\n                enemiesKilled: [],\n                message: `${ability.name} is on cooldown (${ability.currentCooldown} turns remaining)`\n            };\n        }\n\n        if (this.player.stats.mana < ability.manaCost) {\n            return {\n                abilityName: ability.name,\n                success: false,\n                enemiesKilled: [],\n                message: `Not enough mana for ${ability.name} (need ${ability.manaCost}, have ${this.player.stats.mana})`\n            };\n        }\n\n        // Consume mana and set cooldown\n        this.player.useMana(ability.manaCost);\n        ability.currentCooldown = ability.cooldown;\n\n        const enemiesKilled: string[] = [];\n        let totalDamage = 0;\n        let totalHealing = 0;\n        let message = '';\n\n        // Handle healing abilities (self-targeting)\n        if (ability.healing) {\n            const healAmount = Math.floor(this.player.getMaxHealth() * ability.healing);\n            totalHealing = this.player.heal(healAmount);\n            message = `${this.player.name} uses ${ability.name} and heals for ${totalHealing} HP!`;\n            this.state.log.push(message);\n\n            return {\n                abilityName: ability.name,\n                success: true,\n                healing: totalHealing,\n                enemiesKilled: [],\n                message\n            };\n        }\n\n        // Handle buff abilities (self-targeting)\n        if (ability.effect === 'attack_buff') {\n            const attackBonus = Math.floor(this.player.stats.attack * 0.25);\n            this.player.applyBuff(ability.name, { attack: attackBonus }, 3);\n            message = `${this.player.name} uses ${ability.name}, increasing attack by ${attackBonus} for 3 turns!`;\n            this.state.log.push(message);\n\n            return {\n                abilityName: ability.name,\n                success: true,\n                effectApplied: 'attack_buff',\n                enemiesKilled: [],\n                message\n            };\n        }\n\n        // Handle AOE damage abilities\n        if (ability.effect === 'aoe') {\n            const baseDamage = this.player.basicAttack().damage;\n            const abilityDamage = Math.floor(baseDamage * (ability.damage ?? 1));\n            \n            const aliveEnemies = this.enemies.filter(e => e.health > 0);\n            for (const enemy of aliveEnemies) {\n                const damageModifier = this.getDamageReceivedModifier(enemy.id);\n                const finalDamage = Math.max(1, Math.floor(abilityDamage * damageModifier));\n                \n                enemy.health = Math.max(0, enemy.health - finalDamage);\n                totalDamage += finalDamage;\n                \n                this.state.log.push(`${ability.name} hits ${enemy.name} for ${finalDamage} damage!`);\n                \n                if (enemy.health <= 0) {\n                    enemiesKilled.push(enemy.id);\n                    this.state.log.push(`${enemy.name} is defeated!`);\n                }\n            }\n            \n            // Remove dead enemies\n            for (const id of enemiesKilled) {\n                this.removeDeadEnemy(id);\n            }\n            \n            message = `${this.player.name} uses ${ability.name}, dealing ${totalDamage} total damage to all enemies!`;\n            this.checkCombatEnd();\n\n            return {\n                abilityName: ability.name,\n                success: true,\n                damage: totalDamage,\n                isAoe: true,\n                enemiesKilled,\n                message\n            };\n        }\n\n        // Handle single-target damage abilities\n        if (ability.damage && targetId) {\n            const target = this.enemies.find(e => e.id === targetId);\n            if (!target) {\n                return {\n                    abilityName: ability.name,\n                    success: false,\n                    enemiesKilled: [],\n                    message: 'Target not found'\n                };\n            }\n\n            const baseDamage = this.player.basicAttack().damage;\n            const abilityDamage = Math.floor(baseDamage * ability.damage);\n            const damageModifier = this.getDamageReceivedModifier(target.id);\n            totalDamage = Math.max(1, Math.floor(abilityDamage * damageModifier));\n\n            // Apply stun effect if ability has it\n            if (ability.effect === 'stun') {\n                this.applyStatusEffect(\n                    target.id,\n                    StatusEffectType.STUN,\n                    1, // duration in turns\n                    ability.name,\n                    this.player.level\n                );\n                this.state.log.push(`${target.name} is stunned!`);\n            }\n\n            target.health = Math.max(0, target.health - totalDamage);\n            this.state.log.push(`${ability.name} hits ${target.name} for ${totalDamage} damage!`);\n\n            if (target.health <= 0) {\n                enemiesKilled.push(target.id);\n                this.state.log.push(`${target.name} is defeated!`);\n                this.removeDeadEnemy(target.id);\n            }\n\n            message = `${this.player.name} uses ${ability.name} on ${target.name} for ${totalDamage} damage!`;\n            this.checkCombatEnd();\n\n            return {\n                abilityName: ability.name,\n                success: true,\n                damage: totalDamage,\n                effectApplied: ability.effect,\n                enemiesKilled,\n                message\n            };\n        }\n\n        // Fallback for abilities without clear implementation\n        message = `${this.player.name} uses ${ability.name}!`;\n        this.state.log.push(message);\n\n        return {\n            abilityName: ability.name,\n            success: true,\n            enemiesKilled: [],\n            message\n        };\n    }\n\n    /**\n     * Execute an enemy attack against the player.\n     * \n     * @param enemyId - ID of the attacking enemy\n     * @returns AttackResult with full attack details\n     */\n    enemyAttack(enemyId: string): AttackResult {\n        const enemy = this.enemies.find(e => e.id === enemyId);\n        if (!enemy) {\n            throw new Error(`Enemy with ID ${enemyId} not found`);\n        }\n\n        const attacker = this.enemyToCombatant(enemy);\n        const defender = this.playerToCombatant();\n\n        // Roll attack\n        const attackBonus = this.getEnemyAttackBonus(enemy);\n        const attackRoll = this.rollAttack(attackBonus, this.player.getDefense());\n\n        let damage: DamageResult | null = null;\n        let defenderDied = false;\n\n        if (attackRoll.isHit) {\n            // Enemies use attackPower as their damage base (no weapon dice)\n            // Simulate with a dice roll based on CR\n            const enemyDice = this.getEnemyDamageDice(enemy);\n            \n            // Calculate damage (enemies have ~10% crit chance, 1.5x multiplier)\n            damage = this.calculateDamage(\n                enemy.attackPower,\n                enemyDice,\n                this.player.getDefense(),\n                10, // Enemy crit chance\n                1.5, // Enemy crit multiplier\n                attackRoll.isNatural20\n            );\n\n            // Apply vulnerability/fortify modifier\n            const damageModifier = this.getDamageReceivedModifier(this.player.id);\n            damage.finalDamage = Math.max(1, Math.floor(damage.finalDamage * damageModifier));\n\n            // Break sleep on damage\n            this.breakSleepOnDamage(this.player.id);\n\n            // Apply damage to player\n            this.player.takeDamage(damage.finalDamage);\n            defenderDied = !this.player.isAlive();\n\n            // Update combatant in turn order\n            this.updateCombatantHealth(this.player.id, this.player.stats.health);\n\n            // Log the attack\n            if (damage.isCritical) {\n                this.state.log.push(\n                    `${attacker.name} CRITICALLY hits ${defender.name} for ${damage.finalDamage} damage!`\n                );\n            } else {\n                this.state.log.push(\n                    `${attacker.name} hits ${defender.name} for ${damage.finalDamage} damage.`\n                );\n            }\n\n            if (defenderDied) {\n                this.state.log.push(`${defender.name} has fallen!`);\n            }\n        } else {\n            // Log miss\n            if (attackRoll.isNatural1) {\n                this.state.log.push(`${attacker.name} critically misses ${defender.name}!`);\n            } else {\n                this.state.log.push(`${attacker.name} misses ${defender.name}.`);\n            }\n        }\n\n        // Check for defeat\n        this.checkCombatEnd();\n\n        return {\n            attacker,\n            defender,\n            attackRoll,\n            damage,\n            defenderDied\n        };\n    }\n\n    /**\n     * Get damage dice for an enemy based on CR.\n     */\n    private getEnemyDamageDice(enemy: Enemy): string {\n        const cr = enemy.challengeRating;\n        if (cr <= 0.5) return '1d4';\n        if (cr <= 1) return '1d6';\n        if (cr <= 2) return '1d8';\n        if (cr <= 4) return '1d10';\n        if (cr <= 8) return '2d6';\n        if (cr <= 12) return '2d8';\n        if (cr <= 16) return '2d10';\n        return '2d12';\n    }\n\n    // =========================================================================\n    // TURN MANAGEMENT\n    // =========================================================================\n\n    /**\n     * Get the current combatant whose turn it is.\n     */\n    getCurrentTurn(): TurnOrderEntry | null {\n        if (this.state.status !== CombatStatus.IN_PROGRESS) {\n            return null;\n        }\n        return this.state.turnOrder[this.state.currentTurnIndex] ?? null;\n    }\n\n    /**\n     * Start the current combatant's turn.\n     * Processes status effects and returns whether they can act.\n     * \n     * @returns StatusEffectTickResult with turn start information\n     */\n    startTurn(): StatusEffectTickResult {\n        const current = this.getCurrentTurn();\n        if (!current) {\n            return {\n                processedEffects: [],\n                dotDamage: 0,\n                hotHealing: 0,\n                expiredEffects: [],\n                isIncapacitated: false,\n                messages: ['No current turn']\n            };\n        }\n\n        // Process status effects at turn start\n        return this.processStatusEffects(current.combatant.id);\n    }\n\n    /**\n     * Advance to the next turn.\n     * Handles round advancement when all combatants have acted.\n     */\n    nextTurn(): TurnOrderEntry | null {\n        if (this.state.status !== CombatStatus.IN_PROGRESS) {\n            return null;\n        }\n\n        this.state.currentTurnIndex++;\n\n        // Check if round is complete\n        if (this.state.currentTurnIndex >= this.state.turnOrder.length) {\n            this.state.currentTurnIndex = 0;\n            this.state.round++;\n            this.state.log.push(`Round ${this.state.round}`);\n        }\n\n        return this.getCurrentTurn();\n    }\n\n    /**\n     * Update a combatant's health in the turn order.\n     */\n    private updateCombatantHealth(id: string, newHealth: number): void {\n        const entry = this.state.turnOrder.find(e => e.combatant.id === id);\n        if (entry) {\n            entry.combatant.health = newHealth;\n        }\n    }\n\n    /**\n     * Remove a dead enemy from combat.\n     */\n    private removeDeadEnemy(enemyId: string): void {\n        // Remove from enemies array\n        const enemyIndex = this.enemies.findIndex(e => e.id === enemyId);\n        if (enemyIndex !== -1) {\n            this.enemies.splice(enemyIndex, 1);\n        }\n\n        // Remove from turn order\n        const turnIndex = this.state.turnOrder.findIndex(e => e.combatant.id === enemyId);\n        if (turnIndex !== -1) {\n            this.state.turnOrder.splice(turnIndex, 1);\n            \n            // Adjust current turn index if needed\n            if (turnIndex < this.state.currentTurnIndex) {\n                this.state.currentTurnIndex--;\n            } else if (turnIndex === this.state.currentTurnIndex) {\n                // Current combatant died, don't increment on next turn\n                this.state.currentTurnIndex--;\n            }\n        }\n    }\n\n    // =========================================================================\n    // COMBAT STATE\n    // =========================================================================\n\n    /**\n     * Check if combat has ended (victory or defeat).\n     */\n    private checkCombatEnd(): void {\n        if (!this.player.isAlive()) {\n            this.state.status = CombatStatus.DEFEAT;\n            this.state.log.push('DEFEAT - You have been slain!');\n        } else if (this.enemies.length === 0) {\n            this.state.status = CombatStatus.VICTORY;\n            this.state.log.push('VICTORY - All enemies defeated!');\n        }\n    }\n\n    /**\n     * Get the current combat state.\n     */\n    getState(): CombatState {\n        return { ...this.state };\n    }\n\n    /**\n     * Get the current combat status.\n     */\n    getStatus(): CombatStatus {\n        return this.state.status;\n    }\n\n    /**\n     * Get the combat log.\n     */\n    getLog(): string[] {\n        return [...this.state.log];\n    }\n\n    /**\n     * Get remaining enemies.\n     */\n    getEnemies(): Enemy[] {\n        return [...this.enemies];\n    }\n\n    /**\n     * Get the player reference.\n     */\n    getPlayer(): Player {\n        return this.player;\n    }\n\n    /**\n     * Check if it's the player's turn.\n     */\n    isPlayerTurn(): boolean {\n        const current = this.getCurrentTurn();\n        return current?.combatant.isPlayer ?? false;\n    }\n\n    /**\n     * Get all valid target IDs for the player.\n     */\n    getValidTargets(): string[] {\n        return this.enemies.map(e => e.id);\n    }\n}\n", "/**\n * @fileoverview Main Game Loop Controller for Dungeon Roguelike\n * \n * This module contains the GameLoop class which orchestrates the entire game flow:\n * - Game initialization with player creation\n * - Main game loop (render -> input -> execute -> repeat)\n * - Combat turn management\n * - Game over and victory handling\n * \n * The GameLoop acts as the bridge between the GameStateManager (logic) and\n * the UI/rendering layer (to be implemented).\n * \n * @module game/gameLoop\n */\n\nimport { GameStateManager, GameState, GamePhase, Action, ActionResult } from './gameState';\nimport { CombatEngine, CombatStatus, AttackResult, AbilityResult } from './combatEngine';\nimport { generateRandomString } from './seed';\nimport { Player } from '../entities/player';\n\n/**\n * Main controller for the dungeon roguelike game flow.\n * \n * This class orchestrates the game by:\n * 1. Initializing a new game with player selection\n * 2. Running the main game loop (render -> input -> execute -> repeat)\n * 3. Managing combat turns when in combat phase\n * 4. Handling game over and victory conditions\n * \n * @example\n * ```typescript\n * const loop = new GameLoop();\n * const player = new Fighter('Hero');\n * await loop.startGame(player);\n * ```\n */\n/** Action types that do NOT consume a combat turn (menus, overlays) */\nconst NON_TURN_CONSUMING_ACTIONS = new Set([\n    'open_inventory',\n    'close_inventory',\n    'view_character',\n    'close_character',\n    'equip_item',\n    'unequip_item',\n]);\n\nexport class GameLoop {\n    /** The game state manager handling all game logic */\n    protected gameManager: GameStateManager;\n    \n    /** Active combat engine instance, null when not in combat */\n    protected combatEngine: CombatEngine | null = null;\n    \n    /** Whether the game loop is currently running */\n    protected isRunning: boolean = false;\n    \n    /** Previous phase before entering overlay (inventory/character) */\n    protected previousPhase: GamePhase | null = null;\n\n    /**\n     * Creates a new GameLoop instance with a fresh GameStateManager.\n     */\n    constructor() {\n        this.gameManager = new GameStateManager();\n    }\n\n    // =========================================================================\n    // GAME INITIALIZATION\n    // =========================================================================\n\n    /**\n     * Starts a new game with the provided player.\n     * \n     * This method:\n     * - Generates a random seed for the dungeon\n     * - Initializes the game state with the player\n     * - Enters the main game loop\n     * \n     * @param player - The player instance to use for the game\n     * @param seed - Optional seed for dungeon generation (random if not provided)\n     * @returns Promise that resolves when the game ends\n     */\n    async startGame(player: Player, seed: string = generateRandomString(10)): Promise<void> {\n        this.gameManager.startNewGame(player.playerClass, player.name, seed);\n        this.isRunning = true;\n        await this.mainLoop();\n    }\n\n    // =========================================================================\n    // MAIN GAME LOOP\n    // =========================================================================\n\n    /**\n     * Main game loop - runs until game over or victory.\n     * \n     * Loop structure:\n     * 1. Check for terminal states (GAME_OVER, VICTORY)\n     * 2. Render current game state\n     * 3. Get available actions for current phase\n     * 4. Display actions to player\n     * 5. Wait for player input\n     * 6. Execute chosen action\n     * 7. Display action result\n     * 8. If combat phase, run combat loop\n     * 9. Repeat\n     * \n     * @private\n     */\n    private async mainLoop(): Promise<void> {\n        while (this.isRunning) {\n            const state = this.gameManager.getState();\n            \n            // Check for terminal states\n            if (state.phase === GamePhase.GAME_OVER) {\n                this.handleGameOver();\n                break;\n            }\n            if (state.phase === GamePhase.VICTORY) {\n                this.handleVictory();\n                break;\n            }\n            \n            // Render and get player action\n            this.render(state);\n            const actions = this.gameManager.getAvailableActions();\n            this.displayActions(actions);\n            const chosenAction = await this.getPlayerInput(actions);\n            const result = await this.gameManager.executeAction(chosenAction);\n            this.displayResult(result);\n            \n            // Re-fetch state after action execution to check for phase changes\n            const updatedState = this.gameManager.getState();\n            \n            // Handle phase-specific logic\n            await this.handlePhaseTransition(updatedState.phase);\n        }\n    }\n\n    /**\n     * Handles phase-specific logic when transitioning to or continuing in a phase.\n     * \n     * @param phase - The current game phase\n     * @private\n     */\n    private async handlePhaseTransition(phase: GamePhase): Promise<void> {\n        switch (phase) {\n            case GamePhase.COMBAT:\n                this.initializeCombat();\n                await this.runCombatLoop();\n                this.handleCombatEnd();\n                break;\n            case GamePhase.EXPLORATION:\n                this.handleExploration();\n                break;\n            case GamePhase.SHOP:\n                this.handleShop();\n                break;\n            case GamePhase.EVENT:\n                this.handleEvent();\n                break;\n            case GamePhase.REST:\n                this.handleRest();\n                break;\n            case GamePhase.INVENTORY:\n                this.handleInventory();\n                break;\n            case GamePhase.CHARACTER:\n                this.handleCharacter();\n                break;\n            // GAME_OVER and VICTORY are handled at the start of mainLoop\n        }\n    }\n\n    /**\n     * Handles the end of combat by updating game state based on combat result.\n     * @private\n     */\n    private handleCombatEnd(): void {\n        if (!this.combatEngine) return;\n        \n        const status = this.combatEngine.getStatus();\n        \n        if (status === CombatStatus.VICTORY) {\n            // Player won - complete the room and get rewards\n            this.gameManager.completeRoom();\n            \n            // Display rewards\n            const rewards = this.gameManager.getAndClearLastRewards();\n            if (rewards) {\n                this.displayRoomRewards(rewards);\n            }\n        } else if (status === CombatStatus.DEFEAT) {\n            // Player died - trigger game over\n            this.gameManager.handlePlayerDeath();\n        }\n        // FLED status: player escaped, stays in exploration without room completion\n        \n        // Clean up combat engine\n        this.combatEngine = null;\n    }\n\n    /**\n     * Displays room completion rewards to the player.\n     * Override in UI implementations to show rewards appropriately.\n     * \n     * @param rewards - The rewards received from completing the room\n     */\n    protected displayRoomRewards(rewards: { gold: number; experience: number; items: import('../entities/item').Item[]; healthRestore?: number }): void {\n        // Default implementation - override in UI classes\n        console.log('Room Rewards:', rewards);\n    }\n\n    // =========================================================================\n    // COMBAT LOOP\n    // =========================================================================\n\n    /**\n     * Initializes combat when entering a combat room.\n     * \n     * This method:\n     * - Gets the player from game state\n     * - Gets enemies from the current room\n     * - Creates a new CombatEngine instance\n     * - Stores reference for the combat loop\n     * \n     * @private\n     * @throws Error if player or room not found\n     */\n    private initializeCombat(): void {\n        const state = this.gameManager.getState();\n        const player = state.player;\n        \n        if (!player) {\n            throw new Error('Cannot initialize combat: Player not found');\n        }\n        \n        const currentRoomId = state.dungeon.currentRoomId;\n        if (!currentRoomId) {\n            throw new Error('Cannot initialize combat: No current room');\n        }\n        \n        const room = state.dungeon.rooms.get(currentRoomId);\n        if (!room) {\n            throw new Error(`Cannot initialize combat: Room ${currentRoomId} not found`);\n        }\n        \n        const enemies = room.enemies ?? [];\n        if (enemies.length === 0) {\n            throw new Error('Cannot initialize combat: No enemies in room');\n        }\n        \n        this.combatEngine = new CombatEngine(player, enemies);\n    }\n\n    /**\n     * Runs the combat loop until resolved (victory, defeat, or fled).\n     * \n     * Combat turn structure:\n     * 1. Get current turn from combatEngine\n     * 2. Process start-of-turn effects (DOT, status expiration)\n     * 3. Check if combatant is incapacitated (skip turn if so)\n     * 4. If player turn: get combat action input, execute\n     * 5. If enemy turn: run enemy AI, execute attack\n     * 6. Advance to next turn\n     * 7. Check for combat end (victory/defeat)\n     * 8. Repeat until combat resolved\n     * \n     * @private\n     */\n    private async runCombatLoop(): Promise<void> {\n        if (!this.combatEngine) return;\n        \n        while (this.combatEngine.getStatus() === CombatStatus.IN_PROGRESS) {\n            // Process start-of-turn effects\n            const turnResult = this.combatEngine.startTurn();\n            this.displayStatusEffectMessages(turnResult.messages);\n            \n            // Check if combatant died from DOT damage\n            if (this.combatEngine.getStatus() !== CombatStatus.IN_PROGRESS) {\n                break;\n            }\n            \n            // Skip turn if incapacitated (stunned, frozen, etc.)\n            if (turnResult.isIncapacitated) {\n                this.combatEngine.nextTurn();\n                continue;\n            }\n            \n            // Get current turn and process action\n            const currentTurn = this.combatEngine.getCurrentTurn();\n            if (!currentTurn) break;\n            \n            if (currentTurn.combatant.isPlayer) {\n                const shouldContinue = await this.handlePlayerCombatTurn();\n                if (!shouldContinue) {\n                    // Player fled successfully\n                    break;\n                }\n            } else {\n                this.handleEnemyCombatTurn(currentTurn.combatant.id);\n            }\n            \n            // Check combat status after action\n            if (this.combatEngine.getStatus() !== CombatStatus.IN_PROGRESS) {\n                break;\n            }\n            \n            // Re-render combat state after each action\n            this.displayCombatState();\n            \n            // Advance to next turn\n            this.combatEngine.nextTurn();\n        }\n    }\n\n    /**\n     * Handles the player's combat turn.\n     * \n     * This method:\n     * - Displays combat state (enemy HP, player HP/mana)\n     * - Gets available combat actions\n     * - Waits for player input\n     * - Executes the chosen action (attack/ability/item/flee)\n     * - Non-turn-consuming actions (inventory, character) loop back for another action\n     * \n     * @private\n     * @returns true to continue combat, false if player fled\n     */\n    private async handlePlayerCombatTurn(): Promise<boolean> {\n        if (!this.combatEngine) return false;\n        \n        // Loop until a turn-consuming action is taken\n        while (true) {\n            // Display current combat state\n            this.displayCombatState();\n            \n            // Get available combat actions from game state manager\n            const actions = this.gameManager.getAvailableActions();\n            this.displayActions(actions);\n            \n            // Wait for player input\n            const chosenAction = await this.getPlayerInput(actions);\n            \n            // Check if this is a non-turn-consuming action\n            if (NON_TURN_CONSUMING_ACTIONS.has(chosenAction.type)) {\n                const result = await this.gameManager.executeAction(chosenAction);\n                this.displayResult(result);\n                // Loop back to get another action - don't consume turn\n                continue;\n            }\n            \n            // Execute turn-consuming action\n            const turnResult = await this.executeCombatAction(chosenAction);\n            return turnResult;\n        }\n    }\n\n    /**\n     * Executes a turn-consuming combat action.\n     * \n     * @param action - The action to execute\n     * @returns true to continue combat, false if player fled\n     * @private\n     */\n    private async executeCombatAction(action: Action): Promise<boolean> {\n        if (!this.combatEngine) return false;\n        \n        switch (action.type) {\n            case 'basic_attack': {\n                const validTargets = this.combatEngine.getValidTargets();\n                let targetId: string;\n                \n                if (validTargets.length === 1) {\n                    targetId = validTargets[0];\n                } else {\n                    targetId = await this.getTargetSelection(validTargets);\n                }\n                \n                const attackResult = this.combatEngine.playerAttack(targetId);\n                this.displayAttackResult(attackResult);\n                return true;\n            }\n            \n            case 'ability': {\n                const abilityId = action.abilityId as string;\n                const ability = this.gameManager.getState().player?.abilities.find(a => a.id === abilityId);\n                \n                const needsTarget = ability?.damage && ability?.effect !== 'aoe';\n                let targetId: string | undefined;\n                \n                if (needsTarget) {\n                    const validTargets = this.combatEngine.getValidTargets();\n                    if (validTargets.length === 1) {\n                        targetId = validTargets[0];\n                    } else if (validTargets.length > 1) {\n                        targetId = await this.getTargetSelection(validTargets);\n                    }\n                }\n                \n                const abilityResult = this.combatEngine.playerUseAbility(abilityId, targetId);\n                this.displayAbilityResult(abilityResult);\n                return true;\n            }\n            \n            case 'use_item': {\n                const result = await this.gameManager.executeAction(action);\n                this.displayResult(result);\n                return true;\n            }\n            \n            case 'flee': {\n                const result = await this.gameManager.executeAction(action);\n                this.displayResult(result);\n                if (result.success) {\n                    return false; // Player fled - exit combat\n                }\n                return true; // Failed to flee - turn consumed\n            }\n            \n            default: {\n                // Unknown turn-consuming action - let game manager handle it\n                const result = await this.gameManager.executeAction(action);\n                this.displayResult(result);\n                return true;\n            }\n        }\n    }\n\n    /**\n     * Handles an enemy's combat turn.\n     * \n     * This method:\n     * - Executes enemy attack against player\n     * - Displays the result\n     * \n     * @param enemyId - The ID of the enemy taking their turn\n     * @private\n     */\n    private handleEnemyCombatTurn(enemyId: string): void {\n        if (!this.combatEngine) return;\n        \n        const attackResult = this.combatEngine.enemyAttack(enemyId);\n        this.displayAttackResult(attackResult);\n    }\n\n    // =========================================================================\n    // INPUT HANDLING\n    // =========================================================================\n\n    /**\n     * Waits for and validates player input.\n     * \n     * This is an abstract method that must be implemented by a concrete\n     * UI layer (console, web, etc.). The base implementation throws an error.\n     * \n     * @param availableActions - Array of valid actions the player can take\n     * @returns Promise resolving to the selected Action\n     * @throws Error - Must be overridden by UI implementation\n     * @protected\n     */\n    protected async getPlayerInput(availableActions: Action[]): Promise<Action> {\n        // This method should be overridden by a UI-specific subclass\n        // For testing, you can also inject a mock input handler\n        throw new Error('getPlayerInput must be implemented by UI layer');\n    }\n\n    /**\n     * Gets target selection for attacks/abilities.\n     * \n     * This is an abstract method that must be implemented by a concrete\n     * UI layer (console, web, etc.). The base implementation throws an error.\n     * \n     * @param validTargets - Array of valid target IDs\n     * @returns Promise resolving to the selected target ID\n     * @throws Error - Must be overridden by UI implementation\n     * @protected\n     */\n    protected async getTargetSelection(validTargets: string[]): Promise<string> {\n        // This method should be overridden by a UI-specific subclass\n        throw new Error('getTargetSelection must be implemented by UI layer');\n    }\n\n    // =========================================================================\n    // RENDERING / OUTPUT\n    // =========================================================================\n\n    /**\n     * Renders the current game state to screen.\n     * \n     * Displays:\n     * - Current room info (type, description, enemies, interactables)\n     * - Player stats (HP, mana, gold, level)\n     * - Dungeon progress (current level, rooms cleared)\n     * \n     * Override this method in a UI-specific subclass to implement rendering.\n     * \n     * @param state - The current GameState to render\n     * @protected\n     */\n    protected render(state: GameState): void {\n        // Override in UI-specific subclass\n        // Base implementation does nothing\n    }\n\n    /**\n     * Displays available actions to the player.\n     * \n     * Override this method in a UI-specific subclass to implement action display.\n     * \n     * @param actions - Array of actions to display\n     * @protected\n     */\n    protected displayActions(actions: Action[]): void {\n        // Override in UI-specific subclass\n        // Base implementation does nothing\n    }\n\n    /**\n     * Displays the result of an action.\n     * \n     * Override this method in a UI-specific subclass to implement result display.\n     * \n     * @param result - The ActionResult to display\n     * @protected\n     */\n    protected displayResult(result: ActionResult): void {\n        // Override in UI-specific subclass\n        // Base implementation does nothing\n    }\n\n    /**\n     * Displays the current combat state.\n     * \n     * Shows:\n     * - All enemies with HP bars\n     * - Player HP/mana bars\n     * - Active status effects\n     * - Combat log (recent messages)\n     * \n     * Override this method in a UI-specific subclass to implement combat display.\n     * \n     * @protected\n     */\n    protected displayCombatState(): void {\n        // Override in UI-specific subclass\n        // Base implementation does nothing\n    }\n\n    /**\n     * Displays status effect messages from turn processing.\n     * \n     * @param messages - Array of status effect messages to display\n     * @protected\n     */\n    protected displayStatusEffectMessages(messages: string[]): void {\n        // Override in UI-specific subclass\n        // Base implementation does nothing\n    }\n\n    /**\n     * Displays the result of an attack action.\n     * \n     * @param result - The AttackResult from CombatEngine\n     * @protected\n     */\n    protected displayAttackResult(result: AttackResult): void {\n        // Override in UI-specific subclass\n        // Base implementation does nothing\n    }\n\n    /**\n     * Displays the result of an ability usage.\n     * \n     * @param result - The AbilityResult from CombatEngine\n     * @protected\n     */\n    protected displayAbilityResult(result: AbilityResult): void {\n        // Override in UI-specific subclass\n        // Base implementation does nothing\n    }\n\n    // =========================================================================\n    // GAME END HANDLING\n    // =========================================================================\n\n    /**\n     * Handles game over (player death).\n     * \n     * This method:\n     * - Stops the game loop\n     * - Displays game over message (via UI override)\n     * - Shows final stats\n     * \n     * Override this method in a UI-specific subclass to add visual feedback.\n     * \n     * @protected\n     */\n    protected handleGameOver(): void {\n        this.isRunning = false;\n        // Override in UI-specific subclass to display game over screen\n    }\n\n    /**\n     * Handles victory (boss defeated).\n     * \n     * This method:\n     * - Stops the game loop\n     * - Displays victory message (via UI override)\n     * - Shows final stats\n     * \n     * Override this method in a UI-specific subclass to add visual feedback.\n     * \n     * @protected\n     */\n    protected handleVictory(): void {\n        this.isRunning = false;\n        // Override in UI-specific subclass to display victory screen\n    }\n\n    // =========================================================================\n    // PHASE HANDLERS\n    // =========================================================================\n\n    /**\n     * Handles exploration phase logic.\n     * Called when entering or continuing exploration.\n     * \n     * Override this method in a UI-specific subclass for custom behavior.\n     * \n     * @protected\n     */\n    protected handleExploration(): void {\n        // Override in UI-specific subclass\n        // Base implementation does nothing - exploration is handled by main loop\n    }\n\n    /**\n     * Handles shop phase logic.\n     * Called when entering a shop room.\n     * \n     * Override this method in a UI-specific subclass for custom behavior.\n     * \n     * @protected\n     */\n    protected handleShop(): void {\n        // Override in UI-specific subclass\n        // Base implementation does nothing - shop actions handled by getAvailableActions\n    }\n\n    /**\n     * Handles event phase logic.\n     * Called when entering an event room.\n     * \n     * Override this method in a UI-specific subclass for custom behavior.\n     * \n     * @protected\n     */\n    protected handleEvent(): void {\n        // Override in UI-specific subclass\n        // Base implementation does nothing - event choices handled by getAvailableActions\n    }\n\n    /**\n     * Handles rest phase logic.\n     * Called when entering a rest room.\n     * \n     * Override this method in a UI-specific subclass for custom behavior.\n     * \n     * @protected\n     */\n    protected handleRest(): void {\n        // Override in UI-specific subclass\n        // Base implementation does nothing - rest actions handled by getAvailableActions\n    }\n\n    /**\n     * Handles inventory phase logic.\n     * Called when player opens inventory.\n     * \n     * Override this method in a UI-specific subclass for custom behavior.\n     * \n     * @protected\n     */\n    protected handleInventory(): void {\n        // Override in UI-specific subclass\n        // Base implementation does nothing - inventory actions handled by getAvailableActions\n    }\n\n    /**\n     * Handles character sheet phase logic.\n     * Called when player views character.\n     * \n     * Override this method in a UI-specific subclass for custom behavior.\n     * \n     * @protected\n     */\n    protected handleCharacter(): void {\n        // Override in UI-specific subclass\n        // Base implementation does nothing - character view handled by UI\n    }\n\n    /**\n     * Stores the current phase before transitioning to an overlay phase.\n     * Call this before opening inventory or character screens.\n     * \n     * @protected\n     */\n    protected savePreviousPhase(): void {\n        const state = this.gameManager.getState();\n        // Only save if not already in an overlay phase\n        if (state.phase !== GamePhase.INVENTORY && state.phase !== GamePhase.CHARACTER) {\n            this.previousPhase = state.phase;\n        }\n    }\n\n    /**\n     * Gets the phase to return to after closing an overlay.\n     * \n     * @returns The previous phase, or EXPLORATION as fallback\n     * @protected\n     */\n    protected getPreviousPhase(): GamePhase {\n        return this.previousPhase ?? GamePhase.EXPLORATION;\n    }\n\n    // =========================================================================\n    // UTILITY\n    // =========================================================================\n\n    /**\n     * Stops the game loop.\n     * The current iteration will complete before the loop exits.\n     */\n    stop(): void {\n        this.isRunning = false;\n    }\n\n    /**\n     * Checks if the game is currently running.\n     * \n     * @returns true if the game loop is active\n     */\n    isGameRunning(): boolean {\n        return this.isRunning;\n    }\n\n    /**\n     * Gets the current game state.\n     * Useful for UI implementations to read state.\n     * \n     * @returns The current GameState\n     */\n    getState(): GameState {\n        return this.gameManager.getState();\n    }\n\n    /**\n     * Gets the current combat engine if in combat.\n     * Useful for UI implementations to display combat details.\n     * \n     * @returns The CombatEngine or null if not in combat\n     */\n    getCombatEngine(): CombatEngine | null {\n        return this.combatEngine;\n    }\n}\n", "/**\n * @fileoverview Image Assets for Dungeon Roguelike\n * \n * Provides placeholder SVG images for players, monsters, and items.\n * Uses data URIs so no external files are needed.\n * \n * @module ui/imageAssets\n */\n\nimport { EnemyType } from '../entities/enemy';\nimport { ItemType, ItemRarity } from '../entities/item';\n\n/**\n * Color schemes for different entity types\n */\nconst COLORS = {\n    // Player class colors\n    warrior: { primary: '#c0392b', secondary: '#e74c3c', accent: '#f39c12' },\n    mage: { primary: '#8e44ad', secondary: '#9b59b6', accent: '#3498db' },\n    rogue: { primary: '#27ae60', secondary: '#2ecc71', accent: '#1abc9c' },\n    cleric: { primary: '#f1c40f', secondary: '#f39c12', accent: '#ecf0f1' },\n    warlock: { primary: '#2c3e50', secondary: '#34495e', accent: '#9b59b6' },\n    \n    // Monster type colors\n    aberration: { primary: '#6c3483', secondary: '#8e44ad', accent: '#e8daef' },\n    beast: { primary: '#784212', secondary: '#a04000', accent: '#f5b041' },\n    celestial: { primary: '#f4d03f', secondary: '#f7dc6f', accent: '#fcf3cf' },\n    construct: { primary: '#566573', secondary: '#7f8c8d', accent: '#bdc3c7' },\n    dragon: { primary: '#b03a2e', secondary: '#cb4335', accent: '#f9e79f' },\n    elemental: { primary: '#2e86ab', secondary: '#17a2b8', accent: '#a2d9ce' },\n    fey: { primary: '#76d7c4', secondary: '#48c9b0', accent: '#f5b7b1' },\n    fiend: { primary: '#922b21', secondary: '#c0392b', accent: '#f1948a' },\n    giant: { primary: '#5d6d7e', secondary: '#85929e', accent: '#d5dbdb' },\n    humanoid: { primary: '#d4ac0d', secondary: '#f1c40f', accent: '#fdebd0' },\n    monstrosity: { primary: '#1e8449', secondary: '#28b463', accent: '#abebc6' },\n    ooze: { primary: '#239b56', secondary: '#58d68d', accent: '#abebc6' },\n    plant: { primary: '#196f3d', secondary: '#27ae60', accent: '#82e0aa' },\n    undead: { primary: '#1c2833', secondary: '#2c3e50', accent: '#85929e' },\n    \n    // Item rarity colors\n    common: { primary: '#95a5a6', secondary: '#bdc3c7', accent: '#ecf0f1' },\n    uncommon: { primary: '#27ae60', secondary: '#2ecc71', accent: '#82e0aa' },\n    rare: { primary: '#2980b9', secondary: '#3498db', accent: '#85c1e9' },\n    veryRare: { primary: '#8e44ad', secondary: '#9b59b6', accent: '#d7bde2' },\n    legendary: { primary: '#d35400', secondary: '#e67e22', accent: '#f9e79f' },\n};\n\n/**\n * Generates an SVG placeholder for a player character.\n * \n * @param className - The player's class name\n * @param size - Image size in pixels (default 64)\n * @returns Data URI for the SVG image\n */\nexport function getPlayerImage(className: string, size: number = 64): string {\n    const normalizedClass = className.toLowerCase();\n    const colors = COLORS[normalizedClass as keyof typeof COLORS] || COLORS.warrior;\n    \n    // Different silhouettes based on class\n    let silhouette: string;\n    switch (normalizedClass) {\n        case 'mage':\n            // Robed figure with staff\n            silhouette = `\n                <circle cx=\"32\" cy=\"16\" r=\"8\" fill=\"${colors.secondary}\"/>\n                <path d=\"M24 24 L20 56 L28 56 L30 40 L34 40 L36 56 L44 56 L40 24 Z\" fill=\"${colors.primary}\"/>\n                <line x1=\"44\" y1=\"20\" x2=\"52\" y2=\"8\" stroke=\"${colors.accent}\" stroke-width=\"3\"/>\n                <circle cx=\"52\" cy=\"6\" r=\"4\" fill=\"${colors.accent}\"/>\n            `;\n            break;\n        case 'rogue':\n            // Hooded figure with daggers\n            silhouette = `\n                <path d=\"M26 8 L32 4 L38 8 L36 18 L28 18 Z\" fill=\"${colors.secondary}\"/>\n                <circle cx=\"32\" cy=\"14\" r=\"6\" fill=\"${colors.secondary}\"/>\n                <path d=\"M24 20 L20 54 L28 54 L30 36 L34 36 L36 54 L44 54 L40 20 Z\" fill=\"${colors.primary}\"/>\n                <path d=\"M16 30 L12 42 L18 40 Z\" fill=\"${colors.accent}\"/>\n                <path d=\"M48 30 L52 42 L46 40 Z\" fill=\"${colors.accent}\"/>\n            `;\n            break;\n        case 'cleric':\n            // Robed figure with holy symbol\n            silhouette = `\n                <circle cx=\"32\" cy=\"14\" r=\"8\" fill=\"${colors.secondary}\"/>\n                <path d=\"M22 22 L18 56 L28 56 L30 38 L34 38 L36 56 L46 56 L42 22 Z\" fill=\"${colors.primary}\"/>\n                <rect x=\"29\" y=\"26\" width=\"6\" height=\"14\" fill=\"${colors.accent}\"/>\n                <rect x=\"26\" y=\"30\" width=\"12\" height=\"4\" fill=\"${colors.accent}\"/>\n            `;\n            break;\n        case 'warlock':\n            // Dark robed figure with eldritch energy\n            silhouette = `\n                <circle cx=\"32\" cy=\"14\" r=\"8\" fill=\"${colors.secondary}\"/>\n                <path d=\"M22 22 L18 58 L46 58 L42 22 Z\" fill=\"${colors.primary}\"/>\n                <ellipse cx=\"32\" cy=\"38\" rx=\"6\" ry=\"8\" fill=\"${colors.accent}\" opacity=\"0.7\"/>\n                <circle cx=\"32\" cy=\"38\" r=\"3\" fill=\"${colors.accent}\"/>\n            `;\n            break;\n        default: // Warrior\n            // Armored figure with sword\n            silhouette = `\n                <circle cx=\"32\" cy=\"14\" r=\"8\" fill=\"${colors.secondary}\"/>\n                <rect x=\"24\" y=\"22\" width=\"16\" height=\"20\" fill=\"${colors.primary}\" rx=\"2\"/>\n                <rect x=\"22\" y=\"42\" width=\"8\" height=\"14\" fill=\"${colors.primary}\"/>\n                <rect x=\"34\" y=\"42\" width=\"8\" height=\"14\" fill=\"${colors.primary}\"/>\n                <rect x=\"46\" y=\"16\" width=\"4\" height=\"28\" fill=\"${colors.accent}\"/>\n                <rect x=\"44\" y=\"14\" width=\"8\" height=\"4\" fill=\"${colors.accent}\"/>\n            `;\n    }\n    \n    const svg = `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${size}\" height=\"${size}\" viewBox=\"0 0 64 64\">\n            <rect width=\"64\" height=\"64\" fill=\"#1a1a2e\" rx=\"8\"/>\n            ${silhouette}\n        </svg>\n    `.trim();\n    \n    return `data:image/svg+xml,${encodeURIComponent(svg)}`;\n}\n\n/**\n * Generates an SVG placeholder for a monster.\n * \n * @param monsterType - The monster's type (from EnemyType enum)\n * @param name - The monster's name (for display)\n * @param size - Image size in pixels (default 64)\n * @returns Data URI for the SVG image\n */\nexport function getMonsterImage(monsterType: EnemyType | string, name: string, size: number = 64): string {\n    const normalizedType = monsterType.toLowerCase();\n    const colorKey = normalizedType as keyof typeof COLORS;\n    const colors = COLORS[colorKey] || COLORS.humanoid;\n    \n    // Different shapes based on monster type\n    let shape: string;\n    switch (normalizedType) {\n        case 'aberration':\n            // Tentacled horror\n            shape = `\n                <ellipse cx=\"32\" cy=\"28\" rx=\"16\" ry=\"12\" fill=\"${colors.primary}\"/>\n                <circle cx=\"32\" cy=\"26\" r=\"6\" fill=\"${colors.accent}\"/>\n                <circle cx=\"32\" cy=\"26\" r=\"3\" fill=\"#1a1a2e\"/>\n                <path d=\"M18 36 Q12 48 8 52\" stroke=\"${colors.secondary}\" stroke-width=\"4\" fill=\"none\"/>\n                <path d=\"M26 38 Q22 50 18 56\" stroke=\"${colors.secondary}\" stroke-width=\"4\" fill=\"none\"/>\n                <path d=\"M38 38 Q42 50 46 56\" stroke=\"${colors.secondary}\" stroke-width=\"4\" fill=\"none\"/>\n                <path d=\"M46 36 Q52 48 56 52\" stroke=\"${colors.secondary}\" stroke-width=\"4\" fill=\"none\"/>\n            `;\n            break;\n        case 'beast':\n            // Four-legged creature\n            shape = `\n                <ellipse cx=\"32\" cy=\"28\" rx=\"18\" ry=\"10\" fill=\"${colors.primary}\"/>\n                <circle cx=\"46\" cy=\"22\" r=\"8\" fill=\"${colors.primary}\"/>\n                <circle cx=\"48\" cy=\"20\" r=\"2\" fill=\"${colors.accent}\"/>\n                <rect x=\"14\" y=\"34\" width=\"6\" height=\"16\" fill=\"${colors.secondary}\" rx=\"2\"/>\n                <rect x=\"24\" y=\"34\" width=\"6\" height=\"16\" fill=\"${colors.secondary}\" rx=\"2\"/>\n                <rect x=\"34\" y=\"34\" width=\"6\" height=\"16\" fill=\"${colors.secondary}\" rx=\"2\"/>\n                <rect x=\"44\" y=\"34\" width=\"6\" height=\"16\" fill=\"${colors.secondary}\" rx=\"2\"/>\n            `;\n            break;\n        case 'dragon':\n            // Dragon head with wings\n            shape = `\n                <path d=\"M8 20 L32 8 L56 20 L32 32 Z\" fill=\"${colors.secondary}\" opacity=\"0.7\"/>\n                <ellipse cx=\"32\" cy=\"36\" rx=\"14\" ry=\"10\" fill=\"${colors.primary}\"/>\n                <path d=\"M18 36 L8 44 L18 42 Z\" fill=\"${colors.primary}\"/>\n                <circle cx=\"26\" cy=\"34\" r=\"3\" fill=\"${colors.accent}\"/>\n                <circle cx=\"38\" cy=\"34\" r=\"3\" fill=\"${colors.accent}\"/>\n                <path d=\"M28 44 L32 52 L36 44\" stroke=\"${colors.accent}\" stroke-width=\"2\" fill=\"none\"/>\n            `;\n            break;\n        case 'undead':\n            // Skull with glowing eyes\n            shape = `\n                <ellipse cx=\"32\" cy=\"28\" rx=\"14\" ry=\"16\" fill=\"${colors.secondary}\"/>\n                <ellipse cx=\"26\" cy=\"26\" rx=\"4\" ry=\"5\" fill=\"#1a1a2e\"/>\n                <ellipse cx=\"38\" cy=\"26\" rx=\"4\" ry=\"5\" fill=\"#1a1a2e\"/>\n                <circle cx=\"26\" cy=\"26\" r=\"2\" fill=\"${colors.accent}\"/>\n                <circle cx=\"38\" cy=\"26\" r=\"2\" fill=\"${colors.accent}\"/>\n                <path d=\"M26 40 L28 44 L30 40 L32 44 L34 40 L36 44 L38 40\" stroke=\"#1a1a2e\" stroke-width=\"2\" fill=\"none\"/>\n                <ellipse cx=\"32\" cy=\"34\" rx=\"2\" ry=\"3\" fill=\"#1a1a2e\"/>\n            `;\n            break;\n        case 'fiend':\n            // Demonic figure with horns\n            shape = `\n                <path d=\"M20 16 L24 28 L20 28 Z\" fill=\"${colors.accent}\"/>\n                <path d=\"M44 16 L40 28 L44 28 Z\" fill=\"${colors.accent}\"/>\n                <ellipse cx=\"32\" cy=\"32\" rx=\"12\" ry=\"14\" fill=\"${colors.primary}\"/>\n                <circle cx=\"27\" cy=\"30\" r=\"3\" fill=\"${colors.accent}\"/>\n                <circle cx=\"37\" cy=\"30\" r=\"3\" fill=\"${colors.accent}\"/>\n                <path d=\"M26 40 Q32 46 38 40\" stroke=\"${colors.secondary}\" stroke-width=\"2\" fill=\"none\"/>\n            `;\n            break;\n        case 'elemental':\n            // Swirling elemental form\n            shape = `\n                <circle cx=\"32\" cy=\"32\" r=\"18\" fill=\"${colors.primary}\" opacity=\"0.6\"/>\n                <circle cx=\"32\" cy=\"32\" r=\"12\" fill=\"${colors.secondary}\" opacity=\"0.7\"/>\n                <circle cx=\"32\" cy=\"32\" r=\"6\" fill=\"${colors.accent}\"/>\n                <path d=\"M32 14 Q44 20 32 32 Q20 44 32 50\" stroke=\"${colors.accent}\" stroke-width=\"2\" fill=\"none\"/>\n            `;\n            break;\n        case 'construct':\n            // Mechanical/golem figure\n            shape = `\n                <rect x=\"22\" y=\"16\" width=\"20\" height=\"14\" fill=\"${colors.primary}\" rx=\"2\"/>\n                <rect x=\"20\" y=\"32\" width=\"24\" height=\"20\" fill=\"${colors.secondary}\" rx=\"2\"/>\n                <rect x=\"26\" y=\"20\" width=\"4\" height=\"4\" fill=\"${colors.accent}\"/>\n                <rect x=\"34\" y=\"20\" width=\"4\" height=\"4\" fill=\"${colors.accent}\"/>\n                <rect x=\"28\" y=\"38\" width=\"8\" height=\"8\" fill=\"${colors.primary}\"/>\n            `;\n            break;\n        case 'giant':\n            // Large humanoid\n            shape = `\n                <circle cx=\"32\" cy=\"16\" r=\"10\" fill=\"${colors.secondary}\"/>\n                <rect x=\"20\" y=\"26\" width=\"24\" height=\"24\" fill=\"${colors.primary}\" rx=\"4\"/>\n                <rect x=\"12\" y=\"28\" width=\"8\" height=\"18\" fill=\"${colors.secondary}\" rx=\"2\"/>\n                <rect x=\"44\" y=\"28\" width=\"8\" height=\"18\" fill=\"${colors.secondary}\" rx=\"2\"/>\n                <circle cx=\"28\" cy=\"14\" r=\"2\" fill=\"${colors.accent}\"/>\n                <circle cx=\"36\" cy=\"14\" r=\"2\" fill=\"${colors.accent}\"/>\n            `;\n            break;\n        case 'ooze':\n            // Amorphous blob\n            shape = `\n                <ellipse cx=\"32\" cy=\"38\" rx=\"22\" ry=\"14\" fill=\"${colors.primary}\" opacity=\"0.8\"/>\n                <ellipse cx=\"28\" cy=\"36\" rx=\"14\" ry=\"10\" fill=\"${colors.secondary}\" opacity=\"0.6\"/>\n                <circle cx=\"24\" cy=\"34\" r=\"3\" fill=\"${colors.accent}\"/>\n                <circle cx=\"38\" cy=\"38\" r=\"2\" fill=\"${colors.accent}\"/>\n            `;\n            break;\n        default: // humanoid and others\n            // Generic humanoid\n            shape = `\n                <circle cx=\"32\" cy=\"16\" r=\"8\" fill=\"${colors.secondary}\"/>\n                <rect x=\"24\" y=\"24\" width=\"16\" height=\"18\" fill=\"${colors.primary}\" rx=\"2\"/>\n                <rect x=\"14\" y=\"26\" width=\"8\" height=\"14\" fill=\"${colors.secondary}\" rx=\"2\"/>\n                <rect x=\"42\" y=\"26\" width=\"8\" height=\"14\" fill=\"${colors.secondary}\" rx=\"2\"/>\n                <rect x=\"24\" y=\"42\" width=\"6\" height=\"12\" fill=\"${colors.secondary}\" rx=\"2\"/>\n                <rect x=\"34\" y=\"42\" width=\"6\" height=\"12\" fill=\"${colors.secondary}\" rx=\"2\"/>\n                <circle cx=\"28\" cy=\"14\" r=\"2\" fill=\"${colors.accent}\"/>\n                <circle cx=\"36\" cy=\"14\" r=\"2\" fill=\"${colors.accent}\"/>\n            `;\n    }\n    \n    const svg = `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${size}\" height=\"${size}\" viewBox=\"0 0 64 64\">\n            <rect width=\"64\" height=\"64\" fill=\"#1a1a2e\" rx=\"8\"/>\n            ${shape}\n        </svg>\n    `.trim();\n    \n    return `data:image/svg+xml,${encodeURIComponent(svg)}`;\n}\n\n/**\n * Generates an SVG placeholder for an item.\n * \n * @param itemType - The item's type (from ItemType enum)\n * @param rarity - The item's rarity (from ItemRarity enum)\n * @param size - Image size in pixels (default 48)\n * @returns Data URI for the SVG image\n */\nexport function getItemImage(itemType: ItemType | string, rarity: ItemRarity | string = ItemRarity.COMMON, size: number = 48): string {\n    const normalizedType = itemType.toLowerCase();\n    const normalizedRarity = rarity.toLowerCase().replace('_', '');\n    \n    // Map rarity to color key\n    let rarityKey: keyof typeof COLORS;\n    switch (normalizedRarity) {\n        case 'uncommon': rarityKey = 'uncommon'; break;\n        case 'rare': rarityKey = 'rare'; break;\n        case 'veryrare': rarityKey = 'veryRare'; break;\n        case 'legendary': rarityKey = 'legendary'; break;\n        default: rarityKey = 'common';\n    }\n    const colors = COLORS[rarityKey];\n    \n    // Different icons based on item type\n    let icon: string;\n    switch (normalizedType) {\n        case 'weapon':\n            // Sword\n            icon = `\n                <rect x=\"22\" y=\"6\" width=\"4\" height=\"28\" fill=\"${colors.primary}\" rx=\"1\"/>\n                <rect x=\"16\" y=\"32\" width=\"16\" height=\"4\" fill=\"${colors.secondary}\" rx=\"1\"/>\n                <rect x=\"22\" y=\"36\" width=\"4\" height=\"10\" fill=\"${colors.accent}\" rx=\"1\"/>\n            `;\n            break;\n        case 'armor':\n            // Chestplate\n            icon = `\n                <path d=\"M14 14 L24 8 L34 14 L34 36 L24 42 L14 36 Z\" fill=\"${colors.primary}\"/>\n                <path d=\"M18 18 L24 14 L30 18 L30 30 L24 34 L18 30 Z\" fill=\"${colors.secondary}\"/>\n                <circle cx=\"24\" cy=\"24\" r=\"3\" fill=\"${colors.accent}\"/>\n            `;\n            break;\n        case 'accessory':\n            // Ring\n            icon = `\n                <circle cx=\"24\" cy=\"24\" r=\"12\" fill=\"none\" stroke=\"${colors.primary}\" stroke-width=\"6\"/>\n                <circle cx=\"24\" cy=\"12\" r=\"4\" fill=\"${colors.accent}\"/>\n            `;\n            break;\n        case 'consumable':\n            // Potion bottle\n            icon = `\n                <rect x=\"20\" y=\"6\" width=\"8\" height=\"6\" fill=\"${colors.secondary}\" rx=\"1\"/>\n                <path d=\"M18 12 L14 38 Q14 44 24 44 Q34 44 34 38 L30 12 Z\" fill=\"${colors.primary}\"/>\n                <ellipse cx=\"24\" cy=\"30\" rx=\"6\" ry=\"8\" fill=\"${colors.accent}\" opacity=\"0.7\"/>\n            `;\n            break;\n        case 'treasure':\n            // Gold coins\n            icon = `\n                <ellipse cx=\"20\" cy=\"28\" rx=\"10\" ry=\"6\" fill=\"${colors.accent}\"/>\n                <ellipse cx=\"28\" cy=\"24\" rx=\"10\" ry=\"6\" fill=\"${colors.primary}\"/>\n                <ellipse cx=\"24\" cy=\"20\" rx=\"10\" ry=\"6\" fill=\"${colors.secondary}\"/>\n                <text x=\"24\" y=\"24\" font-size=\"8\" fill=\"${colors.accent}\" text-anchor=\"middle\">G</text>\n            `;\n            break;\n        default:\n            // Generic item (box)\n            icon = `\n                <rect x=\"10\" y=\"14\" width=\"28\" height=\"24\" fill=\"${colors.primary}\" rx=\"2\"/>\n                <rect x=\"14\" y=\"18\" width=\"20\" height=\"16\" fill=\"${colors.secondary}\" rx=\"1\"/>\n                <text x=\"24\" y=\"30\" font-size=\"10\" fill=\"${colors.accent}\" text-anchor=\"middle\">?</text>\n            `;\n    }\n    \n    // Add rarity glow for rare+ items\n    let glow = '';\n    if (normalizedRarity !== 'common') {\n        glow = `<rect width=\"48\" height=\"48\" fill=\"none\" stroke=\"${colors.accent}\" stroke-width=\"2\" rx=\"6\" opacity=\"0.6\"/>`;\n    }\n    \n    const svg = `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${size}\" height=\"${size}\" viewBox=\"0 0 48 48\">\n            <rect width=\"48\" height=\"48\" fill=\"#16213e\" rx=\"6\"/>\n            ${glow}\n            ${icon}\n        </svg>\n    `.trim();\n    \n    return `data:image/svg+xml,${encodeURIComponent(svg)}`;\n}\n\n/**\n * Gets a fallback/default image for any entity type.\n * \n * @param size - Image size in pixels (default 64)\n * @returns Data URI for a generic placeholder SVG\n */\nexport function getPlaceholderImage(size: number = 64): string {\n    const svg = `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${size}\" height=\"${size}\" viewBox=\"0 0 64 64\">\n            <rect width=\"64\" height=\"64\" fill=\"#1a1a2e\" rx=\"8\"/>\n            <circle cx=\"32\" cy=\"28\" r=\"12\" fill=\"#34495e\"/>\n            <rect x=\"20\" y=\"42\" width=\"24\" height=\"4\" fill=\"#34495e\" rx=\"2\"/>\n        </svg>\n    `.trim();\n    \n    return `data:image/svg+xml,${encodeURIComponent(svg)}`;\n}\n\n", "/**\n * @fileoverview Web-based UI implementation for the Dungeon Roguelike\n * \n * This module provides a browser-based implementation of the GameLoop,\n * rendering the game state to HTML elements and handling user input\n * through click events and keyboard shortcuts.\n * \n * @module ui/WebGameLoop\n */\n\nimport { GameLoop } from '../game/gameLoop';\nimport { GameState, GamePhase, Action, ActionResult } from '../game/gameState';\nimport { AttackResult, CombatStatus, AbilityResult } from '../game/combatEngine';\nimport { Player } from '../entities/player';\nimport { Room, RoomType, RoomState } from '../dungeon/room';\nimport { Enemy } from '../entities/enemy';\nimport { Item } from '../entities/item';\nimport { getPlayerImage, getMonsterImage, getItemImage } from './imageAssets';\n\n/**\n * Browser-based implementation of the game loop.\n * Renders game state to DOM elements and handles user input via events.\n */\nexport class WebGameLoop extends GameLoop {\n    /** Container element for the entire game UI */\n    private container: HTMLElement;\n    \n    /** Current pending action resolver (for async input) */\n    private actionResolver: ((action: Action) => void) | null = null;\n    \n    /** Current pending target resolver (for combat targeting) */\n    private targetResolver: ((targetId: string) => void) | null = null;\n    \n    /** Message log entries (supports HTML for formatting) */\n    private messageLog: string[] = [];\n    \n    /** Maximum messages to keep in log */\n    private readonly MAX_LOG_MESSAGES = 50;\n\n    /**\n     * Formats a name with appropriate color class based on type.\n     * @param name - The name to format\n     * @param type - The type of name (player, enemy, item, gold, damage, heal, ability)\n     * @returns HTML string with colored span\n     */\n    private formatName(name: string, type: 'player' | 'enemy' | 'item' | 'gold' | 'damage' | 'heal' | 'ability' | 'crit' | 'miss' | 'room'): string {\n        return `<span class=\"log-${type}\">${name}</span>`;\n    }\n\n    /**\n     * Formats an item name with rarity color.\n     * @param name - The item name\n     * @param rarity - The item rarity (optional)\n     * @returns HTML string with colored span\n     */\n    private formatItemName(name: string, rarity?: string): string {\n        const rarityClass = rarity ? `log-item-${rarity.toLowerCase().replace('_', '')}` : 'log-item';\n        return `<span class=\"${rarityClass}\">${name}</span>`;\n    }\n\n    /**\n     * Formats event messages with appropriate styling for items, gold, health, etc.\n     */\n    private formatEventMessage(message: string): string {\n        let formatted = message;\n        \n        // Format \"You found [Item Name]!\" pattern\n        const foundItemMatch = message.match(/You found (.+?)!/);\n        if (foundItemMatch) {\n            const itemName = foundItemMatch[1];\n            // Check if it's a known item type by keywords\n            let itemClass = 'log-item-rare'; // Default to rare for event items\n            if (message.toLowerCase().includes('legendary') || message.toLowerCase().includes('ancient')) {\n                itemClass = 'log-item-legendary';\n            } else if (message.toLowerCase().includes('uncommon') || message.toLowerCase().includes('minor')) {\n                itemClass = 'log-item-uncommon';\n            } else if (message.toLowerCase().includes('common') || message.toLowerCase().includes('basic')) {\n                itemClass = 'log-item-common';\n            }\n            formatted = formatted.replace(\n                `You found ${itemName}!`,\n                `You found <span class=\"${itemClass}\">${itemName}</span>!`\n            );\n        }\n        \n        // Format \"Received [Item Name]\" pattern\n        const receivedMatch = message.match(/Received (.+?)(?:\\.|!|$)/);\n        if (receivedMatch) {\n            const itemName = receivedMatch[1];\n            formatted = formatted.replace(\n                `Received ${itemName}`,\n                `Received <span class=\"log-item-rare\">${itemName}</span>`\n            );\n        }\n        \n        // Format gold amounts\n        const goldMatch = message.match(/(\\d+)\\s*gold/gi);\n        if (goldMatch) {\n            goldMatch.forEach(match => {\n                const amount = match.match(/\\d+/)?.[0];\n                if (amount) {\n                    formatted = formatted.replace(match, `<span class=\"log-gold\">${amount} gold</span>`);\n                }\n            });\n        }\n        \n        // Format healing\n        const healMatch = message.match(/healed?\\s+(?:for\\s+)?(\\d+)/gi);\n        if (healMatch) {\n            healMatch.forEach(match => {\n                const amount = match.match(/\\d+/)?.[0];\n                if (amount) {\n                    formatted = formatted.replace(match, `<span class=\"log-heal\">healed ${amount}</span>`);\n                }\n            });\n        }\n        \n        // Format damage\n        const damageMatch = message.match(/(?:took|deals?|suffer(?:ed)?)\\s+(\\d+)\\s*(?:damage)?/gi);\n        if (damageMatch) {\n            damageMatch.forEach(match => {\n                formatted = formatted.replace(match, `<span class=\"log-damage\">${match}</span>`);\n            });\n        }\n        \n        // Format stat bonuses (+X stat)\n        const statMatch = message.match(/[+-]\\d+\\s+(?:attack|defense|speed|health|mana|crit)/gi);\n        if (statMatch) {\n            statMatch.forEach(match => {\n                const isPositive = match.startsWith('+');\n                const className = isPositive ? 'log-heal' : 'log-damage';\n                formatted = formatted.replace(match, `<span class=\"${className}\">${match}</span>`);\n            });\n        }\n        \n        // Format buff/debuff names (typically capitalized phrases)\n        const buffMatch = message.match(/(?:gained|received|afflicted with)\\s+[\"']?([A-Z][a-zA-Z\\s]+?)[\"']?(?:\\s+for|\\.|!|$)/);\n        if (buffMatch) {\n            const buffName = buffMatch[1].trim();\n            formatted = formatted.replace(buffName, `<span class=\"log-ability\">${buffName}</span>`);\n        }\n        \n        return formatted;\n    }\n\n    /**\n     * Creates a new WebGameLoop attached to the specified container.\n     * \n     * @param containerId - ID of the HTML element to render the game into\n     */\n    constructor(containerId: string = 'game-container') {\n        super();\n        const container = document.getElementById(containerId);\n        if (!container) {\n            throw new Error(`Container element '${containerId}' not found`);\n        }\n        this.container = container;\n        this.setupKeyboardControls();\n    }\n\n    /**\n     * Sets up global keyboard event listeners for game controls.\n     */\n    private setupKeyboardControls(): void {\n        document.addEventListener('keydown', (e) => {\n            // Number keys 1-9 for action selection\n            if (e.key >= '1' && e.key <= '9') {\n                const index = parseInt(e.key) - 1;\n                this.selectActionByIndex(index);\n            }\n            // Escape to cancel/close modals\n            if (e.key === 'Escape') {\n                this.handleEscape();\n            }\n        });\n    }\n\n    /**\n     * Selects an action by its index in the current action list.\n     */\n    private selectActionByIndex(index: number): void {\n        const actionButtons = this.container.querySelectorAll('.action-btn');\n        if (index < actionButtons.length) {\n            (actionButtons[index] as HTMLButtonElement).click();\n        }\n    }\n\n    /**\n     * Handles escape key press - closes modals or cancels targeting.\n     */\n    private handleEscape(): void {\n        // Close any open modals\n        const modal = this.container.querySelector('.modal');\n        if (modal) {\n            modal.remove();\n        }\n    }\n\n    // =========================================================================\n    // INPUT HANDLING OVERRIDES\n    // =========================================================================\n\n    /**\n     * Waits for player to select an action from the available options.\n     * Returns a Promise that resolves when an action button is clicked.\n     */\n    protected async getPlayerInput(availableActions: Action[]): Promise<Action> {\n        return new Promise((resolve) => {\n            this.actionResolver = resolve;\n            this.renderActionButtons(availableActions);\n        });\n    }\n\n    /**\n     * Waits for player to select a target from valid options.\n     * Shows a target selection UI overlay.\n     */\n    protected async getTargetSelection(validTargets: string[]): Promise<string> {\n        return new Promise((resolve) => {\n            this.targetResolver = resolve;\n            this.renderTargetSelection(validTargets);\n        });\n    }\n\n    // =========================================================================\n    // RENDERING OVERRIDES\n    // =========================================================================\n\n    /**\n     * Renders the complete game state to the DOM.\n     */\n    protected render(state: GameState): void {\n        this.container.innerHTML = '';\n        this.container.appendChild(this.createGameLayout(state));\n        \n        // Show inventory overlay if in inventory phase\n        if (state.phase === GamePhase.INVENTORY) {\n            this.container.appendChild(this.createInventoryOverlay(state));\n        }\n        \n        // Show character overlay if in character phase\n        if (state.phase === GamePhase.CHARACTER) {\n            this.container.appendChild(this.createCharacterOverlay(state));\n        }\n    }\n\n    /**\n     * Creates the main game layout structure.\n     */\n    private createGameLayout(state: GameState): HTMLElement {\n        const layout = document.createElement('div');\n        layout.className = 'game-layout';\n\n        // Left sidebar - Player stats\n        const sidebar = this.createPlayerSidebar(state);\n        layout.appendChild(sidebar);\n\n        // Main content area\n        const main = document.createElement('main');\n        main.className = 'game-main';\n\n        // Room/Combat/Event/Shop/Puzzle/Treasure view\n        const currentRoom = this.getCurrentRoom(state);\n        if (state.phase === GamePhase.COMBAT) {\n            main.appendChild(this.createCombatView(state, currentRoom));\n        } else if (state.phase === GamePhase.EVENT && currentRoom?.event) {\n            main.appendChild(this.createEventView(state, currentRoom));\n        } else if (state.phase === GamePhase.SHOP && currentRoom?.shopInventory) {\n            main.appendChild(this.createShopView(state, currentRoom));\n        } else if (state.phase === GamePhase.PUZZLE && currentRoom?.puzzle) {\n            main.appendChild(this.createPuzzleView(state, currentRoom));\n        } else if (state.phase === GamePhase.TREASURE) {\n            main.appendChild(this.createTreasureView(state, currentRoom));\n        } else {\n            main.appendChild(this.createRoomView(state, currentRoom));\n        }\n\n        // Action area\n        const actionArea = document.createElement('div');\n        actionArea.className = 'action-area';\n        actionArea.id = 'action-area';\n        main.appendChild(actionArea);\n\n        layout.appendChild(main);\n\n        // Right sidebar - Message log and minimap\n        const rightSidebar = this.createRightSidebar(state);\n        layout.appendChild(rightSidebar);\n\n        // Seed display in bottom left corner\n        const seedDisplay = document.createElement('div');\n        seedDisplay.className = 'seed-display';\n        seedDisplay.innerHTML = `\n            <span class=\"seed-label\">Seed:</span>\n            <span class=\"seed-value\" title=\"Click to copy\">${state.seed}</span>\n        `;\n        seedDisplay.querySelector('.seed-value')?.addEventListener('click', () => {\n            navigator.clipboard.writeText(state.seed).then(() => {\n                const seedValue = seedDisplay.querySelector('.seed-value');\n                if (seedValue) {\n                    seedValue.textContent = 'Copied!';\n                    setTimeout(() => {\n                        seedValue.textContent = state.seed;\n                    }, 1500);\n                }\n            });\n        });\n        layout.appendChild(seedDisplay);\n\n        return layout;\n    }\n\n    /**\n     * Creates the player stats sidebar.\n     */\n    private createPlayerSidebar(state: GameState): HTMLElement {\n        const sidebar = document.createElement('aside');\n        sidebar.className = 'sidebar sidebar-left';\n\n        if (!state.player) {\n            sidebar.innerHTML = '<p>No player</p>';\n            return sidebar;\n        }\n\n        const player = state.player;\n        const playerImage = getPlayerImage(player.playerClass, 80);\n\n        sidebar.innerHTML = `\n            <div class=\"player-info\">\n                <img src=\"${playerImage}\" alt=\"${player.playerClass}\" class=\"player-portrait\" />\n                <h2 class=\"player-name\">${player.name}</h2>\n                <div class=\"player-class\">${player.playerClass} Lv.${player.level}</div>\n            </div>\n            \n            <div class=\"stat-bars\">\n                <div class=\"stat-bar health-bar\">\n                    <div class=\"stat-bar-label\">\n                        <span>HP</span>\n                        <span>${player.stats.health}/${player.getMaxHealth()}</span>\n                    </div>\n                    <div class=\"stat-bar-track\">\n                        <div class=\"stat-bar-fill\" style=\"width: ${(player.stats.health / player.getMaxHealth()) * 100}%\"></div>\n                    </div>\n                </div>\n                \n                <div class=\"stat-bar mana-bar\">\n                    <div class=\"stat-bar-label\">\n                        <span>MP</span>\n                        <span>${player.stats.mana}/${player.getMaxMana()}</span>\n                    </div>\n                    <div class=\"stat-bar-track\">\n                        <div class=\"stat-bar-fill\" style=\"width: ${(player.stats.mana / player.getMaxMana()) * 100}%\"></div>\n                    </div>\n                </div>\n                \n                <div class=\"stat-bar xp-bar\">\n                    <div class=\"stat-bar-label\">\n                        <span>XP</span>\n                        <span>${player.experience}/${this.getXPForNextLevel(player)}</span>\n                    </div>\n                    <div class=\"stat-bar-track\">\n                        <div class=\"stat-bar-fill\" style=\"width: ${this.getXPProgress(player)}%\"></div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class=\"player-stats\">\n                <div class=\"stat-row\">\n                    <span class=\"stat-icon\">&#9876;</span>\n                    <span class=\"stat-label\">Attack</span>\n                    <span class=\"stat-value\">${player.getAttackPower()}</span>\n                </div>\n                <div class=\"stat-row\">\n                    <span class=\"stat-icon\">&#128737;</span>\n                    <span class=\"stat-label\">Defense</span>\n                    <span class=\"stat-value\">${player.getDefense()}</span>\n                </div>\n                <div class=\"stat-row\">\n                    <span class=\"stat-icon\">&#9889;</span>\n                    <span class=\"stat-label\">Speed</span>\n                    <span class=\"stat-value\">${player.getSpeed()}</span>\n                </div>\n                <div class=\"stat-row\">\n                    <span class=\"stat-icon\">&#10026;</span>\n                    <span class=\"stat-label\">Crit</span>\n                    <span class=\"stat-value\">${player.getCritChance()}%</span>\n                </div>\n            </div>\n            \n            <div class=\"player-gold\">\n                <span class=\"gold-icon\">&#9733;</span>\n                <span class=\"gold-amount\">${player.gold}</span>\n                <span class=\"gold-label\">Gold</span>\n            </div>\n            \n            ${player.relics.length > 0 ? `\n            <div class=\"player-relics\">\n                <h3>Relics (${player.relics.length})</h3>\n                <div class=\"relic-list\">\n                    ${player.relics.slice(0, 5).map(relic => `\n                        <div class=\"relic-item relic-${relic.rarity}\" title=\"${relic.description}\">\n                            <span class=\"relic-icon\">${this.getRelicIcon(relic.type)}</span>\n                            <span class=\"relic-name\">${relic.name}</span>\n                        </div>\n                    `).join('')}\n                    ${player.relics.length > 5 ? `<div class=\"relic-more\">+${player.relics.length - 5} more</div>` : ''}\n                </div>\n            </div>\n            ` : ''}\n            \n            <div class=\"game-stats\">\n                <div class=\"game-stat\">Rooms: ${state.stats.roomsCleared}</div>\n                <div class=\"game-stat\">Enemies: ${state.stats.enemiesDefeated}</div>\n            </div>\n        `;\n\n        return sidebar;\n    }\n\n    /**\n     * Gets an icon for a relic type.\n     */\n    private getRelicIcon(type: string): string {\n        switch (type) {\n            case 'ability': return '&#10024;'; // sparkles\n            case 'stat_boost': return '&#9650;'; // triangle up\n            case 'passive': return '&#9711;'; // circle\n            case 'combat_modifier': return '&#9876;'; // swords\n            default: return '&#10070;'; // diamond\n        }\n    }\n\n    /**\n     * Creates the right sidebar with message log and minimap.\n     */\n    private createRightSidebar(state: GameState): HTMLElement {\n        const sidebar = document.createElement('aside');\n        sidebar.className = 'sidebar sidebar-right';\n\n        // Minimap\n        const minimap = this.createMinimap(state);\n        sidebar.appendChild(minimap);\n\n        // Message log\n        const log = document.createElement('div');\n        log.className = 'message-log';\n        log.innerHTML = `\n            <h3>Log</h3>\n            <div class=\"log-entries\">\n                ${this.messageLog.slice(-8).map(msg => `<div class=\"log-entry\">${msg}</div>`).join('')}\n            </div>\n        `;\n        sidebar.appendChild(log);\n\n        return sidebar;\n    }\n\n    /**\n     * Creates a minimap showing dungeon structure with connections.\n     * Shows current level, one above, and one below with visual connections.\n     */\n    private createMinimap(state: GameState): HTMLElement {\n        const minimap = document.createElement('div');\n        minimap.className = 'minimap';\n        \n        const currentRoom = this.getCurrentRoom(state);\n        const currentLevel = currentRoom?.level ?? 1;\n        \n        // Find rooms that connect TO current room (came from - previous level)\n        const cameFromRooms = new Set<string>();\n        // Find rooms that current room connects TO (can go to - next level)\n        const canGoToRooms = new Set<string>(currentRoom?.connections ?? []);\n        \n        // Find which rooms on previous level connect to current room\n        if (currentRoom) {\n            const prevLayer = state.dungeon.layers.find(l => l.level === currentLevel - 1);\n            if (prevLayer) {\n                prevLayer.rooms.forEach(room => {\n                    if (room.connections.includes(currentRoom.id)) {\n                        cameFromRooms.add(room.id);\n                    }\n                });\n            }\n        }\n        \n        // Header with level indicator\n        minimap.innerHTML = `\n            <div class=\"minimap-header\">\n                <h3>Dungeon Map</h3>\n                <span class=\"current-level\">Level ${currentLevel}</span>\n            </div>\n        `;\n\n        const mapContent = document.createElement('div');\n        mapContent.className = 'minimap-content';\n\n        // Show levels: previous, current, next (in order from top to bottom)\n        const levelsToShow = [currentLevel - 1, currentLevel, currentLevel + 1].filter(l => l >= 1);\n        \n        // Store room positions for drawing connections\n        const roomPositions: Map<string, { level: number; index: number; total: number }> = new Map();\n        \n        levelsToShow.forEach(levelNum => {\n            const layer = state.dungeon.layers.find(l => l.level === levelNum);\n            if (!layer) return;\n            \n            layer.rooms.forEach((room, index) => {\n                roomPositions.set(room.id, { level: levelNum, index, total: layer.rooms.length });\n            });\n        });\n\n        levelsToShow.forEach(levelNum => {\n            const layer = state.dungeon.layers.find(l => l.level === levelNum);\n            if (!layer) return;\n            \n            const levelDiv = document.createElement('div');\n            levelDiv.className = `minimap-level ${levelNum === currentLevel ? 'current-level-row' : ''}`;\n            levelDiv.dataset.level = levelNum.toString();\n            \n            // Level label with direction indicator\n            const levelLabel = document.createElement('div');\n            levelLabel.className = 'minimap-level-label';\n            if (levelNum < currentLevel) {\n                levelLabel.innerHTML = `<span class=\"level-arrow up\">&#9650;</span> L${levelNum}`;\n            } else if (levelNum > currentLevel) {\n                levelLabel.innerHTML = `L${levelNum} <span class=\"level-arrow down\">&#9660;</span>`;\n            } else {\n                levelLabel.innerHTML = `<span class=\"level-marker\">&#9654;</span> L${levelNum}`;\n            }\n            levelDiv.appendChild(levelLabel);\n            \n            // Rooms container\n            const roomsContainer = document.createElement('div');\n            roomsContainer.className = 'minimap-rooms';\n            \n            layer.rooms.forEach((room, index) => {\n                const roomNode = document.createElement('div');\n                roomNode.className = `minimap-room ${room.state.toLowerCase()} room-${room.type.toLowerCase()}`;\n                roomNode.dataset.roomId = room.id;\n                \n                // Current room\n                if (room.id === state.dungeon.currentRoomId) {\n                    roomNode.classList.add('current');\n                }\n                \n                // Room you came from (previous level, connected to current)\n                if (cameFromRooms.has(room.id)) {\n                    roomNode.classList.add('came-from');\n                }\n                \n                // Rooms you can go to (connected from current room)\n                if (canGoToRooms.has(room.id) && room.id !== state.dungeon.currentRoomId) {\n                    roomNode.classList.add('can-go-to');\n                }\n                \n                // Add icon\n                roomNode.innerHTML = this.getRoomIcon(room.type);\n                \n                // Tooltip with more info\n                let stateLabel = room.state === 'cleared' ? 'Cleared' : \n                                 room.state === 'available' ? 'Available' :\n                                 room.state === 'active' ? 'Current' : 'Locked';\n                if (cameFromRooms.has(room.id)) stateLabel += ' (Came from)';\n                if (canGoToRooms.has(room.id) && room.state === 'available') stateLabel += ' (Can go)';\n                \n                roomNode.title = `${this.formatRoomType(room.type)} - ${stateLabel}`;\n                \n                roomsContainer.appendChild(roomNode);\n            });\n            \n            levelDiv.appendChild(roomsContainer);\n            mapContent.appendChild(levelDiv);\n        });\n\n        // Legend\n        const legend = document.createElement('div');\n        legend.className = 'minimap-legend';\n        legend.innerHTML = `\n            <div class=\"legend-item\"><span class=\"legend-dot current\"></span> Current</div>\n            <div class=\"legend-item\"><span class=\"legend-dot came-from\"></span> Came From</div>\n            <div class=\"legend-item\"><span class=\"legend-dot can-go-to\"></span> Can Go To</div>\n            <div class=\"legend-item\"><span class=\"legend-dot locked\"></span> Locked</div>\n        `;\n\n        minimap.appendChild(mapContent);\n        minimap.appendChild(legend);\n        return minimap;\n    }\n\n    /**\n     * Formats room type for display.\n     */\n    private formatRoomType(type: string): string {\n        return type.charAt(0).toUpperCase() + type.slice(1).toLowerCase();\n    }\n\n    /**\n     * Creates the inventory overlay modal.\n     * Shows equipped items and inventory grid with item actions.\n     */\n    private createInventoryOverlay(state: GameState): HTMLElement {\n        const overlay = document.createElement('div');\n        overlay.className = 'inventory-overlay';\n\n        const modal = document.createElement('div');\n        modal.className = 'inventory-modal';\n\n        // Header\n        const header = document.createElement('div');\n        header.className = 'inventory-header';\n        header.innerHTML = `\n            <h2>Inventory</h2>\n            <button class=\"close-btn\" data-action=\"close_inventory\">X</button>\n        `;\n        modal.appendChild(header);\n\n        if (!state.player) {\n            modal.innerHTML += '<p>No player data</p>';\n            overlay.appendChild(modal);\n            return overlay;\n        }\n\n        const player = state.player;\n        const content = document.createElement('div');\n        content.className = 'inventory-content';\n\n        // Equipment section (left side)\n        const equipmentSection = document.createElement('div');\n        equipmentSection.className = 'equipment-section';\n        const weaponImg = player.equipment.weapon \n            ? getItemImage(player.equipment.weapon.type, player.equipment.weapon.rarity, 48) \n            : '';\n        const armorImg = player.equipment.armor \n            ? getItemImage(player.equipment.armor.type, player.equipment.armor.rarity, 48) \n            : '';\n        const accessoryImg = player.equipment.accessory \n            ? getItemImage(player.equipment.accessory.type, player.equipment.accessory.rarity, 48) \n            : '';\n\n        equipmentSection.innerHTML = `\n            <h3>Equipment</h3>\n            <div class=\"equipment-slots\">\n                <div class=\"equipment-slot\" data-slot=\"weapon\">\n                    <div class=\"slot-label\">Weapon</div>\n                    <div class=\"slot-item ${player.equipment.weapon ? 'filled' : 'empty'}\">\n                        ${player.equipment.weapon \n                            ? `<img src=\"${weaponImg}\" alt=\"${player.equipment.weapon.name}\" class=\"equipment-image\" />\n                               <span class=\"item-name\">${player.equipment.weapon.name}</span>\n                               <button class=\"unequip-btn\" data-action=\"unequip_item\" data-slot=\"weapon\">Unequip</button>`\n                            : '<span class=\"empty-slot\">Empty</span>'}\n                    </div>\n                </div>\n                <div class=\"equipment-slot\" data-slot=\"armor\">\n                    <div class=\"slot-label\">Armor</div>\n                    <div class=\"slot-item ${player.equipment.armor ? 'filled' : 'empty'}\">\n                        ${player.equipment.armor \n                            ? `<img src=\"${armorImg}\" alt=\"${player.equipment.armor.name}\" class=\"equipment-image\" />\n                               <span class=\"item-name\">${player.equipment.armor.name}</span>\n                               <button class=\"unequip-btn\" data-action=\"unequip_item\" data-slot=\"armor\">Unequip</button>`\n                            : '<span class=\"empty-slot\">Empty</span>'}\n                    </div>\n                </div>\n                <div class=\"equipment-slot\" data-slot=\"accessory\">\n                    <div class=\"slot-label\">Accessory</div>\n                    <div class=\"slot-item ${player.equipment.accessory ? 'filled' : 'empty'}\">\n                        ${player.equipment.accessory \n                            ? `<img src=\"${accessoryImg}\" alt=\"${player.equipment.accessory.name}\" class=\"equipment-image\" />\n                               <span class=\"item-name\">${player.equipment.accessory.name}</span>\n                               <button class=\"unequip-btn\" data-action=\"unequip_item\" data-slot=\"accessory\">Unequip</button>`\n                            : '<span class=\"empty-slot\">Empty</span>'}\n                    </div>\n                </div>\n            </div>\n            <div class=\"gold-display\">\n                <span class=\"gold-icon\">G</span>\n                <span class=\"gold-amount\">${player.gold}</span>\n            </div>\n        `;\n        content.appendChild(equipmentSection);\n\n        // Inventory grid (right side)\n        const inventorySection = document.createElement('div');\n        inventorySection.className = 'inventory-grid-section';\n        inventorySection.innerHTML = `<h3>Items (${player.inventory.length})</h3>`;\n\n        const grid = document.createElement('div');\n        grid.className = 'inventory-grid';\n\n        if (player.inventory.length === 0) {\n            grid.innerHTML = '<div class=\"empty-inventory\">No items in inventory</div>';\n        } else {\n            player.inventory.forEach(item => {\n                const itemImg = getItemImage(item.type, item.rarity, 40);\n                const itemEl = document.createElement('div');\n                itemEl.className = `inventory-item item-${item.type.toLowerCase()} rarity-${item.rarity.toLowerCase()}`;\n                itemEl.innerHTML = `\n                    <img src=\"${itemImg}\" alt=\"${item.name}\" class=\"item-image\" />\n                    <div class=\"item-info\">\n                        <span class=\"item-name\">${item.name}</span>\n                        <span class=\"item-type\">${item.type}</span>\n                    </div>\n                    <div class=\"item-actions\">\n                        ${this.getItemActions(item)}\n                    </div>\n                `;\n                grid.appendChild(itemEl);\n            });\n        }\n\n        inventorySection.appendChild(grid);\n        content.appendChild(inventorySection);\n\n        modal.appendChild(content);\n        overlay.appendChild(modal);\n\n        // Add click handler for close button and item actions\n        overlay.addEventListener('click', (e) => {\n            const target = e.target as HTMLElement;\n            const action = target.dataset.action;\n            \n            if (action === 'close_inventory') {\n                if (this.actionResolver) {\n                    this.actionResolver({ type: 'close_inventory' });\n                }\n            } else if (action === 'unequip_item') {\n                const slot = target.dataset.slot as 'weapon' | 'armor' | 'accessory';\n                if (this.actionResolver && slot) {\n                    this.actionResolver({ type: 'unequip_item', slot });\n                }\n            } else if (action === 'equip_item') {\n                const itemId = target.dataset.itemId;\n                if (this.actionResolver && itemId) {\n                    this.actionResolver({ type: 'equip_item', itemId });\n                }\n            } else if (action === 'use_item') {\n                const itemId = target.dataset.itemId;\n                if (this.actionResolver && itemId) {\n                    this.actionResolver({ type: 'use_item', itemId });\n                }\n            }\n        });\n\n        // Close on overlay click (outside modal)\n        overlay.addEventListener('click', (e) => {\n            if (e.target === overlay && this.actionResolver) {\n                this.actionResolver({ type: 'close_inventory' });\n            }\n        });\n\n        return overlay;\n    }\n\n    /**\n     * Returns action buttons HTML for an inventory item based on its type.\n     */\n    private getItemActions(item: { id: string; type: string; name: string }): string {\n        switch (item.type.toLowerCase()) {\n            case 'weapon':\n            case 'armor':\n            case 'accessory':\n                return `<button class=\"item-action-btn\" data-action=\"equip_item\" data-item-id=\"${item.id}\">Equip</button>`;\n            case 'consumable':\n                return `<button class=\"item-action-btn\" data-action=\"use_item\" data-item-id=\"${item.id}\">Use</button>`;\n            default:\n                return '';\n        }\n    }\n\n    /**\n     * Creates the character sheet overlay modal.\n     */\n    private createCharacterOverlay(state: GameState): HTMLElement {\n        const overlay = document.createElement('div');\n        overlay.className = 'character-overlay';\n\n        const modal = document.createElement('div');\n        modal.className = 'character-modal';\n\n        // Header\n        const header = document.createElement('div');\n        header.className = 'character-header';\n        header.innerHTML = `\n            <h2>Character Sheet</h2>\n            <button class=\"close-btn\" data-action=\"close_character\">X</button>\n        `;\n        modal.appendChild(header);\n\n        if (!state.player) {\n            modal.innerHTML += '<p>No player data</p>';\n            overlay.appendChild(modal);\n            return overlay;\n        }\n\n        const player = state.player;\n        const content = document.createElement('div');\n        content.className = 'character-content';\n\n        content.innerHTML = `\n            <div class=\"character-info\">\n                <h3>${player.name}</h3>\n                <p class=\"character-class\">${player.playerClass} - Level ${player.level}</p>\n            </div>\n            \n            <div class=\"character-stats\">\n                <h4>Stats</h4>\n                <div class=\"stat-grid\">\n                    <div class=\"stat-item\">\n                        <span class=\"stat-label\">Health</span>\n                        <span class=\"stat-value\">${player.stats.health}/${player.getMaxHealth()}</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <span class=\"stat-label\">Mana</span>\n                        <span class=\"stat-value\">${player.stats.mana}/${player.getMaxMana()}</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <span class=\"stat-label\">Attack</span>\n                        <span class=\"stat-value\">${player.getAttackPower()}</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <span class=\"stat-label\">Defense</span>\n                        <span class=\"stat-value\">${player.getDefense()}</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <span class=\"stat-label\">Speed</span>\n                        <span class=\"stat-value\">${player.getSpeed()}</span>\n                    </div>\n                    <div class=\"stat-item\">\n                        <span class=\"stat-label\">Crit Chance</span>\n                        <span class=\"stat-value\">${player.getCritChance()}%</span>\n                    </div>\n                </div>\n            </div>\n            \n            <div class=\"character-abilities\">\n                <h4>Abilities</h4>\n                <div class=\"ability-list\">\n                    ${player.abilities.map(ability => `\n                        <div class=\"ability-item ${ability.currentCooldown > 0 ? 'on-cooldown' : ''}\">\n                            <span class=\"ability-name\">${ability.name}</span>\n                            <span class=\"ability-cost\">${ability.manaCost} MP</span>\n                            ${ability.currentCooldown > 0 ? `<span class=\"ability-cd\">(${ability.currentCooldown} turns)</span>` : ''}\n                        </div>\n                    `).join('')}\n                </div>\n            </div>\n            \n            <div class=\"character-experience\">\n                <h4>Experience</h4>\n                <p>XP: ${player.experience} / ${this.getXPForNextLevel(player)}</p>\n                <p>Gold: ${player.gold}</p>\n            </div>\n        `;\n\n        modal.appendChild(content);\n        overlay.appendChild(modal);\n\n        // Add click handler for close button\n        overlay.addEventListener('click', (e) => {\n            const target = e.target as HTMLElement;\n            if (target.dataset.action === 'close_character' || e.target === overlay) {\n                if (this.actionResolver) {\n                    this.actionResolver({ type: 'close_character' });\n                }\n            }\n        });\n\n        return overlay;\n    }\n\n    /**\n     * Creates the room view for exploration phase.\n     */\n    private createRoomView(state: GameState, room: Room | null): HTMLElement {\n        const view = document.createElement('div');\n        view.className = 'room-view';\n\n        if (!room) {\n            view.innerHTML = '<p>No room</p>';\n            return view;\n        }\n\n        view.innerHTML = `\n            <div class=\"room-header\">\n                <span class=\"room-icon\">${this.getRoomIcon(room.type)}</span>\n                <h2 class=\"room-title\">${this.getRoomTitle(room.type)}</h2>\n                <span class=\"room-level\">Level ${room.level}</span>\n            </div>\n            <p class=\"room-description\">${room.description}</p>\n        `;\n\n        // Show interactables\n        const interactables = room.getAvailableInteractables();\n        if (interactables.length > 0) {\n            const interactablesDiv = document.createElement('div');\n            interactablesDiv.className = 'room-interactables';\n            interactablesDiv.innerHTML = `\n                <h3>Objects</h3>\n                <div class=\"interactable-list\">\n                    ${interactables.map(i => `\n                        <div class=\"interactable-item\">\n                            <span class=\"interactable-icon\">${this.getInteractableIcon(i.type)}</span>\n                            <span class=\"interactable-name\">${i.name}</span>\n                        </div>\n                    `).join('')}\n                </div>\n            `;\n            view.appendChild(interactablesDiv);\n        }\n\n        // Show connected rooms\n        const connectedRooms = this.getConnectedRooms(state, room);\n        if (connectedRooms.length > 0) {\n            const connectionsDiv = document.createElement('div');\n            connectionsDiv.className = 'room-connections';\n            connectionsDiv.innerHTML = `\n                <h3>Paths</h3>\n                <div class=\"connection-list\">\n                    ${connectedRooms.map(r => `\n                        <div class=\"connection-item ${r.canEnter() ? 'available' : 'locked'}\">\n                            <span class=\"connection-icon\">${this.getRoomIcon(r.type)}</span>\n                            <span class=\"connection-name\">${this.getRoomTitle(r.type)}</span>\n                            <span class=\"connection-status\">${r.state}</span>\n                        </div>\n                    `).join('')}\n                </div>\n            `;\n            view.appendChild(connectionsDiv);\n        }\n\n        return view;\n    }\n\n    /**\n     * Creates the event view showing the mysterious event.\n     */\n    private createEventView(state: GameState, room: Room): HTMLElement {\n        const view = document.createElement('div');\n        view.className = 'event-view';\n\n        const event = room.event;\n        if (!event) {\n            view.innerHTML = '<p>No event</p>';\n            return view;\n        }\n\n        const outcome = event.outcome;\n        const outcomeClass = outcome.isPositive ? 'positive' : 'negative';\n\n        view.innerHTML = `\n            <div class=\"event-container\">\n                <div class=\"event-header\">\n                    <span class=\"event-icon\">${this.getEventIcon(outcome.type)}</span>\n                    <h2 class=\"event-title\">${event.title}</h2>\n                </div>\n                \n                <div class=\"event-description\">\n                    <p>${event.description}</p>\n                </div>\n                \n                <div class=\"event-outcome ${outcomeClass}\">\n                    <div class=\"outcome-icon\">${outcome.isPositive ? '\u2728' : '\uD83D\uDC80'}</div>\n                    <div class=\"outcome-details\">\n                        <h3 class=\"outcome-name\">${outcome.name}</h3>\n                        <p class=\"outcome-description\">${outcome.description}</p>\n                        ${this.getOutcomeDetails(outcome)}\n                    </div>\n                </div>\n                \n                <div class=\"event-hint\">\n                    <p>Click \"Accept Your Fate\" to continue...</p>\n                </div>\n            </div>\n        `;\n\n        return view;\n    }\n\n    /**\n     * Gets the icon for an event outcome type.\n     */\n    private getEventIcon(type: string): string {\n        const icons: Record<string, string> = {\n            'buff': '\u2B06\uFE0F',\n            'debuff': '\u2B07\uFE0F',\n            'weapon': '\u2694\uFE0F',\n            'armor': '\uD83D\uDEE1\uFE0F',\n            'potion': '\uD83E\uDDEA',\n            'gold': '\uD83D\uDCB0',\n            'heal': '\uD83D\uDC9A',\n            'damage': '\uD83D\uDC94',\n        };\n        return icons[type] || '\u2753';\n    }\n\n    /**\n     * Gets detailed HTML for an event outcome.\n     */\n    private getOutcomeDetails(outcome: { type: string; statBonus?: object; duration?: number; item?: { name: string }; gold?: number; healthChange?: number }): string {\n        switch (outcome.type) {\n            case 'buff':\n            case 'debuff':\n                if (outcome.statBonus) {\n                    const stats = Object.entries(outcome.statBonus)\n                        .map(([stat, value]) => `<span class=\"stat-change ${value > 0 ? 'positive' : 'negative'}\">${value > 0 ? '+' : ''}${value} ${stat}</span>`)\n                        .join(', ');\n                    return `<div class=\"outcome-stats\">${stats} for ${outcome.duration} turns</div>`;\n                }\n                return '';\n            case 'weapon':\n            case 'armor':\n            case 'potion':\n                return outcome.item ? `<div class=\"outcome-item\">Received: ${outcome.item.name}</div>` : '';\n            case 'gold':\n                return outcome.gold ? `<div class=\"outcome-gold\">+${outcome.gold} gold</div>` : '';\n            case 'heal':\n                return outcome.healthChange ? `<div class=\"outcome-heal\">Heals ${Math.floor(outcome.healthChange * 100)}% of max HP</div>` : '';\n            case 'damage':\n                return outcome.healthChange ? `<div class=\"outcome-damage\">Deals ${Math.floor(Math.abs(outcome.healthChange) * 100)}% of max HP</div>` : '';\n            default:\n                return '';\n        }\n    }\n\n    /**\n     * Creates the puzzle view showing the puzzle challenge.\n     */\n    private createPuzzleView(state: GameState, room: Room): HTMLElement {\n        const view = document.createElement('div');\n        view.className = 'puzzle-view';\n\n        const puzzle = room.puzzle;\n        if (!puzzle) {\n            view.innerHTML = '<p>No puzzle here</p>';\n            return view;\n        }\n\n        const attemptsLeft = puzzle.maxAttempts - puzzle.attempts;\n        const attemptsClass = attemptsLeft <= 1 ? 'attempts-critical' : attemptsLeft <= 2 ? 'attempts-warning' : '';\n\n        view.innerHTML = `\n            <div class=\"puzzle-header\">\n                <span class=\"puzzle-icon\">${this.getPuzzleIcon(puzzle.type)}</span>\n                <h2 class=\"puzzle-title\">${puzzle.title}</h2>\n            </div>\n            <div class=\"puzzle-attempts ${attemptsClass}\">\n                <span>Attempts remaining: ${attemptsLeft}</span>\n            </div>\n            <div class=\"puzzle-question\">\n                <p>${puzzle.question}</p>\n            </div>\n            <div class=\"puzzle-options\">\n                ${puzzle.options.map((option, index) => `\n                    <button class=\"puzzle-option\" \n                            data-action=\"puzzle_answer\" \n                            data-answer-index=\"${index}\">\n                        ${option}\n                    </button>\n                `).join('')}\n            </div>\n            <div class=\"puzzle-actions\">\n                <button class=\"skip-puzzle-btn\" data-action=\"skip_puzzle\">\n                    Skip Puzzle (forfeit rewards)\n                </button>\n            </div>\n        `;\n\n        // Add click handlers\n        view.addEventListener('click', (e) => {\n            const target = e.target as HTMLElement;\n            const action = target.dataset.action;\n            \n            if (action === 'puzzle_answer' && this.actionResolver) {\n                const answerIndex = parseInt(target.dataset.answerIndex || '0', 10);\n                this.actionResolver({ type: 'puzzle_answer', answerIndex });\n            } else if (action === 'skip_puzzle' && this.actionResolver) {\n                this.actionResolver({ type: 'skip_puzzle' });\n            }\n        });\n\n        return view;\n    }\n\n    /**\n     * Gets the icon for a puzzle type.\n     */\n    private getPuzzleIcon(type: string): string {\n        switch (type) {\n            case 'riddle': return '\uD83E\uDDE9';\n            case 'sequence': return '\uD83D\uDD2E';\n            case 'math': return '\uD83D\uDD22';\n            default: return '\u2753';\n        }\n    }\n\n    /**\n     * Creates the treasure room view showing interactable objects.\n     */\n    private createTreasureView(state: GameState, room: Room | null): HTMLElement {\n        const view = document.createElement('div');\n        view.className = 'treasure-view';\n\n        if (!room) {\n            view.innerHTML = '<p>No room</p>';\n            return view;\n        }\n\n        const unusedInteractables = room.interactables.filter(i => !i.used);\n        const hasUnopened = unusedInteractables.length > 0;\n\n        view.innerHTML = `\n            <div class=\"treasure-header\">\n                <span class=\"treasure-icon\">\uD83D\uDC8E</span>\n                <h2 class=\"treasure-title\">Treasure Chamber</h2>\n            </div>\n            <p class=\"treasure-description\">${room.description || 'A room filled with glittering treasures...'}</p>\n        `;\n\n        if (hasUnopened) {\n            const interactablesContainer = document.createElement('div');\n            interactablesContainer.className = 'interactables-grid';\n\n            room.interactables.forEach((interactable, index) => {\n                const el = document.createElement('div');\n                el.className = `interactable-card ${interactable.used ? 'used' : 'available'}`;\n                el.innerHTML = `\n                    <span class=\"interactable-icon\">${this.getInteractableIcon(interactable.type)}</span>\n                    <span class=\"interactable-name\">${interactable.name}</span>\n                    ${!interactable.used ? `\n                        <button class=\"interact-btn\" \n                                data-action=\"interact\" \n                                data-index=\"${index}\">\n                            ${this.getInteractableAction(interactable.type)}\n                        </button>\n                    ` : '<span class=\"used-label\">Used</span>'}\n                `;\n                interactablesContainer.appendChild(el);\n            });\n\n            view.appendChild(interactablesContainer);\n        } else {\n            view.innerHTML += '<p class=\"no-treasures\">All treasures have been claimed.</p>';\n        }\n\n        // Leave button\n        const leaveBtn = document.createElement('button');\n        leaveBtn.className = 'leave-treasure-btn';\n        leaveBtn.textContent = 'Leave Room';\n        leaveBtn.dataset.action = 'leave';\n        view.appendChild(leaveBtn);\n\n        // Add click handlers\n        view.addEventListener('click', (e) => {\n            const target = e.target as HTMLElement;\n            const action = target.dataset.action;\n            \n            if (action === 'interact' && this.actionResolver) {\n                const index = parseInt(target.dataset.index || '0', 10);\n                this.actionResolver({ type: 'interact', interactableIndex: index });\n            } else if (action === 'leave' && this.actionResolver) {\n                this.actionResolver({ type: 'leave' });\n            }\n        });\n\n        return view;\n    }\n\n    /**\n     * Gets the action verb for an interactable type.\n     */\n    private getInteractableAction(type: string): string {\n        switch (type) {\n            case 'chest': return 'Open';\n            case 'trap': return 'Disarm';\n            case 'altar': return 'Pray';\n            case 'lever': return 'Pull';\n            case 'npc': return 'Talk';\n            default: return 'Interact';\n        }\n    }\n\n    /**\n     * Creates the shop view showing items for sale and player inventory.\n     */\n    private createShopView(state: GameState, room: Room): HTMLElement {\n        const view = document.createElement('div');\n        view.className = 'shop-view';\n\n        const player = state.player;\n        if (!player || !room.shopInventory) {\n            view.innerHTML = '<p>Shop not available</p>';\n            return view;\n        }\n\n        view.innerHTML = `\n            <div class=\"shop-header\">\n                <span class=\"shop-icon\">\uD83C\uDFEA</span>\n                <h2 class=\"shop-title\">Merchant's Wares</h2>\n                <div class=\"player-gold\">\n                    <span class=\"gold-icon\">G</span>\n                    <span class=\"gold-amount\">${player.gold}</span>\n                </div>\n            </div>\n            <p class=\"shop-description\">\"Welcome, adventurer! Browse my finest goods...\"</p>\n        `;\n\n        const shopContent = document.createElement('div');\n        shopContent.className = 'shop-content';\n\n        // Items for sale section\n        const forSaleSection = document.createElement('div');\n        forSaleSection.className = 'shop-section for-sale';\n        forSaleSection.innerHTML = `<h3>For Sale</h3>`;\n\n        const forSaleGrid = document.createElement('div');\n        forSaleGrid.className = 'shop-grid';\n\n        if (room.shopInventory.length === 0) {\n            forSaleGrid.innerHTML = '<p class=\"empty-shop\">Sold out!</p>';\n        } else {\n            room.shopInventory.forEach(shopItem => {\n                const canAfford = player.gold >= shopItem.buyPrice;\n                const itemImg = getItemImage(shopItem.item.type, shopItem.item.rarity, 48);\n                const itemEl = document.createElement('div');\n                itemEl.className = `shop-item ${canAfford ? 'affordable' : 'too-expensive'} item-${shopItem.item.type.toLowerCase()} rarity-${shopItem.item.rarity.toLowerCase()}`;\n                itemEl.innerHTML = `\n                    <img src=\"${itemImg}\" alt=\"${shopItem.item.name}\" class=\"shop-item-image\" />\n                    <div class=\"item-info\">\n                        <span class=\"item-name\">${shopItem.item.name}</span>\n                        <span class=\"item-type\">${shopItem.item.type}</span>\n                        ${shopItem.item.description ? `<span class=\"item-desc\">${shopItem.item.description}</span>` : ''}\n                    </div>\n                    <div class=\"item-price\">\n                        <span class=\"price-amount\">${shopItem.buyPrice}</span>\n                        <span class=\"price-label\">gold</span>\n                    </div>\n                    <button class=\"buy-btn ${canAfford ? '' : 'disabled'}\" \n                            data-action=\"buy_item\" \n                            data-item-id=\"${shopItem.item.id}\"\n                            ${canAfford ? '' : 'disabled'}>\n                        ${canAfford ? 'Buy' : 'Cannot Afford'}\n                    </button>\n                `;\n                forSaleGrid.appendChild(itemEl);\n            });\n        }\n\n        forSaleSection.appendChild(forSaleGrid);\n        shopContent.appendChild(forSaleSection);\n\n        // Player inventory for selling\n        const sellSection = document.createElement('div');\n        sellSection.className = 'shop-section for-sell';\n        sellSection.innerHTML = `<h3>Your Items</h3>`;\n\n        const sellGrid = document.createElement('div');\n        sellGrid.className = 'shop-grid';\n\n        if (player.inventory.length === 0) {\n            sellGrid.innerHTML = '<p class=\"empty-inventory\">No items to sell</p>';\n        } else {\n            player.inventory.forEach(item => {\n                const sellPrice = Math.floor(item.value * 0.5);\n                const itemImg = getItemImage(item.type, item.rarity, 48);\n                const itemEl = document.createElement('div');\n                itemEl.className = `shop-item sellable item-${item.type.toLowerCase()} rarity-${item.rarity.toLowerCase()}`;\n                itemEl.innerHTML = `\n                    <img src=\"${itemImg}\" alt=\"${item.name}\" class=\"shop-item-image\" />\n                    <div class=\"item-info\">\n                        <span class=\"item-name\">${item.name}</span>\n                        <span class=\"item-type\">${item.type}</span>\n                    </div>\n                    <div class=\"item-price sell-price\">\n                        <span class=\"price-amount\">${sellPrice}</span>\n                        <span class=\"price-label\">gold</span>\n                    </div>\n                    <button class=\"sell-btn\" \n                            data-action=\"sell_item\" \n                            data-item-id=\"${item.id}\">\n                        Sell\n                    </button>\n                `;\n                sellGrid.appendChild(itemEl);\n            });\n        }\n\n        sellSection.appendChild(sellGrid);\n        shopContent.appendChild(sellSection);\n\n        view.appendChild(shopContent);\n\n        // Add click handlers for buy/sell buttons\n        view.addEventListener('click', (e) => {\n            const target = e.target as HTMLElement;\n            const action = target.dataset.action;\n            const itemId = target.dataset.itemId;\n\n            if (action && itemId && this.actionResolver) {\n                this.actionResolver({ type: action, itemId });\n            }\n        });\n\n        return view;\n    }\n\n    /**\n     * Creates the combat view showing enemies and combat state.\n     */\n    private createCombatView(state: GameState, room: Room | null): HTMLElement {\n        const view = document.createElement('div');\n        view.className = 'combat-view';\n\n        if (!room || !room.enemies) {\n            view.innerHTML = '<p>No enemies</p>';\n            return view;\n        }\n\n        view.innerHTML = `\n            <div class=\"combat-header\">\n                <h2>Combat!</h2>\n            </div>\n        `;\n\n        // Enemy list\n        const enemiesDiv = document.createElement('div');\n        enemiesDiv.className = 'enemies-list';\n\n        room.enemies.forEach((enemy, index) => {\n            const enemyCard = document.createElement('div');\n            enemyCard.className = `enemy-card ${enemy.health <= 0 ? 'defeated' : ''}`;\n            enemyCard.dataset.enemyId = enemy.id;\n\n            const hpPercent = (enemy.health / enemy.maxHealth) * 100;\n            // Use API image if available, otherwise use placeholder SVG\n            const placeholderImage = getMonsterImage(enemy.type, enemy.name, 120);\n            const enemyImage = enemy.imageUrl || placeholderImage;\n            \n            enemyCard.innerHTML = `\n                <img src=\"${enemyImage}\" \n                     alt=\"${enemy.name}\" \n                     class=\"enemy-image ${enemy.imageUrl ? 'api-image' : 'placeholder-image'}\"\n                     onerror=\"this.src='${placeholderImage}'; this.classList.remove('api-image'); this.classList.add('placeholder-image');\" />\n                <div class=\"enemy-header\">\n                    <span class=\"enemy-name\">${enemy.name}</span>\n                    <span class=\"enemy-cr\">CR ${enemy.challengeRating}</span>\n                </div>\n                <div class=\"enemy-hp-bar\">\n                    <div class=\"enemy-hp-fill\" style=\"width: ${hpPercent}%\"></div>\n                    <span class=\"enemy-hp-text\">${enemy.health}/${enemy.maxHealth}</span>\n                </div>\n                <div class=\"enemy-stats\">\n                    <span>ATK<br/>${enemy.attackPower}</span>\n                    <span>DEF<br/>${enemy.defense}</span>\n                </div>\n            `;\n\n            enemiesDiv.appendChild(enemyCard);\n        });\n\n        view.appendChild(enemiesDiv);\n\n        return view;\n    }\n\n    /**\n     * Renders action buttons in the action area.\n     */\n    private renderActionButtons(actions: Action[]): void {\n        const actionArea = this.container.querySelector('#action-area');\n        if (!actionArea) return;\n\n        actionArea.innerHTML = '<h3>Actions</h3>';\n\n        const buttonContainer = document.createElement('div');\n        buttonContainer.className = 'action-buttons';\n\n        actions.forEach((action, index) => {\n            const button = document.createElement('button');\n            button.className = `action-btn action-${action.type}`;\n            button.innerHTML = `\n                <span class=\"action-key\">${index + 1}</span>\n                <span class=\"action-label\">${this.getActionLabel(action)}</span>\n            `;\n            \n            button.addEventListener('click', () => {\n                if (this.actionResolver) {\n                    this.actionResolver(action);\n                    this.actionResolver = null;\n                }\n            });\n\n            buttonContainer.appendChild(button);\n        });\n\n        actionArea.appendChild(buttonContainer);\n    }\n\n    /**\n     * Renders target selection overlay for combat.\n     */\n    private renderTargetSelection(validTargets: string[]): void {\n        const state = this.getState();\n        const room = this.getCurrentRoom(state);\n        if (!room || !room.enemies) return;\n\n        const overlay = document.createElement('div');\n        overlay.className = 'target-overlay';\n        overlay.innerHTML = '<h3>Select Target</h3>';\n\n        const targetList = document.createElement('div');\n        targetList.className = 'target-list';\n\n        validTargets.forEach(targetId => {\n            const enemy = room.enemies?.find(e => e.id === targetId);\n            if (!enemy) return;\n\n            const targetBtn = document.createElement('button');\n            targetBtn.className = 'target-btn';\n            targetBtn.innerHTML = `\n                <span class=\"target-name\">${enemy.name}</span>\n                <span class=\"target-hp\">${enemy.health}/${enemy.maxHealth} HP</span>\n            `;\n\n            targetBtn.addEventListener('click', () => {\n                if (this.targetResolver) {\n                    this.targetResolver(targetId);\n                    this.targetResolver = null;\n                    overlay.remove();\n                }\n            });\n\n            targetList.appendChild(targetBtn);\n        });\n\n        overlay.appendChild(targetList);\n        this.container.appendChild(overlay);\n    }\n\n    /**\n     * Displays available actions (called by base GameLoop).\n     */\n    protected displayActions(actions: Action[]): void {\n        // Actions are rendered in getPlayerInput\n    }\n\n    /**\n     * Displays the result of an action with formatted names.\n     */\n    protected displayResult(result: ActionResult): void {\n        if (result.message) {\n            // Format the message based on action type\n            let formattedMessage = result.message;\n            \n            // Format item names in messages\n            if (result.result?.item) {\n                const item = result.result.item;\n                const itemName = this.formatItemName(item.name, item.rarity);\n                formattedMessage = formattedMessage.replace(item.name, itemName);\n            }\n            \n            // Format gold amounts\n            if (result.result?.gold !== undefined) {\n                const goldAmount = Math.abs(result.result.gold);\n                formattedMessage = formattedMessage.replace(\n                    new RegExp(`${goldAmount}\\\\s*gold`, 'gi'),\n                    `${this.formatName(goldAmount.toString(), 'gold')} gold`\n                );\n            }\n            \n            // Format specific action types\n            switch (result.type) {\n                case 'item_bought':\n                case 'item_sold':\n                case 'item_equipped':\n                case 'item_unequipped':\n                case 'item_used':\n                    // Already formatted above\n                    break;\n                case 'rested':\n                    formattedMessage = `${this.formatName('Rested', 'heal')}: ${result.message}`;\n                    break;\n                case 'flee':\n                    if (result.success) {\n                        formattedMessage = `${this.formatName('Escaped!', 'heal')} You fled from combat.`;\n                    } else {\n                        formattedMessage = `${this.formatName('Failed to escape!', 'damage')} The enemies block your path.`;\n                    }\n                    break;\n                case 'moved':\n                    formattedMessage = `Entered a new ${this.formatName('room', 'room')}.`;\n                    break;\n                case 'interacted':\n                    // Interaction results are already descriptive\n                    break;\n                case 'event':\n                    // Format event messages with appropriate styling\n                    formattedMessage = this.formatEventMessage(result.message);\n                    break;\n            }\n            \n            this.addLogMessage(formattedMessage);\n        }\n\n        // Re-render to show updated state\n        const state = this.getState();\n        this.render(state);\n    }\n\n    /**\n     * Displays current combat state.\n     */\n    protected displayCombatState(): void {\n        const state = this.getState();\n        this.render(state);\n    }\n\n    /**\n     * Displays status effect messages.\n     */\n    protected displayStatusEffectMessages(messages: string[]): void {\n        messages.forEach(msg => this.addLogMessage(msg));\n    }\n\n    /**\n     * Displays attack result with formatted names.\n     */\n    protected displayAttackResult(result: AttackResult): void {\n        const { attacker, defender, attackRoll, damage, defenderDied } = result;\n\n        // Determine if attacker is player or enemy\n        const attackerType = 'id' in attacker && typeof attacker.id === 'string' && attacker.id.includes('-') ? 'enemy' : 'player';\n        const defenderType = attackerType === 'player' ? 'enemy' : 'player';\n\n        const attackerName = this.formatName(attacker.name, attackerType as 'player' | 'enemy');\n        const defenderName = this.formatName(defender.name, defenderType as 'player' | 'enemy');\n\n        let message = `${attackerName} attacks ${defenderName}`;\n\n        if (attackRoll.isNatural20) {\n            message += ` - ${this.formatName('CRITICAL HIT!', 'crit')}`;\n        } else if (attackRoll.isNatural1) {\n            message += ` - ${this.formatName('Miss!', 'miss')}`;\n        } else if (!attackRoll.isHit) {\n            message += ` - ${this.formatName('Miss', 'miss')} (${attackRoll.total} vs ${attackRoll.targetDefense})`;\n        }\n\n        if (damage) {\n            message += ` for ${this.formatName(damage.finalDamage.toString(), 'damage')} damage`;\n            if (damage.isCritical) {\n                message += ` ${this.formatName('(crit!)', 'crit')}`;\n            }\n        }\n\n        if (defenderDied) {\n            message += ` - ${defenderName} ${this.formatName('defeated!', 'crit')}`;\n        }\n\n        this.addLogMessage(message);\n\n        // Re-render to show updated HP\n        const state = this.getState();\n        this.render(state);\n    }\n\n    /**\n     * Displays ability result with formatted names.\n     */\n    protected displayAbilityResult(result: AbilityResult): void {\n        const abilityName = this.formatName(result.abilityName, 'ability');\n        let message = result.message;\n\n        // Add additional context for different ability types\n        if (result.healing) {\n            message = `${abilityName}: Healed for ${this.formatName(result.healing.toString(), 'heal')} HP`;\n        } else if (result.damage) {\n            if (result.isAoe) {\n                message = `${abilityName}: Dealt ${this.formatName(result.damage.toString(), 'damage')} total damage to all enemies!`;\n            } else {\n                message = `${abilityName}: Dealt ${this.formatName(result.damage.toString(), 'damage')} damage`;\n            }\n        }\n\n        if (result.effectApplied) {\n            message += ` [${this.formatName(result.effectApplied, 'ability')}]`;\n        }\n\n        if (result.enemiesKilled.length > 0) {\n            const count = result.enemiesKilled.length;\n            message += ` - ${this.formatName(count.toString(), 'damage')} ${count === 1 ? 'enemy' : 'enemies'} ${this.formatName('defeated!', 'crit')}`;\n        }\n\n        this.addLogMessage(message);\n\n        // Re-render to show updated state\n        const state = this.getState();\n        this.render(state);\n    }\n\n    /**\n     * Displays room completion rewards.\n     */\n    protected displayRoomRewards(rewards: { gold: number; experience: number; items: Item[]; healthRestore?: number }): void {\n        // Victory message\n        this.addLogMessage(`${this.formatName('Victory!', 'crit')} You cleared the room!`);\n\n        // Gold reward\n        if (rewards.gold > 0) {\n            this.addLogMessage(`Received ${this.formatName(rewards.gold.toString(), 'gold')} gold`);\n        }\n\n        // Experience reward\n        if (rewards.experience > 0) {\n            this.addLogMessage(`Gained ${this.formatName(rewards.experience.toString(), 'ability')} XP`);\n        }\n\n        // Item rewards - list each item with rarity color\n        if (rewards.items.length > 0) {\n            const itemList = rewards.items.map(item => this.formatItemName(item.name, item.rarity)).join(', ');\n            this.addLogMessage(`Found: ${itemList}`);\n        }\n\n        // Health restore (from rest rooms)\n        if (rewards.healthRestore && rewards.healthRestore > 0) {\n            this.addLogMessage(`Restored ${this.formatName(rewards.healthRestore.toString(), 'heal')} HP`);\n        }\n\n        // Re-render to show updated state\n        const state = this.getState();\n        this.render(state);\n    }\n\n    /**\n     * Handles game over state.\n     */\n    protected handleGameOver(): void {\n        super.handleGameOver();\n        this.showEndScreen('Game Over', 'You have been defeated...');\n    }\n\n    /**\n     * Handles victory state.\n     */\n    protected handleVictory(): void {\n        super.handleVictory();\n        this.showEndScreen('Victory!', 'You have conquered the dungeon!');\n    }\n\n    /**\n     * Shows the end game screen.\n     */\n    private showEndScreen(title: string, message: string): void {\n        const state = this.getState();\n        \n        this.container.innerHTML = `\n            <div class=\"end-screen\">\n                <h1 class=\"end-title\">${title}</h1>\n                <p class=\"end-message\">${message}</p>\n                \n                <div class=\"end-stats\">\n                    <h3>Final Stats</h3>\n                    <div class=\"stat-row\">\n                        <span>Rooms Cleared:</span>\n                        <span>${state.stats.roomsCleared}</span>\n                    </div>\n                    <div class=\"stat-row\">\n                        <span>Enemies Defeated:</span>\n                        <span>${state.stats.enemiesDefeated}</span>\n                    </div>\n                    <div class=\"stat-row\">\n                        <span>Gold Collected:</span>\n                        <span>${state.stats.goldCollected}</span>\n                    </div>\n                    <div class=\"stat-row\">\n                        <span>Items Found:</span>\n                        <span>${state.stats.itemsFound}</span>\n                    </div>\n                </div>\n                \n                <button class=\"restart-btn\" onclick=\"location.reload()\">Play Again</button>\n            </div>\n        `;\n    }\n\n    // =========================================================================\n    // HELPER METHODS\n    // =========================================================================\n\n    /**\n     * Gets the current room from game state.\n     */\n    private getCurrentRoom(state: GameState): Room | null {\n        if (!state.dungeon.currentRoomId) return null;\n        return state.dungeon.rooms.get(state.dungeon.currentRoomId) ?? null;\n    }\n\n    /**\n     * Gets rooms connected to the given room.\n     */\n    private getConnectedRooms(state: GameState, room: Room): Room[] {\n        return room.connections\n            .map(id => state.dungeon.rooms.get(id))\n            .filter((r): r is Room => r !== undefined);\n    }\n\n    /**\n     * Adds a message to the log.\n     */\n    private addLogMessage(message: string): void {\n        this.messageLog.push(message);\n        if (this.messageLog.length > this.MAX_LOG_MESSAGES) {\n            this.messageLog.shift();\n        }\n    }\n\n    /**\n     * Gets XP needed for next level.\n     */\n    private getXPForNextLevel(player: Player): number {\n        const xpTable = [0, 100, 300, 600, 1000, 1500, 2100, 2800, 3600, 4500,\n            5500, 6600, 7800, 9100, 10500, 12000, 13600, 15300, 17100, 19000];\n        if (player.level >= 20) return xpTable[19];\n        return xpTable[player.level];\n    }\n\n    /**\n     * Gets XP progress percentage toward next level.\n     */\n    private getXPProgress(player: Player): number {\n        const xpTable = [0, 100, 300, 600, 1000, 1500, 2100, 2800, 3600, 4500,\n            5500, 6600, 7800, 9100, 10500, 12000, 13600, 15300, 17100, 19000];\n        if (player.level >= 20) return 100;\n        const currentLevelXP = player.level > 1 ? xpTable[player.level - 1] : 0;\n        const nextLevelXP = xpTable[player.level];\n        const progress = player.experience - currentLevelXP;\n        const needed = nextLevelXP - currentLevelXP;\n        return Math.min(100, (progress / needed) * 100);\n    }\n\n    /**\n     * Gets icon for room type.\n     */\n    private getRoomIcon(type: RoomType): string {\n        const icons: Record<RoomType, string> = {\n            [RoomType.ENTRANCE]: '&#128682;',\n            [RoomType.COMBAT]: '&#9876;',\n            [RoomType.ELITE]: '&#128128;',\n            [RoomType.BOSS]: '&#128123;',\n            [RoomType.TREASURE]: '&#128176;',\n            [RoomType.REST]: '&#128293;',\n            [RoomType.SHOP]: '&#127978;',\n            [RoomType.EVENT]: '&#10067;',\n            [RoomType.PUZZLE]: '&#128273;'\n        };\n        return icons[type] || '?';\n    }\n\n    /**\n     * Gets display title for room type.\n     */\n    private getRoomTitle(type: RoomType): string {\n        const titles: Record<RoomType, string> = {\n            [RoomType.ENTRANCE]: 'Dungeon Entrance',\n            [RoomType.COMBAT]: 'Combat Room',\n            [RoomType.ELITE]: 'Elite Encounter',\n            [RoomType.BOSS]: 'Boss Chamber',\n            [RoomType.TREASURE]: 'Treasure Room',\n            [RoomType.REST]: 'Rest Area',\n            [RoomType.SHOP]: 'Merchant',\n            [RoomType.EVENT]: 'Mysterious Event',\n            [RoomType.PUZZLE]: 'Puzzle Chamber'\n        };\n        return titles[type] || type;\n    }\n\n    /**\n     * Gets icon for interactable type.\n     */\n    private getInteractableIcon(type: string): string {\n        const icons: Record<string, string> = {\n            'chest': '&#128230;',\n            'trap': '&#9888;',\n            'altar': '&#9962;',\n            'lever': '&#128295;',\n            'npc': '&#128100;'\n        };\n        return icons[type] || '?';\n    }\n\n    /**\n     * Gets display label for an action.\n     */\n    private getActionLabel(action: Action): string {\n        switch (action.type) {\n            case 'move':\n                return `Go to ${this.getRoomTitle(action.roomType!)}`;\n            case 'interact':\n                return `Interact: ${action.name}`;\n            case 'basic_attack':\n                return 'Attack';\n            case 'ability':\n                return action.name || action.abilityId || 'Use Ability';\n            case 'use_item':\n                return `Use ${action.name || action.itemName}`;\n            case 'flee':\n                return 'Flee';\n            case 'rest':\n                return 'Rest';\n            case 'leave':\n            case 'leave_shop':\n                return 'Leave';\n            case 'open_inventory':\n                return 'Inventory';\n            case 'view_character':\n                return 'Character';\n            case 'restart':\n                return 'Restart';\n            case 'quit':\n                return 'Quit';\n            default:\n                return action.type;\n        }\n    }\n}\n\n", "/**\n * @fileoverview Web Entry Point for Dungeon Roguelike\n * \n * This module initializes the web-based game UI, handling:\n * - Character selection screen\n * - Game initialization\n * - Starting the WebGameLoop\n * \n * @module ui/webEntry\n */\n\nimport { WebGameLoop } from './WebGameLoop';\nimport { Fighter } from '../entities/fighter';\nimport { Warlock } from '../entities/warlock';\nimport { Player } from '../entities/player';\n\n/**\n * Main entry point for the web game.\n * Sets up event listeners and initializes the game when ready.\n */\nfunction initializeGame(): void {\n    const characterSelect = document.getElementById('character-select');\n    const loadingScreen = document.getElementById('loading-screen');\n    const gameScreen = document.getElementById('game-screen');\n    const startButton = document.getElementById('start-game') as HTMLButtonElement;\n    const nameInput = document.getElementById('player-name') as HTMLInputElement;\n    const seedInput = document.getElementById('game-seed') as HTMLInputElement;\n    const classCards = document.querySelectorAll('.class-card');\n\n    let selectedClass: 'fighter' | 'warlock' | null = null;\n\n    // Class selection handler\n    function selectClass(card: Element): void {\n        // Remove selection from all cards\n        classCards.forEach(c => c.classList.remove('selected'));\n        // Add selection to clicked card\n        card.classList.add('selected');\n        selectedClass = card.getAttribute('data-class') as 'fighter' | 'warlock';\n        updateStartButton();\n    }\n\n    // Class selection - click and keyboard support\n    classCards.forEach(card => {\n        card.addEventListener('click', () => selectClass(card));\n        card.addEventListener('keydown', (e) => {\n            if ((e as KeyboardEvent).key === 'Enter' || (e as KeyboardEvent).key === ' ') {\n                e.preventDefault();\n                selectClass(card);\n            }\n        });\n    });\n\n    // Name input validation\n    nameInput.addEventListener('input', updateStartButton);\n\n    function updateStartButton(): void {\n        const hasName = nameInput.value.trim().length > 0;\n        const hasClass = selectedClass !== null;\n        const shouldEnable = hasName && hasClass;\n        console.log('updateStartButton:', { hasName, hasClass, shouldEnable, nameValue: nameInput.value, selectedClass });\n        startButton.disabled = !shouldEnable;\n    }\n\n    // Start game button\n    startButton.addEventListener('click', async () => {\n        if (!selectedClass) return;\n\n        const playerName = nameInput.value.trim() || 'Hero';\n        const seed = seedInput.value.trim() || undefined;\n\n        // Show loading screen\n        characterSelect?.classList.add('hidden');\n        loadingScreen?.classList.remove('hidden');\n\n        try {\n            // Create player based on selected class\n            let player: Player;\n            if (selectedClass === 'fighter') {\n                player = new Fighter(playerName);\n            } else {\n                player = new Warlock(playerName);\n            }\n\n            // Small delay to show loading screen\n            await new Promise(resolve => setTimeout(resolve, 500));\n\n            // Hide loading, show game\n            loadingScreen?.classList.add('hidden');\n            gameScreen?.classList.remove('hidden');\n\n            // Initialize and start the game\n            const gameLoop = new WebGameLoop('game-screen');\n            await gameLoop.startGame(player, seed);\n\n        } catch (error) {\n            console.error('Failed to start game:', error);\n            loadingScreen?.classList.add('hidden');\n            characterSelect?.classList.remove('hidden');\n            alert('Failed to start game. Please try again.');\n        }\n    });\n\n    // Set default name and trigger update\n    nameInput.value = 'Hero';\n    // Dispatch input event to ensure the button state is updated\n    nameInput.dispatchEvent(new Event('input', { bubbles: true }));\n    updateStartButton();\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initializeGame);\n} else {\n    initializeGame();\n}\n\n"],
  "mappings": "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",
  "names": ["ItemRarity", "message"]
}
